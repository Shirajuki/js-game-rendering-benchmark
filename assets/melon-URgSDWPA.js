import{E as Rh}from"./engine-4ZHbU-ty.js";var ji={};/*!
 * melonJS Game Engine - v17.4.0
 * http://www.melonjs.org
 * melonjs is licensed under the MIT License.
 * http://www.opensource.org/licenses/mit-license
 * @copyright (C) 2011 - 2024 Olivier Biot (AltByte Pte Ltd)
 */var Pt=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function Ho(s){return s&&s.__esModule&&Object.prototype.hasOwnProperty.call(s,"default")?s.default:s}var Ee=function(s){return s&&s.Math===Math&&s},ft=Ee(typeof globalThis=="object"&&globalThis)||Ee(typeof window=="object"&&window)||Ee(typeof self=="object"&&self)||Ee(typeof Pt=="object"&&Pt)||Ee(typeof Pt=="object"&&Pt)||(function(){return this})()||Function("return this")(),cr={},Lt=function(s){try{return!!s()}catch{return!0}},Mh=Lt,se=!Mh(function(){return Object.defineProperty({},1,{get:function(){return 7}})[1]!==7}),Oh=Lt,Xo=!Oh(function(){var s=(function(){}).bind();return typeof s!="function"||s.hasOwnProperty("prototype")}),Lh=Xo,je=Function.prototype.call,dr=Lh?je.bind(je):function(){return je.apply(je,arguments)},Wo={},Yo={}.propertyIsEnumerable,qo=Object.getOwnPropertyDescriptor,Bh=qo&&!Yo.call({1:2},1);Wo.f=Bh?function(t){var e=qo(this,t);return!!e&&e.enumerable}:Yo;var Ko=function(s,t){return{enumerable:!(s&1),configurable:!(s&2),writable:!(s&4),value:t}},Zo=Xo,Qo=Function.prototype,Es=Qo.call,Dh=Zo&&Qo.bind.bind(Es,Es),mt=Zo?Dh:function(s){return function(){return Es.apply(s,arguments)}},Jo=mt,$h=Jo({}.toString),Nh=Jo("".slice),ta=function(s){return Nh($h(s),8,-1)},kh=mt,Fh=Lt,Vh=ta,Hi=Object,Uh=kh("".split),zh=Fh(function(){return!Hi("z").propertyIsEnumerable(0)})?function(s){return Vh(s)==="String"?Uh(s,""):Hi(s)}:Hi,ea=function(s){return s==null},Gh=ea,jh=TypeError,pr=function(s){if(Gh(s))throw new jh("Can't call method on "+s);return s},Hh=zh,Xh=pr,gr=function(s){return Hh(Xh(s))},Xi=typeof document=="object"&&document.all,_t=typeof Xi>"u"&&Xi!==void 0?function(s){return typeof s=="function"||s===Xi}:function(s){return typeof s=="function"},Wh=_t,Ti=function(s){return typeof s=="object"?s!==null:Wh(s)},Wi=ft,Yh=_t,qh=function(s){return Yh(s)?s:void 0},ia=function(s,t){return arguments.length<2?qh(Wi[s]):Wi[s]&&Wi[s][t]},Kh=mt,Zh=Kh({}.isPrototypeOf),Qh=typeof navigator<"u"&&String(navigator.userAgent)||"",sa=ft,Yi=Qh,Zr=sa.process,Qr=sa.Deno,Jr=Zr&&Zr.versions||Qr&&Qr.version,tn=Jr&&Jr.v8,pt,li;tn&&(pt=tn.split("."),li=pt[0]>0&&pt[0]<4?1:+(pt[0]+pt[1]));!li&&Yi&&(pt=Yi.match(/Edge\/(\d+)/),(!pt||pt[1]>=74)&&(pt=Yi.match(/Chrome\/(\d+)/),pt&&(li=+pt[1])));var Jh=li,en=Jh,tl=Lt,el=ft,il=el.String,ra=!!Object.getOwnPropertySymbols&&!tl(function(){var s=Symbol("symbol detection");return!il(s)||!(Object(s)instanceof Symbol)||!Symbol.sham&&en&&en<41}),sl=ra,na=sl&&!Symbol.sham&&typeof Symbol.iterator=="symbol",rl=ia,nl=_t,ol=Zh,al=na,hl=Object,oa=al?function(s){return typeof s=="symbol"}:function(s){var t=rl("Symbol");return nl(t)&&ol(t.prototype,hl(s))},ll=String,ul=function(s){try{return ll(s)}catch{return"Object"}},fl=_t,cl=ul,dl=TypeError,pl=function(s){if(fl(s))return s;throw new dl(cl(s)+" is not a function")},gl=pl,yl=ea,ml=function(s,t){var e=s[t];return yl(e)?void 0:gl(e)},qi=dr,Ki=_t,Zi=Ti,_l=TypeError,xl=function(s,t){var e,i;if(t==="string"&&Ki(e=s.toString)&&!Zi(i=qi(e,s))||Ki(e=s.valueOf)&&!Zi(i=qi(e,s))||t!=="string"&&Ki(e=s.toString)&&!Zi(i=qi(e,s)))return i;throw new _l("Can't convert object to primitive value")},aa={exports:{}},sn=ft,vl=Object.defineProperty,yr=function(s,t){try{vl(sn,s,{value:t,configurable:!0,writable:!0})}catch{sn[s]=t}return t},wl=ft,bl=yr,rn="__core-js_shared__",nn=aa.exports=wl[rn]||bl(rn,{});(nn.versions||(nn.versions=[])).push({version:"3.37.1",mode:"global",copyright:"© 2014-2024 Denis Pushkarev (zloirock.ru)",license:"https://github.com/zloirock/core-js/blob/v3.37.1/LICENSE",source:"https://github.com/zloirock/core-js"});var mr=aa.exports,on=mr,ha=function(s,t){return on[s]||(on[s]=t||{})},Tl=pr,El=Object,Al=function(s){return El(Tl(s))},Sl=mt,Cl=Al,Pl=Sl({}.hasOwnProperty),re=Object.hasOwn||function(t,e){return Pl(Cl(t),e)},Il=mt,Rl=0,Ml=Math.random(),Ol=Il(1 .toString),la=function(s){return"Symbol("+(s===void 0?"":s)+")_"+Ol(++Rl+Ml,36)},Ll=ft,Bl=ha,an=re,Dl=la,$l=ra,Nl=na,fe=Ll.Symbol,Qi=Bl("wks"),kl=Nl?fe.for||fe:fe&&fe.withoutSetter||Dl,_r=function(s){return an(Qi,s)||(Qi[s]=$l&&an(fe,s)?fe[s]:kl("Symbol."+s)),Qi[s]},Fl=dr,hn=Ti,ln=oa,Vl=ml,Ul=xl,zl=_r,Gl=TypeError,jl=zl("toPrimitive"),Hl=function(s,t){if(!hn(s)||ln(s))return s;var e=Vl(s,jl),i;if(e){if(t===void 0&&(t="default"),i=Fl(e,s,t),!hn(i)||ln(i))return i;throw new Gl("Can't convert object to primitive value")}return t===void 0&&(t="number"),Ul(s,t)},Xl=Hl,Wl=oa,ua=function(s){var t=Xl(s,"string");return Wl(t)?t:t+""},Yl=ft,un=Ti,As=Yl.document,ql=un(As)&&un(As.createElement),Kl=function(s){return ql?As.createElement(s):{}},Zl=se,Ql=Lt,Jl=Kl,fa=!Zl&&!Ql(function(){return Object.defineProperty(Jl("div"),"a",{get:function(){return 7}}).a!==7}),tu=se,eu=dr,iu=Wo,su=Ko,ru=gr,nu=ua,ou=re,au=fa,fn=Object.getOwnPropertyDescriptor;cr.f=tu?fn:function(t,e){if(t=ru(t),e=nu(e),au)try{return fn(t,e)}catch{}if(ou(t,e))return su(!eu(iu.f,t,e),t[e])};var Ei={},hu=se,lu=Lt,uu=hu&&lu(function(){return Object.defineProperty(function(){},"prototype",{value:42,writable:!1}).prototype!==42}),fu=Ti,cu=String,du=TypeError,ca=function(s){if(fu(s))return s;throw new du(cu(s)+" is not an object")},pu=se,gu=fa,yu=uu,He=ca,cn=ua,mu=TypeError,Ji=Object.defineProperty,_u=Object.getOwnPropertyDescriptor,ts="enumerable",es="configurable",is="writable";Ei.f=pu?yu?function(t,e,i){if(He(t),e=cn(e),He(i),typeof t=="function"&&e==="prototype"&&"value"in i&&is in i&&!i[is]){var r=_u(t,e);r&&r[is]&&(t[e]=i.value,i={configurable:es in i?i[es]:r[es],enumerable:ts in i?i[ts]:r[ts],writable:!1})}return Ji(t,e,i)}:Ji:function(t,e,i){if(He(t),e=cn(e),He(i),gu)try{return Ji(t,e,i)}catch{}if("get"in i||"set"in i)throw new mu("Accessors not supported");return"value"in i&&(t[e]=i.value),t};var xu=se,vu=Ei,wu=Ko,da=xu?function(s,t,e){return vu.f(s,t,wu(1,e))}:function(s,t,e){return s[t]=e,s},pa={exports:{}},Ss=se,bu=re,ga=Function.prototype,Tu=Ss&&Object.getOwnPropertyDescriptor,ya=bu(ga,"name"),Eu=ya&&(function(){}).name==="something",Au=ya&&(!Ss||Ss&&Tu(ga,"name").configurable),ma={PROPER:Eu,CONFIGURABLE:Au},Su=mt,Cu=_t,Cs=mr,Pu=Su(Function.toString);Cu(Cs.inspectSource)||(Cs.inspectSource=function(s){return Pu(s)});var Iu=Cs.inspectSource,Ru=ft,Mu=_t,dn=Ru.WeakMap,Ou=Mu(dn)&&/native code/.test(String(dn)),Lu=ha,Bu=la,pn=Lu("keys"),Du=function(s){return pn[s]||(pn[s]=Bu(s))},_a={},$u=Ou,xa=ft,Nu=da,ss=re,rs=mr,ku=Du,Fu=_a,gn="Object already initialized",yn=xa.TypeError,Vu=xa.WeakMap,Ps,ui,Is,Uu=function(s){return Is(s)?ui(s):Ps(s,{})};if($u||rs.state){var wt=rs.state||(rs.state=new Vu);wt.get=wt.get,wt.has=wt.has,wt.set=wt.set,Ps=function(s,t){if(wt.has(s))throw new yn(gn);return t.facade=s,wt.set(s,t),t},ui=function(s){return wt.get(s)||{}},Is=function(s){return wt.has(s)}}else{var oe=ku("state");Fu[oe]=!0,Ps=function(s,t){if(ss(s,oe))throw new yn(gn);return t.facade=s,Nu(s,oe,t),t},ui=function(s){return ss(s,oe)?s[oe]:{}},Is=function(s){return ss(s,oe)}}var zu={get:ui,enforce:Uu},xr=mt,Gu=Lt,ju=_t,Xe=re,Rs=se,Hu=ma.CONFIGURABLE,Xu=Iu,va=zu,Wu=va.enforce,Yu=va.get,mn=String,oi=Object.defineProperty,qu=xr("".slice),Ku=xr("".replace),Zu=xr([].join),Qu=Rs&&!Gu(function(){return oi(function(){},"length",{value:8}).length!==8}),Ju=String(String).split("String"),tf=pa.exports=function(s,t,e){qu(mn(t),0,7)==="Symbol("&&(t="["+Ku(mn(t),/^Symbol\(([^)]*)\).*$/,"$1")+"]"),e&&e.getter&&(t="get "+t),e&&e.setter&&(t="set "+t),(!Xe(s,"name")||Hu&&s.name!==t)&&(Rs?oi(s,"name",{value:t,configurable:!0}):s.name=t),Qu&&e&&Xe(e,"arity")&&s.length!==e.arity&&oi(s,"length",{value:e.arity});try{e&&Xe(e,"constructor")&&e.constructor?Rs&&oi(s,"prototype",{writable:!1}):s.prototype&&(s.prototype=void 0)}catch{}var i=Wu(s);return Xe(i,"source")||(i.source=Zu(Ju,typeof t=="string"?t:"")),s};Function.prototype.toString=tf(function(){return ju(this)&&Yu(this).source||Xu(this)},"toString");var ef=pa.exports,sf=_t,rf=Ei,nf=ef,of=yr,af=function(s,t,e,i){i||(i={});var r=i.enumerable,n=i.name!==void 0?i.name:t;if(sf(e)&&nf(e,n,i),i.global)r?s[t]=e:of(t,e);else{try{i.unsafe?s[t]&&(r=!0):delete s[t]}catch{}r?s[t]=e:rf.f(s,t,{value:e,enumerable:!1,configurable:!i.nonConfigurable,writable:!i.nonWritable})}return s},wa={},hf=Math.ceil,lf=Math.floor,uf=Math.trunc||function(t){var e=+t;return(e>0?lf:hf)(e)},ff=uf,ba=function(s){var t=+s;return t!==t||t===0?0:ff(t)},cf=ba,df=Math.max,pf=Math.min,gf=function(s,t){var e=cf(s);return e<0?df(e+t,0):pf(e,t)},yf=ba,mf=Math.min,_f=function(s){var t=yf(s);return t>0?mf(t,9007199254740991):0},xf=_f,vf=function(s){return xf(s.length)},wf=gr,bf=gf,Tf=vf,Ef=function(s){return function(t,e,i){var r=wf(t),n=Tf(r);if(n===0)return!s&&-1;var o=bf(i,n),h;if(s&&e!==e){for(;n>o;)if(h=r[o++],h!==h)return!0}else for(;n>o;o++)if((s||o in r)&&r[o]===e)return s||o||0;return!s&&-1}},Af={indexOf:Ef(!1)},Sf=mt,ns=re,Cf=gr,Pf=Af.indexOf,If=_a,_n=Sf([].push),Rf=function(s,t){var e=Cf(s),i=0,r=[],n;for(n in e)!ns(If,n)&&ns(e,n)&&_n(r,n);for(;t.length>i;)ns(e,n=t[i++])&&(~Pf(r,n)||_n(r,n));return r},Mf=["constructor","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"],Of=Rf,Lf=Mf,Bf=Lf.concat("length","prototype");wa.f=Object.getOwnPropertyNames||function(t){return Of(t,Bf)};var Ta={};Ta.f=Object.getOwnPropertySymbols;var Df=ia,$f=mt,Nf=wa,kf=Ta,Ff=ca,Vf=$f([].concat),Uf=Df("Reflect","ownKeys")||function(t){var e=Nf.f(Ff(t)),i=kf.f;return i?Vf(e,i(t)):e},xn=re,zf=Uf,Gf=cr,jf=Ei,Hf=function(s,t,e){for(var i=zf(t),r=jf.f,n=Gf.f,o=0;o<i.length;o++){var h=i[o];!xn(s,h)&&!(e&&xn(e,h))&&r(s,h,n(t,h))}},Xf=Lt,Wf=_t,Yf=/#|\.prototype\./,Ve=function(s,t){var e=Kf[qf(s)];return e===Qf?!0:e===Zf?!1:Wf(t)?Xf(t):!!t},qf=Ve.normalize=function(s){return String(s).replace(Yf,".").toLowerCase()},Kf=Ve.data={},Zf=Ve.NATIVE="N",Qf=Ve.POLYFILL="P",Jf=Ve,We=ft,tc=cr.f,ec=da,ic=af,sc=yr,rc=Hf,nc=Jf,Ue=function(s,t){var e=s.target,i=s.global,r=s.stat,n,o,h,l,f,d;if(i?o=We:r?o=We[e]||sc(e,{}):o=We[e]&&We[e].prototype,o)for(h in t){if(f=t[h],s.dontCallGetSet?(d=tc(o,h),l=d&&d.value):l=o[h],n=nc(i?h:e+(r?".":"#")+h,s.forced),!n&&l!==void 0){if(typeof f==typeof l)continue;rc(f,l)}(s.sham||l&&l.sham)&&ec(f,"sham",!0),ic(o,h,f,s)}},oc=Ue,os=ft;oc({global:!0,forced:os.globalThis!==os},{globalThis:os});var ac=_r,hc=ac("toStringTag"),Ea={};Ea[hc]="z";var lc=String(Ea)==="[object z]",uc=lc,fc=_t,ai=ta,cc=_r,dc=cc("toStringTag"),pc=Object,gc=ai((function(){return arguments})())==="Arguments",yc=function(s,t){try{return s[t]}catch{}},mc=uc?ai:function(s){var t,e,i;return s===void 0?"Undefined":s===null?"Null":typeof(e=yc(t=pc(s),dc))=="string"?e:gc?ai(t):(i=ai(t))==="Object"&&fc(t.callee)?"Arguments":i},_c=mc,xc=String,vc=function(s){if(_c(s)==="Symbol")throw new TypeError("Cannot convert a Symbol value to a string");return xc(s)},Aa=`	
\v\f\r                　\u2028\u2029\uFEFF`,wc=mt,bc=pr,Tc=vc,Ms=Aa,vn=wc("".replace),Ec=RegExp("^["+Ms+"]+"),Ac=RegExp("(^|[^"+Ms+"])["+Ms+"]+$"),wn=function(s){return function(t){var e=Tc(bc(t));return s&1&&(e=vn(e,Ec,"")),s&2&&(e=vn(e,Ac,"$1")),e}},Sa={start:wn(1),end:wn(2)},Sc=ma.PROPER,Cc=Lt,bn=Aa,Tn="​᠎",Ca=function(s){return Cc(function(){return!!bn[s]()||Tn[s]()!==Tn||Sc&&bn[s].name!==s})},Pc=Sa.start,Ic=Ca,Pa=Ic("trimStart")?function(){return Pc(this)}:"".trimStart,Rc=Ue,En=Pa;Rc({target:"String",proto:!0,name:"trimStart",forced:"".trimLeft!==En},{trimLeft:En});var Mc=Ue,An=Pa;Mc({target:"String",proto:!0,name:"trimStart",forced:"".trimStart!==An},{trimStart:An});var Oc=ft,Lc=mt,Ia=function(s,t){return Lc(Oc[s].prototype[t])},Bc=Ia;Bc("String","trimLeft");var Dc=Sa.end,$c=Ca,Ra=$c("trimEnd")?function(){return Dc(this)}:"".trimEnd,Nc=Ue,Sn=Ra;Nc({target:"String",proto:!0,name:"trimEnd",forced:"".trimRight!==Sn},{trimRight:Sn});var kc=Ue,Cn=Ra;kc({target:"String",proto:!0,name:"trimEnd",forced:"".trimEnd!==Cn},{trimEnd:Cn});var Fc=Ia;Fc("String","trimRight");typeof globalThis<"u"&&typeof globalThis.console>"u"&&(globalThis.console={},globalThis.console.log=function(){},globalThis.console.assert=function(){},globalThis.console.warn=function(){},globalThis.console.error=function(){alert(Array.prototype.slice.call(arguments).join(", "))});(()=>{function s(t,e,i,r,n){if(![t,e,i,r].every(m=>Number.isFinite(m)))return;n=c(n);let o,h,l,f;if(n.length===4)o=y(n[0]),h=y(n[1]),l=y(n[2]),f=y(n[3]);else if(n.length===3)o=y(n[0]),h=y(n[1]),f=y(n[1]),l=y(n[2]);else if(n.length===2)o=y(n[0]),l=y(n[0]),h=y(n[1]),f=y(n[1]);else if(n.length===1)o=y(n[0]),h=y(n[0]),l=y(n[0]),f=y(n[0]);else throw new Error(n.length+" is not a valid size for radii sequence.");const d=[o,h,l,f],a=d.find(({x:m,y:x})=>m<0||x<0);if(d.some(({x:m,y:x})=>!Number.isFinite(m)||!Number.isFinite(x)))return;if(a)throw new Error("Radius value "+a+" is negative.");_(d),i<0&&r<0?(this.moveTo(t-o.x,e),this.ellipse(t+i+h.x,e-h.y,h.x,h.y,0,-Math.PI*1.5,-Math.PI),this.ellipse(t+i+l.x,e+r+l.y,l.x,l.y,0,-Math.PI,-Math.PI/2),this.ellipse(t-f.x,e+r+f.y,f.x,f.y,0,-Math.PI/2,0),this.ellipse(t-o.x,e-o.y,o.x,o.y,0,0,-Math.PI/2)):i<0?(this.moveTo(t-o.x,e),this.ellipse(t+i+h.x,e+h.y,h.x,h.y,0,-Math.PI/2,-Math.PI,1),this.ellipse(t+i+l.x,e+r-l.y,l.x,l.y,0,-Math.PI,-Math.PI*1.5,1),this.ellipse(t-f.x,e+r-f.y,f.x,f.y,0,Math.PI/2,0,1),this.ellipse(t-o.x,e+o.y,o.x,o.y,0,0,-Math.PI/2,1)):r<0?(this.moveTo(t+o.x,e),this.ellipse(t+i-h.x,e-h.y,h.x,h.y,0,Math.PI/2,0,1),this.ellipse(t+i-l.x,e+r+l.y,l.x,l.y,0,0,-Math.PI/2,1),this.ellipse(t+f.x,e+r+f.y,f.x,f.y,0,-Math.PI/2,-Math.PI,1),this.ellipse(t+o.x,e-o.y,o.x,o.y,0,-Math.PI,-Math.PI*1.5,1)):(this.moveTo(t+o.x,e),this.ellipse(t+i-h.x,e+h.y,h.x,h.y,0,-Math.PI/2,0),this.ellipse(t+i-l.x,e+r-l.y,l.x,l.y,0,0,Math.PI/2),this.ellipse(t+f.x,e+r-f.y,f.x,f.y,0,Math.PI/2,Math.PI),this.ellipse(t+o.x,e+o.y,o.x,o.y,0,Math.PI,Math.PI*1.5)),this.closePath(),this.moveTo(t,e);function u(m){const{x,y:v,z:w,w:E}=m;return{x,y:v,z:w,w:E}}function c(m){const x=typeof m;return x==="undefined"||m===null?[0]:x==="function"?[NaN]:x==="object"?typeof m[Symbol.iterator]=="function"?[...m].map(v=>{const w=typeof v;return w==="undefined"||v===null?0:w==="function"?NaN:w==="object"?u(v):p(v)}):[u(m)]:[p(m)]}function p(m){return+m}function y(m){const x=p(m);return Number.isFinite(x)?{x,y:x}:Object(m)===m?{x:p(m.x||0),y:p(m.y||0)}:{x:NaN,y:NaN}}function _(m){const[x,v,w,E]=m,A=[Math.abs(i)/(x.x+v.x),Math.abs(r)/(v.y+w.y),Math.abs(i)/(w.x+E.x),Math.abs(r)/(x.y+E.y)],I=Math.min(...A);I<=1&&m.forEach(z=>{z.x*=I,z.y*=I})}}globalThis.CanvasRenderingContext2D&&typeof globalThis.Path2D.prototype.roundRect>"u"&&(globalThis.Path2D.prototype.roundRect=s),globalThis.CanvasRenderingContext2D&&typeof globalThis.CanvasRenderingContext2D.prototype.roundRect>"u"&&(globalThis.CanvasRenderingContext2D.prototype.roundRect=s),globalThis.OffscreenCanvasRenderingContext2D&&typeof globalThis.OffscreenCanvasRenderingContext2D.prototype.roundRect>"u"&&(globalThis.OffscreenCanvasRenderingContext2D.prototype.roundRect=s)})();var J=typeof globalThis<"u"&&globalThis||typeof self<"u"&&self||typeof global<"u"&&global||{},tt={searchParams:"URLSearchParams"in J,iterable:"Symbol"in J&&"iterator"in Symbol,blob:"FileReader"in J&&"Blob"in J&&(function(){try{return new Blob,!0}catch{return!1}})(),formData:"FormData"in J,arrayBuffer:"ArrayBuffer"in J};function Vc(s){return s&&DataView.prototype.isPrototypeOf(s)}if(tt.arrayBuffer)var Uc=["[object Int8Array]","[object Uint8Array]","[object Uint8ClampedArray]","[object Int16Array]","[object Uint16Array]","[object Int32Array]","[object Uint32Array]","[object Float32Array]","[object Float64Array]"],zc=ArrayBuffer.isView||function(s){return s&&Uc.indexOf(Object.prototype.toString.call(s))>-1};function xe(s){if(typeof s!="string"&&(s=String(s)),/[^a-z0-9\-#$%&'*+.^_`|~!]/i.test(s)||s==="")throw new TypeError('Invalid character in header field name: "'+s+'"');return s.toLowerCase()}function vr(s){return typeof s!="string"&&(s=String(s)),s}function wr(s){var t={next:function(){var e=s.shift();return{done:e===void 0,value:e}}};return tt.iterable&&(t[Symbol.iterator]=function(){return t}),t}function Z(s){this.map={},s instanceof Z?s.forEach(function(t,e){this.append(e,t)},this):Array.isArray(s)?s.forEach(function(t){if(t.length!=2)throw new TypeError("Headers constructor: expected name/value pair to be length 2, found"+t.length);this.append(t[0],t[1])},this):s&&Object.getOwnPropertyNames(s).forEach(function(t){this.append(t,s[t])},this)}Z.prototype.append=function(s,t){s=xe(s),t=vr(t);var e=this.map[s];this.map[s]=e?e+", "+t:t};Z.prototype.delete=function(s){delete this.map[xe(s)]};Z.prototype.get=function(s){return s=xe(s),this.has(s)?this.map[s]:null};Z.prototype.has=function(s){return this.map.hasOwnProperty(xe(s))};Z.prototype.set=function(s,t){this.map[xe(s)]=vr(t)};Z.prototype.forEach=function(s,t){for(var e in this.map)this.map.hasOwnProperty(e)&&s.call(t,this.map[e],e,this)};Z.prototype.keys=function(){var s=[];return this.forEach(function(t,e){s.push(e)}),wr(s)};Z.prototype.values=function(){var s=[];return this.forEach(function(t){s.push(t)}),wr(s)};Z.prototype.entries=function(){var s=[];return this.forEach(function(t,e){s.push([e,t])}),wr(s)};tt.iterable&&(Z.prototype[Symbol.iterator]=Z.prototype.entries);function as(s){if(!s._noBody){if(s.bodyUsed)return Promise.reject(new TypeError("Already read"));s.bodyUsed=!0}}function Ma(s){return new Promise(function(t,e){s.onload=function(){t(s.result)},s.onerror=function(){e(s.error)}})}function Gc(s){var t=new FileReader,e=Ma(t);return t.readAsArrayBuffer(s),e}function jc(s){var t=new FileReader,e=Ma(t),i=/charset=([A-Za-z0-9_-]+)/.exec(s.type),r=i?i[1]:"utf-8";return t.readAsText(s,r),e}function Hc(s){for(var t=new Uint8Array(s),e=new Array(t.length),i=0;i<t.length;i++)e[i]=String.fromCharCode(t[i]);return e.join("")}function Pn(s){if(s.slice)return s.slice(0);var t=new Uint8Array(s.byteLength);return t.set(new Uint8Array(s)),t.buffer}function Oa(){return this.bodyUsed=!1,this._initBody=function(s){this.bodyUsed=this.bodyUsed,this._bodyInit=s,s?typeof s=="string"?this._bodyText=s:tt.blob&&Blob.prototype.isPrototypeOf(s)?this._bodyBlob=s:tt.formData&&FormData.prototype.isPrototypeOf(s)?this._bodyFormData=s:tt.searchParams&&URLSearchParams.prototype.isPrototypeOf(s)?this._bodyText=s.toString():tt.arrayBuffer&&tt.blob&&Vc(s)?(this._bodyArrayBuffer=Pn(s.buffer),this._bodyInit=new Blob([this._bodyArrayBuffer])):tt.arrayBuffer&&(ArrayBuffer.prototype.isPrototypeOf(s)||zc(s))?this._bodyArrayBuffer=Pn(s):this._bodyText=s=Object.prototype.toString.call(s):(this._noBody=!0,this._bodyText=""),this.headers.get("content-type")||(typeof s=="string"?this.headers.set("content-type","text/plain;charset=UTF-8"):this._bodyBlob&&this._bodyBlob.type?this.headers.set("content-type",this._bodyBlob.type):tt.searchParams&&URLSearchParams.prototype.isPrototypeOf(s)&&this.headers.set("content-type","application/x-www-form-urlencoded;charset=UTF-8"))},tt.blob&&(this.blob=function(){var s=as(this);if(s)return s;if(this._bodyBlob)return Promise.resolve(this._bodyBlob);if(this._bodyArrayBuffer)return Promise.resolve(new Blob([this._bodyArrayBuffer]));if(this._bodyFormData)throw new Error("could not read FormData body as blob");return Promise.resolve(new Blob([this._bodyText]))}),this.arrayBuffer=function(){if(this._bodyArrayBuffer){var s=as(this);return s||(ArrayBuffer.isView(this._bodyArrayBuffer)?Promise.resolve(this._bodyArrayBuffer.buffer.slice(this._bodyArrayBuffer.byteOffset,this._bodyArrayBuffer.byteOffset+this._bodyArrayBuffer.byteLength)):Promise.resolve(this._bodyArrayBuffer))}else{if(tt.blob)return this.blob().then(Gc);throw new Error("could not read as ArrayBuffer")}},this.text=function(){var s=as(this);if(s)return s;if(this._bodyBlob)return jc(this._bodyBlob);if(this._bodyArrayBuffer)return Promise.resolve(Hc(this._bodyArrayBuffer));if(this._bodyFormData)throw new Error("could not read FormData body as text");return Promise.resolve(this._bodyText)},tt.formData&&(this.formData=function(){return this.text().then(Yc)}),this.json=function(){return this.text().then(JSON.parse)},this}var Xc=["CONNECT","DELETE","GET","HEAD","OPTIONS","PATCH","POST","PUT","TRACE"];function Wc(s){var t=s.toUpperCase();return Xc.indexOf(t)>-1?t:s}function Kt(s,t){if(!(this instanceof Kt))throw new TypeError('Please use the "new" operator, this DOM object constructor cannot be called as a function.');t=t||{};var e=t.body;if(s instanceof Kt){if(s.bodyUsed)throw new TypeError("Already read");this.url=s.url,this.credentials=s.credentials,t.headers||(this.headers=new Z(s.headers)),this.method=s.method,this.mode=s.mode,this.signal=s.signal,!e&&s._bodyInit!=null&&(e=s._bodyInit,s.bodyUsed=!0)}else this.url=String(s);if(this.credentials=t.credentials||this.credentials||"same-origin",(t.headers||!this.headers)&&(this.headers=new Z(t.headers)),this.method=Wc(t.method||this.method||"GET"),this.mode=t.mode||this.mode||null,this.signal=t.signal||this.signal||(function(){if("AbortController"in J){var n=new AbortController;return n.signal}})(),this.referrer=null,(this.method==="GET"||this.method==="HEAD")&&e)throw new TypeError("Body not allowed for GET or HEAD requests");if(this._initBody(e),(this.method==="GET"||this.method==="HEAD")&&(t.cache==="no-store"||t.cache==="no-cache")){var i=/([?&])_=[^&]*/;if(i.test(this.url))this.url=this.url.replace(i,"$1_="+new Date().getTime());else{var r=/\?/;this.url+=(r.test(this.url)?"&":"?")+"_="+new Date().getTime()}}}Kt.prototype.clone=function(){return new Kt(this,{body:this._bodyInit})};function Yc(s){var t=new FormData;return s.trim().split("&").forEach(function(e){if(e){var i=e.split("="),r=i.shift().replace(/\+/g," "),n=i.join("=").replace(/\+/g," ");t.append(decodeURIComponent(r),decodeURIComponent(n))}}),t}function qc(s){var t=new Z,e=s.replace(/\r?\n[\t ]+/g," ");return e.split("\r").map(function(i){return i.indexOf(`
`)===0?i.substr(1,i.length):i}).forEach(function(i){var r=i.split(":"),n=r.shift().trim();if(n){var o=r.join(":").trim();try{t.append(n,o)}catch(h){console.warn("Response "+h.message)}}}),t}Oa.call(Kt.prototype);function St(s,t){if(!(this instanceof St))throw new TypeError('Please use the "new" operator, this DOM object constructor cannot be called as a function.');if(t||(t={}),this.type="default",this.status=t.status===void 0?200:t.status,this.status<200||this.status>599)throw new RangeError("Failed to construct 'Response': The status provided (0) is outside the range [200, 599].");this.ok=this.status>=200&&this.status<300,this.statusText=t.statusText===void 0?"":""+t.statusText,this.headers=new Z(t.headers),this.url=t.url||"",this._initBody(s)}Oa.call(St.prototype);St.prototype.clone=function(){return new St(this._bodyInit,{status:this.status,statusText:this.statusText,headers:new Z(this.headers),url:this.url})};St.error=function(){var s=new St(null,{status:200,statusText:""});return s.ok=!1,s.status=0,s.type="error",s};var Kc=[301,302,303,307,308];St.redirect=function(s,t){if(Kc.indexOf(t)===-1)throw new RangeError("Invalid status code");return new St(null,{status:t,headers:{location:s}})};var Wt=J.DOMException;try{new Wt}catch{Wt=function(t,e){this.message=t,this.name=e;var i=Error(t);this.stack=i.stack},Wt.prototype=Object.create(Error.prototype),Wt.prototype.constructor=Wt}function La(s,t){return new Promise(function(e,i){var r=new Kt(s,t);if(r.signal&&r.signal.aborted)return i(new Wt("Aborted","AbortError"));var n=new XMLHttpRequest;function o(){n.abort()}n.onload=function(){var f={statusText:n.statusText,headers:qc(n.getAllResponseHeaders()||"")};r.url.indexOf("file://")===0&&(n.status<200||n.status>599)?f.status=200:f.status=n.status,f.url="responseURL"in n?n.responseURL:f.headers.get("X-Request-URL");var d="response"in n?n.response:n.responseText;setTimeout(function(){e(new St(d,f))},0)},n.onerror=function(){setTimeout(function(){i(new TypeError("Network request failed"))},0)},n.ontimeout=function(){setTimeout(function(){i(new TypeError("Network request timed out"))},0)},n.onabort=function(){setTimeout(function(){i(new Wt("Aborted","AbortError"))},0)};function h(f){try{return f===""&&J.location.href?J.location.href:f}catch{return f}}if(n.open(r.method,h(r.url),!0),r.credentials==="include"?n.withCredentials=!0:r.credentials==="omit"&&(n.withCredentials=!1),"responseType"in n&&(tt.blob?n.responseType="blob":tt.arrayBuffer&&(n.responseType="arraybuffer")),t&&typeof t.headers=="object"&&!(t.headers instanceof Z||J.Headers&&t.headers instanceof J.Headers)){var l=[];Object.getOwnPropertyNames(t.headers).forEach(function(f){l.push(xe(f)),n.setRequestHeader(f,vr(t.headers[f]))}),r.headers.forEach(function(f,d){l.indexOf(d)===-1&&n.setRequestHeader(d,f)})}else r.headers.forEach(function(f,d){n.setRequestHeader(d,f)});r.signal&&(r.signal.addEventListener("abort",o),n.onreadystatechange=function(){n.readyState===4&&r.signal.removeEventListener("abort",o)}),n.send(typeof r._bodyInit>"u"?null:r._bodyInit)})}La.polyfill=!0;J.fetch||(J.fetch=La,J.Headers=Z,J.Request=Kt,J.Response=St);const Zc=Math.PI/180,Q=Math.PI*2,Ba=Math.PI*.5,Qc=1e-6;function ge(s){return(s&s-1)===0}function In(s){return s--,s|=s>>1,s|=s>>2,s|=s>>4,s|=s>>8,s|=s>>16,s++,s}function br(s){return s*Zc}function C(s,t,e){return s<t?t:s>e?e:+s}function hs(s,t){return~~(Math.random()*(t-s))+s}function ae(s,t){return Math.random()*(t-s)+s}function Rn(s,t,e=2){return Math.abs(s-t)<Math.pow(10,-e)/2}function it(s){return Math.pow(s,2)}class Jc{constructor(){this.objectClass={},this.instance_counter=0}register(t,e,i=!1){if(typeof e<"u")this.objectClass[t]={class:e,pool:i?[]:void 0};else throw new Error("Cannot register object '"+t+"', invalid class")}pull(t,...e){let i=this.objectClass[t];if(i){let r=i.class,n=i.pool,o;return n&&(o=n.pop())?(o.onResetEvent.apply(o,e),this.instance_counter--):(o=new(r.bind.apply(r,[r,...e])),n&&(o.className=t)),o}throw new Error("Cannot instantiate object of type '"+t+"'")}purge(){for(let t in this.objectClass)this.objectClass[t]&&(this.objectClass[t].pool=[]);this.instance_counter=0}push(t,e=!0){if(!this.poolable(t)){if(e===!0)throw new Error("me.pool: object "+t+" cannot be recycled");return!1}return this.objectClass[t.className].pool.push(t),this.instance_counter++,!0}exists(t){return t in this.objectClass}poolable(t){let e=t.className;return typeof e<"u"&&typeof t.onResetEvent=="function"&&e in this.objectClass&&typeof this.objectClass[e].pool<"u"}getInstanceCount(){return this.instance_counter}}let g=new Jc;const Mn=["0","1","2","3","4","5","6","7","8","9","A","B","C","D","E","F"];function Gt(s){return Mn[(s&240)>>4]+Mn[s&15]}function ls(s,t,e){return e<0&&(e+=1),e>1&&(e-=1),e<1/6?s+(t-s)*6*e:e<1/2?t:e<2/3?s+(t-s)*(2/3-e)*6:s}const td=/^rgba?\((\d+), ?(\d+), ?(\d+)(, ?([\d\.]+))?\)$/,ed=/^#([\da-fA-F])([\da-fA-F])([\da-fA-F])$/,id=/^#([\da-fA-F])([\da-fA-F])([\da-fA-F])([\da-fA-F])$/,sd=/^#([\da-fA-F]{2})([\da-fA-F]{2})([\da-fA-F]{2})$/,rd=/^#([\da-fA-F]{2})([\da-fA-F]{2})([\da-fA-F]{2})([\da-fA-F]{2})$/;let Os=new Map;[["black",[0,0,0]],["silver",[192,192,129]],["gray",[128,128,128]],["white",[255,255,255]],["maroon",[128,0,0]],["red",[255,0,0]],["purple",[128,0,128]],["fuchsia",[255,0,255]],["green",[0,128,0]],["lime",[0,255,0]],["olive",[128,128,0]],["yellow",[255,255,0]],["navy",[0,0,128]],["blue",[0,0,255]],["teal",[0,128,128]],["aqua",[0,255,255]],["orange",[255,165,0]],["aliceblue",[240,248,245]],["antiquewhite",[250,235,215]],["aquamarine",[127,255,212]],["azure",[240,255,255]],["beige",[245,245,220]],["bisque",[255,228,196]],["blanchedalmond",[255,235,205]],["blueviolet",[138,43,226]],["brown",[165,42,42]],["burlywood",[222,184,35]],["cadetblue",[95,158,160]],["chartreuse",[127,255,0]],["chocolate",[210,105,30]],["coral",[255,127,80]],["cornflowerblue",[100,149,237]],["cornsilk",[255,248,220]],["crimson",[220,20,60]],["darkblue",[0,0,139]],["darkcyan",[0,139,139]],["darkgoldenrod",[184,134,11]],["darkgray[*]",[169,169,169]],["darkgreen",[0,100,0]],["darkgrey[*]",[169,169,169]],["darkkhaki",[189,183,107]],["darkmagenta",[139,0,139]],["darkolivegreen",[85,107,47]],["darkorange",[255,140,0]],["darkorchid",[153,50,204]],["darkred",[139,0,0]],["darksalmon",[233,150,122]],["darkseagreen",[143,188,143]],["darkslateblue",[72,61,139]],["darkslategray",[47,79,79]],["darkslategrey",[47,79,79]],["darkturquoise",[0,206,209]],["darkviolet",[148,0,211]],["deeppink",[255,20,147]],["deepskyblue",[0,191,255]],["dimgray",[105,105,105]],["dimgrey",[105,105,105]],["dodgerblue",[30,144,255]],["firebrick",[178,34,34]],["floralwhite",[255,250,240]],["forestgreen",[34,139,34]],["gainsboro",[220,220,220]],["ghostwhite",[248,248,255]],["gold",[255,215,0]],["goldenrod",[218,165,32]],["greenyellow",[173,255,47]],["grey",[128,128,128]],["honeydew",[240,255,240]],["hotpink",[255,105,180]],["indianred",[205,92,92]],["indigo",[75,0,130]],["ivory",[255,255,240]],["khaki",[240,230,140]],["lavender",[230,230,250]],["lavenderblush",[255,240,245]],["lawngreen",[124,252,0]],["lemonchiffon",[255,250,205]],["lightblue",[173,216,230]],["lightcoral",[240,128,128]],["lightcyan",[224,255,255]],["lightgoldenrodyellow",[250,250,210]],["lightgray",[211,211,211]],["lightgreen",[144,238,144]],["lightgrey",[211,211,211]],["lightpink",[255,182,193]],["lightsalmon",[255,160,122]],["lightseagreen",[32,178,170]],["lightskyblue",[135,206,250]],["lightslategray",[119,136,153]],["lightslategrey",[119,136,153]],["lightsteelblue",[176,196,222]],["lightyellow",[255,255,224]],["limegreen",[50,205,50]],["linen",[250,240,230]],["mediumaquamarine",[102,205,170]],["mediumblue",[0,0,205]],["mediumorchid",[186,85,211]],["mediumpurple",[147,112,219]],["mediumseagreen",[60,179,113]],["mediumslateblue",[123,104,238]],["mediumspringgreen",[0,250,154]],["mediumturquoise",[72,209,204]],["mediumvioletred",[199,21,133]],["midnightblue",[25,25,112]],["mintcream",[245,255,250]],["mistyrose",[255,228,225]],["moccasin",[255,228,181]],["navajowhite",[255,222,173]],["oldlace",[253,245,230]],["olivedrab",[107,142,35]],["orangered",[255,69,0]],["orchid",[218,112,214]],["palegoldenrod",[238,232,170]],["palegreen",[152,251,152]],["paleturquoise",[175,238,238]],["palevioletred",[219,112,147]],["papayawhip",[255,239,213]],["peachpuff",[255,218,185]],["peru",[205,133,63]],["pink",[255,192,203]],["plum",[221,160,221]],["powderblue",[176,224,230]],["rosybrown",[188,143,143]],["royalblue",[65,105,225]],["saddlebrown",[139,69,19]],["salmon",[250,128,114]],["sandybrown",[244,164,96]],["seagreen",[46,139,87]],["seashell",[255,245,238]],["sienna",[160,82,45]],["skyblue",[135,206,235]],["slateblue",[106,90,205]],["slategray",[112,128,144]],["slategrey",[112,128,144]],["snow",[255,250,250]],["springgreen",[0,255,127]],["steelblue",[70,130,180]],["tan",[210,180,140]],["thistle",[216,191,216]],["tomato",[255,99,71]],["turquoise",[64,224,208]],["violet",[238,130,238]],["wheat",[245,222,179]],["whitesmoke",[245,245,245]],["yellowgreen",[154,205,50]]].forEach(s=>{Os.set(s[0],s[1])});class nt{constructor(t=0,e=0,i=0,r=1){this.onResetEvent(t,e,i,r)}onResetEvent(t=0,e=0,i=0,r=1){typeof this.glArray>"u"&&(this.glArray=new Float32Array([0,0,0,1])),this.setColor(t,e,i,r)}get r(){return~~(this.glArray[0]*255)}set r(t){this.glArray[0]=C(~~t||0,0,255)/255}get g(){return~~(this.glArray[1]*255)}set g(t){this.glArray[1]=C(~~t||0,0,255)/255}get b(){return~~(this.glArray[2]*255)}set b(t){this.glArray[2]=C(~~t||0,0,255)/255}get alpha(){return this.glArray[3]}set alpha(t=1){this.glArray[3]=C(+t,0,1)}setColor(t,e,i,r=1){return this.r=t,this.g=e,this.b=i,this.alpha=r,this}setFloat(t,e,i,r=1){const n=this.glArray;return n[0]=C(+t,0,1),n[1]=C(+e,0,1),n[2]=C(+i,0,1),n[3]=C(+r,0,1),this}setHSV(t,e,i){let r,n,o,h=Math.floor(t*6),l=t*6-h,f=i*(1-e),d=i*(1-l*e),a=i*(1-(1-l)*e);switch(h%6){case 0:r=i,n=a,o=f;break;case 1:r=d,n=i,o=f;break;case 2:r=f,n=i,o=a;break;case 3:r=f,n=d,o=i;break;case 4:r=a,n=f,o=i;break;case 5:r=i,n=f,o=d;break}return this.setColor(r*255,n*255,o*255)}setHSL(t,e,i){let r,n,o;if(e===0)r=n=o=i;else{let h=i<.5?i*(1+e):i+e-i*e,l=2*i-h;r=ls(l,h,t+1/3),n=ls(l,h,t),o=ls(l,h,t-1/3)}return this.setColor(r*255,n*255,o*255)}clone(){return g.pull("Color").copy(this)}copy(t){return typeof t=="string"?this.parseCSS(t):(this.glArray.set(t.glArray),this)}add(t){return this.glArray[0]=C(this.glArray[0]+t.glArray[0],0,1),this.glArray[1]=C(this.glArray[1]+t.glArray[1],0,1),this.glArray[2]=C(this.glArray[2]+t.glArray[2],0,1),this.glArray[3]=(this.glArray[3]+t.glArray[3])/2,this}darken(t){return t=C(t,0,1),this.glArray[0]*=t,this.glArray[1]*=t,this.glArray[2]*=t,this}lerp(t,e){return e=C(e,0,1),this.glArray[0]+=(t.glArray[0]-this.glArray[0])*e,this.glArray[1]+=(t.glArray[1]-this.glArray[1])*e,this.glArray[2]+=(t.glArray[2]-this.glArray[2])*e,this}lighten(t){return t=C(t,0,1),this.glArray[0]=C(this.glArray[0]+(1-this.glArray[0])*t,0,1),this.glArray[1]=C(this.glArray[1]+(1-this.glArray[1])*t,0,1),this.glArray[2]=C(this.glArray[2]+(1-this.glArray[2])*t,0,1),this}random(t=0,e=255){return t<0&&(t=0),e>255&&(e=255),this.setColor(hs(t,e),hs(t,e),hs(t,e),this.alpha)}equals(t){return this.glArray[0]===t.glArray[0]&&this.glArray[1]===t.glArray[1]&&this.glArray[2]===t.glArray[2]&&this.glArray[3]===t.glArray[3]}parseCSS(t){return Os.has(t)?this.setColor.apply(this,Os.get(t)):this.parseRGB(t)}parseRGB(t){let e=td.exec(t);return e?this.setColor(+e[1],+e[2],+e[3],+e[5]):this.parseHex(t)}parseHex(t,e=!1){let i;if(i=rd.exec(t))return this.setColor(parseInt(i[e===!1?1:2],16),parseInt(i[e===!1?2:3],16),parseInt(i[e===!1?3:4],16),(C(parseInt(i[e===!1?4:1],16),0,255)/255).toFixed(1));if(i=sd.exec(t))return this.setColor(parseInt(i[1],16),parseInt(i[2],16),parseInt(i[3],16));if(i=id.exec(t)){let r=i[e===!1?1:2],n=i[e===!1?2:3],o=i[e===!1?3:4],h=i[e===!1?4:1];return this.setColor(parseInt(r+r,16),parseInt(n+n,16),parseInt(o+o,16),(C(parseInt(h+h,16),0,255)/255).toFixed(1))}if(i=ed.exec(t))return this.setColor(parseInt(i[1]+i[1],16),parseInt(i[2]+i[2],16),parseInt(i[3]+i[3],16));throw new Error("invalid parameter: "+t)}toUint32(t=1){const e=this.glArray,i=e[0]*255>>0,r=e[1]*255>>0,n=e[2]*255>>0;return t*255>>0<<24|i<<16|r<<8|n}toArray(){return this.glArray}toHex(){return"#"+Gt(this.r)+Gt(this.g)+Gt(this.b)}toHex8(t=this.alpha){return"#"+Gt(this.r)+Gt(this.g)+Gt(this.b)+Gt(t*255)}toRGB(){return"rgb("+this.r+","+this.g+","+this.b+")"}toRGBA(t=this.alpha){return"rgba("+this.r+","+this.g+","+this.b+","+t+")"}}class M{constructor(t=0,e=0){this.onResetEvent(t,e)}onResetEvent(t=0,e=0){this.x=t,this.y=e}_set(t,e){return this.x=t,this.y=e,this}set(t,e){if(t!==+t||e!==+e)throw new Error("invalid x,y parameters (not a number)");return this._set(t,e)}setZero(){return this.set(0,0)}setV(t){return this._set(t.x,t.y)}add(t){return this._set(this.x+t.x,this.y+t.y)}sub(t){return this._set(this.x-t.x,this.y-t.y)}scale(t,e=t){return this._set(this.x*t,this.y*e)}toIso(){return this._set(this.x-this.y,(this.x+this.y)*.5)}to2d(){return this._set(this.y+this.x/2,this.y-this.x/2)}scaleV(t){return this._set(this.x*t.x,this.y*t.y)}div(t){return this._set(this.x/t,this.y/t)}abs(){return this._set(this.x<0?-this.x:this.x,this.y<0?-this.y:this.y)}clamp(t,e){return new M(C(this.x,t,e),C(this.y,t,e))}clampSelf(t,e){return this._set(C(this.x,t,e),C(this.y,t,e))}minV(t){return this._set(this.x<t.x?this.x:t.x,this.y<t.y?this.y:t.y)}maxV(t){return this._set(this.x>t.x?this.x:t.x,this.y>t.y?this.y:t.y)}floor(){return new M(Math.floor(this.x),Math.floor(this.y))}floorSelf(){return this._set(Math.floor(this.x),Math.floor(this.y))}ceil(){return new M(Math.ceil(this.x),Math.ceil(this.y))}ceilSelf(){return this._set(Math.ceil(this.x),Math.ceil(this.y))}negate(){return new M(-this.x,-this.y)}negateSelf(){return this._set(-this.x,-this.y)}copy(t){return this._set(t.x,t.y)}equals(...t){let e,i;return t.length===2?[e,i]=t:[e,i]=[t[0].x,t[0].y],this.x===e&&this.y===i}normalize(){return this.div(this.length()||1)}perp(){return this._set(this.y,-this.x)}rotate(t,e){let i=0,r=0;typeof e=="object"&&(i=e.x,r=e.y);let n=this.x-i,o=this.y-r,h=Math.cos(t),l=Math.sin(t);return this._set(n*h-o*l+i,n*l+o*h+r)}dot(t){return this.x*t.x+this.y*t.y}cross(t){return this.x*t.y-this.y*t.x}length2(){return this.dot(this)}length(){return Math.sqrt(this.length2())}lerp(t,e){return this.x+=(t.x-this.x)*e,this.y+=(t.y-this.y)*e,this}moveTowards(t,e){let i=Math.atan2(t.y-this.y,t.x-this.x),r=this.distance(t);return r===0||e>=0&&r<=e*e?t:(this.x+=Math.cos(i)*e,this.y+=Math.sin(i)*e,this)}distance(t){let e=this.x-t.x,i=this.y-t.y;return Math.sqrt(e*e+i*i)}angle(t){return Math.acos(C(this.dot(t)/(this.length()*t.length()),-1,1))}project(t){return this.scale(this.dot(t)/t.length2())}projectN(t){return this.scale(this.dot(t))}clone(){return g.pull("Vector2d",this.x,this.y)}toString(){return"x:"+this.x+",y:"+this.y}}class It{constructor(t=0,e=0,i=0){this.onResetEvent(t,e,i)}onResetEvent(t=0,e=0,i=0){this.x=t,this.y=e,this.z=i}_set(t,e,i=0){return this.x=t,this.y=e,this.z=i,this}set(t,e,i){if(t!==+t||e!==+e||typeof i<"u"&&i!==+i)throw new Error("invalid x, y, z parameters (not a number)");return this._set(t,e,i)}setZero(){return this.set(0,0,0)}setV(t){return this._set(t.x,t.y,t.z)}add(t){return this._set(this.x+t.x,this.y+t.y,this.z+(t.z||0))}sub(t){return this._set(this.x-t.x,this.y-t.y,this.z-(t.z||0))}scale(t,e=t,i=1){return this._set(this.x*t,this.y*e,this.z*i)}scaleV(t){return this.scale(t.x,t.y,t.z)}toIso(){return this._set(this.x-this.y,(this.x+this.y)*.5,this.z)}to2d(){return this._set(this.y+this.x/2,this.y-this.x/2,this.z)}div(t){return this._set(this.x/t,this.y/t,this.z/t)}abs(){return this._set(this.x<0?-this.x:this.x,this.y<0?-this.y:this.y,this.z<0?-this.z:this.z)}clamp(t,e){return new It(C(this.x,t,e),C(this.y,t,e),C(this.z,t,e))}clampSelf(t,e){return this._set(C(this.x,t,e),C(this.y,t,e),C(this.z,t,e))}minV(t){let e=t.z||0;return this._set(this.x<t.x?this.x:t.x,this.y<t.y?this.y:t.y,this.z<e?this.z:e)}maxV(t){let e=t.z||0;return this._set(this.x>t.x?this.x:t.x,this.y>t.y?this.y:t.y,this.z>e?this.z:e)}floor(){return new It(Math.floor(this.x),Math.floor(this.y),Math.floor(this.z))}floorSelf(){return this._set(Math.floor(this.x),Math.floor(this.y),Math.floor(this.z))}ceil(){return new It(Math.ceil(this.x),Math.ceil(this.y),Math.ceil(this.z))}ceilSelf(){return this._set(Math.ceil(this.x),Math.ceil(this.y),Math.ceil(this.z))}negate(){return new It(-this.x,-this.y,-this.z)}negateSelf(){return this._set(-this.x,-this.y,-this.z)}copy(t){return this._set(t.x,t.y,t.z||0)}equals(...t){let e,i,r;return t.length>=2?[e,i,r]=t:[e,i,r]=[t[0].x,t[0].y,t[0].z],typeof r>"u"&&(r=this.z),this.x===e&&this.y===i&&this.z===r}normalize(){return this.div(this.length()||1)}perp(){return this._set(this.y,-this.x,this.z)}rotate(t,e){let i=0,r=0;typeof e=="object"&&(i=e.x,r=e.y);let n=this.x-i,o=this.y-r,h=Math.cos(t),l=Math.sin(t);return this._set(n*h-o*l+i,n*l+o*h+r,this.z)}dot(t){return this.x*t.x+this.y*t.y+this.z*(typeof t.z<"u"?t.z:this.z)}cross(t){let e=this.x,i=this.y,r=this.z,n=t.x,o=t.y,h=t.z;return this.x=i*h-r*o,this.y=r*n-e*h,this.z=e*o-i*n,this}length2(){return this.dot(this)}length(){return Math.sqrt(this.length2())}lerp(t,e){return this.x+=(t.x-this.x)*e,this.y+=(t.y-this.y)*e,this.z+=(t.z-this.z)*e,this}moveTowards(t,e){let i=Math.atan2(t.y-this.y,t.x-this.x),r=this.x-t.x,n=this.y-t.y,o=Math.sqrt(r*r+n*n);return o===0||e>=0&&o<=e*e?t:(this.x+=Math.cos(i)*e,this.y+=Math.sin(i)*e,this)}distance(t){let e=this.x-t.x,i=this.y-t.y,r=this.z-(t.z||0);return Math.sqrt(e*e+i*i+r*r)}angle(t){return Math.acos(C(this.dot(t)/(this.length()*t.length()),-1,1))}project(t){let e=this.dot(t)/t.length2();return this.scale(e,e,e)}projectN(t){let e=this.dot(t)/t.length2();return this.scale(e,e,e)}clone(){return g.pull("Vector3d",this.x,this.y,this.z)}toString(){return"x:"+this.x+",y:"+this.y+",z:"+this.z}}class Rt extends M{constructor(t=0,e=0,i){if(super(t,e),typeof i>"u")throw new Error("undefined `onUpdate` callback");this.setCallback(i.onUpdate,i.scope)}onResetEvent(t=0,e=0,i){this.setMuted(t,e),typeof i<"u"&&this.setCallback(i.onUpdate,i.scope)}get x(){return this._x}set x(t){let e=this.onUpdate.call(this.scope,t,this._y,this._x,this._y);e&&"x"in e?this._x=e.x:this._x=t}get y(){return this._y}set y(t){let e=this.onUpdate.call(this.scope,this._x,t,this._x,this._y);e&&"y"in e?this._y=e.y:this._y=t}_set(t,e){let i=this.onUpdate.call(this.scope,t,e,this._x,this._y);return i&&"x"in i&&"y"in i?(this._x=i.x,this._y=i.y):(this._x=t,this._y=e),this}setMuted(t,e){return this._x=t,this._y=e,this}setCallback(t,e=null){if(typeof t!="function")throw new Error("invalid `onUpdate` callback");return this.onUpdate=t,this.scope=e,this}add(t){return this._set(this._x+t.x,this._y+t.y)}sub(t){return this._set(this._x-t.x,this._y-t.y)}scale(t,e=t){return this._set(this._x*t,this._y*e)}scaleV(t){return this._set(this._x*t.x,this._y*t.y)}div(t){return this._set(this._x/t,this._y/t)}abs(){return this._set(this._x<0?-this._x:this._x,this._y<0?-this._y:this._y)}clamp(t,e){return new Rt(C(this.x,t,e),C(this.y,t,e),{onUpdate:this.onUpdate,scope:this.scope})}clampSelf(t,e){return this._set(C(this._x,t,e),C(this._y,t,e))}minV(t){return this._set(this._x<t.x?this._x:t.x,this._y<t.y?this._y:t.y)}maxV(t){return this._set(this._x>t.x?this._x:t.x,this._y>t.y?this._y:t.y)}floor(){return new Rt(Math.floor(this._x),Math.floor(this._y),{onUpdate:this.onUpdate,scope:this.scope})}floorSelf(){return this._set(Math.floor(this._x),Math.floor(this._y))}ceil(){return new Rt(Math.ceil(this._x),Math.ceil(this._y),{onUpdate:this.onUpdate,scope:this.scope})}ceilSelf(){return this._set(Math.ceil(this._x),Math.ceil(this._y))}negate(){return new Rt(-this._x,-this._y,{onUpdate:this.onUpdate,scope:this.scope})}negateSelf(){return this._set(-this._x,-this._y)}copy(t){return this._set(t.x,t.y)}equals(t){return this._x===t.x&&this._y===t.y}perp(){return this._set(this._y,-this._x)}rotate(t,e){let i=0,r=0;typeof e=="object"&&(i=e.x,r=e.y);let n=this._x-i,o=this._y-r,h=Math.cos(t),l=Math.sin(t);return this._set(n*h-o*l+i,n*l+o*h+r)}dot(t){return this._x*t.x+this._y*t.y}cross(t){return this._x*t.y-this._y*t.x}lerp(t,e){return this._set(this._x+(t.x-this._x)*e,this._y+(t.y-this._y)*e)}moveTowards(t,e){let i=Math.atan2(t.y-this._y,t.x-this._x),r=this.distance(t);return r===0||e>=0&&r<=e*e?t:(this._x+=Math.cos(i)*e,this._y+=Math.sin(i)*e,this)}distance(t){return Math.sqrt((this._x-t.x)*(this._x-t.x)+(this._y-t.y)*(this._y-t.y))}clone(){return g.pull("ObservableVector2d",this._x,this._y,{onUpdate:this.onUpdate,scope:this.scope})}toVector2d(){return g.pull("Vector2d",this._x,this._y)}toString(){return"x:"+this._x+",y:"+this._y}}class Mt extends It{constructor(t=0,e=0,i=0,r){if(super(t,e,i),typeof r>"u")throw new Error("undefined `onUpdate` callback");this.setCallback(r.onUpdate,r.scope)}onResetEvent(t=0,e=0,i=0,r){return this.setMuted(t,e,i),typeof r<"u"&&this.setCallback(r.onUpdate,r.scope),this}get x(){return this._x}set x(t){let e=this.onUpdate.call(this.scope,t,this._y,this._z,this._x,this._y,this._z);e&&"x"in e?this._x=e.x:this._x=t}get y(){return this._y}set y(t){let e=this.onUpdate.call(this.scope,this._x,t,this._z,this._x,this._y,this._z);e&&"y"in e?this._y=e.y:this._y=t}get z(){return this._z}set z(t){let e=this.onUpdate.call(this.scope,this._x,this._y,t,this._x,this._y,this._z);e&&"z"in e?this._z=e.z:this._z=t}_set(t,e,i){let r=this.onUpdate.call(this.scope,t,e,i,this._x,this._y,this._z);return r&&"x"in r&&"y"in r&&"z"in r?(this._x=r.x,this._y=r.y,this._z=r.z):(this._x=t,this._y=e,this._z=i||0),this}setMuted(t,e,i){return this._x=t,this._y=e,this._z=i||0,this}setCallback(t,e=null){if(typeof t!="function")throw new Error("invalid `onUpdate` callback");return this.onUpdate=t,this.scope=e,this}add(t){return this._set(this._x+t.x,this._y+t.y,this._z+(t.z||0))}sub(t){return this._set(this._x-t.x,this._y-t.y,this._z-(t.z||0))}scale(t,e=t,i=1){return this._set(this._x*t,this._y*e,this._z*i)}scaleV(t){return this._set(this._x*t.x,this._y*t.y,this._z*(t.z||1))}div(t){return this._set(this._x/t,this._y/t,this._z/t)}abs(){return this._set(this._x<0?-this._x:this._x,this._y<0?-this._y:this._y,this._Z<0?-this._z:this._z)}clamp(t,e){return new Mt(C(this._x,t,e),C(this._y,t,e),C(this._z,t,e),{onUpdate:this.onUpdate,scope:this.scope})}clampSelf(t,e){return this._set(C(this._x,t,e),C(this._y,t,e),C(this._z,t,e))}minV(t){let e=t.z||0;return this._set(this._x<t.x?this._x:t.x,this._y<t.y?this._y:t.y,this._z<e?this._z:e)}maxV(t){let e=t.z||0;return this._set(this._x>t.x?this._x:t.x,this._y>t.y?this._y:t.y,this._z>e?this._z:e)}floor(){return new Mt(Math.floor(this._x),Math.floor(this._y),Math.floor(this._z),{onUpdate:this.onUpdate,scope:this.scope})}floorSelf(){return this._set(Math.floor(this._x),Math.floor(this._y),Math.floor(this._z))}ceil(){return new Mt(Math.ceil(this._x),Math.ceil(this._y),Math.ceil(this._z),{onUpdate:this.onUpdate,scope:this.scope})}ceilSelf(){return this._set(Math.ceil(this._x),Math.ceil(this._y),Math.ceil(this._z))}negate(){return new Mt(-this._x,-this._y,-this._z,{onUpdate:this.onUpdate,scope:this.scope})}negateSelf(){return this._set(-this._x,-this._y,-this._z)}copy(t){return this._set(t.x,t.y,t.z||0)}equals(t){return this._x===t.x&&this._y===t.y&&this._z===(t.z||this._z)}perp(){return this._set(this._y,-this._x,this._z)}rotate(t,e){let i=0,r=0;typeof e=="object"&&(i=e.x,r=e.y);let n=this.x-i,o=this.y-r,h=Math.cos(t),l=Math.sin(t);return this._set(n*h-o*l+i,n*l+o*h+r,this.z)}dot(t){return this._x*t.x+this._y*t.y+this._z*(t.z||1)}cross(t){let e=this._x,i=this._y,r=this._z,n=t.x,o=t.y,h=t.z;return this._set(i*h-r*o,r*n-e*h,e*o-i*n)}lerp(t,e){return this._set(this._x+(t.x-this._x)*e,this._y+(t.y-this._y)*e,this._z+(t.z-this._z)*e)}moveTowards(t,e){let i=Math.atan2(t.y-this._y,t.x-this._x),r=this._x-t.x,n=this._y-t.y,o=Math.sqrt(r*r+n*n);return o===0||e>=0&&o<=e*e?t:this._set(this._x+Math.cos(i)*e,this._y+Math.sin(i)*e,this._z)}distance(t){let e=this._x-t.x,i=this._y-t.y,r=this._z-(t.z||0);return Math.sqrt(e*e+i*i+r*r)}clone(){return g.pull("ObservableVector3d",this._x,this._y,this._z,{onUpdate:this.onUpdate})}toVector3d(){return g.pull("Vector3d",this._x,this._y,this._z)}toString(){return"x:"+this._x+",y:"+this._y+",z:"+this._z}}class Re{constructor(...t){this.onResetEvent(...t)}onResetEvent(){const t=arguments[0],e=arguments.length;if(typeof this.val>"u"&&(this.val=new Float32Array(9)),e===1)if(t.val.length===9)this.copy(t);else if(t.val.length===16)this.fromMat3d(arguments[0]);else throw new Error("invalid Matrix2d constructor parameter");else arguments.length>=6?this.setTransform.apply(this,arguments):this.identity()}get tx(){return this.val[6]}get ty(){return this.val[7]}identity(){return this.setTransform(1,0,0,0,1,0,0,0,1),this}setTransform(){let t=this.val;return arguments.length===9?(t[0]=arguments[0],t[1]=arguments[1],t[2]=arguments[2],t[3]=arguments[3],t[4]=arguments[4],t[5]=arguments[5],t[6]=arguments[6],t[7]=arguments[7],t[8]=arguments[8]):arguments.length===6&&(t[0]=arguments[0],t[1]=arguments[2],t[2]=arguments[4],t[3]=arguments[1],t[4]=arguments[3],t[5]=arguments[5],t[6]=0,t[7]=0,t[8]=1),this}transform(t,e,i,r,n,o){let h=this.val,l=h[0],f=h[1],d=h[3],a=h[4],u=t,c=e,p=i,y=r,_=n,m=o;return h[0]=l*u+d*c,h[1]=f*u+a*c,h[3]=l*p+d*y,h[4]=f*p+a*y,h[6]+=l*_+d*m,h[7]+=f*_+a*m,this}copy(t){return this.val.set(t.val),this}fromMat3d(t){let e=t.val,i=this.val;return i[0]=e[0],i[1]=e[1],i[2]=e[2],i[3]=e[4],i[4]=e[5],i[5]=e[6],i[6]=e[8],i[7]=e[9],i[8]=e[10],this}multiply(t){let e=t.val,i=this.val,r=i[0],n=i[1],o=i[3],h=i[4],l=e[0],f=e[1],d=e[3],a=e[4],u=e[6],c=e[7];return i[0]=r*l+o*f,i[1]=n*l+h*f,i[3]=r*d+o*a,i[4]=n*d+h*a,i[6]+=r*u+o*c,i[7]+=n*u+h*c,this}transpose(){let t=this.val,e=t[1],i=t[2],r=t[5];return t[1]=t[3],t[2]=t[6],t[3]=e,t[5]=t[7],t[6]=i,t[7]=r,this}invert(){let t=this.val,e=t[0],i=t[1],r=t[2],n=t[3],o=t[4],h=t[5],l=t[6],f=t[7],d=t[8],a=d*o-h*f,u=h*l-d*n,c=f*n-o*l,p=e*a+i*u+r*c;return t[0]=a/p,t[1]=(r*f-d*i)/p,t[2]=(h*i-r*o)/p,t[3]=u/p,t[4]=(d*e-r*l)/p,t[5]=(r*n-h*e)/p,t[6]=c/p,t[7]=(i*l-f*e)/p,t[8]=(o*e-i*n)/p,this}apply(t){let e=this.val,i=t.x,r=t.y,n=typeof t.z<"u"?t.z:1;return t.x=i*e[0]+r*e[3]+n*e[6],t.y=i*e[1]+r*e[4]+n*e[7],typeof t.z<"u"&&(t.z=i*e[2]+r*e[5]+n*e[8]),t}applyInverse(t){let e=this.val,i=t.x,r=t.y,n=1/(e[0]*e[4]+e[3]*-e[1]);return t.x=e[4]*n*i+-e[3]*n*r+(e[7]*e[3]-e[6]*e[4])*n,t.y=e[0]*n*r+-e[1]*n*i+(-e[7]*e[0]+e[6]*e[1])*n,t}scale(t,e=t){let i=this.val;return i[0]*=t,i[1]*=t,i[3]*=e,i[4]*=e,this}scaleV(t){return this.scale(t.x,t.y)}scaleX(t){return this.scale(t,1)}scaleY(t){return this.scale(1,t)}rotate(t){if(t!==0){let e=this.val,i=e[0],r=e[1],n=e[2],o=e[3],h=e[4],l=e[5],f=Math.sin(t),d=Math.cos(t);e[0]=d*i+f*o,e[1]=d*r+f*h,e[2]=d*n+f*l,e[3]=d*o-f*i,e[4]=d*h-f*r,e[5]=d*l-f*n}return this}translate(){let t=this.val,e,i;return arguments.length===2?(e=arguments[0],i=arguments[1]):(e=arguments[0].x,i=arguments[0].y),t[6]+=t[0]*e+t[3]*i,t[7]+=t[1]*e+t[4]*i,this}isIdentity(){let t=this.val;return t[0]===1&&t[1]===0&&t[2]===0&&t[3]===0&&t[4]===1&&t[5]===0&&t[6]===0&&t[7]===0&&t[8]===1}equals(t){let e=t.val,i=this.val;return i[0]===e[0]&&i[1]===e[1]&&i[2]===e[2]&&i[3]===e[3]&&i[4]===e[4]&&i[5]===e[5]&&i[6]===e[6]&&i[7]===e[7]&&i[8]===e[8]}clone(){return g.pull("Matrix2d",this)}toArray(){return this.val}toString(){let t=this.val;return"me.Matrix2d("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+", "+t[6]+", "+t[7]+", "+t[8]+")"}}class fi{constructor(...t){this.onResetEvent(...t)}onResetEvent(){const t=arguments[0],e=arguments.length;typeof this.val>"u"&&(this.val=new Float32Array(16)),e===1&&t.val.length===16?this.copy(t):e===16?this.setTransform.apply(this,arguments):this.identity()}get tx(){return this.val[12]}get ty(){return this.val[13]}get tz(){return this.val[14]}identity(){return this.setTransform(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1)}setTransform(t,e,i,r,n,o,h,l,f,d,a,u,c,p,y,_){let m=this.val;return m[0]=t,m[1]=e,m[2]=i,m[3]=r,m[4]=n,m[5]=o,m[6]=h,m[7]=l,m[8]=f,m[9]=d,m[10]=a,m[11]=u,m[12]=c,m[13]=p,m[14]=y,m[15]=_,this}copy(t){return this.val.set(t.val),this}fromMat2d(t){let e=t.val;return this.setTransform(e[0],e[3],e[6],0,e[1],e[4],e[7],0,e[2],e[5],e[8],0,0,0,0,1)}multiply(t){let e=this.val,i=t.val,r=e[0],n=e[1],o=e[2],h=e[3],l=e[4],f=e[5],d=e[6],a=e[7],u=e[8],c=e[9],p=e[10],y=e[11],_=e[12],m=e[13],x=e[14],v=e[15],w=i[0],E=i[1],A=i[2],I=i[3];return e[0]=w*r+E*l+A*u+I*_,e[1]=w*n+E*f+A*c+I*m,e[2]=w*o+E*d+A*p+I*x,e[3]=w*h+E*a+A*y+I*v,w=i[4],E=i[5],A=i[6],I=i[7],e[4]=w*r+E*l+A*u+I*_,e[5]=w*n+E*f+A*c+I*m,e[6]=w*o+E*d+A*p+I*x,e[7]=w*h+E*a+A*y+I*v,w=i[8],E=i[9],A=i[10],I=i[11],e[8]=w*r+E*l+A*u+I*_,e[9]=w*n+E*f+A*c+I*m,e[10]=w*o+E*d+A*p+I*x,e[11]=w*h+E*a+A*y+I*v,w=i[12],E=i[13],A=i[14],I=i[15],e[12]=w*r+E*l+A*u+I*_,e[13]=w*n+E*f+A*c+I*m,e[14]=w*o+E*d+A*p+I*x,e[15]=w*h+E*a+A*y+I*v,this}transpose(){let t=this.val,e=t[1],i=t[2],r=t[3],n=t[6],o=t[7],h=t[11];return t[1]=t[4],t[2]=t[8],t[3]=t[12],t[4]=e,t[6]=t[9],t[7]=t[13],t[8]=i,t[9]=n,t[11]=t[14],t[12]=r,t[13]=o,t[14]=h,this}invert(){let t=this.val,e=t[0],i=t[1],r=t[2],n=t[3],o=t[4],h=t[5],l=t[6],f=t[7],d=t[8],a=t[9],u=t[10],c=t[11],p=t[12],y=t[13],_=t[14],m=t[15],x=e*h-i*o,v=e*l-r*o,w=e*f-n*o,E=i*l-r*h,A=i*f-n*h,I=r*f-n*l,z=d*y-a*p,L=d*_-u*p,G=d*m-c*p,Y=a*_-u*y,q=a*m-c*y,T=u*m-c*_,b=x*T-v*q+w*Y+E*G-A*L+I*z;return b?(b=1/b,t[0]=(h*T-l*q+f*Y)*b,t[1]=(r*q-i*T-n*Y)*b,t[2]=(y*I-_*A+m*E)*b,t[3]=(u*A-a*I-c*E)*b,t[4]=(l*G-o*T-f*L)*b,t[5]=(e*T-r*G+n*L)*b,t[6]=(_*w-p*I-m*v)*b,t[7]=(d*I-u*w+c*v)*b,t[8]=(o*q-h*G+f*z)*b,t[9]=(i*G-e*q-n*z)*b,t[10]=(p*A-y*w+m*x)*b,t[11]=(a*w-d*A-c*x)*b,t[12]=(h*L-o*Y-l*z)*b,t[13]=(e*Y-i*L+r*z)*b,t[14]=(y*v-p*E-_*x)*b,t[15]=(d*E-a*v+u*x)*b,this):null}apply(t){let e=this.val,i=t.x,r=t.y,n=typeof t.z<"u"?t.z:1,o=e[3]*i+e[7]*r+e[11]*n+e[15]||1;return t.x=(e[0]*i+e[4]*r+e[8]*n+e[12])/o,t.y=(e[1]*i+e[5]*r+e[9]*n+e[13])/o,typeof t.z<"u"&&(t.z=(e[2]*i+e[6]*r+e[10]*n+e[14])/o),t}applyInverse(t){let e=g.pull("Matrix3d",this).invert();return e.apply(t),g.push(e),t}ortho(t,e,i,r,n,o){let h=this.val,l=1/(t-e),f=1/(i-r),d=1/(n-o);return h[0]=-2*l,h[1]=0,h[2]=0,h[3]=0,h[4]=0,h[5]=-2*f,h[6]=0,h[7]=0,h[8]=0,h[9]=0,h[10]=2*d,h[11]=0,h[12]=(t+e)*l,h[13]=(r+i)*f,h[14]=(o+n)*d,h[15]=1,this}scale(t,e=t,i=0){let r=this.val;return r[0]=r[0]*t,r[1]=r[1]*t,r[2]=r[2]*t,r[3]=r[3]*t,r[4]=r[4]*e,r[5]=r[5]*e,r[6]=r[6]*e,r[7]=r[7]*e,r[8]=r[8]*i,r[9]=r[9]*i,r[10]=r[10]*i,r[11]=r[11]*i,this}scaleV(t){return this.scale(t.x,t.y,t.z)}scaleX(t){return this.scale(t,1)}scaleY(t){return this.scale(1,t)}rotate(t,e){if(t!==0){let i=this.val,r=e.x,n=e.y,o=e.z,h=Math.sqrt(r*r+n*n+o*o),l,f,d,a,u,c,p,y,_,m,x,v,w,E,A,I,z,L,G,Y,q,T,b,S;if(h<Qc)return null;h=1/h,r*=h,n*=h,o*=h,l=Math.sin(t),f=Math.cos(t),d=1-f,a=i[0],u=i[1],c=i[2],p=i[3],y=i[4],_=i[5],m=i[6],x=i[7],v=i[8],w=i[9],E=i[10],A=i[11],I=r*r*d+f,z=n*r*d+o*l,L=o*r*d-n*l,G=r*n*d-o*l,Y=n*n*d+f,q=o*n*d+r*l,T=r*o*d+n*l,b=n*o*d-r*l,S=o*o*d+f,i[0]=a*I+y*z+v*L,i[1]=u*I+_*z+w*L,i[2]=c*I+m*z+E*L,i[3]=p*I+x*z+A*L,i[4]=a*G+y*Y+v*q,i[5]=u*G+_*Y+w*q,i[6]=c*G+m*Y+E*q,i[7]=p*G+x*Y+A*q,i[8]=a*T+y*b+v*S,i[9]=u*T+_*b+w*S,i[10]=c*T+m*b+E*S,i[11]=p*T+x*b+A*S}return this}translate(){let t=this.val,e,i,r;return arguments.length>1?(e=arguments[0],i=arguments[1],r=typeof arguments[2]>"u"?0:arguments[2]):(e=arguments[0].x,i=arguments[0].y,r=typeof arguments[0].z>"u"?0:arguments[0].z),t[12]=t[0]*e+t[4]*i+t[8]*r+t[12],t[13]=t[1]*e+t[5]*i+t[9]*r+t[13],t[14]=t[2]*e+t[6]*i+t[10]*r+t[14],t[15]=t[3]*e+t[7]*i+t[11]*r+t[15],this}isIdentity(){let t=this.val;return t[0]===1&&t[1]===0&&t[2]===0&&t[3]===0&&t[4]===0&&t[5]===1&&t[6]===0&&t[7]===0&&t[8]===0&&t[9]===0&&t[10]===1&&t[11]===0&&t[12]===0&&t[13]===0&&t[14]===0&&t[15]===1}equals(t){let e=t.val,i=this.val;return i[0]===e[0]&&i[1]===e[1]&&i[2]===e[2]&&i[3]===e[3]&&i[4]===e[4]&&i[5]===e[5]&&i[6]===e[6]&&i[7]===e[7]&&i[8]===e[8]&&i[9]===e[9]&&i[10]===e[10]&&i[11]===e[11]&&i[12]===e[12]&&i[13]===e[13]&&i[14]===e[14]&&i[15]===e[15]}clone(){return g.pull("Matrix3d",this)}toArray(){return this.val}toString(){let t=this.val;return"me.Matrix3d("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+", "+t[6]+", "+t[7]+", "+t[8]+", "+t[9]+", "+t[10]+", "+t[11]+", "+t[12]+", "+t[13]+", "+t[14]+", "+t[15]+")"}}var Tr={exports:{}};Tr.exports=Ai;Tr.exports.default=Ai;function Ai(s,t,e){e=e||2;var i=t&&t.length,r=i?t[0]*e:s.length,n=Da(s,0,r,e,!0),o=[];if(!n||n.next===n.prev)return o;var h,l,f,d,a,u,c;if(i&&(n=ld(s,t,n,e)),s.length>80*e){h=f=s[0],l=d=s[1];for(var p=e;p<r;p+=e)a=s[p],u=s[p+1],a<h&&(h=a),u<l&&(l=u),a>f&&(f=a),u>d&&(d=u);c=Math.max(f-h,d-l),c=c!==0?32767/c:0}return Me(n,o,e,h,l,c,0),o}function Da(s,t,e,i,r){var n,o;if(r===Ds(s,t,e,i)>0)for(n=t;n<e;n+=i)o=On(n,s[n],s[n+1],o);else for(n=e-i;n>=t;n-=i)o=On(n,s[n],s[n+1],o);return o&&Si(o,o.next)&&(Le(o),o=o.next),o}function Zt(s,t){if(!s)return s;t||(t=s);var e=s,i;do if(i=!1,!e.steiner&&(Si(e,e.next)||X(e.prev,e,e.next)===0)){if(Le(e),e=t=e.prev,e===e.next)break;i=!0}else e=e.next;while(i||e!==t);return t}function Me(s,t,e,i,r,n,o){if(s){!o&&n&&pd(s,i,r,n);for(var h=s,l,f;s.prev!==s.next;){if(l=s.prev,f=s.next,n?od(s,i,r,n):nd(s)){t.push(l.i/e|0),t.push(s.i/e|0),t.push(f.i/e|0),Le(s),s=f.next,h=f.next;continue}if(s=f,s===h){o?o===1?(s=ad(Zt(s),t,e),Me(s,t,e,i,r,n,2)):o===2&&hd(s,t,e,i,r,n):Me(Zt(s),t,e,i,r,n,1);break}}}}function nd(s){var t=s.prev,e=s,i=s.next;if(X(t,e,i)>=0)return!1;for(var r=t.x,n=e.x,o=i.x,h=t.y,l=e.y,f=i.y,d=r<n?r<o?r:o:n<o?n:o,a=h<l?h<f?h:f:l<f?l:f,u=r>n?r>o?r:o:n>o?n:o,c=h>l?h>f?h:f:l>f?l:f,p=i.next;p!==t;){if(p.x>=d&&p.x<=u&&p.y>=a&&p.y<=c&&ce(r,h,n,l,o,f,p.x,p.y)&&X(p.prev,p,p.next)>=0)return!1;p=p.next}return!0}function od(s,t,e,i){var r=s.prev,n=s,o=s.next;if(X(r,n,o)>=0)return!1;for(var h=r.x,l=n.x,f=o.x,d=r.y,a=n.y,u=o.y,c=h<l?h<f?h:f:l<f?l:f,p=d<a?d<u?d:u:a<u?a:u,y=h>l?h>f?h:f:l>f?l:f,_=d>a?d>u?d:u:a>u?a:u,m=Ls(c,p,t,e,i),x=Ls(y,_,t,e,i),v=s.prevZ,w=s.nextZ;v&&v.z>=m&&w&&w.z<=x;){if(v.x>=c&&v.x<=y&&v.y>=p&&v.y<=_&&v!==r&&v!==o&&ce(h,d,l,a,f,u,v.x,v.y)&&X(v.prev,v,v.next)>=0||(v=v.prevZ,w.x>=c&&w.x<=y&&w.y>=p&&w.y<=_&&w!==r&&w!==o&&ce(h,d,l,a,f,u,w.x,w.y)&&X(w.prev,w,w.next)>=0))return!1;w=w.nextZ}for(;v&&v.z>=m;){if(v.x>=c&&v.x<=y&&v.y>=p&&v.y<=_&&v!==r&&v!==o&&ce(h,d,l,a,f,u,v.x,v.y)&&X(v.prev,v,v.next)>=0)return!1;v=v.prevZ}for(;w&&w.z<=x;){if(w.x>=c&&w.x<=y&&w.y>=p&&w.y<=_&&w!==r&&w!==o&&ce(h,d,l,a,f,u,w.x,w.y)&&X(w.prev,w,w.next)>=0)return!1;w=w.nextZ}return!0}function ad(s,t,e){var i=s;do{var r=i.prev,n=i.next.next;!Si(r,n)&&$a(r,i,i.next,n)&&Oe(r,n)&&Oe(n,r)&&(t.push(r.i/e|0),t.push(i.i/e|0),t.push(n.i/e|0),Le(i),Le(i.next),i=s=n),i=i.next}while(i!==s);return Zt(i)}function hd(s,t,e,i,r,n){var o=s;do{for(var h=o.next.next;h!==o.prev;){if(o.i!==h.i&&md(o,h)){var l=Na(o,h);o=Zt(o,o.next),l=Zt(l,l.next),Me(o,t,e,i,r,n,0),Me(l,t,e,i,r,n,0);return}h=h.next}o=o.next}while(o!==s)}function ld(s,t,e,i){var r=[],n,o,h,l,f;for(n=0,o=t.length;n<o;n++)h=t[n]*i,l=n<o-1?t[n+1]*i:s.length,f=Da(s,h,l,i,!1),f===f.next&&(f.steiner=!0),r.push(yd(f));for(r.sort(ud),n=0;n<r.length;n++)e=fd(r[n],e);return e}function ud(s,t){return s.x-t.x}function fd(s,t){var e=cd(s,t);if(!e)return t;var i=Na(e,s);return Zt(i,i.next),Zt(e,e.next)}function cd(s,t){var e=t,i=s.x,r=s.y,n=-1/0,o;do{if(r<=e.y&&r>=e.next.y&&e.next.y!==e.y){var h=e.x+(r-e.y)*(e.next.x-e.x)/(e.next.y-e.y);if(h<=i&&h>n&&(n=h,o=e.x<e.next.x?e:e.next,h===i))return o}e=e.next}while(e!==t);if(!o)return null;var l=o,f=o.x,d=o.y,a=1/0,u;e=o;do i>=e.x&&e.x>=f&&i!==e.x&&ce(r<d?i:n,r,f,d,r<d?n:i,r,e.x,e.y)&&(u=Math.abs(r-e.y)/(i-e.x),Oe(e,s)&&(u<a||u===a&&(e.x>o.x||e.x===o.x&&dd(o,e)))&&(o=e,a=u)),e=e.next;while(e!==l);return o}function dd(s,t){return X(s.prev,s,t.prev)<0&&X(t.next,s,s.next)<0}function pd(s,t,e,i){var r=s;do r.z===0&&(r.z=Ls(r.x,r.y,t,e,i)),r.prevZ=r.prev,r.nextZ=r.next,r=r.next;while(r!==s);r.prevZ.nextZ=null,r.prevZ=null,gd(r)}function gd(s){var t,e,i,r,n,o,h,l,f=1;do{for(e=s,s=null,n=null,o=0;e;){for(o++,i=e,h=0,t=0;t<f&&(h++,i=i.nextZ,!!i);t++);for(l=f;h>0||l>0&&i;)h!==0&&(l===0||!i||e.z<=i.z)?(r=e,e=e.nextZ,h--):(r=i,i=i.nextZ,l--),n?n.nextZ=r:s=r,r.prevZ=n,n=r;e=i}n.nextZ=null,f*=2}while(o>1);return s}function Ls(s,t,e,i,r){return s=(s-e)*r|0,t=(t-i)*r|0,s=(s|s<<8)&16711935,s=(s|s<<4)&252645135,s=(s|s<<2)&858993459,s=(s|s<<1)&1431655765,t=(t|t<<8)&16711935,t=(t|t<<4)&252645135,t=(t|t<<2)&858993459,t=(t|t<<1)&1431655765,s|t<<1}function yd(s){var t=s,e=s;do(t.x<e.x||t.x===e.x&&t.y<e.y)&&(e=t),t=t.next;while(t!==s);return e}function ce(s,t,e,i,r,n,o,h){return(r-o)*(t-h)>=(s-o)*(n-h)&&(s-o)*(i-h)>=(e-o)*(t-h)&&(e-o)*(n-h)>=(r-o)*(i-h)}function md(s,t){return s.next.i!==t.i&&s.prev.i!==t.i&&!_d(s,t)&&(Oe(s,t)&&Oe(t,s)&&xd(s,t)&&(X(s.prev,s,t.prev)||X(s,t.prev,t))||Si(s,t)&&X(s.prev,s,s.next)>0&&X(t.prev,t,t.next)>0)}function X(s,t,e){return(t.y-s.y)*(e.x-t.x)-(t.x-s.x)*(e.y-t.y)}function Si(s,t){return s.x===t.x&&s.y===t.y}function $a(s,t,e,i){var r=qe(X(s,t,e)),n=qe(X(s,t,i)),o=qe(X(e,i,s)),h=qe(X(e,i,t));return!!(r!==n&&o!==h||r===0&&Ye(s,e,t)||n===0&&Ye(s,i,t)||o===0&&Ye(e,s,i)||h===0&&Ye(e,t,i))}function Ye(s,t,e){return t.x<=Math.max(s.x,e.x)&&t.x>=Math.min(s.x,e.x)&&t.y<=Math.max(s.y,e.y)&&t.y>=Math.min(s.y,e.y)}function qe(s){return s>0?1:s<0?-1:0}function _d(s,t){var e=s;do{if(e.i!==s.i&&e.next.i!==s.i&&e.i!==t.i&&e.next.i!==t.i&&$a(e,e.next,s,t))return!0;e=e.next}while(e!==s);return!1}function Oe(s,t){return X(s.prev,s,s.next)<0?X(s,t,s.next)>=0&&X(s,s.prev,t)>=0:X(s,t,s.prev)<0||X(s,s.next,t)<0}function xd(s,t){var e=s,i=!1,r=(s.x+t.x)/2,n=(s.y+t.y)/2;do e.y>n!=e.next.y>n&&e.next.y!==e.y&&r<(e.next.x-e.x)*(n-e.y)/(e.next.y-e.y)+e.x&&(i=!i),e=e.next;while(e!==s);return i}function Na(s,t){var e=new Bs(s.i,s.x,s.y),i=new Bs(t.i,t.x,t.y),r=s.next,n=t.prev;return s.next=t,t.prev=s,e.next=r,r.prev=e,i.next=e,e.prev=i,n.next=i,i.prev=n,i}function On(s,t,e,i){var r=new Bs(s,t,e);return i?(r.next=i.next,r.prev=i,i.next.prev=r,i.next=r):(r.prev=r,r.next=r),r}function Le(s){s.next.prev=s.prev,s.prev.next=s.next,s.prevZ&&(s.prevZ.nextZ=s.nextZ),s.nextZ&&(s.nextZ.prevZ=s.prevZ)}function Bs(s,t,e){this.i=s,this.x=t,this.y=e,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}Ai.deviation=function(s,t,e,i){var r=t&&t.length,n=r?t[0]*e:s.length,o=Math.abs(Ds(s,0,n,e));if(r)for(var h=0,l=t.length;h<l;h++){var f=t[h]*e,d=h<l-1?t[h+1]*e:s.length;o-=Math.abs(Ds(s,f,d,e))}var a=0;for(h=0;h<i.length;h+=3){var u=i[h]*e,c=i[h+1]*e,p=i[h+2]*e;a+=Math.abs((s[u]-s[p])*(s[c+1]-s[u+1])-(s[u]-s[c])*(s[p+1]-s[u+1]))}return o===0&&a===0?0:Math.abs((a-o)/o)};function Ds(s,t,e,i){for(var r=0,n=t,o=e-i;n<e;n+=i)r+=(s[o]-s[n])*(s[n+1]+s[o+1]),o=n;return r}Ai.flatten=function(s){for(var t=s[0][0].length,e={vertices:[],holes:[],dimensions:t},i=0,r=0;r<s.length;r++){for(var n=0;n<s[r].length;n++)for(var o=0;o<t;o++)e.vertices.push(s[r][n][o]);r>0&&(i+=s[r-1].length,e.holes.push(i))}return e};var vd=Tr.exports,ka=Ho(vd);class kt{constructor(t=0,e=0,i){this.pos=g.pull("Vector2d"),this.points=[],this.edges=[],this.indices=[],this.normals=[],this._bounds,this.type="Polygon",this.setShape(t,e,i)}onResetEvent(t,e,i){this.setShape(t,e,i)}setShape(t,e,i){return this.pos.set(t,e),this.setVertices(i),this}setVertices(t){if(!Array.isArray(t))return this;if(typeof t[0]=="object")typeof t[0].setV=="function"?this.points=t:(this.points.length=0,t.forEach(e=>{this.points.push(g.pull("Vector2d",e.x,e.y))}));else{let e=t.length;this.points.length=0;for(let i=0;i<e;i+=2)this.points.push(g.pull("Vector2d",t[i],t[i+1]))}return this.recalc(),this.updateBounds(),this}transform(t){let e=this.points,i=e.length;for(let r=0;r<i;r++)t.apply(e[r]);return this.recalc(),this.updateBounds(),this}toIso(){return this.rotate(Math.PI/4).scale(Math.SQRT2,Math.SQRT1_2)}to2d(){return this.scale(Math.SQRT1_2,Math.SQRT2).rotate(-Math.PI/4)}rotate(t,e){if(t!==0){let i=this.points,r=i.length;for(let n=0;n<r;n++)i[n].rotate(t,e);this.recalc(),this.updateBounds()}return this}scale(t,e=t){let i=this.points,r=i.length;for(let n=0;n<r;n++)i[n].scale(t,e);return this.recalc(),this.updateBounds(),this}scaleV(t){return this.scale(t.x,t.y)}recalc(){let t=this.edges,e=this.normals,i=this.indices,r=this.points,n=r.length;if(n<3)throw new Error("Requires at least 3 points");for(let o=0;o<n;o++){let h=t[o];typeof h>"u"&&(h=t[o]=g.pull("Vector2d")),h.copy(r[(o+1)%n]).sub(r[o]);let l=e[o];typeof l>"u"&&(l=e[o]=g.pull("Vector2d")),l.copy(h).perp().normalize()}for(let o=n;o<t.length;o++)g.push(t[o]),g.push(e[o]);return t.length=n,e.length=n,i.length=0,this}getIndices(){return this.indices.length===0&&(this.indices=ka(this.points.flatMap(t=>[t.x,t.y]))),this.indices}isConvex(){let t=0,e=this.points,i=e.length;if(i<3)return null;for(let r=0;r<i;r++){let n=(r+1)%i,o=(r+2)%i,h=(e[n].x-e[r].x)*(e[o].y-e[n].y);if(h-=(e[n].y-e[r].y)*(e[o].x-e[n].x),h<0?t|=1:h>0&&(t|=2),t===3)return!1}return t!==0?!0:null}translate(){let t,e;return arguments.length===2?(t=arguments[0],e=arguments[1]):(t=arguments[0].x,e=arguments[0].y),this.pos.x+=t,this.pos.y+=e,this.getBounds().translate(t,e),this}shift(){let t,e;arguments.length===2?(t=arguments[0],e=arguments[1]):(t=arguments[0].x,e=arguments[0].y),this.pos.x=t,this.pos.y=e,this.updateBounds()}contains(...t){let[e,i]=t.length===2?t:[t[0].x,t[0].y],r=!1,n=this.pos.x,o=this.pos.y,h=this.points,l=h.length;for(let f=0,d=l-1;f<l;d=f++){const a=h[f].y+o,u=h[f].x+n,c=h[d].y+o,p=h[d].x+n;a>i!=c>i&&e<(p-u)*(i-a)/(c-a)+u&&(r=!r)}return r}getBounds(){return typeof this._bounds>"u"&&(this._bounds=g.pull("Bounds")),this._bounds}updateBounds(){let t=this.getBounds();return t.update(this.points),t.translate(this.pos),t}clone(){let t=[];return this.points.forEach(e=>{t.push(e.clone())}),new kt(this.pos.x,this.pos.y,t)}}class ci extends kt{contains(){let t,e;arguments.length===2?(t=arguments[0],e=arguments[1]):(t=arguments[0].x,e=arguments[0].y),t-=this.pos.x,e-=this.pos.y;let i=this.points[0],r=this.points[1];return(e-i.y)*(r.x-i.x)===(r.y-i.y)*(t-i.x)}recalc(){let t=this.edges,e=this.normals,i=this.indices,r=this.points;if(r.length!==2)throw new Error("Requires exactly 2 points");return t[0]===void 0&&(t[0]=g.pull("Vector2d")),t[0].copy(r[1]).sub(r[0]),e[0]===void 0&&(e[0]=g.pull("Vector2d")),e[0].copy(t[0]).perp().normalize(),i.length=0,this}clone(){let t=[];return this.points.forEach(e=>{t.push(e.clone())}),new ci(this.pos.x,this.pos.y,t)}}class Be{constructor(t,e,i,r){this.pos=g.pull("Vector2d"),this._bounds=void 0,this.radius=NaN,this.radiusV=g.pull("Vector2d"),this.radiusSq=g.pull("Vector2d"),this.ratio=g.pull("Vector2d"),this.type="Ellipse",this.setShape(t,e,i,r)}onResetEvent(t,e,i,r){this.setShape(t,e,i,r)}setShape(t,e,i,r){const n=i/2,o=r/2,h=Math.max(n,o),l=h*h;this.pos.set(t,e),this.radius=h,this.ratio.set(n/h,o/h),this.radiusV.set(h,h).scaleV(this.ratio),this.radiusSq.set(l,l).scaleV(this.ratio);let f=this.getBounds();return f.setMinMax(t,e,t+i,t+r),f.translate(-this.radiusV.x,-this.radiusV.y),this}rotate(t,e){let i=this.getBounds();return this.pos.rotate(t,e),i.shift(this.pos),i.translate(-this.radiusV.x,-this.radiusV.y),this}scale(t,e=t){return this.setShape(this.pos.x,this.pos.y,this.radiusV.x*2*t,this.radiusV.y*2*e)}scaleV(t){return this.scale(t.x,t.y)}transform(t){return this}translate(){let t,e;return arguments.length===2?(t=arguments[0],e=arguments[1]):(t=arguments[0].x,e=arguments[0].y),this.pos.x+=t,this.pos.y+=e,this.getBounds().translate(t,e),this}contains(...t){let e,i;return t.length===2?[e,i]=t:[e,i]=[t[0].x,t[0].y],e-=this.pos.x,i-=this.pos.y,e*e/this.radiusSq.x+i*i/this.radiusSq.y<=1}getBounds(){return typeof this._bounds>"u"&&(this._bounds=g.pull("Bounds")),this._bounds}clone(){return new Be(this.pos.x,this.pos.y,this.radiusV.x*2,this.radiusV.y*2)}}class De{constructor(t=0,e=0){this.x=t,this.y=e,this.type="Point"}onResetEvent(t=0,e=0){this.set(t,e)}set(t=0,e=0){return this.x=t,this.y=e,this}equals(...t){let e,i;return t.length===2?[e,i]=t:[e,i]=[t[0].x,t[0].y],this.x===e&&this.y===i}clone(){return new De(this.x,this.y)}}class Ft extends kt{constructor(t,e,i,r){super(t,e,[g.pull("Vector2d",0,0),g.pull("Vector2d",i,0),g.pull("Vector2d",i,r),g.pull("Vector2d",0,r)]),this.type="Rectangle"}onResetEvent(t,e,i,r){this.setShape(t,e,i,r)}setShape(t,e,i,r){let n=i;return this.pos.set(t,e),arguments.length===4&&(n=this.points,n[0].set(0,0),n[1].set(i,0),n[2].set(i,r),n[3].set(0,r)),this.setVertices(n),this}get left(){return this.pos.x}get right(){let t=this.width;return this.left+t||t}get top(){return this.pos.y}get bottom(){let t=this.height;return this.top+t||t}get width(){return this.points[2].x}set width(t){this.points[1].x=this.points[2].x=t,this.recalc(),this.updateBounds()}get height(){return this.points[2].y}set height(t){this.points[2].y=this.points[3].y=t,this.recalc(),this.updateBounds()}get centerX(){return isFinite(this.width)?this.left+this.width/2:this.width}set centerX(t){this.pos.x=t-this.width/2,this.recalc(),this.updateBounds()}get centerY(){return isFinite(this.height)?this.top+this.height/2:this.height}set centerY(t){this.pos.y=t-this.height/2,this.recalc(),this.updateBounds()}centerOn(t,e){return this.centerX=t,this.centerY=e,this}resize(t,e){return this.width=t,this.height=e,this}scale(t,e=t){return this.width*=t,this.height*=e,this}clone(){return new Ft(this.left,this.top,this.width,this.height)}copy(t){return this.setShape(t.left,t.top,t.width,t.height)}union(t){let e=Math.min(this.left,t.left),i=Math.min(this.top,t.top);return this.resize(Math.max(this.right,t.right)-e,Math.max(this.bottom,t.bottom)-i),this.pos.set(e,i),this}overlaps(t){return this.left<t.right&&t.left<this.right&&this.top<t.bottom&&t.top<this.bottom}contains(){let t=arguments[0],e,i,r,n;return arguments.length===2?(e=i=t,r=n=arguments[1]):typeof t.bottom=="number"?(e=t.left,i=t.right,r=t.top,n=t.bottom):(e=i=t.x,r=n=t.y),e>=this.left&&i<=this.right&&r>=this.top&&n<=this.bottom}equals(t){return t.left===this.left&&t.right===this.right&&t.top===this.top&&t.bottom===this.bottom}isFinite(){return isFinite(this.left)&&isFinite(this.top)&&isFinite(this.width)&&isFinite(this.height)}toPolygon(){return g.pull("Polygon",this.left,this.top,this.points)}}class di extends Ft{constructor(t,e,i,r,n=20){super(t,e,i,r),this.type="RoundRect",this.radius=n}onResetEvent(t,e,i,r,n){super.setShape(t,e,i,r),this.radius=n}get radius(){return this._radius}set radius(t){this.width<2*t&&(t=this.width/2),this.height<2*t&&(t=this.height/2),this._radius=t}copy(t){return super.setShape(t.pos.x,t.pos.y,t.width,t.height),this.radius=t.radius,this}contains(){let t=arguments[0],e,i;if(arguments.length===2)e=t,i=arguments[1];else{if(typeof t.radius>"u"&&typeof t.bottom=="number")return super.contains(t);e=t.x,i=t.y}if(e<this.left||e>=this.right||i<this.top||i>=this.bottom)return!1;if(e>=this.left+this.radius&&e<=this.right-this.radius||i>=this.top+this.radius&&i<=this.bottom-this.radius)return!0;let r,n;const o=Math.max(0,Math.min(this.radius,this.width/2)),h=Math.max(0,Math.min(this.radius,this.height/2));if(e<this.left+o&&i<this.top+h)r=e-this.left-o,n=i-this.top-h;else if(e>this.right-o&&i<this.top+h)r=e-this.right+o,n=i-this.top-h;else if(e>this.right-o&&i>this.bottom-h)r=e-this.right+o,n=i-this.bottom+h;else if(e<this.left+o&&i>this.bottom-h)r=e-this.left-o,n=i-this.bottom+h;else return!1;return r*r+n*n<=o*h}equals(t){return super.equals(t)&&this.radius===t.radius}clone(){return new di(this.pos.x,this.pos.y,this.width,this.height,this.radius)}}function pi(s,t){let e=Array.prototype.indexOf.call(s,t);return e!==-1&&Array.prototype.splice.call(s,e,1),s}let $s=[];function Ke(s,t,e=4,i=4,r=0){if($s.length>0){let n=$s.pop();return n.world=s,n.bounds=t,n.max_objects=e,n.max_levels=i,n.level=r,n}else return new Fa(s,t,e,i,r)}function wd(s){$s.push(s)}let Ln=new M;class Fa{constructor(t,e,i=4,r=4,n=0){this.world=t,this.bounds=e,this.max_objects=i,this.max_levels=r,this.level=n,this.objects=[],this.nodes=[]}split(){let t=this.level+1,e=this.bounds.width/2,i=this.bounds.height/2,r=this.bounds.left,n=this.bounds.top;this.nodes[0]=Ke(this.world,{left:r+e,top:n,width:e,height:i},this.max_objects,this.max_levels,t),this.nodes[1]=Ke(this.world,{left:r,top:n,width:e,height:i},this.max_objects,this.max_levels,t),this.nodes[2]=Ke(this.world,{left:r,top:n+i,width:e,height:i},this.max_objects,this.max_levels,t),this.nodes[3]=Ke(this.world,{left:r+e,top:n+i,width:e,height:i},this.max_objects,this.max_levels,t)}getIndex(t){let e,i=t.getBounds();t.isFloating===!0?e=this.world.app.viewport.localToWorld(i.left,i.top,Ln):e=Ln.set(t.left,t.top);let r=-1,n=e.x,o=e.y,h=i.width,l=i.height,f=this.bounds.left+this.bounds.width/2,d=this.bounds.top+this.bounds.height/2,a=o<d&&o+l<d,u=o>d;return n<f&&n+h<f?a?r=1:u&&(r=2):n>f&&(a?r=0:u&&(r=3)),r}insertContainer(t){const e=t.children,i=e.length;for(let r=i,n;r--,n=e[r];)n.isKinematic!==!0&&(typeof n.addChild=="function"?(n.name!=="rootContainer"&&this.insert(n),this.insertContainer(n)):typeof n.getBounds=="function"&&this.insert(n))}insert(t){let e=-1;if(this.nodes.length>0&&(e=this.getIndex(t),e!==-1)){this.nodes[e].insert(t);return}if(this.objects.push(t),this.objects.length>this.max_objects&&this.level<this.max_levels){this.nodes.length===0&&this.split();let i=0;for(;i<this.objects.length;)e=this.getIndex(this.objects[i]),e!==-1?this.nodes[e].insert(this.objects.splice(i,1)[0]):i=i+1}}retrieve(t,e){let i=this.objects;if(this.nodes.length>0){let r=this.getIndex(t);if(r!==-1)i=i.concat(this.nodes[r].retrieve(t));else for(let n=0;n<this.nodes.length;n=n+1)i=i.concat(this.nodes[n].retrieve(t))}return typeof e=="function"&&i.sort(e),i}remove(t){let e=!1;if(typeof t.getBounds>"u")return!1;if(this.nodes.length>0){let i=this.getIndex(t);i!==-1&&(e=pi(this.nodes[i],t),e&&this.nodes[i].isPrunable()&&this.nodes.splice(i,1))}return e===!1&&this.objects.indexOf(t)!==-1&&(pi(this.objects,t),e=!0),e}isPrunable(){return!(this.hasChildren()||this.objects.length>0)}hasChildren(){for(let t=0;t<this.nodes.length;t=t+1){const e=this.nodes[t];if(e.length>0||e.objects.length>0)return!0}return!1}clear(t){this.objects.length=0;for(let e=0;e<this.nodes.length;e++)this.nodes[e].clear(),wd(this.nodes[e]);this.nodes.length=0,typeof t<"u"&&this.bounds.setMinMax(t.min.x,t.min.y,t.max.x,t.max.y)}}class ut{constructor(t){this._center=new M,this.onResetEvent(t),this.type="Bounds"}onResetEvent(t){typeof this.min>"u"?(this.min={x:1/0,y:1/0},this.max={x:-1/0,y:-1/0}):this.clear(),typeof t<"u"&&this.update(t)}clear(){this.setMinMax(1/0,1/0,-1/0,-1/0)}setMinMax(t,e,i,r){this.min.x=t,this.min.y=e,this.max.x=i,this.max.y=r}get x(){return this.min.x}set x(t){let e=this.max.x-this.min.x;this.min.x=t,this.max.x=t+e}get y(){return this.min.y}set y(t){let e=this.max.y-this.min.y;this.min.y=t,this.max.y=t+e}get width(){return this.max.x-this.min.x}set width(t){this.max.x=this.min.x+t}get height(){return this.max.y-this.min.y}set height(t){this.max.y=this.min.y+t}get left(){return this.min.x}get right(){return this.max.x}get top(){return this.min.y}get bottom(){return this.max.y}get centerX(){return this.min.x+this.width/2}get centerY(){return this.min.y+this.height/2}get center(){return this._center.set(this.centerX,this.centerY)}centerOn(t,e){return this.shift(t-this.width/2,e-this.height/2),this}update(t){this.add(t,!0)}add(t,e=!1){const i=t.length;e===!0&&this.clear();for(let r=0;r<i;r++){const n=t[r];n.x>this.max.x&&(this.max.x=n.x),n.x<this.min.x&&(this.min.x=n.x),n.y>this.max.y&&(this.max.y=n.y),n.y<this.min.y&&(this.min.y=n.y)}}addBounds(t,e=!1){e===!0?(this.max.x=t.max.x,this.min.x=t.min.x,this.max.y=t.max.y,this.min.y=t.min.y):(t.max.x>this.max.x&&(this.max.x=t.max.x),t.min.x<this.min.x&&(this.min.x=t.min.x),t.max.y>this.max.y&&(this.max.y=t.max.y),t.min.y<this.min.y&&(this.min.y=t.min.y))}addPoint(t,e){typeof e<"u"&&(t=e.apply(t)),this.min.x=Math.min(this.min.x,t.x),this.max.x=Math.max(this.max.x,t.x),this.min.y=Math.min(this.min.y,t.y),this.max.y=Math.max(this.max.y,t.y)}addFrame(t,e,i,r,n){let o=g.pull("Point");this.addPoint(o.set(t,e),n),this.addPoint(o.set(i,e),n),this.addPoint(o.set(t,r),n),this.addPoint(o.set(i,r),n),g.push(o)}contains(){let t=arguments[0],e,i,r,n;return arguments.length===2?(e=i=t,r=n=arguments[1]):typeof t.max<"u"?(e=t.min.x,i=t.max.x,r=t.min.y,n=t.max.y):(e=i=t.x,r=n=t.y),e>=this.min.x&&i<=this.max.x&&r>=this.min.y&&n<=this.max.y}overlaps(t){return!(this.right<t.left||this.left>t.right||this.bottom<t.top||this.top>t.bottom)}isFinite(){return isFinite(this.min.x)&&isFinite(this.max.x)&&isFinite(this.min.y)&&isFinite(this.max.y)}translate(){let t,e;arguments.length===2?(t=arguments[0],e=arguments[1]):(t=arguments[0].x,e=arguments[0].y),this.min.x+=t,this.max.x+=t,this.min.y+=e,this.max.y+=e}shift(){let t,e;arguments.length===2?(t=arguments[0],e=arguments[1]):(t=arguments[0].x,e=arguments[0].y);let i=this.max.x-this.min.x,r=this.max.y-this.min.y;this.min.x=t,this.max.x=t+i,this.min.y=e,this.max.y=e+r}clone(){let t=new ut;return t.addBounds(this),t}toPolygon(){return g.pull("Polygon",this.x,this.y,[g.pull("Vector2d",0,0),g.pull("Vector2d",this.width,0),g.pull("Vector2d",this.width,this.height),g.pull("Vector2d",0,this.height)])}}let lt={maxChildren:8,maxDepth:4,types:{NO_OBJECT:0,PLAYER_OBJECT:1,NPC_OBJECT:2,ENEMY_OBJECT:4,COLLECTABLE_OBJECT:8,ACTION_OBJECT:16,PROJECTILE_OBJECT:32,WORLD_SHAPE:64,USER:128,ALL_OBJECT:4294967295}};function Qt(s,t,...e){return setTimeout(s.bind(t),.01,...e)}function Bn(s,t,e){let i=globalThis.performance.now(),r;return typeof e!="boolean"&&(e=!1),function(){let n=globalThis.performance.now(),o=n-i,h=arguments;if(o<t)e===!1&&(clearTimeout(r),r=setTimeout(()=>(i=n,s.apply(null,h)),o));else return i=n,s.apply(null,h)}}var Va={exports:{}};(function(s){var t=Object.prototype.hasOwnProperty,e="~";function i(){}Object.create&&(i.prototype=Object.create(null),new i().__proto__||(e=!1));function r(l,f,d){this.fn=l,this.context=f,this.once=d||!1}function n(l,f,d,a,u){if(typeof d!="function")throw new TypeError("The listener must be a function");var c=new r(d,a||l,u),p=e?e+f:f;return l._events[p]?l._events[p].fn?l._events[p]=[l._events[p],c]:l._events[p].push(c):(l._events[p]=c,l._eventsCount++),l}function o(l,f){--l._eventsCount===0?l._events=new i:delete l._events[f]}function h(){this._events=new i,this._eventsCount=0}h.prototype.eventNames=function(){var f=[],d,a;if(this._eventsCount===0)return f;for(a in d=this._events)t.call(d,a)&&f.push(e?a.slice(1):a);return Object.getOwnPropertySymbols?f.concat(Object.getOwnPropertySymbols(d)):f},h.prototype.listeners=function(f){var d=e?e+f:f,a=this._events[d];if(!a)return[];if(a.fn)return[a.fn];for(var u=0,c=a.length,p=new Array(c);u<c;u++)p[u]=a[u].fn;return p},h.prototype.listenerCount=function(f){var d=e?e+f:f,a=this._events[d];return a?a.fn?1:a.length:0},h.prototype.emit=function(f,d,a,u,c,p){var y=e?e+f:f;if(!this._events[y])return!1;var _=this._events[y],m=arguments.length,x,v;if(_.fn){switch(_.once&&this.removeListener(f,_.fn,void 0,!0),m){case 1:return _.fn.call(_.context),!0;case 2:return _.fn.call(_.context,d),!0;case 3:return _.fn.call(_.context,d,a),!0;case 4:return _.fn.call(_.context,d,a,u),!0;case 5:return _.fn.call(_.context,d,a,u,c),!0;case 6:return _.fn.call(_.context,d,a,u,c,p),!0}for(v=1,x=new Array(m-1);v<m;v++)x[v-1]=arguments[v];_.fn.apply(_.context,x)}else{var w=_.length,E;for(v=0;v<w;v++)switch(_[v].once&&this.removeListener(f,_[v].fn,void 0,!0),m){case 1:_[v].fn.call(_[v].context);break;case 2:_[v].fn.call(_[v].context,d);break;case 3:_[v].fn.call(_[v].context,d,a);break;case 4:_[v].fn.call(_[v].context,d,a,u);break;default:if(!x)for(E=1,x=new Array(m-1);E<m;E++)x[E-1]=arguments[E];_[v].fn.apply(_[v].context,x)}}return!0},h.prototype.on=function(f,d,a){return n(this,f,d,a,!1)},h.prototype.once=function(f,d,a){return n(this,f,d,a,!0)},h.prototype.removeListener=function(f,d,a,u){var c=e?e+f:f;if(!this._events[c])return this;if(!d)return o(this,c),this;var p=this._events[c];if(p.fn)p.fn===d&&(!u||p.once)&&(!a||p.context===a)&&o(this,c);else{for(var y=0,_=[],m=p.length;y<m;y++)(p[y].fn!==d||u&&!p[y].once||a&&p[y].context!==a)&&_.push(p[y]);_.length?this._events[c]=_.length===1?_[0]:_:o(this,c)}return this},h.prototype.removeAllListeners=function(f){var d;return f?(d=e?e+f:f,this._events[d]&&o(this,d)):(this._events=new i,this._eventsCount=0),this},h.prototype.off=h.prototype.removeListener,h.prototype.addListener=h.prototype.on,h.prefixed=e,h.EventEmitter=h,s.exports=h})(Va);var bd=Va.exports,Td=Ho(bd);let Ci=new Td;const Ua="dom_ready",Pi="me.boot",za="me.tick",Ns="me.blur",ks="me.focus",Fs="me.state.onPause",$e="me.state.onResume",Ed="me.state.onStop",Er="me.state.onRestart",Ar="me.state.onChange",Ga="me.stage.onReset",Sr="me.video.onInit",Ad="me.game.onInit",ze="me.game.onReset",ja="me.game.beforeUpdate",Sd="me.game.afterUpdate",Cd="me.game.onUpdate",Pd="me.game.beforeDraw",Id="me.game.afterDraw",Rd="me.world.step",gi="me.game.onLevelLoaded",Md="me.loader.onload",Vs="me.loader.onProgress",Od="me.loader.onError",Ld="me.input.keydown",Bd="me.input.keyup",Dd="gamepad.connected",$d="gamepad.disconnected",Ha="globalThis.onresize",Ii="canvas.onresize",Jt="viewport.onresize",hi="globalThis.orientationchange",Nd="globalThis.onscroll",Us="viewport.onchange",Cr="renderer.contextlost",yi="renderer.contextrestored";function B(s,...t){return Ci.emit(s,...t)}function F(s,t,e){return Ci.on(s,t,e)}function ye(s,t,e){return Ci.once(s,t,e)}function Ot(s,t){return Ci.off(s,t)}var zs={};/*!
 *  howler.js v2.2.4
 *  howlerjs.com
 *
 *  (c) 2013-2020, James Simpson of GoldFire Studios
 *  goldfirestudios.com
 *
 *  MIT License
 */(function(s){(function(){var t=function(){this.init()};t.prototype={init:function(){var a=this||e;return a._counter=1e3,a._html5AudioPool=[],a.html5PoolSize=10,a._codecs={},a._howls=[],a._muted=!1,a._volume=1,a._canPlayEvent="canplaythrough",a._navigator=typeof window<"u"&&window.navigator?window.navigator:null,a.masterGain=null,a.noAudio=!1,a.usingWebAudio=!0,a.autoSuspend=!0,a.ctx=null,a.autoUnlock=!0,a._setup(),a},volume:function(a){var u=this||e;if(a=parseFloat(a),u.ctx||d(),typeof a<"u"&&a>=0&&a<=1){if(u._volume=a,u._muted)return u;u.usingWebAudio&&u.masterGain.gain.setValueAtTime(a,e.ctx.currentTime);for(var c=0;c<u._howls.length;c++)if(!u._howls[c]._webAudio)for(var p=u._howls[c]._getSoundIds(),y=0;y<p.length;y++){var _=u._howls[c]._soundById(p[y]);_&&_._node&&(_._node.volume=_._volume*a)}return u}return u._volume},mute:function(a){var u=this||e;u.ctx||d(),u._muted=a,u.usingWebAudio&&u.masterGain.gain.setValueAtTime(a?0:u._volume,e.ctx.currentTime);for(var c=0;c<u._howls.length;c++)if(!u._howls[c]._webAudio)for(var p=u._howls[c]._getSoundIds(),y=0;y<p.length;y++){var _=u._howls[c]._soundById(p[y]);_&&_._node&&(_._node.muted=a?!0:_._muted)}return u},stop:function(){for(var a=this||e,u=0;u<a._howls.length;u++)a._howls[u].stop();return a},unload:function(){for(var a=this||e,u=a._howls.length-1;u>=0;u--)a._howls[u].unload();return a.usingWebAudio&&a.ctx&&typeof a.ctx.close<"u"&&(a.ctx.close(),a.ctx=null,d()),a},codecs:function(a){return(this||e)._codecs[a.replace(/^x-/,"")]},_setup:function(){var a=this||e;if(a.state=a.ctx&&a.ctx.state||"suspended",a._autoSuspend(),!a.usingWebAudio)if(typeof Audio<"u")try{var u=new Audio;typeof u.oncanplaythrough>"u"&&(a._canPlayEvent="canplay")}catch{a.noAudio=!0}else a.noAudio=!0;try{var u=new Audio;u.muted&&(a.noAudio=!0)}catch{}return a.noAudio||a._setupCodecs(),a},_setupCodecs:function(){var a=this||e,u=null;try{u=typeof Audio<"u"?new Audio:null}catch{return a}if(!u||typeof u.canPlayType!="function")return a;var c=u.canPlayType("audio/mpeg;").replace(/^no$/,""),p=a._navigator?a._navigator.userAgent:"",y=p.match(/OPR\/(\d+)/g),_=y&&parseInt(y[0].split("/")[1],10)<33,m=p.indexOf("Safari")!==-1&&p.indexOf("Chrome")===-1,x=p.match(/Version\/(.*?) /),v=m&&x&&parseInt(x[1],10)<15;return a._codecs={mp3:!!(!_&&(c||u.canPlayType("audio/mp3;").replace(/^no$/,""))),mpeg:!!c,opus:!!u.canPlayType('audio/ogg; codecs="opus"').replace(/^no$/,""),ogg:!!u.canPlayType('audio/ogg; codecs="vorbis"').replace(/^no$/,""),oga:!!u.canPlayType('audio/ogg; codecs="vorbis"').replace(/^no$/,""),wav:!!(u.canPlayType('audio/wav; codecs="1"')||u.canPlayType("audio/wav")).replace(/^no$/,""),aac:!!u.canPlayType("audio/aac;").replace(/^no$/,""),caf:!!u.canPlayType("audio/x-caf;").replace(/^no$/,""),m4a:!!(u.canPlayType("audio/x-m4a;")||u.canPlayType("audio/m4a;")||u.canPlayType("audio/aac;")).replace(/^no$/,""),m4b:!!(u.canPlayType("audio/x-m4b;")||u.canPlayType("audio/m4b;")||u.canPlayType("audio/aac;")).replace(/^no$/,""),mp4:!!(u.canPlayType("audio/x-mp4;")||u.canPlayType("audio/mp4;")||u.canPlayType("audio/aac;")).replace(/^no$/,""),weba:!!(!v&&u.canPlayType('audio/webm; codecs="vorbis"').replace(/^no$/,"")),webm:!!(!v&&u.canPlayType('audio/webm; codecs="vorbis"').replace(/^no$/,"")),dolby:!!u.canPlayType('audio/mp4; codecs="ec-3"').replace(/^no$/,""),flac:!!(u.canPlayType("audio/x-flac;")||u.canPlayType("audio/flac;")).replace(/^no$/,"")},a},_unlockAudio:function(){var a=this||e;if(!(a._audioUnlocked||!a.ctx)){a._audioUnlocked=!1,a.autoUnlock=!1,!a._mobileUnloaded&&a.ctx.sampleRate!==44100&&(a._mobileUnloaded=!0,a.unload()),a._scratchBuffer=a.ctx.createBuffer(1,1,22050);var u=function(c){for(;a._html5AudioPool.length<a.html5PoolSize;)try{var p=new Audio;p._unlocked=!0,a._releaseHtml5Audio(p)}catch{a.noAudio=!0;break}for(var y=0;y<a._howls.length;y++)if(!a._howls[y]._webAudio)for(var _=a._howls[y]._getSoundIds(),m=0;m<_.length;m++){var x=a._howls[y]._soundById(_[m]);x&&x._node&&!x._node._unlocked&&(x._node._unlocked=!0,x._node.load())}a._autoResume();var v=a.ctx.createBufferSource();v.buffer=a._scratchBuffer,v.connect(a.ctx.destination),typeof v.start>"u"?v.noteOn(0):v.start(0),typeof a.ctx.resume=="function"&&a.ctx.resume(),v.onended=function(){v.disconnect(0),a._audioUnlocked=!0,document.removeEventListener("touchstart",u,!0),document.removeEventListener("touchend",u,!0),document.removeEventListener("click",u,!0),document.removeEventListener("keydown",u,!0);for(var w=0;w<a._howls.length;w++)a._howls[w]._emit("unlock")}};return document.addEventListener("touchstart",u,!0),document.addEventListener("touchend",u,!0),document.addEventListener("click",u,!0),document.addEventListener("keydown",u,!0),a}},_obtainHtml5Audio:function(){var a=this||e;if(a._html5AudioPool.length)return a._html5AudioPool.pop();var u=new Audio().play();return u&&typeof Promise<"u"&&(u instanceof Promise||typeof u.then=="function")&&u.catch(function(){console.warn("HTML5 Audio pool exhausted, returning potentially locked audio object.")}),new Audio},_releaseHtml5Audio:function(a){var u=this||e;return a._unlocked&&u._html5AudioPool.push(a),u},_autoSuspend:function(){var a=this;if(!(!a.autoSuspend||!a.ctx||typeof a.ctx.suspend>"u"||!e.usingWebAudio)){for(var u=0;u<a._howls.length;u++)if(a._howls[u]._webAudio){for(var c=0;c<a._howls[u]._sounds.length;c++)if(!a._howls[u]._sounds[c]._paused)return a}return a._suspendTimer&&clearTimeout(a._suspendTimer),a._suspendTimer=setTimeout(function(){if(a.autoSuspend){a._suspendTimer=null,a.state="suspending";var p=function(){a.state="suspended",a._resumeAfterSuspend&&(delete a._resumeAfterSuspend,a._autoResume())};a.ctx.suspend().then(p,p)}},3e4),a}},_autoResume:function(){var a=this;if(!(!a.ctx||typeof a.ctx.resume>"u"||!e.usingWebAudio))return a.state==="running"&&a.ctx.state!=="interrupted"&&a._suspendTimer?(clearTimeout(a._suspendTimer),a._suspendTimer=null):a.state==="suspended"||a.state==="running"&&a.ctx.state==="interrupted"?(a.ctx.resume().then(function(){a.state="running";for(var u=0;u<a._howls.length;u++)a._howls[u]._emit("resume")}),a._suspendTimer&&(clearTimeout(a._suspendTimer),a._suspendTimer=null)):a.state==="suspending"&&(a._resumeAfterSuspend=!0),a}};var e=new t,i=function(a){var u=this;if(!a.src||a.src.length===0){console.error("An array of source files must be passed with any new Howl.");return}u.init(a)};i.prototype={init:function(a){var u=this;return e.ctx||d(),u._autoplay=a.autoplay||!1,u._format=typeof a.format!="string"?a.format:[a.format],u._html5=a.html5||!1,u._muted=a.mute||!1,u._loop=a.loop||!1,u._pool=a.pool||5,u._preload=typeof a.preload=="boolean"||a.preload==="metadata"?a.preload:!0,u._rate=a.rate||1,u._sprite=a.sprite||{},u._src=typeof a.src!="string"?a.src:[a.src],u._volume=a.volume!==void 0?a.volume:1,u._xhr={method:a.xhr&&a.xhr.method?a.xhr.method:"GET",headers:a.xhr&&a.xhr.headers?a.xhr.headers:null,withCredentials:a.xhr&&a.xhr.withCredentials?a.xhr.withCredentials:!1},u._duration=0,u._state="unloaded",u._sounds=[],u._endTimers={},u._queue=[],u._playLock=!1,u._onend=a.onend?[{fn:a.onend}]:[],u._onfade=a.onfade?[{fn:a.onfade}]:[],u._onload=a.onload?[{fn:a.onload}]:[],u._onloaderror=a.onloaderror?[{fn:a.onloaderror}]:[],u._onplayerror=a.onplayerror?[{fn:a.onplayerror}]:[],u._onpause=a.onpause?[{fn:a.onpause}]:[],u._onplay=a.onplay?[{fn:a.onplay}]:[],u._onstop=a.onstop?[{fn:a.onstop}]:[],u._onmute=a.onmute?[{fn:a.onmute}]:[],u._onvolume=a.onvolume?[{fn:a.onvolume}]:[],u._onrate=a.onrate?[{fn:a.onrate}]:[],u._onseek=a.onseek?[{fn:a.onseek}]:[],u._onunlock=a.onunlock?[{fn:a.onunlock}]:[],u._onresume=[],u._webAudio=e.usingWebAudio&&!u._html5,typeof e.ctx<"u"&&e.ctx&&e.autoUnlock&&e._unlockAudio(),e._howls.push(u),u._autoplay&&u._queue.push({event:"play",action:function(){u.play()}}),u._preload&&u._preload!=="none"&&u.load(),u},load:function(){var a=this,u=null;if(e.noAudio){a._emit("loaderror",null,"No audio support.");return}typeof a._src=="string"&&(a._src=[a._src]);for(var c=0;c<a._src.length;c++){var p,y;if(a._format&&a._format[c])p=a._format[c];else{if(y=a._src[c],typeof y!="string"){a._emit("loaderror",null,"Non-string found in selected audio sources - ignoring.");continue}p=/^data:audio\/([^;,]+);/i.exec(y),p||(p=/\.([^.]+)$/.exec(y.split("?",1)[0])),p&&(p=p[1].toLowerCase())}if(p||console.warn('No file extension was found. Consider using the "format" property or specify an extension.'),p&&e.codecs(p)){u=a._src[c];break}}if(!u){a._emit("loaderror",null,"No codec support for selected audio sources.");return}return a._src=u,a._state="loading",window.location.protocol==="https:"&&u.slice(0,5)==="http:"&&(a._html5=!0,a._webAudio=!1),new r(a),a._webAudio&&o(a),a},play:function(a,u){var c=this,p=null;if(typeof a=="number")p=a,a=null;else{if(typeof a=="string"&&c._state==="loaded"&&!c._sprite[a])return null;if(typeof a>"u"&&(a="__default",!c._playLock)){for(var y=0,_=0;_<c._sounds.length;_++)c._sounds[_]._paused&&!c._sounds[_]._ended&&(y++,p=c._sounds[_]._id);y===1?a=null:p=null}}var m=p?c._soundById(p):c._inactiveSound();if(!m)return null;if(p&&!a&&(a=m._sprite||"__default"),c._state!=="loaded"){m._sprite=a,m._ended=!1;var x=m._id;return c._queue.push({event:"play",action:function(){c.play(x)}}),x}if(p&&!m._paused)return u||c._loadQueue("play"),m._id;c._webAudio&&e._autoResume();var v=Math.max(0,m._seek>0?m._seek:c._sprite[a][0]/1e3),w=Math.max(0,(c._sprite[a][0]+c._sprite[a][1])/1e3-v),E=w*1e3/Math.abs(m._rate),A=c._sprite[a][0]/1e3,I=(c._sprite[a][0]+c._sprite[a][1])/1e3;m._sprite=a,m._ended=!1;var z=function(){m._paused=!1,m._seek=v,m._start=A,m._stop=I,m._loop=!!(m._loop||c._sprite[a][2])};if(v>=I){c._ended(m);return}var L=m._node;if(c._webAudio){var G=function(){c._playLock=!1,z(),c._refreshBuffer(m);var b=m._muted||c._muted?0:m._volume;L.gain.setValueAtTime(b,e.ctx.currentTime),m._playStart=e.ctx.currentTime,typeof L.bufferSource.start>"u"?m._loop?L.bufferSource.noteGrainOn(0,v,86400):L.bufferSource.noteGrainOn(0,v,w):m._loop?L.bufferSource.start(0,v,86400):L.bufferSource.start(0,v,w),E!==1/0&&(c._endTimers[m._id]=setTimeout(c._ended.bind(c,m),E)),u||setTimeout(function(){c._emit("play",m._id),c._loadQueue()},0)};e.state==="running"&&e.ctx.state!=="interrupted"?G():(c._playLock=!0,c.once("resume",G),c._clearTimer(m._id))}else{var Y=function(){L.currentTime=v,L.muted=m._muted||c._muted||e._muted||L.muted,L.volume=m._volume*e.volume(),L.playbackRate=m._rate;try{var b=L.play();if(b&&typeof Promise<"u"&&(b instanceof Promise||typeof b.then=="function")?(c._playLock=!0,z(),b.then(function(){c._playLock=!1,L._unlocked=!0,u?c._loadQueue():c._emit("play",m._id)}).catch(function(){c._playLock=!1,c._emit("playerror",m._id,"Playback was unable to start. This is most commonly an issue on mobile devices and Chrome where playback was not within a user interaction."),m._ended=!0,m._paused=!0})):u||(c._playLock=!1,z(),c._emit("play",m._id)),L.playbackRate=m._rate,L.paused){c._emit("playerror",m._id,"Playback was unable to start. This is most commonly an issue on mobile devices and Chrome where playback was not within a user interaction.");return}a!=="__default"||m._loop?c._endTimers[m._id]=setTimeout(c._ended.bind(c,m),E):(c._endTimers[m._id]=function(){c._ended(m),L.removeEventListener("ended",c._endTimers[m._id],!1)},L.addEventListener("ended",c._endTimers[m._id],!1))}catch(S){c._emit("playerror",m._id,S)}};L.src==="data:audio/wav;base64,UklGRigAAABXQVZFZm10IBIAAAABAAEARKwAAIhYAQACABAAAABkYXRhAgAAAAEA"&&(L.src=c._src,L.load());var q=window&&window.ejecta||!L.readyState&&e._navigator.isCocoonJS;if(L.readyState>=3||q)Y();else{c._playLock=!0,c._state="loading";var T=function(){c._state="loaded",Y(),L.removeEventListener(e._canPlayEvent,T,!1)};L.addEventListener(e._canPlayEvent,T,!1),c._clearTimer(m._id)}}return m._id},pause:function(a){var u=this;if(u._state!=="loaded"||u._playLock)return u._queue.push({event:"pause",action:function(){u.pause(a)}}),u;for(var c=u._getSoundIds(a),p=0;p<c.length;p++){u._clearTimer(c[p]);var y=u._soundById(c[p]);if(y&&!y._paused&&(y._seek=u.seek(c[p]),y._rateSeek=0,y._paused=!0,u._stopFade(c[p]),y._node))if(u._webAudio){if(!y._node.bufferSource)continue;typeof y._node.bufferSource.stop>"u"?y._node.bufferSource.noteOff(0):y._node.bufferSource.stop(0),u._cleanBuffer(y._node)}else(!isNaN(y._node.duration)||y._node.duration===1/0)&&y._node.pause();arguments[1]||u._emit("pause",y?y._id:null)}return u},stop:function(a,u){var c=this;if(c._state!=="loaded"||c._playLock)return c._queue.push({event:"stop",action:function(){c.stop(a)}}),c;for(var p=c._getSoundIds(a),y=0;y<p.length;y++){c._clearTimer(p[y]);var _=c._soundById(p[y]);_&&(_._seek=_._start||0,_._rateSeek=0,_._paused=!0,_._ended=!0,c._stopFade(p[y]),_._node&&(c._webAudio?_._node.bufferSource&&(typeof _._node.bufferSource.stop>"u"?_._node.bufferSource.noteOff(0):_._node.bufferSource.stop(0),c._cleanBuffer(_._node)):(!isNaN(_._node.duration)||_._node.duration===1/0)&&(_._node.currentTime=_._start||0,_._node.pause(),_._node.duration===1/0&&c._clearSound(_._node))),u||c._emit("stop",_._id))}return c},mute:function(a,u){var c=this;if(c._state!=="loaded"||c._playLock)return c._queue.push({event:"mute",action:function(){c.mute(a,u)}}),c;if(typeof u>"u")if(typeof a=="boolean")c._muted=a;else return c._muted;for(var p=c._getSoundIds(u),y=0;y<p.length;y++){var _=c._soundById(p[y]);_&&(_._muted=a,_._interval&&c._stopFade(_._id),c._webAudio&&_._node?_._node.gain.setValueAtTime(a?0:_._volume,e.ctx.currentTime):_._node&&(_._node.muted=e._muted?!0:a),c._emit("mute",_._id))}return c},volume:function(){var a=this,u=arguments,c,p;if(u.length===0)return a._volume;if(u.length===1||u.length===2&&typeof u[1]>"u"){var y=a._getSoundIds(),_=y.indexOf(u[0]);_>=0?p=parseInt(u[0],10):c=parseFloat(u[0])}else u.length>=2&&(c=parseFloat(u[0]),p=parseInt(u[1],10));var m;if(typeof c<"u"&&c>=0&&c<=1){if(a._state!=="loaded"||a._playLock)return a._queue.push({event:"volume",action:function(){a.volume.apply(a,u)}}),a;typeof p>"u"&&(a._volume=c),p=a._getSoundIds(p);for(var x=0;x<p.length;x++)m=a._soundById(p[x]),m&&(m._volume=c,u[2]||a._stopFade(p[x]),a._webAudio&&m._node&&!m._muted?m._node.gain.setValueAtTime(c,e.ctx.currentTime):m._node&&!m._muted&&(m._node.volume=c*e.volume()),a._emit("volume",m._id))}else return m=p?a._soundById(p):a._sounds[0],m?m._volume:0;return a},fade:function(a,u,c,p){var y=this;if(y._state!=="loaded"||y._playLock)return y._queue.push({event:"fade",action:function(){y.fade(a,u,c,p)}}),y;a=Math.min(Math.max(0,parseFloat(a)),1),u=Math.min(Math.max(0,parseFloat(u)),1),c=parseFloat(c),y.volume(a,p);for(var _=y._getSoundIds(p),m=0;m<_.length;m++){var x=y._soundById(_[m]);if(x){if(p||y._stopFade(_[m]),y._webAudio&&!x._muted){var v=e.ctx.currentTime,w=v+c/1e3;x._volume=a,x._node.gain.setValueAtTime(a,v),x._node.gain.linearRampToValueAtTime(u,w)}y._startFadeInterval(x,a,u,c,_[m],typeof p>"u")}}return y},_startFadeInterval:function(a,u,c,p,y,_){var m=this,x=u,v=c-u,w=Math.abs(v/.01),E=Math.max(4,w>0?p/w:p),A=Date.now();a._fadeTo=c,a._interval=setInterval(function(){var I=(Date.now()-A)/p;A=Date.now(),x+=v*I,x=Math.round(x*100)/100,v<0?x=Math.max(c,x):x=Math.min(c,x),m._webAudio?a._volume=x:m.volume(x,a._id,!0),_&&(m._volume=x),(c<u&&x<=c||c>u&&x>=c)&&(clearInterval(a._interval),a._interval=null,a._fadeTo=null,m.volume(c,a._id),m._emit("fade",a._id))},E)},_stopFade:function(a){var u=this,c=u._soundById(a);return c&&c._interval&&(u._webAudio&&c._node.gain.cancelScheduledValues(e.ctx.currentTime),clearInterval(c._interval),c._interval=null,u.volume(c._fadeTo,a),c._fadeTo=null,u._emit("fade",a)),u},loop:function(){var a=this,u=arguments,c,p,y;if(u.length===0)return a._loop;if(u.length===1)if(typeof u[0]=="boolean")c=u[0],a._loop=c;else return y=a._soundById(parseInt(u[0],10)),y?y._loop:!1;else u.length===2&&(c=u[0],p=parseInt(u[1],10));for(var _=a._getSoundIds(p),m=0;m<_.length;m++)y=a._soundById(_[m]),y&&(y._loop=c,a._webAudio&&y._node&&y._node.bufferSource&&(y._node.bufferSource.loop=c,c&&(y._node.bufferSource.loopStart=y._start||0,y._node.bufferSource.loopEnd=y._stop,a.playing(_[m])&&(a.pause(_[m],!0),a.play(_[m],!0)))));return a},rate:function(){var a=this,u=arguments,c,p;if(u.length===0)p=a._sounds[0]._id;else if(u.length===1){var y=a._getSoundIds(),_=y.indexOf(u[0]);_>=0?p=parseInt(u[0],10):c=parseFloat(u[0])}else u.length===2&&(c=parseFloat(u[0]),p=parseInt(u[1],10));var m;if(typeof c=="number"){if(a._state!=="loaded"||a._playLock)return a._queue.push({event:"rate",action:function(){a.rate.apply(a,u)}}),a;typeof p>"u"&&(a._rate=c),p=a._getSoundIds(p);for(var x=0;x<p.length;x++)if(m=a._soundById(p[x]),m){a.playing(p[x])&&(m._rateSeek=a.seek(p[x]),m._playStart=a._webAudio?e.ctx.currentTime:m._playStart),m._rate=c,a._webAudio&&m._node&&m._node.bufferSource?m._node.bufferSource.playbackRate.setValueAtTime(c,e.ctx.currentTime):m._node&&(m._node.playbackRate=c);var v=a.seek(p[x]),w=(a._sprite[m._sprite][0]+a._sprite[m._sprite][1])/1e3-v,E=w*1e3/Math.abs(m._rate);(a._endTimers[p[x]]||!m._paused)&&(a._clearTimer(p[x]),a._endTimers[p[x]]=setTimeout(a._ended.bind(a,m),E)),a._emit("rate",m._id)}}else return m=a._soundById(p),m?m._rate:a._rate;return a},seek:function(){var a=this,u=arguments,c,p;if(u.length===0)a._sounds.length&&(p=a._sounds[0]._id);else if(u.length===1){var y=a._getSoundIds(),_=y.indexOf(u[0]);_>=0?p=parseInt(u[0],10):a._sounds.length&&(p=a._sounds[0]._id,c=parseFloat(u[0]))}else u.length===2&&(c=parseFloat(u[0]),p=parseInt(u[1],10));if(typeof p>"u")return 0;if(typeof c=="number"&&(a._state!=="loaded"||a._playLock))return a._queue.push({event:"seek",action:function(){a.seek.apply(a,u)}}),a;var m=a._soundById(p);if(m)if(typeof c=="number"&&c>=0){var x=a.playing(p);x&&a.pause(p,!0),m._seek=c,m._ended=!1,a._clearTimer(p),!a._webAudio&&m._node&&!isNaN(m._node.duration)&&(m._node.currentTime=c);var v=function(){x&&a.play(p,!0),a._emit("seek",p)};if(x&&!a._webAudio){var w=function(){a._playLock?setTimeout(w,0):v()};setTimeout(w,0)}else v()}else if(a._webAudio){var E=a.playing(p)?e.ctx.currentTime-m._playStart:0,A=m._rateSeek?m._rateSeek-m._seek:0;return m._seek+(A+E*Math.abs(m._rate))}else return m._node.currentTime;return a},playing:function(a){var u=this;if(typeof a=="number"){var c=u._soundById(a);return c?!c._paused:!1}for(var p=0;p<u._sounds.length;p++)if(!u._sounds[p]._paused)return!0;return!1},duration:function(a){var u=this,c=u._duration,p=u._soundById(a);return p&&(c=u._sprite[p._sprite][1]/1e3),c},state:function(){return this._state},unload:function(){for(var a=this,u=a._sounds,c=0;c<u.length;c++)u[c]._paused||a.stop(u[c]._id),a._webAudio||(a._clearSound(u[c]._node),u[c]._node.removeEventListener("error",u[c]._errorFn,!1),u[c]._node.removeEventListener(e._canPlayEvent,u[c]._loadFn,!1),u[c]._node.removeEventListener("ended",u[c]._endFn,!1),e._releaseHtml5Audio(u[c]._node)),delete u[c]._node,a._clearTimer(u[c]._id);var p=e._howls.indexOf(a);p>=0&&e._howls.splice(p,1);var y=!0;for(c=0;c<e._howls.length;c++)if(e._howls[c]._src===a._src||a._src.indexOf(e._howls[c]._src)>=0){y=!1;break}return n&&y&&delete n[a._src],e.noAudio=!1,a._state="unloaded",a._sounds=[],a=null,null},on:function(a,u,c,p){var y=this,_=y["_on"+a];return typeof u=="function"&&_.push(p?{id:c,fn:u,once:p}:{id:c,fn:u}),y},off:function(a,u,c){var p=this,y=p["_on"+a],_=0;if(typeof u=="number"&&(c=u,u=null),u||c)for(_=0;_<y.length;_++){var m=c===y[_].id;if(u===y[_].fn&&m||!u&&m){y.splice(_,1);break}}else if(a)p["_on"+a]=[];else{var x=Object.keys(p);for(_=0;_<x.length;_++)x[_].indexOf("_on")===0&&Array.isArray(p[x[_]])&&(p[x[_]]=[])}return p},once:function(a,u,c){var p=this;return p.on(a,u,c,1),p},_emit:function(a,u,c){for(var p=this,y=p["_on"+a],_=y.length-1;_>=0;_--)(!y[_].id||y[_].id===u||a==="load")&&(setTimeout((function(m){m.call(this,u,c)}).bind(p,y[_].fn),0),y[_].once&&p.off(a,y[_].fn,y[_].id));return p._loadQueue(a),p},_loadQueue:function(a){var u=this;if(u._queue.length>0){var c=u._queue[0];c.event===a&&(u._queue.shift(),u._loadQueue()),a||c.action()}return u},_ended:function(a){var u=this,c=a._sprite;if(!u._webAudio&&a._node&&!a._node.paused&&!a._node.ended&&a._node.currentTime<a._stop)return setTimeout(u._ended.bind(u,a),100),u;var p=!!(a._loop||u._sprite[c][2]);if(u._emit("end",a._id),!u._webAudio&&p&&u.stop(a._id,!0).play(a._id),u._webAudio&&p){u._emit("play",a._id),a._seek=a._start||0,a._rateSeek=0,a._playStart=e.ctx.currentTime;var y=(a._stop-a._start)*1e3/Math.abs(a._rate);u._endTimers[a._id]=setTimeout(u._ended.bind(u,a),y)}return u._webAudio&&!p&&(a._paused=!0,a._ended=!0,a._seek=a._start||0,a._rateSeek=0,u._clearTimer(a._id),u._cleanBuffer(a._node),e._autoSuspend()),!u._webAudio&&!p&&u.stop(a._id,!0),u},_clearTimer:function(a){var u=this;if(u._endTimers[a]){if(typeof u._endTimers[a]!="function")clearTimeout(u._endTimers[a]);else{var c=u._soundById(a);c&&c._node&&c._node.removeEventListener("ended",u._endTimers[a],!1)}delete u._endTimers[a]}return u},_soundById:function(a){for(var u=this,c=0;c<u._sounds.length;c++)if(a===u._sounds[c]._id)return u._sounds[c];return null},_inactiveSound:function(){var a=this;a._drain();for(var u=0;u<a._sounds.length;u++)if(a._sounds[u]._ended)return a._sounds[u].reset();return new r(a)},_drain:function(){var a=this,u=a._pool,c=0,p=0;if(!(a._sounds.length<u)){for(p=0;p<a._sounds.length;p++)a._sounds[p]._ended&&c++;for(p=a._sounds.length-1;p>=0;p--){if(c<=u)return;a._sounds[p]._ended&&(a._webAudio&&a._sounds[p]._node&&a._sounds[p]._node.disconnect(0),a._sounds.splice(p,1),c--)}}},_getSoundIds:function(a){var u=this;if(typeof a>"u"){for(var c=[],p=0;p<u._sounds.length;p++)c.push(u._sounds[p]._id);return c}else return[a]},_refreshBuffer:function(a){var u=this;return a._node.bufferSource=e.ctx.createBufferSource(),a._node.bufferSource.buffer=n[u._src],a._panner?a._node.bufferSource.connect(a._panner):a._node.bufferSource.connect(a._node),a._node.bufferSource.loop=a._loop,a._loop&&(a._node.bufferSource.loopStart=a._start||0,a._node.bufferSource.loopEnd=a._stop||0),a._node.bufferSource.playbackRate.setValueAtTime(a._rate,e.ctx.currentTime),u},_cleanBuffer:function(a){var u=this,c=e._navigator&&e._navigator.vendor.indexOf("Apple")>=0;if(!a.bufferSource)return u;if(e._scratchBuffer&&a.bufferSource&&(a.bufferSource.onended=null,a.bufferSource.disconnect(0),c))try{a.bufferSource.buffer=e._scratchBuffer}catch{}return a.bufferSource=null,u},_clearSound:function(a){var u=/MSIE |Trident\//.test(e._navigator&&e._navigator.userAgent);u||(a.src="data:audio/wav;base64,UklGRigAAABXQVZFZm10IBIAAAABAAEARKwAAIhYAQACABAAAABkYXRhAgAAAAEA")}};var r=function(a){this._parent=a,this.init()};r.prototype={init:function(){var a=this,u=a._parent;return a._muted=u._muted,a._loop=u._loop,a._volume=u._volume,a._rate=u._rate,a._seek=0,a._paused=!0,a._ended=!0,a._sprite="__default",a._id=++e._counter,u._sounds.push(a),a.create(),a},create:function(){var a=this,u=a._parent,c=e._muted||a._muted||a._parent._muted?0:a._volume;return u._webAudio?(a._node=typeof e.ctx.createGain>"u"?e.ctx.createGainNode():e.ctx.createGain(),a._node.gain.setValueAtTime(c,e.ctx.currentTime),a._node.paused=!0,a._node.connect(e.masterGain)):e.noAudio||(a._node=e._obtainHtml5Audio(),a._errorFn=a._errorListener.bind(a),a._node.addEventListener("error",a._errorFn,!1),a._loadFn=a._loadListener.bind(a),a._node.addEventListener(e._canPlayEvent,a._loadFn,!1),a._endFn=a._endListener.bind(a),a._node.addEventListener("ended",a._endFn,!1),a._node.src=u._src,a._node.preload=u._preload===!0?"auto":u._preload,a._node.volume=c*e.volume(),a._node.load()),a},reset:function(){var a=this,u=a._parent;return a._muted=u._muted,a._loop=u._loop,a._volume=u._volume,a._rate=u._rate,a._seek=0,a._rateSeek=0,a._paused=!0,a._ended=!0,a._sprite="__default",a._id=++e._counter,a},_errorListener:function(){var a=this;a._parent._emit("loaderror",a._id,a._node.error?a._node.error.code:0),a._node.removeEventListener("error",a._errorFn,!1)},_loadListener:function(){var a=this,u=a._parent;u._duration=Math.ceil(a._node.duration*10)/10,Object.keys(u._sprite).length===0&&(u._sprite={__default:[0,u._duration*1e3]}),u._state!=="loaded"&&(u._state="loaded",u._emit("load"),u._loadQueue()),a._node.removeEventListener(e._canPlayEvent,a._loadFn,!1)},_endListener:function(){var a=this,u=a._parent;u._duration===1/0&&(u._duration=Math.ceil(a._node.duration*10)/10,u._sprite.__default[1]===1/0&&(u._sprite.__default[1]=u._duration*1e3),u._ended(a)),a._node.removeEventListener("ended",a._endFn,!1)}};var n={},o=function(a){var u=a._src;if(n[u]){a._duration=n[u].duration,f(a);return}if(/^data:[^;]+;base64,/.test(u)){for(var c=atob(u.split(",")[1]),p=new Uint8Array(c.length),y=0;y<c.length;++y)p[y]=c.charCodeAt(y);l(p.buffer,a)}else{var _=new XMLHttpRequest;_.open(a._xhr.method,u,!0),_.withCredentials=a._xhr.withCredentials,_.responseType="arraybuffer",a._xhr.headers&&Object.keys(a._xhr.headers).forEach(function(m){_.setRequestHeader(m,a._xhr.headers[m])}),_.onload=function(){var m=(_.status+"")[0];if(m!=="0"&&m!=="2"&&m!=="3"){a._emit("loaderror",null,"Failed loading audio file with status: "+_.status+".");return}l(_.response,a)},_.onerror=function(){a._webAudio&&(a._html5=!0,a._webAudio=!1,a._sounds=[],delete n[u],a.load())},h(_)}},h=function(a){try{a.send()}catch{a.onerror()}},l=function(a,u){var c=function(){u._emit("loaderror",null,"Decoding audio data failed.")},p=function(y){y&&u._sounds.length>0?(n[u._src]=y,f(u,y)):c()};typeof Promise<"u"&&e.ctx.decodeAudioData.length===1?e.ctx.decodeAudioData(a).then(p).catch(c):e.ctx.decodeAudioData(a,p,c)},f=function(a,u){u&&!a._duration&&(a._duration=u.duration),Object.keys(a._sprite).length===0&&(a._sprite={__default:[0,a._duration*1e3]}),a._state!=="loaded"&&(a._state="loaded",a._emit("load"),a._loadQueue())},d=function(){if(e.usingWebAudio){try{typeof AudioContext<"u"?e.ctx=new AudioContext:typeof webkitAudioContext<"u"?e.ctx=new webkitAudioContext:e.usingWebAudio=!1}catch{e.usingWebAudio=!1}e.ctx||(e.usingWebAudio=!1);var a=/iP(hone|od|ad)/.test(e._navigator&&e._navigator.platform),u=e._navigator&&e._navigator.appVersion.match(/OS (\d+)_(\d+)_?(\d+)?/),c=u?parseInt(u[1],10):null;if(a&&c&&c<9){var p=/safari/.test(e._navigator&&e._navigator.userAgent.toLowerCase());e._navigator&&!p&&(e.usingWebAudio=!1)}e.usingWebAudio&&(e.masterGain=typeof e.ctx.createGain>"u"?e.ctx.createGainNode():e.ctx.createGain(),e.masterGain.gain.setValueAtTime(e._muted?0:e._volume,e.ctx.currentTime),e.masterGain.connect(e.ctx.destination)),e._setup()}};s.Howler=e,s.Howl=i,typeof Pt<"u"?(Pt.HowlerGlobal=t,Pt.Howler=e,Pt.Howl=i,Pt.Sound=r):typeof window<"u"&&(window.HowlerGlobal=t,window.Howler=e,window.Howl=i,window.Sound=r)})();/*!
 *  Spatial Plugin - Adds support for stereo and 3D audio where Web Audio is supported.
 *  
 *  howler.js v2.2.4
 *  howlerjs.com
 *
 *  (c) 2013-2020, James Simpson of GoldFire Studios
 *  goldfirestudios.com
 *
 *  MIT License
 */(function(){HowlerGlobal.prototype._pos=[0,0,0],HowlerGlobal.prototype._orientation=[0,0,-1,0,1,0],HowlerGlobal.prototype.stereo=function(e){var i=this;if(!i.ctx||!i.ctx.listener)return i;for(var r=i._howls.length-1;r>=0;r--)i._howls[r].stereo(e);return i},HowlerGlobal.prototype.pos=function(e,i,r){var n=this;if(!n.ctx||!n.ctx.listener)return n;if(i=typeof i!="number"?n._pos[1]:i,r=typeof r!="number"?n._pos[2]:r,typeof e=="number")n._pos=[e,i,r],typeof n.ctx.listener.positionX<"u"?(n.ctx.listener.positionX.setTargetAtTime(n._pos[0],Howler.ctx.currentTime,.1),n.ctx.listener.positionY.setTargetAtTime(n._pos[1],Howler.ctx.currentTime,.1),n.ctx.listener.positionZ.setTargetAtTime(n._pos[2],Howler.ctx.currentTime,.1)):n.ctx.listener.setPosition(n._pos[0],n._pos[1],n._pos[2]);else return n._pos;return n},HowlerGlobal.prototype.orientation=function(e,i,r,n,o,h){var l=this;if(!l.ctx||!l.ctx.listener)return l;var f=l._orientation;if(i=typeof i!="number"?f[1]:i,r=typeof r!="number"?f[2]:r,n=typeof n!="number"?f[3]:n,o=typeof o!="number"?f[4]:o,h=typeof h!="number"?f[5]:h,typeof e=="number")l._orientation=[e,i,r,n,o,h],typeof l.ctx.listener.forwardX<"u"?(l.ctx.listener.forwardX.setTargetAtTime(e,Howler.ctx.currentTime,.1),l.ctx.listener.forwardY.setTargetAtTime(i,Howler.ctx.currentTime,.1),l.ctx.listener.forwardZ.setTargetAtTime(r,Howler.ctx.currentTime,.1),l.ctx.listener.upX.setTargetAtTime(n,Howler.ctx.currentTime,.1),l.ctx.listener.upY.setTargetAtTime(o,Howler.ctx.currentTime,.1),l.ctx.listener.upZ.setTargetAtTime(h,Howler.ctx.currentTime,.1)):l.ctx.listener.setOrientation(e,i,r,n,o,h);else return f;return l},Howl.prototype.init=(function(e){return function(i){var r=this;return r._orientation=i.orientation||[1,0,0],r._stereo=i.stereo||null,r._pos=i.pos||null,r._pannerAttr={coneInnerAngle:typeof i.coneInnerAngle<"u"?i.coneInnerAngle:360,coneOuterAngle:typeof i.coneOuterAngle<"u"?i.coneOuterAngle:360,coneOuterGain:typeof i.coneOuterGain<"u"?i.coneOuterGain:0,distanceModel:typeof i.distanceModel<"u"?i.distanceModel:"inverse",maxDistance:typeof i.maxDistance<"u"?i.maxDistance:1e4,panningModel:typeof i.panningModel<"u"?i.panningModel:"HRTF",refDistance:typeof i.refDistance<"u"?i.refDistance:1,rolloffFactor:typeof i.rolloffFactor<"u"?i.rolloffFactor:1},r._onstereo=i.onstereo?[{fn:i.onstereo}]:[],r._onpos=i.onpos?[{fn:i.onpos}]:[],r._onorientation=i.onorientation?[{fn:i.onorientation}]:[],e.call(this,i)}})(Howl.prototype.init),Howl.prototype.stereo=function(e,i){var r=this;if(!r._webAudio)return r;if(r._state!=="loaded")return r._queue.push({event:"stereo",action:function(){r.stereo(e,i)}}),r;var n=typeof Howler.ctx.createStereoPanner>"u"?"spatial":"stereo";if(typeof i>"u")if(typeof e=="number")r._stereo=e,r._pos=[e,0,0];else return r._stereo;for(var o=r._getSoundIds(i),h=0;h<o.length;h++){var l=r._soundById(o[h]);if(l)if(typeof e=="number")l._stereo=e,l._pos=[e,0,0],l._node&&(l._pannerAttr.panningModel="equalpower",(!l._panner||!l._panner.pan)&&t(l,n),n==="spatial"?typeof l._panner.positionX<"u"?(l._panner.positionX.setValueAtTime(e,Howler.ctx.currentTime),l._panner.positionY.setValueAtTime(0,Howler.ctx.currentTime),l._panner.positionZ.setValueAtTime(0,Howler.ctx.currentTime)):l._panner.setPosition(e,0,0):l._panner.pan.setValueAtTime(e,Howler.ctx.currentTime)),r._emit("stereo",l._id);else return l._stereo}return r},Howl.prototype.pos=function(e,i,r,n){var o=this;if(!o._webAudio)return o;if(o._state!=="loaded")return o._queue.push({event:"pos",action:function(){o.pos(e,i,r,n)}}),o;if(i=typeof i!="number"?0:i,r=typeof r!="number"?-.5:r,typeof n>"u")if(typeof e=="number")o._pos=[e,i,r];else return o._pos;for(var h=o._getSoundIds(n),l=0;l<h.length;l++){var f=o._soundById(h[l]);if(f)if(typeof e=="number")f._pos=[e,i,r],f._node&&((!f._panner||f._panner.pan)&&t(f,"spatial"),typeof f._panner.positionX<"u"?(f._panner.positionX.setValueAtTime(e,Howler.ctx.currentTime),f._panner.positionY.setValueAtTime(i,Howler.ctx.currentTime),f._panner.positionZ.setValueAtTime(r,Howler.ctx.currentTime)):f._panner.setPosition(e,i,r)),o._emit("pos",f._id);else return f._pos}return o},Howl.prototype.orientation=function(e,i,r,n){var o=this;if(!o._webAudio)return o;if(o._state!=="loaded")return o._queue.push({event:"orientation",action:function(){o.orientation(e,i,r,n)}}),o;if(i=typeof i!="number"?o._orientation[1]:i,r=typeof r!="number"?o._orientation[2]:r,typeof n>"u")if(typeof e=="number")o._orientation=[e,i,r];else return o._orientation;for(var h=o._getSoundIds(n),l=0;l<h.length;l++){var f=o._soundById(h[l]);if(f)if(typeof e=="number")f._orientation=[e,i,r],f._node&&(f._panner||(f._pos||(f._pos=o._pos||[0,0,-.5]),t(f,"spatial")),typeof f._panner.orientationX<"u"?(f._panner.orientationX.setValueAtTime(e,Howler.ctx.currentTime),f._panner.orientationY.setValueAtTime(i,Howler.ctx.currentTime),f._panner.orientationZ.setValueAtTime(r,Howler.ctx.currentTime)):f._panner.setOrientation(e,i,r)),o._emit("orientation",f._id);else return f._orientation}return o},Howl.prototype.pannerAttr=function(){var e=this,i=arguments,r,n,o;if(!e._webAudio)return e;if(i.length===0)return e._pannerAttr;if(i.length===1)if(typeof i[0]=="object")r=i[0],typeof n>"u"&&(r.pannerAttr||(r.pannerAttr={coneInnerAngle:r.coneInnerAngle,coneOuterAngle:r.coneOuterAngle,coneOuterGain:r.coneOuterGain,distanceModel:r.distanceModel,maxDistance:r.maxDistance,refDistance:r.refDistance,rolloffFactor:r.rolloffFactor,panningModel:r.panningModel}),e._pannerAttr={coneInnerAngle:typeof r.pannerAttr.coneInnerAngle<"u"?r.pannerAttr.coneInnerAngle:e._coneInnerAngle,coneOuterAngle:typeof r.pannerAttr.coneOuterAngle<"u"?r.pannerAttr.coneOuterAngle:e._coneOuterAngle,coneOuterGain:typeof r.pannerAttr.coneOuterGain<"u"?r.pannerAttr.coneOuterGain:e._coneOuterGain,distanceModel:typeof r.pannerAttr.distanceModel<"u"?r.pannerAttr.distanceModel:e._distanceModel,maxDistance:typeof r.pannerAttr.maxDistance<"u"?r.pannerAttr.maxDistance:e._maxDistance,refDistance:typeof r.pannerAttr.refDistance<"u"?r.pannerAttr.refDistance:e._refDistance,rolloffFactor:typeof r.pannerAttr.rolloffFactor<"u"?r.pannerAttr.rolloffFactor:e._rolloffFactor,panningModel:typeof r.pannerAttr.panningModel<"u"?r.pannerAttr.panningModel:e._panningModel});else return o=e._soundById(parseInt(i[0],10)),o?o._pannerAttr:e._pannerAttr;else i.length===2&&(r=i[0],n=parseInt(i[1],10));for(var h=e._getSoundIds(n),l=0;l<h.length;l++)if(o=e._soundById(h[l]),o){var f=o._pannerAttr;f={coneInnerAngle:typeof r.coneInnerAngle<"u"?r.coneInnerAngle:f.coneInnerAngle,coneOuterAngle:typeof r.coneOuterAngle<"u"?r.coneOuterAngle:f.coneOuterAngle,coneOuterGain:typeof r.coneOuterGain<"u"?r.coneOuterGain:f.coneOuterGain,distanceModel:typeof r.distanceModel<"u"?r.distanceModel:f.distanceModel,maxDistance:typeof r.maxDistance<"u"?r.maxDistance:f.maxDistance,refDistance:typeof r.refDistance<"u"?r.refDistance:f.refDistance,rolloffFactor:typeof r.rolloffFactor<"u"?r.rolloffFactor:f.rolloffFactor,panningModel:typeof r.panningModel<"u"?r.panningModel:f.panningModel};var d=o._panner;d||(o._pos||(o._pos=e._pos||[0,0,-.5]),t(o,"spatial"),d=o._panner),d.coneInnerAngle=f.coneInnerAngle,d.coneOuterAngle=f.coneOuterAngle,d.coneOuterGain=f.coneOuterGain,d.distanceModel=f.distanceModel,d.maxDistance=f.maxDistance,d.refDistance=f.refDistance,d.rolloffFactor=f.rolloffFactor,d.panningModel=f.panningModel}return e},Sound.prototype.init=(function(e){return function(){var i=this,r=i._parent;i._orientation=r._orientation,i._stereo=r._stereo,i._pos=r._pos,i._pannerAttr=r._pannerAttr,e.call(this),i._stereo?r.stereo(i._stereo):i._pos&&r.pos(i._pos[0],i._pos[1],i._pos[2],i._id)}})(Sound.prototype.init),Sound.prototype.reset=(function(e){return function(){var i=this,r=i._parent;return i._orientation=r._orientation,i._stereo=r._stereo,i._pos=r._pos,i._pannerAttr=r._pannerAttr,i._stereo?r.stereo(i._stereo):i._pos?r.pos(i._pos[0],i._pos[1],i._pos[2],i._id):i._panner&&(i._panner.disconnect(0),i._panner=void 0,r._refreshBuffer(i)),e.call(this)}})(Sound.prototype.reset);var t=function(e,i){i=i||"spatial",i==="spatial"?(e._panner=Howler.ctx.createPanner(),e._panner.coneInnerAngle=e._pannerAttr.coneInnerAngle,e._panner.coneOuterAngle=e._pannerAttr.coneOuterAngle,e._panner.coneOuterGain=e._pannerAttr.coneOuterGain,e._panner.distanceModel=e._pannerAttr.distanceModel,e._panner.maxDistance=e._pannerAttr.maxDistance,e._panner.refDistance=e._pannerAttr.refDistance,e._panner.rolloffFactor=e._pannerAttr.rolloffFactor,e._panner.panningModel=e._pannerAttr.panningModel,typeof e._panner.positionX<"u"?(e._panner.positionX.setValueAtTime(e._pos[0],Howler.ctx.currentTime),e._panner.positionY.setValueAtTime(e._pos[1],Howler.ctx.currentTime),e._panner.positionZ.setValueAtTime(e._pos[2],Howler.ctx.currentTime)):e._panner.setPosition(e._pos[0],e._pos[1],e._pos[2]),typeof e._panner.orientationX<"u"?(e._panner.orientationX.setValueAtTime(e._orientation[0],Howler.ctx.currentTime),e._panner.orientationY.setValueAtTime(e._orientation[1],Howler.ctx.currentTime),e._panner.orientationZ.setValueAtTime(e._orientation[2],Howler.ctx.currentTime)):e._panner.setOrientation(e._orientation[0],e._orientation[1],e._orientation[2])):(e._panner=Howler.ctx.createStereoPanner(),e._panner.pan.setValueAtTime(e._stereo,Howler.ctx.currentTime)),e._panner.connect(e._node),e._paused||e._parent.pause(e._id,!0).play(e._id,!0)}})()})(zs);function Xa(s){return s.charAt(0).toUpperCase()+s.slice(1)}function Wa(s){return typeof s=="string"&&(s=s.trim()),!isNaN(s)&&/^[+-]?(\d+(\.\d+)?|\.\d+)$/.test(s)}function kd(s){const t=s.trim();return t==="true"||t==="false"}function Fd(s){let t="",e=0;for(;e<s.length;)t+=s.charCodeAt(e++).toString(16);return t}function mi(s){return/^data:(.+);base64,(.+)$/.test(s)}let Yt={},Ya=0,us=[],Vd=function(s,t){if(Ya++>3){let e="melonJS: failed loading "+s;throw new Error(e)}else Yt[s].load()};function Ud(s,t,e,i={}){let r=[];if(us.length===0)throw new Error("target audio extension(s) should be set through me.audio.init() before calling the preloader.");if(mi(s.src)===!0)r.push(s.src);else for(let n=0;n<us.length;n++)r.push(s.src+s.name+"."+us[n]+i.nocache);return Yt[s.name]=new zs.Howl({src:r,volume:zs.Howler.volume(),autoplay:s.autoplay===!0,loop:s.loop=!0,html5:s.stream===!0||s.html5===!0,xhrWithCredentials:i.withCredentials,onloaderror(){Vd.call(this,s.name,e)},onload(){Ya=0,typeof t=="function"&&t()}}),1}function qa(s){return s in Yt?(Yt[s].unload(),delete Yt[s],!0):!1}function zd(){for(let s in Yt)Yt.hasOwnProperty(s)&&qa(s)}let Gs=!1;try{Gs=typeof globalThis<"u"&&typeof globalThis.localStorage<"u"}catch{Gs=!1}ye(Pi,()=>{if(Gs===!0){let s=globalThis.localStorage.getItem("me.save");typeof s=="string"&&s.length>0&&(JSON.parse(s)||[]).forEach(e=>{JSON.parse(globalThis.localStorage.getItem("me.save."+e))})}});const Ka=["ms","MS","moz","webkit","o"];function _i(s,t){if(t=t||globalThis,s in t)return t[s];let e=Xa(s),i;return Ka.some(r=>{let n=r+e;return i=n in t?t[n]:void 0}),i}function Gd(s,t,e){if(e=e||globalThis,s in e){e[s]=t;return}let i=Xa(s);return Ka.some(r=>{let n=r+i;return n in e?(e[n]=t,!0):!1}),!1}const ve=typeof globalThis.navigator<"u"?globalThis.navigator.userAgent:"",jd=/iPhone|iPad|iPod/i.test(ve),Hd=/Android/i.test(ve),Xd=/Windows Phone/i.test(ve),Wd=/BlackBerry/i.test(ve),Yd=/Kindle|Silk.*Mobile Safari/i.test(ve),Za=typeof globalThis.process<"u"&&typeof globalThis.process.release<"u"&&globalThis.process.release.name==="node",Qa=/Mobi/i.test(ve)||jd||Hd||Xd||Wd||Yd||!1;typeof globalThis.navigator<"u"&&globalThis.navigator.standalone===!0||typeof globalThis.matchMedia<"u"&&globalThis.matchMedia("(display-mode: standalone)").matches;var qd={__proto__:null,isMobile:Qa,nodeJS:Za};let Dn=!1,js=!1;function pe(){if(!js){if(typeof globalThis.document<"u"&&!globalThis.document.body)return setTimeout(pe,13);typeof globalThis.document<"u"&&typeof globalThis.document.removeEventListener=="function"&&globalThis.document.removeEventListener("DOMContentLoaded",pe,!1),typeof globalThis.removeEventListener=="function"&&globalThis.removeEventListener("load",pe,!1),B(Ua),js=!0}}function Kd(s){js?s.call(globalThis,[]):(ye(Ua,s,globalThis),Dn||(Za===!0||typeof globalThis.document<"u"&&globalThis.document.readyState==="complete"?globalThis.setTimeout(pe,0):(typeof globalThis.document<"u"&&typeof globalThis.document.addEventListener=="function"&&globalThis.document.addEventListener("DOMContentLoaded",pe,!1),globalThis.addEventListener("load",pe,!1)),Dn=!0))}let Ze=!0,Ae={left:0,top:0,x:0,y:0,width:0,height:0,right:0,bottom:0},fs,Qe=-1;function $n(s){return s.preventDefault(),typeof globalThis.scroll=="function"&&globalThis.scroll(0,0),!1}function Zd(){try{return!!globalThis.localStorage}catch{return!1}}function Qd(){try{return typeof globalThis.OffscreenCanvas<"u"&&new globalThis.OffscreenCanvas(0,0).getContext("2d")!==null}catch{return!1}}let Hs=qd;const Jd="ontouchstart"in globalThis,tp=!!globalThis.PointerEvent;typeof globalThis.document<"u"&&"onwheel"in globalThis.document.createElement("div");const Ja=typeof screen<"u"&&typeof screen.orientation<"u",ep=typeof globalThis.document<"u"&&(_i("fullscreenEnabled",globalThis.document)||globalThis.document.mozFullScreenEnabled);ep===!0&&(globalThis.document.exitFullscreen=_i("cancelFullScreen",globalThis.document)||_i("exitFullscreen",globalThis.document));const ip=!!(globalThis.AudioContext||globalThis.webkitAudioContext),sp=typeof globalThis.document<"u"&&!!globalThis.document.createElement("video").canPlayType;Zd();const rp=Qd(),np=typeof globalThis.navigator<"u"&&(globalThis.navigator.language||globalThis.navigator.browserLanguage||globalThis.navigator.userLanguage)||"en",th=globalThis.devicePixelRatio||1;function op(s){typeof globalThis.addEventListener=="function"&&(globalThis.addEventListener("blur",()=>{B(Ns)},!1),globalThis.addEventListener("focus",()=>{B(ks),Nn()},!1)),typeof globalThis.document<"u"&&typeof globalThis.document.addEventListener=="function"&&globalThis.document.addEventListener("visibilitychange",()=>{globalThis.document.visibilityState==="visible"?(B(ks),Nn()):B(Ns)},!1),Kd(s)}function ap(s){let t=tp?"pointermove":Jd?"touchmove":"mousemove";s!==!1?Ze===!1&&(globalThis.document.removeEventListener(t,$n),Ze=!0):Ze===!0&&(globalThis.document.addEventListener(t,$n,{passive:!1}),Ze=!1)}function hp(){const s="portrait",t="landscape";let e=globalThis.screen;if(Ja===!0){let i=_i("orientation",e);if(typeof i<"u"&&typeof i.type=="string")return i.type;if(typeof i=="string")return i}return typeof globalThis.orientation=="number"?Math.abs(globalThis.orientation)===90?t:s:globalThis.outerWidth>globalThis.outerHeight?t:s}function lp(s){let t=Xs(s);return t.parentNode!==null&&(t=t.parentNode),t}function Xs(s){let t=null;return s!=="undefined"&&(typeof s=="string"?t=globalThis.document.getElementById(s):typeof s=="object"&&s.nodeType===Node.ELEMENT_NODE&&(t=s)),t||(t=globalThis.document.body),t}function Pr(s){return typeof s=="object"&&s!==globalThis.document.body&&typeof s.getBoundingClientRect<"u"?s.getBoundingClientRect():(Ae.width=Ae.right=globalThis.innerWidth,Ae.height=Ae.bottom=globalThis.innerHeight,Ae)}function up(s){return Pr(lp(s))}function fp(s){if(Qe===-1){let t=!1;try{let e=globalThis.document.createElement("canvas"),i={stencil:!0,failIfMajorPerformanceCaveat:s.failIfMajorPerformanceCaveat};t=!!(globalThis.WebGLRenderingContext&&(e.getContext("webgl",i)||e.getContext("experimental-webgl",i))),Qe=t?1:0}catch{Qe=0}}return Qe===1}function Nn(){typeof globalThis.focus=="function"&&globalThis.focus()}function cp(s){let t=!1;if(sp===!0){if(typeof fs>"u"){const e=globalThis.document.createElement("video");fs={h264:e.canPlayType('video/mp4; codecs="avc1.42E01E"').replace(/^no$/,""),h265:e.canPlayType('video/mp4; codecs="hev1"').replace(/^no$/,""),ogg:e.canPlayType('video/ogg; codecs="theora"').replace(/^no$/,""),mp4:e.canPlayType('video/mp4; codecs="avc1.42E01E"').replace(/^no$/,""),m4v:e.canPlayType("video/x-m4v").replace(/^no$/,""),webm:e.canPlayType('video/webm; codecs="vp8, vorbis"').replace(/^no$/,""),vp9:e.canPlayType('video/webm; codecs="vp9"').replace(/^no$/,""),hls:e.canPlayType('application/x-mpegURL; codecs="avc1.42E01E"').replace(/^no$/,"")}}t=!!fs[s]}return t}const eh={parent:void 0,canvas:void 0,renderer:2,autoScale:!1,scale:1,scaleMethod:"manual",scaleTarget:void 0,preferWebGL1:!1,depthTest:"sorting",powerPreference:"default",transparent:!1,antiAlias:!1,consoleHeader:!0,premultipliedAlpha:!0,blendMode:"normal",physic:"builtin",failIfMajorPerformanceCaveat:!0,subPixel:!1,verbose:!1,legacy:!1},ih=0,Ws=1,sh=2;let U=null;function dp(s,t,e){if(!fr)throw new Error("me.video.init() called before engine initialization.");try{N.init(s,t,Object.assign(eh,e||{}))}catch(i){return console.log(i.message),!1}return U=N.renderer,globalThis.addEventListener("resize",Bn(i=>{B(Ha,i)},100),!1),globalThis.addEventListener("orientationchange",i=>{B(hi,i)},!1),globalThis.addEventListener("onmozorientationchange",i=>{B(hi,i)},!1),Ja===!0&&(globalThis.screen.orientation.onchange=function(i){B(hi,i)}),globalThis.addEventListener("scroll",Bn(i=>{B(Nd,i)},100),!1),B(Sr,N.renderer),!0}function Ir(s,t,e=!1){let i;if(s===0||t===0)throw new Error("width or height was zero, Canvas could not be initialized !");return rp===!0&&e===!0?(i=new globalThis.OffscreenCanvas(0,0),typeof i.style>"u"&&(i.style={})):i=globalThis.document.createElement("canvas"),i.width=s,i.height=t,i}function pp(){return N.getParentElement()}var kn={__proto__:null,AUTO:sh,CANVAS:ih,WEBGL:Ws,createCanvas:Ir,getParent:pp,init:dp,get renderer(){return U}};let Ys={},qs={},rh={},nh={},gp=function(s,t,e){t=t||s.keyCode||s.button;let i=nh[t];if(B(Ld,i,t,i?!Ys[i]:!0),i){if(!Ys[i]){let r=typeof e<"u"?e:t;qs[i][r]||(qs[i][r]=!0)}return rh[t]&&typeof s.preventDefault=="function"?s.preventDefault():!0}return!0},yp=function(s,t,e){t=t||s.keyCode||s.button;let i=nh[t];if(B(Bd,i,t),i){let r=typeof e<"u"?e:t;return qs[i][r]=void 0,Ys[i]=!1,rh[t]&&typeof s.preventDefault=="function"?s.preventDefault():!0}return!0},Se=null;function mp(){Se===null&&Qa===!1&&(Se=globalThis,typeof Se.addEventListener=="function"&&(Se.addEventListener("keydown",gp,!1),Se.addEventListener("keyup",yp,!1)))}let he=new M;class _p extends ut{constructor(t=0,e=0,i=1,r=1){super(),this.setMinMax(t,e,t+i,e+r),this.LEFT=0,this.MIDDLE=1,this.RIGHT=2,this.event=void 0,this.type=void 0,this.button=0,this.isPrimary=!1,this.pageX=0,this.pageY=0,this.clientX=0,this.clientY=0,this.movementX=0,this.movementY=0,this.deltaMode=0,this.deltaX=0,this.deltaY=0,this.deltaZ=0,this.gameX=0,this.gameY=0,this.gameScreenX=0,this.gameScreenY=0,this.gameWorldX=0,this.gameWorldY=0,this.gameLocalX=0,this.gameLocalY=0,this.pointerId=void 0,this.isNormalized=!1,this.locked=!1,this.bind=[0,0,0]}setEvent(t,e=0,i=0,r=0,n=0,o=1){this.event=t,this.pageX=e,this.pageY=i,this.clientX=r,this.clientY=n,Ep(this.pageX,this.pageY,he),this.gameScreenX=this.x=he.x,this.gameScreenY=this.y=he.y,this.isNormalized=typeof globalThis.PointerEvent<"u"&&!(t instanceof globalThis.PointerEvent),this.locked=bp,this.movementX=t.movementX||0,this.movementY=t.movementY||0,t.type==="wheel"?(this.deltaMode=t.deltaMode||0,this.deltaX=t.deltaX||0,this.deltaY=t.deltaY||0,this.deltaZ=t.deltaZ||0):(this.deltaMode=0,this.deltaX=0,this.deltaY=0,this.deltaZ=0),this.pointerId=o,this.isPrimary=typeof t.isPrimary<"u"?t.isPrimary:!0,this.button=t.button||0,this.type=t.type,typeof N.viewport<"u"&&N.viewport.localToWorld(this.gameScreenX,this.gameScreenY,he),this.gameWorldX=he.x,this.gameWorldY=he.y,this.isNormalized===!1?(this.width=t.width||1,this.height=t.height||1):typeof t.radiusX=="number"?(this.width=t.radiusX*2||1,this.height=t.radiusY*2||1):this.width=this.height=1}}let xi=new Map,xp=[];const Rr=["wheel"],Ri=["pointermove","mousemove","touchmove"],Mi=["pointerdown","mousedown","touchstart"],Oi=["pointerup","mouseup","touchend"],Li=["pointercancel","mousecancel","touchcancel"],Bi=["pointerenter","mouseenter","touchenter"],Di=["pointerover","mouseover","touchover"],$i=["pointerleave","mouseleave","touchleave"],Ks=[Rr[0],Ri[0],Mi[0],Oi[0],Li[0],Bi[0],Di[0],$i[0]];Rr[0],Ri[1],Mi[1],Oi[1],Li[1],Bi[1],Di[1],$i[1];Ri[2],Mi[2],Oi[2],Li[2],Bi[2],Di[2],$i[2];const vp={wheel:Rr,pointermove:Ri,pointerdown:Mi,pointerup:Oi,pointercancel:Li,pointerenter:Bi,pointerover:Di,pointerleave:$i};function wp(s,t){let e=[];for(let i=0;i<t.length;i++)s.indexOf(t[i])!==-1&&e.push(t[i]);return e}new _p(0,0,1,1);let bp=!1;function Tp(){return xi.size>0}function Ep(s,t,e){e=e||g.pull("Vector2d");let i=Pr(U.getCanvas()),r=globalThis.devicePixelRatio||1;s-=i.left+(globalThis.pageXOffset||0),t-=i.top+(globalThis.pageYOffset||0);let n=U.scaleRatio;return(n.x!==1||n.y!==1)&&(s/=n.x,t/=n.y),e.set(s*r,t*r)}function Ap(s,t,e){if(Ks.indexOf(s)===-1)throw new Error("invalid event type : "+s);let i=wp(xp,vp[s]),r=xi.get(t);if(typeof r<"u"){for(let n=0;n<i.length;n++){const o=i[n];if(r.callbacks[o]){if(typeof e<"u")pi(r.callbacks[o],e);else for(;r.callbacks[o].length>0;)r.callbacks[o].pop();r.callbacks[o].length===0&&delete r.callbacks[o]}}Object.keys(r.callbacks).length===0&&xi.delete(t)}}function Sp(s){if(xi.has(s))for(let t=0;t<Ks.length;t++)Ap(Ks[t],s)}function Cp(s,t,e){return e===this.GAMEPAD.BUTTONS.L2||e===this.GAMEPAD.BUTTONS.R2?(s+1)/2:s}function Fn(s,t,e){return s>0?e===this.GAMEPAD.BUTTONS.L2?s=Math.max(0,s-2e4)/111070:s=(s-1)/131070:s=(65536+s)/131070+.5,s}const Vn=/^([0-9a-f]{1,4})-([0-9a-f]{1,4})-/i,Un=/^0+/;function Pp(s,t){const e=s.replace(Vn,(r,n,o)=>"000".slice(n.length-1)+n+"-"+"000".slice(o.length-1)+o+"-"),i=s.replace(Vn,(r,n,o)=>n.replace(Un,"")+"-"+o.replace(Un,"")+"-");t.analog=t.analog||t.buttons.map(()=>-1),t.normalize_fn=t.normalize_fn||function(r){return r},zn.set(e,t),zn.set(i,t)}let zn=new Map;[["45e-28e-Xbox 360 Wired Controller",{axes:[0,1,3,4],buttons:[11,12,13,14,8,9,-1,-1,5,4,6,7,0,1,2,3,10],analog:[-1,-1,-1,-1,-1,-1,2,5,-1,-1,-1,-1,-1,-1,-1,-1,-1],normalize_fn:Cp}],["54c-268-PLAYSTATION(R)3 Controller",{axes:[0,1,2,3],buttons:[14,13,15,12,10,11,8,9,0,3,1,2,4,6,7,5,16]}],["54c-5c4-Wireless Controller",{axes:[0,1,2,3],buttons:[1,0,2,3,4,5,6,7,8,9,10,11,14,15,16,17,12,13]}],["2836-1-OUYA Game Controller",{axes:[0,3,7,9],buttons:[3,6,4,5,7,8,15,16,-1,-1,9,10,11,12,13,14,-1],analog:[-1,-1,-1,-1,-1,-1,5,11,-1,-1,-1,-1,-1,-1,-1,-1,-1],normalize_fn:Fn}],["OUYA Game Controller (Vendor: 2836 Product: 0001)",{axes:[0,1,3,4],buttons:[0,3,1,2,4,5,12,13,-1,-1,6,7,8,9,10,11,-1],analog:[-1,-1,-1,-1,-1,-1,2,5,-1,-1,-1,-1,-1,-1,-1,-1,-1],normalize_fn:Fn}]].forEach(s=>{Pp(s[0],s[1])});globalThis.navigator&&typeof globalThis.navigator.getGamepads=="function"&&(globalThis.addEventListener("gamepadconnected",s=>{B(Dd,s.gamepad)},!1),globalThis.addEventListener("gamepaddisconnected",s=>{B($d,s.gamepad)},!1));const Ip={bool:"1i",int:"1i",float:"1f",vec2:"2fv",vec3:"3fv",vec4:"4fv",bvec2:"2iv",bvec3:"3iv",bvec4:"4iv",ivec2:"2iv",ivec3:"3iv",ivec4:"4iv",mat2:"Matrix2fv",mat3:"Matrix3fv",mat4:"Matrix4fv",sampler2D:"1i"};function Rp(s,t){let e={},i=/uniform\s+(\w+)\s+(\w+)/g,r={},n={},o={},h;return[t.vertex,t.fragment].forEach(l=>{for(;h=i.exec(l);)r[h[2]]=h[1]}),Object.keys(r).forEach(l=>{let f=r[l];o[l]=s.getUniformLocation(t.program,l),n[l]={get:(function(d){return function(){return o[d]}})(l),set:(function(d,a,u){return a.indexOf("mat")===0?function(c){s[u](o[d],!1,c)}:function(c){let p=u;c.length&&u.slice(-1)!=="v"&&(p+="v"),s[p](o[d],c)}})(l,f,"uniform"+Ip[f])}}),Object.defineProperties(e,n),e}function Mp(s,t){let e={},i=/attribute\s+\w+\s+(\w+)/g,r,n=0;for(;r=i.exec(t.vertex);)e[r[1]]=n++;return e}function Gn(s,t,e){let i=s.createShader(t);if(s.shaderSource(i,e),s.compileShader(i),!s.getShaderParameter(i,s.COMPILE_STATUS))throw new Error(s.getShaderInfoLog(i));return i}function Op(s,t,e,i){let r=Gn(s,s.VERTEX_SHADER,t),n=Gn(s,s.FRAGMENT_SHADER,e),o=s.createProgram();s.attachShader(o,r),s.attachShader(o,n);for(let h in i)s.bindAttribLocation(o,i[h],h);if(s.linkProgram(o),!s.getProgramParameter(o,s.LINK_STATUS)){let h="Error initializing Shader "+this+`
gl.VALIDATE_STATUS: `+s.getProgramParameter(o,s.VALIDATE_STATUS)+`
gl.getError()`+s.getError()+`
gl.getProgramInfoLog()`+s.getProgramInfoLog(o);throw s.deleteProgram(o),o=null,new Error(h)}return s.useProgram(o),s.deleteShader(r),s.deleteShader(n),o}function jn(s,t){return s.substring(0,9)!=="precision"?"precision "+t+" float;"+s:s}function Hn(s){return s.getShaderPrecisionFormat(s.VERTEX_SHADER,s.HIGH_FLOAT).precision>0&&s.getShaderPrecisionFormat(s.FRAGMENT_SHADER,s.HIGH_FLOAT).precision>0?"highp":s.getShaderPrecisionFormat(s.VERTEX_SHADER,s.MEDIUM_FLOAT).precision>0&&s.getShaderPrecisionFormat(s.FRAGMENT_SHADER,s.MEDIUM_FLOAT).precision>0?"mediump":"lowp"}function Xn(s){return s=s.replace(/\/\*[\s\S]*?\*\/|([^\\:]|^)\/\/.*$/gm,"$1"),s=s.replace(/(\\n\s+)|(\s+\\n)/g,""),s=s.replace(/(\\r|\\n)+/g,""),s=s.replace(/\s*([;,[\](){}\\\/\-+*|^&!=<>?~%])\s*/g,"$1"),s}class oh{constructor(t,e,i,r){this.gl=t,this.vertex=jn(Xn(e),r||Hn(this.gl)),this.fragment=jn(Xn(i),r||Hn(this.gl)),this.attributes=Mp(this.gl,this),this.program=Op(this.gl,this.vertex,this.fragment,this.attributes),this.uniforms=Rp(this.gl,this),F(Cr,this.destroy,this)}bind(){this.gl.useProgram(this.program)}getAttribLocation(t){let e=this.attributes[t];return typeof e<"u"?e:-1}setUniform(t,e){let i=this.uniforms;if(typeof i[t]<"u")typeof e=="object"&&typeof e.toArray=="function"?i[t]=e.toArray():i[t]=e;else throw new Error("undefined ("+t+") uniform for shader "+this)}setVertexAttributes(t,e,i){for(let r=0;r<e.length;++r){let n=e[r],o=this.getAttribLocation(n.name);o!==-1?(t.enableVertexAttribArray(o),t.vertexAttribPointer(o,n.size,n.type,n.normalized,i,n.offset)):t.disableVertexAttribArray(r)}}destroy(){this.uniforms=null,this.attributes=null,this.gl.deleteProgram(this.program),this.vertex=null,this.fragment=null}}class W extends Ft{constructor(t,e,i,r){super(t,e,i,r),this.pos instanceof Mt?this.pos.setMuted(t,e,0).setCallback(this.updateBoundsPos,this):this.pos=g.pull("ObservableVector3d",t,e,0,{onUpdate:this.updateBoundsPos,scope:this}),this.anchorPoint instanceof Rt?this.anchorPoint.setMuted(.5,.5).setCallback(this.onAnchorUpdate,this):this.anchorPoint=g.pull("ObservableVector2d",.5,.5,{onUpdate:this.onAnchorUpdate,scope:this}),typeof this.currentTransform>"u"&&(this.currentTransform=g.pull("Matrix2d")),this.currentTransform.identity(),this.body=void 0,this.GUID=void 0,this.onVisibilityChange=void 0,this.alwaysUpdate=!1,this.updateWhenPaused=!1,this.isPersistent=!1,this.floating=!1,this.autoTransform=!0,this.alpha=1,this.ancestor=void 0,this.mask=void 0,this.shader=void 0,this.blendMode="normal",this.name="",this.isRenderable=!0,this.isKinematic=!0,this.isDirty=!0,this._flip={x:!1,y:!1},this._inViewport=!1,this._parentApp=void 0,this._tint=g.pull("Color",255,255,255,1),this.setOpacity(1)}get parentApp(){return typeof this._parentApp>"u"&&typeof this.ancestor<"u"&&typeof this.ancestor.getRootAncestor=="function"&&(this._parentApp=this.ancestor.getRootAncestor().app),this._parentApp}get isFloating(){return this.floating===!0||typeof this.ancestor<"u"&&this.ancestor.isFloating===!0}get tint(){return this._tint}set tint(t){this._tint.copy(t),this.isDirty=!0}get depth(){return this.pos.z}set depth(t){this.pos.z=t,this.isDirty=!0}get inViewport(){return this._inViewport}set inViewport(t){this._inViewport!==t&&(this._inViewport=t,typeof this.onVisibilityChange=="function"&&this.onVisibilityChange.call(this,t))}get isFlippedX(){return this._flip.x===!0}get isFlippedY(){return this._flip.y===!0}getBounds(){return typeof this._bounds>"u"&&(super.getBounds(),this.isFinite()?this.updateBounds():this._bounds.setMinMax(this.pos.x,this.pos.y,this.width,this.height)),this._bounds}getOpacity(){return this.alpha}setOpacity(t){typeof t=="number"&&(this.alpha=C(t,0,1),isNaN(this.alpha)&&(this.alpha=1),this.isDirty=!0)}flipX(t=!0){return this._flip.x=!!t,this.isDirty=!0,this}flipY(t=!0){return this._flip.y=!!t,this.isDirty=!0,this}transform(t){return this.currentTransform.multiply(t),this.updateBounds(),this.isDirty=!0,this}angleTo(t){let e=this.getBounds(),i,r;if(t instanceof W){let n=t.getBounds();i=n.centerX-e.centerX,r=n.centerY-e.centerY}else i=t.x-e.centerX,r=t.y-e.centerY;return Math.atan2(r,i)}distanceTo(t){let e=this.getBounds(),i,r;if(t instanceof W){let n=t.getBounds();i=e.centerX-n.centerX,r=e.centerY-n.centerY}else i=e.centerX-t.x,r=e.centerY-t.y;return Math.sqrt(i*i+r*r)}lookAt(t){let e;t instanceof W?e=t.pos:e=t;let i=this.angleTo(e);return this.rotate(i),this}rotate(t,e){return t!==0&&(this.currentTransform.rotate(t,e),this.updateBounds(),this.isDirty=!0),this}scale(t,e=t){return this.currentTransform.scale(t,e),this.updateBounds(),this.isDirty=!0,this}scaleV(t){return this.scale(t.x,t.y),this}update(t){return this.isDirty}updateBounds(t=!0){if(this.isRenderable){let e=this.getBounds();if(e.clear(),this.autoTransform===!0&&!this.currentTransform.isIdentity()?(this.currentTransform.translate(-this.width*this.anchorPoint.x,-this.height*this.anchorPoint.y),e.addFrame(0,0,this.width,this.height,this.currentTransform),this.currentTransform.translate(this.width*this.anchorPoint.x,this.height*this.anchorPoint.y)):(e.addFrame(0,0,this.width,this.height),e.translate(-this.width*this.anchorPoint.x,-this.height*this.anchorPoint.y)),t===!0){let i=this.getAbsolutePosition();e.centerOn(i.x+e.x+e.width/2,i.y+e.y+e.height/2)}return e}else return super.updateBounds(t)}updateBoundsPos(t=this.pos.x,e=this.pos.y){this.getBounds().translate(t-this.pos.x,e-this.pos.y)}getAbsolutePosition(){return typeof this._absPos>"u"&&(this._absPos=g.pull("Vector2d")),this._absPos.set(this.pos.x,this.pos.y),typeof this.ancestor<"u"&&typeof this.ancestor.getAbsolutePosition=="function"&&this.floating!==!0&&this._absPos.add(this.ancestor.getAbsolutePosition()),this._absPos}onAnchorUpdate(t,e){this.anchorPoint.setMuted(t,e),this.updateBounds(),this.isDirty=!0}preDraw(t){let e=this.width*this.anchorPoint.x,i=this.height*this.anchorPoint.y;if(t.save(),t.setGlobalAlpha(t.globalAlpha()*this.getOpacity()),this._flip.x||this._flip.y){var r=this._flip.x?this.centerX-e:0,n=this._flip.y?this.centerY-i:0;t.translate(r,n),t.scale(this._flip.x?-1:1,this._flip.y?-1:1),t.translate(-r,-n)}typeof this.mask<"u"&&(t.translate(this.pos.x,this.pos.y),t.setMask(this.mask),t.translate(-this.pos.x,-this.pos.y)),typeof this.shader=="object"&&typeof t.gl<"u"&&(t.customShader=this.shader),this.autoTransform===!0&&!this.currentTransform.isIdentity()&&(t.translate(this.pos.x,this.pos.y),t.transform(this.currentTransform),t.translate(-this.pos.x,-this.pos.y)),t.translate(-e,-i),t.setTint(this.tint,this.getOpacity()),this.blendMode!==t.getBlendMode()&&t.setBlendMode(this.blendMode)}draw(t,e){}postDraw(t){t.clearTint(),typeof this.mask<"u"&&t.clearMask(),typeof this.shader=="object"&&typeof t.gl<"u"&&(t.customShader=void 0),t.restore(),this.isDirty=!1}onCollision(t,e){return!1}destroy(){g.push(this.currentTransform),this.currentTransform=void 0,g.push(this.anchorPoint),this.anchorPoint=void 0,g.push(this.pos),this.pos=void 0,typeof this._absPos<"u"&&(g.push(this._absPos),this._absPos=void 0),this._bounds instanceof ut&&(g.push(this._bounds),this._bounds=void 0),this.onVisibilityChange=void 0,typeof this.mask<"u"&&(g.push(this.mask),this.mask=void 0),this._tint instanceof nt&&(g.push(this._tint),this._tint=void 0),this.ancestor=void 0,this._parentApp=void 0,this.body instanceof yt&&(this.body.destroy.apply(this.body,arguments),this.body=void 0),Sp(this),this.onDestroyEvent.apply(this,arguments),this.shader instanceof oh&&(this.shader.destroy(),this.shader=void 0)}onDestroyEvent(){}}const Wn=Math.min,Yn=Math.max;let ct=new M;class Lp extends W{constructor(t,e,i,r){super(t,e,i-t,r-e),this.AXIS={NONE:0,HORIZONTAL:1,VERTICAL:2,BOTH:3},this.bounds=g.pull("Bounds"),this.smoothFollow=!0,this.damping=1,this.near=-1e3,this.far=1e3,this.projectionMatrix=new fi,this.invCurrentTransform=new Re,this.offset=new M,this.target=null,this.follow_axis=this.AXIS.NONE,this._shake={intensity:0,duration:0,axis:this.AXIS.BOTH,onComplete:null},this._fadeOut={color:null,tween:null},this._fadeIn={color:null,tween:null},this.name="default",this.setDeadzone(this.width/6,this.height/6),this.anchorPoint.set(0,0),this.isKinematic=!1,this.bounds.setMinMax(t,e,i,r),this._updateProjectionMatrix(),F(ze,this.reset,this),F(Ii,this.resize,this)}_updateProjectionMatrix(){this.projectionMatrix.ortho(0,this.width,this.height,0,this.near,this.far)}_followH(t){let e=this.pos.x;return t.x-this.pos.x>this.deadzone.right?e=Wn(t.x-this.deadzone.right,this.bounds.width-this.width):t.x-this.pos.x<this.deadzone.pos.x&&(e=Yn(t.x-this.deadzone.pos.x,this.bounds.left)),e}_followV(t){let e=this.pos.y;return t.y-this.pos.y>this.deadzone.bottom?e=Wn(t.y-this.deadzone.bottom,this.bounds.height-this.height):t.y-this.pos.y<this.deadzone.pos.y&&(e=Yn(t.y-this.deadzone.pos.y,this.bounds.top)),e}reset(t=0,e=0){this.pos.x=t,this.pos.y=e,this.unfollow(),this.smoothFollow=!0,this.damping=1,this.currentTransform.identity(),this.invCurrentTransform.identity().invert(),this._updateProjectionMatrix()}setDeadzone(t,e){typeof this.deadzone>"u"&&(this.deadzone=new Ft(0,0,0,0)),this.deadzone.pos.set(~~((this.width-t)/2),~~((this.height-e)/2-e*.25)),this.deadzone.resize(t,e),this.smoothFollow=!1,this.updateTarget(),this.smoothFollow=!0}resize(t,e){return super.resize(t,e),this.smoothFollow=!1,this.setBounds(0,0,t,e),this.setDeadzone(t/6,e/6),this.update(),this.smoothFollow=!0,this._updateProjectionMatrix(),B(Jt,this.width,this.height,this),this}setBounds(t,e,i,r){this.smoothFollow=!1,this.bounds.setMinMax(t,e,i+t,r+e),this.moveTo(this.pos.x,this.pos.y),this.update(),this.smoothFollow=!0}follow(t,e,i){if(t instanceof W)this.target=t.pos;else if(t instanceof M||t instanceof It||t instanceof Rt||t instanceof Mt)this.target=t;else throw new Error("invalid target for me.Camera2d.follow");this.follow_axis=typeof e>"u"?this.AXIS.BOTH:e,this.smoothFollow=!1,typeof i!="number"?this.damping=1:this.damping=C(i,0,1),this.updateTarget(),this.smoothFollow=!0}unfollow(){this.target=null,this.follow_axis=this.AXIS.NONE}move(t,e){this.moveTo(this.pos.x+t,this.pos.y+e)}moveTo(t,e){let i=this.pos.x,r=this.pos.y;this.pos.x=C(t,this.bounds.left,this.bounds.width),this.pos.y=C(e,this.bounds.top,this.bounds.height),(i!==this.pos.x||r!==this.pos.y)&&(this.isDirty=!0)}updateTarget(){if(this.target){switch(ct.setV(this.pos),this.follow_axis){case this.AXIS.NONE:break;case this.AXIS.HORIZONTAL:ct.x=this._followH(this.target);break;case this.AXIS.VERTICAL:ct.y=this._followV(this.target);break;case this.AXIS.BOTH:ct.x=this._followH(this.target),ct.y=this._followV(this.target);break}if(!this.pos.equals(ct)){if(this.smoothFollow===!0&&this.damping<1)if(Rn(ct.x,this.pos.x,2)&&Rn(ct.y,this.pos.y,2)){this.pos.setV(ct);return}else this.pos.lerp(ct,this.damping);else this.pos.setV(ct);this.isDirty=!0}}}update(t){return this.updateTarget(t),this._shake.duration>0&&(this._shake.duration-=t,this._shake.duration<=0?(this._shake.duration=0,this.offset.setZero(),typeof this._shake.onComplete=="function"&&this._shake.onComplete()):((this._shake.axis===this.AXIS.BOTH||this._shake.axis===this.AXIS.HORIZONTAL)&&(this.offset.x=(Math.random()-.5)*this._shake.intensity),(this._shake.axis===this.AXIS.BOTH||this._shake.axis===this.AXIS.VERTICAL)&&(this.offset.y=(Math.random()-.5)*this._shake.intensity)),this.isDirty=!0),this.isDirty===!0&&B(Us,this.pos),(this._fadeIn.tween!=null||this._fadeOut.tween!=null)&&(this.isDirty=!0),this.currentTransform.isIdentity()?this.invCurrentTransform.identity():this.invCurrentTransform.copy(this.currentTransform).invert(),super.update(t)}shake(t,e,i,r,n){(this._shake.duration===0||n===!0)&&(this._shake.intensity=t,this._shake.duration=e,this._shake.axis=i||this.AXIS.BOTH,this._shake.onComplete=typeof r=="function"?r:void 0)}fadeOut(t,e=1e3,i){this._fadeOut.color=g.pull("Color").copy(t),this._fadeOut.tween=g.pull("Tween",this._fadeOut.color).to({alpha:0},e).onComplete(i||null),this._fadeOut.tween.isPersistent=!0,this._fadeOut.tween.start()}fadeIn(t,e=1e3,i){this._fadeIn.color=g.pull("Color").copy(t);let r=this._fadeIn.color.alpha;this._fadeIn.color.alpha=0,this._fadeIn.tween=g.pull("Tween",this._fadeIn.color).to({alpha:r},e).onComplete(i||null),this._fadeIn.tween.isPersistent=!0,this._fadeIn.tween.start()}focusOn(t){let e=t.getBounds();this.moveTo(t.pos.x+e.left+e.width/2,t.pos.y+e.top+e.height/2)}isVisible(t,e=t.floating){return e===!0||t.floating===!0?U.overlaps(t.getBounds()):t.getBounds().overlaps(this)}localToWorld(t,e,i){return i=i||g.pull("Vector2d"),i.set(t,e).add(this.pos).sub(N.world.pos),this.currentTransform.isIdentity()||this.invCurrentTransform.apply(i),i}worldToLocal(t,e,i){return i=i||g.pull("Vector2d"),i.set(t,e),this.currentTransform.isIdentity()||this.currentTransform.apply(i),i.sub(this.pos).add(N.world.pos)}drawFX(t){this._fadeIn.tween&&(t.save(),t.resetTransform(),t.setColor(this._fadeIn.color),t.fillRect(0,0,this.width,this.height),t.restore(),this._fadeIn.color.alpha===1&&(this._fadeIn.tween=null,g.push(this._fadeIn.color),this._fadeIn.color=null)),this._fadeOut.tween&&(t.save(),t.resetTransform(),t.setColor(this._fadeOut.color),t.fillRect(0,0,this.width,this.height),t.restore(),this._fadeOut.color.alpha===0&&(this._fadeOut.tween=null,g.push(this._fadeOut.color),this._fadeOut.color=null))}draw(t,e){let i=this.pos.x+this.offset.x,r=this.pos.y+this.offset.y;e.currentTransform.translate(-i,-r),t.setProjection(this.projectionMatrix),t.clipRect(0,0,this.width,this.height),this.preDraw(t),e.preDraw(t,this),e.draw(t,this),this.drawFX(t),e.postDraw(t,this),this.postDraw(t),e.currentTransform.translate(i,r)}}let cs,Bp={cameras:[]};class Mr{constructor(t){this.cameras=new Map,this.lights=new Map,this.ambientLight=new nt(0,0,0,0),this.settings=Object.assign(Bp,t||{})}reset(){if(this.settings.cameras.forEach(t=>{this.cameras.set(t.name,t)}),this.cameras.has("default")===!1){if(typeof cs>"u"){let t=U.width,e=U.height;cs=new Lp(0,0,t,e)}this.cameras.set("default",cs)}B(Ga,this),this.onResetEvent.apply(this,arguments)}update(t){let e=!1;return this.cameras.forEach(i=>{i.update(t)===!0&&(e=!0)}),this.lights.forEach(i=>{i.update(t)===!0&&(e=!0)}),e}draw(t,e){this.cameras.forEach(i=>{i.draw(t,e),this.ambientLight.alpha!==0&&(t.save(),this.lights.forEach(r=>{t.setMask(r.getVisibleArea(),!0)}),t.setColor(this.ambientLight),t.fillRect(0,0,i.width,i.height),t.clearMask(),t.restore()),this.lights.forEach(r=>{r.preDraw(t,e),r.draw(t,e),r.postDraw(t,e)})})}destroy(){this.cameras.clear(),this.lights.forEach(t=>{t.destroy()}),this.lights.clear(),this.onDestroyEvent.apply(this,arguments)}onResetEvent(){typeof this.settings.onResetEvent=="function"&&this.settings.onResetEvent.apply(this,arguments)}onDestroyEvent(){typeof this.settings.onDestroyEvent=="function"&&this.settings.onDestroyEvent.apply(this,arguments)}}const Dp=/^.*(\\|\/|\:)/,$p=/\.[^\.]*$/;function Or(s){return s.replace(Dp,"").replace($p,"")}function me(s){return s.substring(s.lastIndexOf(".")+1,s.length)}let At={},Vt={},te={},Ut={},zt={},ee={};function qt(s,t,e={}){return new Promise((i,r)=>{fetch(s,{method:"GET",cache:e.nocache===""?"no-cache":"reload",credentials:e.withCredentials===!0?"include":"omit",mode:e.crossOrigin==="anonymous"?"cors":"no-cors"}).then(n=>{switch(n.ok||n.status!==0&&typeof onerror=="function"&&r(new Error("`Network response was not ok ${response.statusText}`")),t){case"json":return n.json();case"text":return n.text();case"blob":return n.blob();case"arrayBuffer":return n.arrayBuffer();default:r(new Error("Invalid response type"))}}).then(n=>i(n)).catch(n=>r(n))})}function Np(){throw new Error("unsupported format")}function kp(){throw new Error("unsupported format")}function Fp(){throw new Error("unsupported format")}function Vp(){throw new Error("unsupported format")}function Up(){throw new Error("unsupported format")}let Zs;ye(Sr,s=>{Zs=s});function zp(s,t){let e;if(Zs.type.includes("WebGL"))switch(t){case"dds":e=Np();break;case"pvr":e=Vp();break;case"pkm":e=Up();break;case"ktx":e=kp();break;case"ktx2":e=Fp();break}if(typeof e<"u"&&Zs.hasSupportedCompressedFormats(e.format))return console.log("Compressed texture format supported: "+e.format),e;throw"unsupported texture format:"+t+e?" ("+e.format+")":""}function Gp(s,t,e,i){if(typeof At[s.name]<"u")return 0;let r=Array.isArray(s.src)?s.src:[s.src],n=!1;for(const o of r){const h=me(o);switch(h){case"dds":case"pvr":case"pkm":case"ktx":case"ktx2":qt(o,"arrayBuffer",i).then(l=>{try{At[s.name]=zp(l,h),n=!0,typeof t=="function"&&t()}catch{}}).catch(l=>{typeof e=="function"&&e(l)});break;case"svg":qt(o,"text",i).then(l=>{const f=new Image;f.onload=function(){At[s.name]=f,typeof t=="function"&&t()},f.onerror=function(d){typeof e=="function"&&e(d)},f.src="data:image/svg+xml;charset=utf8,"+encodeURIComponent(l)}).catch(l=>{typeof e=="function"&&e(l)}),n=!0;break;default:qt(o,"blob",i).then(l=>{globalThis.createImageBitmap(l).then(f=>{At[s.name]=f,typeof t=="function"&&t()})}).catch(l=>{typeof e=="function"&&e(l)}),n=!0;break}if(n===!0)return 1}throw new Error("No supported Image file format found for "+s.name)}function jp(s,t,e){const i=typeof globalThis.document<"u"?globalThis.document.fonts:void 0;if(mi(s.src)===!0&&(s.src.startsWith("url(")||(s.src="url("+s.src+")")),typeof i<"u"){let r=new FontFace(s.name,s.src);r.load().then(()=>{ee[s.name]=r,i.add(r),typeof t=="function"&&t()},()=>{typeof e=="function"&&e(s.name)})}else typeof e=="function"&&e(error);return 1}var Qs={exports:{}};const Hp="2.0.0",ah=256,Xp=Number.MAX_SAFE_INTEGER||9007199254740991,Wp=16,Yp=ah-6,qp=["major","premajor","minor","preminor","patch","prepatch","prerelease"];var Ni={MAX_LENGTH:ah,MAX_SAFE_COMPONENT_LENGTH:Wp,MAX_SAFE_BUILD_LENGTH:Yp,MAX_SAFE_INTEGER:Xp,RELEASE_TYPES:qp,SEMVER_SPEC_VERSION:Hp,FLAG_INCLUDE_PRERELEASE:1,FLAG_LOOSE:2};const Kp=typeof process=="object"&&ji&&ji.NODE_DEBUG&&/\bsemver\b/i.test(ji.NODE_DEBUG)?(...s)=>console.error("SEMVER",...s):()=>{};var ki=Kp;(function(s,t){const{MAX_SAFE_COMPONENT_LENGTH:e,MAX_SAFE_BUILD_LENGTH:i,MAX_LENGTH:r}=Ni,n=ki;t=s.exports={};const o=t.re=[],h=t.safeRe=[],l=t.src=[],f=t.t={};let d=0;const a="[a-zA-Z0-9-]",u=[["\\s",1],["\\d",r],[a,i]],c=y=>{for(const[_,m]of u)y=y.split(`${_}*`).join(`${_}{0,${m}}`).split(`${_}+`).join(`${_}{1,${m}}`);return y},p=(y,_,m)=>{const x=c(_),v=d++;n(y,v,_),f[y]=v,l[v]=_,o[v]=new RegExp(_,m?"g":void 0),h[v]=new RegExp(x,m?"g":void 0)};p("NUMERICIDENTIFIER","0|[1-9]\\d*"),p("NUMERICIDENTIFIERLOOSE","\\d+"),p("NONNUMERICIDENTIFIER",`\\d*[a-zA-Z-]${a}*`),p("MAINVERSION",`(${l[f.NUMERICIDENTIFIER]})\\.(${l[f.NUMERICIDENTIFIER]})\\.(${l[f.NUMERICIDENTIFIER]})`),p("MAINVERSIONLOOSE",`(${l[f.NUMERICIDENTIFIERLOOSE]})\\.(${l[f.NUMERICIDENTIFIERLOOSE]})\\.(${l[f.NUMERICIDENTIFIERLOOSE]})`),p("PRERELEASEIDENTIFIER",`(?:${l[f.NUMERICIDENTIFIER]}|${l[f.NONNUMERICIDENTIFIER]})`),p("PRERELEASEIDENTIFIERLOOSE",`(?:${l[f.NUMERICIDENTIFIERLOOSE]}|${l[f.NONNUMERICIDENTIFIER]})`),p("PRERELEASE",`(?:-(${l[f.PRERELEASEIDENTIFIER]}(?:\\.${l[f.PRERELEASEIDENTIFIER]})*))`),p("PRERELEASELOOSE",`(?:-?(${l[f.PRERELEASEIDENTIFIERLOOSE]}(?:\\.${l[f.PRERELEASEIDENTIFIERLOOSE]})*))`),p("BUILDIDENTIFIER",`${a}+`),p("BUILD",`(?:\\+(${l[f.BUILDIDENTIFIER]}(?:\\.${l[f.BUILDIDENTIFIER]})*))`),p("FULLPLAIN",`v?${l[f.MAINVERSION]}${l[f.PRERELEASE]}?${l[f.BUILD]}?`),p("FULL",`^${l[f.FULLPLAIN]}$`),p("LOOSEPLAIN",`[v=\\s]*${l[f.MAINVERSIONLOOSE]}${l[f.PRERELEASELOOSE]}?${l[f.BUILD]}?`),p("LOOSE",`^${l[f.LOOSEPLAIN]}$`),p("GTLT","((?:<|>)?=?)"),p("XRANGEIDENTIFIERLOOSE",`${l[f.NUMERICIDENTIFIERLOOSE]}|x|X|\\*`),p("XRANGEIDENTIFIER",`${l[f.NUMERICIDENTIFIER]}|x|X|\\*`),p("XRANGEPLAIN",`[v=\\s]*(${l[f.XRANGEIDENTIFIER]})(?:\\.(${l[f.XRANGEIDENTIFIER]})(?:\\.(${l[f.XRANGEIDENTIFIER]})(?:${l[f.PRERELEASE]})?${l[f.BUILD]}?)?)?`),p("XRANGEPLAINLOOSE",`[v=\\s]*(${l[f.XRANGEIDENTIFIERLOOSE]})(?:\\.(${l[f.XRANGEIDENTIFIERLOOSE]})(?:\\.(${l[f.XRANGEIDENTIFIERLOOSE]})(?:${l[f.PRERELEASELOOSE]})?${l[f.BUILD]}?)?)?`),p("XRANGE",`^${l[f.GTLT]}\\s*${l[f.XRANGEPLAIN]}$`),p("XRANGELOOSE",`^${l[f.GTLT]}\\s*${l[f.XRANGEPLAINLOOSE]}$`),p("COERCEPLAIN",`(^|[^\\d])(\\d{1,${e}})(?:\\.(\\d{1,${e}}))?(?:\\.(\\d{1,${e}}))?`),p("COERCE",`${l[f.COERCEPLAIN]}(?:$|[^\\d])`),p("COERCEFULL",l[f.COERCEPLAIN]+`(?:${l[f.PRERELEASE]})?(?:${l[f.BUILD]})?(?:$|[^\\d])`),p("COERCERTL",l[f.COERCE],!0),p("COERCERTLFULL",l[f.COERCEFULL],!0),p("LONETILDE","(?:~>?)"),p("TILDETRIM",`(\\s*)${l[f.LONETILDE]}\\s+`,!0),t.tildeTrimReplace="$1~",p("TILDE",`^${l[f.LONETILDE]}${l[f.XRANGEPLAIN]}$`),p("TILDELOOSE",`^${l[f.LONETILDE]}${l[f.XRANGEPLAINLOOSE]}$`),p("LONECARET","(?:\\^)"),p("CARETTRIM",`(\\s*)${l[f.LONECARET]}\\s+`,!0),t.caretTrimReplace="$1^",p("CARET",`^${l[f.LONECARET]}${l[f.XRANGEPLAIN]}$`),p("CARETLOOSE",`^${l[f.LONECARET]}${l[f.XRANGEPLAINLOOSE]}$`),p("COMPARATORLOOSE",`^${l[f.GTLT]}\\s*(${l[f.LOOSEPLAIN]})$|^$`),p("COMPARATOR",`^${l[f.GTLT]}\\s*(${l[f.FULLPLAIN]})$|^$`),p("COMPARATORTRIM",`(\\s*)${l[f.GTLT]}\\s*(${l[f.LOOSEPLAIN]}|${l[f.XRANGEPLAIN]})`,!0),t.comparatorTrimReplace="$1$2$3",p("HYPHENRANGE",`^\\s*(${l[f.XRANGEPLAIN]})\\s+-\\s+(${l[f.XRANGEPLAIN]})\\s*$`),p("HYPHENRANGELOOSE",`^\\s*(${l[f.XRANGEPLAINLOOSE]})\\s+-\\s+(${l[f.XRANGEPLAINLOOSE]})\\s*$`),p("STAR","(<|>)?=?\\s*\\*"),p("GTE0","^\\s*>=\\s*0\\.0\\.0\\s*$"),p("GTE0PRE","^\\s*>=\\s*0\\.0\\.0-0\\s*$")})(Qs,Qs.exports);var Ge=Qs.exports;const Zp=Object.freeze({loose:!0}),Qp=Object.freeze({}),Jp=s=>s?typeof s!="object"?Zp:s:Qp;var Lr=Jp;const qn=/^[0-9]+$/,hh=(s,t)=>{const e=qn.test(s),i=qn.test(t);return e&&i&&(s=+s,t=+t),s===t?0:e&&!i?-1:i&&!e?1:s<t?-1:1},tg=(s,t)=>hh(t,s);var lh={compareIdentifiers:hh,rcompareIdentifiers:tg};const Je=ki,{MAX_LENGTH:Kn,MAX_SAFE_INTEGER:ti}=Ni,{safeRe:Zn,t:Qn}=Ge,eg=Lr,{compareIdentifiers:le}=lh;let ig=class bt{constructor(t,e){if(e=eg(e),t instanceof bt){if(t.loose===!!e.loose&&t.includePrerelease===!!e.includePrerelease)return t;t=t.version}else if(typeof t!="string")throw new TypeError(`Invalid version. Must be a string. Got type "${typeof t}".`);if(t.length>Kn)throw new TypeError(`version is longer than ${Kn} characters`);Je("SemVer",t,e),this.options=e,this.loose=!!e.loose,this.includePrerelease=!!e.includePrerelease;const i=t.trim().match(e.loose?Zn[Qn.LOOSE]:Zn[Qn.FULL]);if(!i)throw new TypeError(`Invalid Version: ${t}`);if(this.raw=t,this.major=+i[1],this.minor=+i[2],this.patch=+i[3],this.major>ti||this.major<0)throw new TypeError("Invalid major version");if(this.minor>ti||this.minor<0)throw new TypeError("Invalid minor version");if(this.patch>ti||this.patch<0)throw new TypeError("Invalid patch version");i[4]?this.prerelease=i[4].split(".").map(r=>{if(/^[0-9]+$/.test(r)){const n=+r;if(n>=0&&n<ti)return n}return r}):this.prerelease=[],this.build=i[5]?i[5].split("."):[],this.format()}format(){return this.version=`${this.major}.${this.minor}.${this.patch}`,this.prerelease.length&&(this.version+=`-${this.prerelease.join(".")}`),this.version}toString(){return this.version}compare(t){if(Je("SemVer.compare",this.version,this.options,t),!(t instanceof bt)){if(typeof t=="string"&&t===this.version)return 0;t=new bt(t,this.options)}return t.version===this.version?0:this.compareMain(t)||this.comparePre(t)}compareMain(t){return t instanceof bt||(t=new bt(t,this.options)),le(this.major,t.major)||le(this.minor,t.minor)||le(this.patch,t.patch)}comparePre(t){if(t instanceof bt||(t=new bt(t,this.options)),this.prerelease.length&&!t.prerelease.length)return-1;if(!this.prerelease.length&&t.prerelease.length)return 1;if(!this.prerelease.length&&!t.prerelease.length)return 0;let e=0;do{const i=this.prerelease[e],r=t.prerelease[e];if(Je("prerelease compare",e,i,r),i===void 0&&r===void 0)return 0;if(r===void 0)return 1;if(i===void 0)return-1;if(i===r)continue;return le(i,r)}while(++e)}compareBuild(t){t instanceof bt||(t=new bt(t,this.options));let e=0;do{const i=this.build[e],r=t.build[e];if(Je("build compare",e,i,r),i===void 0&&r===void 0)return 0;if(r===void 0)return 1;if(i===void 0)return-1;if(i===r)continue;return le(i,r)}while(++e)}inc(t,e,i){switch(t){case"premajor":this.prerelease.length=0,this.patch=0,this.minor=0,this.major++,this.inc("pre",e,i);break;case"preminor":this.prerelease.length=0,this.patch=0,this.minor++,this.inc("pre",e,i);break;case"prepatch":this.prerelease.length=0,this.inc("patch",e,i),this.inc("pre",e,i);break;case"prerelease":this.prerelease.length===0&&this.inc("patch",e,i),this.inc("pre",e,i);break;case"major":(this.minor!==0||this.patch!==0||this.prerelease.length===0)&&this.major++,this.minor=0,this.patch=0,this.prerelease=[];break;case"minor":(this.patch!==0||this.prerelease.length===0)&&this.minor++,this.patch=0,this.prerelease=[];break;case"patch":this.prerelease.length===0&&this.patch++,this.prerelease=[];break;case"pre":{const r=Number(i)?1:0;if(!e&&i===!1)throw new Error("invalid increment argument: identifier is empty");if(this.prerelease.length===0)this.prerelease=[r];else{let n=this.prerelease.length;for(;--n>=0;)typeof this.prerelease[n]=="number"&&(this.prerelease[n]++,n=-2);if(n===-1){if(e===this.prerelease.join(".")&&i===!1)throw new Error("invalid increment argument: identifier already exists");this.prerelease.push(r)}}if(e){let n=[e,r];i===!1&&(n=[e]),le(this.prerelease[0],e)===0?isNaN(this.prerelease[1])&&(this.prerelease=n):this.prerelease=n}break}default:throw new Error(`invalid increment argument: ${t}`)}return this.raw=this.format(),this.build.length&&(this.raw+=`+${this.build.join(".")}`),this}};var et=ig;const Jn=et,sg=(s,t,e=!1)=>{if(s instanceof Jn)return s;try{return new Jn(s,t)}catch(i){if(!e)return null;throw i}};var we=sg;const rg=we,ng=(s,t)=>{const e=rg(s,t);return e?e.version:null};var og=ng;const ag=we,hg=(s,t)=>{const e=ag(s.trim().replace(/^[=v]+/,""),t);return e?e.version:null};var lg=hg;const to=et,ug=(s,t,e,i,r)=>{typeof e=="string"&&(r=i,i=e,e=void 0);try{return new to(s instanceof to?s.version:s,e).inc(t,i,r).version}catch{return null}};var fg=ug;const eo=we,cg=(s,t)=>{const e=eo(s,null,!0),i=eo(t,null,!0),r=e.compare(i);if(r===0)return null;const n=r>0,o=n?e:i,h=n?i:e,l=!!o.prerelease.length;if(!!h.prerelease.length&&!l)return!h.patch&&!h.minor?"major":o.patch?"patch":o.minor?"minor":"major";const d=l?"pre":"";return e.major!==i.major?d+"major":e.minor!==i.minor?d+"minor":e.patch!==i.patch?d+"patch":"prerelease"};var dg=cg;const pg=et,gg=(s,t)=>new pg(s,t).major;var yg=gg;const mg=et,_g=(s,t)=>new mg(s,t).minor;var xg=_g;const vg=et,wg=(s,t)=>new vg(s,t).patch;var bg=wg;const Tg=we,Eg=(s,t)=>{const e=Tg(s,t);return e&&e.prerelease.length?e.prerelease:null};var Ag=Eg;const io=et,Sg=(s,t,e)=>new io(s,e).compare(new io(t,e));var xt=Sg;const Cg=xt,Pg=(s,t,e)=>Cg(t,s,e);var Ig=Pg;const Rg=xt,Mg=(s,t)=>Rg(s,t,!0);var Og=Mg;const so=et,Lg=(s,t,e)=>{const i=new so(s,e),r=new so(t,e);return i.compare(r)||i.compareBuild(r)};var Br=Lg;const Bg=Br,Dg=(s,t)=>s.sort((e,i)=>Bg(e,i,t));var $g=Dg;const Ng=Br,kg=(s,t)=>s.sort((e,i)=>Ng(i,e,t));var Fg=kg;const Vg=xt,Ug=(s,t,e)=>Vg(s,t,e)>0;var Fi=Ug;const zg=xt,Gg=(s,t,e)=>zg(s,t,e)<0;var Dr=Gg;const jg=xt,Hg=(s,t,e)=>jg(s,t,e)===0;var uh=Hg;const Xg=xt,Wg=(s,t,e)=>Xg(s,t,e)!==0;var fh=Wg;const Yg=xt,qg=(s,t,e)=>Yg(s,t,e)>=0;var $r=qg;const Kg=xt,Zg=(s,t,e)=>Kg(s,t,e)<=0;var Nr=Zg;const Qg=uh,Jg=fh,ty=Fi,ey=$r,iy=Dr,sy=Nr,ry=(s,t,e,i)=>{switch(t){case"===":return typeof s=="object"&&(s=s.version),typeof e=="object"&&(e=e.version),s===e;case"!==":return typeof s=="object"&&(s=s.version),typeof e=="object"&&(e=e.version),s!==e;case"":case"=":case"==":return Qg(s,e,i);case"!=":return Jg(s,e,i);case">":return ty(s,e,i);case">=":return ey(s,e,i);case"<":return iy(s,e,i);case"<=":return sy(s,e,i);default:throw new TypeError(`Invalid operator: ${t}`)}};var ch=ry;const ny=et,oy=we,{safeRe:ei,t:ii}=Ge,ay=(s,t)=>{if(s instanceof ny)return s;if(typeof s=="number"&&(s=String(s)),typeof s!="string")return null;t=t||{};let e=null;if(!t.rtl)e=s.match(t.includePrerelease?ei[ii.COERCEFULL]:ei[ii.COERCE]);else{const l=t.includePrerelease?ei[ii.COERCERTLFULL]:ei[ii.COERCERTL];let f;for(;(f=l.exec(s))&&(!e||e.index+e[0].length!==s.length);)(!e||f.index+f[0].length!==e.index+e[0].length)&&(e=f),l.lastIndex=f.index+f[1].length+f[2].length;l.lastIndex=-1}if(e===null)return null;const i=e[2],r=e[3]||"0",n=e[4]||"0",o=t.includePrerelease&&e[5]?`-${e[5]}`:"",h=t.includePrerelease&&e[6]?`+${e[6]}`:"";return oy(`${i}.${r}.${n}${o}${h}`,t)};var hy=ay;class ly{constructor(){this.max=1e3,this.map=new Map}get(t){const e=this.map.get(t);if(e!==void 0)return this.map.delete(t),this.map.set(t,e),e}delete(t){return this.map.delete(t)}set(t,e){if(!this.delete(t)&&e!==void 0){if(this.map.size>=this.max){const r=this.map.keys().next().value;this.delete(r)}this.map.set(t,e)}return this}}var uy=ly,ds,ro;function vt(){if(ro)return ds;ro=1;class s{constructor(b,S){if(S=i(S),b instanceof s)return b.loose===!!S.loose&&b.includePrerelease===!!S.includePrerelease?b:new s(b.raw,S);if(b instanceof r)return this.raw=b.value,this.set=[[b]],this.format(),this;if(this.options=S,this.loose=!!S.loose,this.includePrerelease=!!S.includePrerelease,this.raw=b.trim().split(/\s+/).join(" "),this.set=this.raw.split("||").map(R=>this.parseRange(R.trim())).filter(R=>R.length),!this.set.length)throw new TypeError(`Invalid SemVer Range: ${this.raw}`);if(this.set.length>1){const R=this.set[0];if(this.set=this.set.filter(O=>!p(O[0])),this.set.length===0)this.set=[R];else if(this.set.length>1){for(const O of this.set)if(O.length===1&&y(O[0])){this.set=[O];break}}}this.format()}format(){return this.range=this.set.map(b=>b.join(" ").trim()).join("||").trim(),this.range}toString(){return this.range}parseRange(b){const R=((this.options.includePrerelease&&u)|(this.options.loose&&c))+":"+b,O=e.get(R);if(O)return O;const P=this.options.loose,D=P?h[l.HYPHENRANGELOOSE]:h[l.HYPHENRANGE];b=b.replace(D,Y(this.options.includePrerelease)),n("hyphen replace",b),b=b.replace(h[l.COMPARATORTRIM],f),n("comparator trim",b),b=b.replace(h[l.TILDETRIM],d),n("tilde trim",b),b=b.replace(h[l.CARETTRIM],a),n("caret trim",b);let V=b.split(" ").map(K=>m(K,this.options)).join(" ").split(/\s+/).map(K=>G(K,this.options));P&&(V=V.filter(K=>(n("loose invalid filter",K,this.options),!!K.match(h[l.COMPARATORLOOSE])))),n("range list",V);const k=new Map,H=V.map(K=>new r(K,this.options));for(const K of H){if(p(K))return[K];k.set(K.value,K)}k.size>1&&k.has("")&&k.delete("");const st=[...k.values()];return e.set(R,st),st}intersects(b,S){if(!(b instanceof s))throw new TypeError("a Range is required");return this.set.some(R=>_(R,S)&&b.set.some(O=>_(O,S)&&R.every(P=>O.every(D=>P.intersects(D,S)))))}test(b){if(!b)return!1;if(typeof b=="string")try{b=new o(b,this.options)}catch{return!1}for(let S=0;S<this.set.length;S++)if(q(this.set[S],b,this.options))return!0;return!1}}ds=s;const t=uy,e=new t,i=Lr,r=Vi(),n=ki,o=et,{safeRe:h,t:l,comparatorTrimReplace:f,tildeTrimReplace:d,caretTrimReplace:a}=Ge,{FLAG_INCLUDE_PRERELEASE:u,FLAG_LOOSE:c}=Ni,p=T=>T.value==="<0.0.0-0",y=T=>T.value==="",_=(T,b)=>{let S=!0;const R=T.slice();let O=R.pop();for(;S&&R.length;)S=R.every(P=>O.intersects(P,b)),O=R.pop();return S},m=(T,b)=>(n("comp",T,b),T=E(T,b),n("caret",T),T=v(T,b),n("tildes",T),T=I(T,b),n("xrange",T),T=L(T,b),n("stars",T),T),x=T=>!T||T.toLowerCase()==="x"||T==="*",v=(T,b)=>T.trim().split(/\s+/).map(S=>w(S,b)).join(" "),w=(T,b)=>{const S=b.loose?h[l.TILDELOOSE]:h[l.TILDE];return T.replace(S,(R,O,P,D,V)=>{n("tilde",T,R,O,P,D,V);let k;return x(O)?k="":x(P)?k=`>=${O}.0.0 <${+O+1}.0.0-0`:x(D)?k=`>=${O}.${P}.0 <${O}.${+P+1}.0-0`:V?(n("replaceTilde pr",V),k=`>=${O}.${P}.${D}-${V} <${O}.${+P+1}.0-0`):k=`>=${O}.${P}.${D} <${O}.${+P+1}.0-0`,n("tilde return",k),k})},E=(T,b)=>T.trim().split(/\s+/).map(S=>A(S,b)).join(" "),A=(T,b)=>{n("caret",T,b);const S=b.loose?h[l.CARETLOOSE]:h[l.CARET],R=b.includePrerelease?"-0":"";return T.replace(S,(O,P,D,V,k)=>{n("caret",T,O,P,D,V,k);let H;return x(P)?H="":x(D)?H=`>=${P}.0.0${R} <${+P+1}.0.0-0`:x(V)?P==="0"?H=`>=${P}.${D}.0${R} <${P}.${+D+1}.0-0`:H=`>=${P}.${D}.0${R} <${+P+1}.0.0-0`:k?(n("replaceCaret pr",k),P==="0"?D==="0"?H=`>=${P}.${D}.${V}-${k} <${P}.${D}.${+V+1}-0`:H=`>=${P}.${D}.${V}-${k} <${P}.${+D+1}.0-0`:H=`>=${P}.${D}.${V}-${k} <${+P+1}.0.0-0`):(n("no pr"),P==="0"?D==="0"?H=`>=${P}.${D}.${V}${R} <${P}.${D}.${+V+1}-0`:H=`>=${P}.${D}.${V}${R} <${P}.${+D+1}.0-0`:H=`>=${P}.${D}.${V} <${+P+1}.0.0-0`),n("caret return",H),H})},I=(T,b)=>(n("replaceXRanges",T,b),T.split(/\s+/).map(S=>z(S,b)).join(" ")),z=(T,b)=>{T=T.trim();const S=b.loose?h[l.XRANGELOOSE]:h[l.XRANGE];return T.replace(S,(R,O,P,D,V,k)=>{n("xRange",T,R,O,P,D,V,k);const H=x(P),st=H||x(D),K=st||x(V),Te=K;return O==="="&&Te&&(O=""),k=b.includePrerelease?"-0":"",H?O===">"||O==="<"?R="<0.0.0-0":R="*":O&&Te?(st&&(D=0),V=0,O===">"?(O=">=",st?(P=+P+1,D=0,V=0):(D=+D+1,V=0)):O==="<="&&(O="<",st?P=+P+1:D=+D+1),O==="<"&&(k="-0"),R=`${O+P}.${D}.${V}${k}`):st?R=`>=${P}.0.0${k} <${+P+1}.0.0-0`:K&&(R=`>=${P}.${D}.0${k} <${P}.${+D+1}.0-0`),n("xRange return",R),R})},L=(T,b)=>(n("replaceStars",T,b),T.trim().replace(h[l.STAR],"")),G=(T,b)=>(n("replaceGTE0",T,b),T.trim().replace(h[b.includePrerelease?l.GTE0PRE:l.GTE0],"")),Y=T=>(b,S,R,O,P,D,V,k,H,st,K,Te)=>(x(R)?S="":x(O)?S=`>=${R}.0.0${T?"-0":""}`:x(P)?S=`>=${R}.${O}.0${T?"-0":""}`:D?S=`>=${S}`:S=`>=${S}${T?"-0":""}`,x(H)?k="":x(st)?k=`<${+H+1}.0.0-0`:x(K)?k=`<${H}.${+st+1}.0-0`:Te?k=`<=${H}.${st}.${K}-${Te}`:T?k=`<${H}.${st}.${+K+1}-0`:k=`<=${k}`,`${S} ${k}`.trim()),q=(T,b,S)=>{for(let R=0;R<T.length;R++)if(!T[R].test(b))return!1;if(b.prerelease.length&&!S.includePrerelease){for(let R=0;R<T.length;R++)if(n(T[R].semver),T[R].semver!==r.ANY&&T[R].semver.prerelease.length>0){const O=T[R].semver;if(O.major===b.major&&O.minor===b.minor&&O.patch===b.patch)return!0}return!1}return!0};return ds}var ps,no;function Vi(){if(no)return ps;no=1;const s=Symbol("SemVer ANY");class t{static get ANY(){return s}constructor(d,a){if(a=e(a),d instanceof t){if(d.loose===!!a.loose)return d;d=d.value}d=d.trim().split(/\s+/).join(" "),o("comparator",d,a),this.options=a,this.loose=!!a.loose,this.parse(d),this.semver===s?this.value="":this.value=this.operator+this.semver.version,o("comp",this)}parse(d){const a=this.options.loose?i[r.COMPARATORLOOSE]:i[r.COMPARATOR],u=d.match(a);if(!u)throw new TypeError(`Invalid comparator: ${d}`);this.operator=u[1]!==void 0?u[1]:"",this.operator==="="&&(this.operator=""),u[2]?this.semver=new h(u[2],this.options.loose):this.semver=s}toString(){return this.value}test(d){if(o("Comparator.test",d,this.options.loose),this.semver===s||d===s)return!0;if(typeof d=="string")try{d=new h(d,this.options)}catch{return!1}return n(d,this.operator,this.semver,this.options)}intersects(d,a){if(!(d instanceof t))throw new TypeError("a Comparator is required");return this.operator===""?this.value===""?!0:new l(d.value,a).test(this.value):d.operator===""?d.value===""?!0:new l(this.value,a).test(d.semver):(a=e(a),a.includePrerelease&&(this.value==="<0.0.0-0"||d.value==="<0.0.0-0")||!a.includePrerelease&&(this.value.startsWith("<0.0.0")||d.value.startsWith("<0.0.0"))?!1:!!(this.operator.startsWith(">")&&d.operator.startsWith(">")||this.operator.startsWith("<")&&d.operator.startsWith("<")||this.semver.version===d.semver.version&&this.operator.includes("=")&&d.operator.includes("=")||n(this.semver,"<",d.semver,a)&&this.operator.startsWith(">")&&d.operator.startsWith("<")||n(this.semver,">",d.semver,a)&&this.operator.startsWith("<")&&d.operator.startsWith(">")))}}ps=t;const e=Lr,{safeRe:i,t:r}=Ge,n=ch,o=ki,h=et,l=vt();return ps}const fy=vt(),cy=(s,t,e)=>{try{t=new fy(t,e)}catch{return!1}return t.test(s)};var Ui=cy;const dy=vt(),py=(s,t)=>new dy(s,t).set.map(e=>e.map(i=>i.value).join(" ").trim().split(" "));var gy=py;const yy=et,my=vt(),_y=(s,t,e)=>{let i=null,r=null,n=null;try{n=new my(t,e)}catch{return null}return s.forEach(o=>{n.test(o)&&(!i||r.compare(o)===-1)&&(i=o,r=new yy(i,e))}),i};var xy=_y;const vy=et,wy=vt(),by=(s,t,e)=>{let i=null,r=null,n=null;try{n=new wy(t,e)}catch{return null}return s.forEach(o=>{n.test(o)&&(!i||r.compare(o)===1)&&(i=o,r=new vy(i,e))}),i};var Ty=by;const gs=et,Ey=vt(),oo=Fi,Ay=(s,t)=>{s=new Ey(s,t);let e=new gs("0.0.0");if(s.test(e)||(e=new gs("0.0.0-0"),s.test(e)))return e;e=null;for(let i=0;i<s.set.length;++i){const r=s.set[i];let n=null;r.forEach(o=>{const h=new gs(o.semver.version);switch(o.operator){case">":h.prerelease.length===0?h.patch++:h.prerelease.push(0),h.raw=h.format();case"":case">=":(!n||oo(h,n))&&(n=h);break;case"<":case"<=":break;default:throw new Error(`Unexpected operation: ${o.operator}`)}}),n&&(!e||oo(e,n))&&(e=n)}return e&&s.test(e)?e:null};var Sy=Ay;const Cy=vt(),Py=(s,t)=>{try{return new Cy(s,t).range||"*"}catch{return null}};var Iy=Py;const Ry=et,dh=Vi(),{ANY:My}=dh,Oy=vt(),Ly=Ui,ao=Fi,ho=Dr,By=Nr,Dy=$r,$y=(s,t,e,i)=>{s=new Ry(s,i),t=new Oy(t,i);let r,n,o,h,l;switch(e){case">":r=ao,n=By,o=ho,h=">",l=">=";break;case"<":r=ho,n=Dy,o=ao,h="<",l="<=";break;default:throw new TypeError('Must provide a hilo val of "<" or ">"')}if(Ly(s,t,i))return!1;for(let f=0;f<t.set.length;++f){const d=t.set[f];let a=null,u=null;if(d.forEach(c=>{c.semver===My&&(c=new dh(">=0.0.0")),a=a||c,u=u||c,r(c.semver,a.semver,i)?a=c:o(c.semver,u.semver,i)&&(u=c)}),a.operator===h||a.operator===l||(!u.operator||u.operator===h)&&n(s,u.semver))return!1;if(u.operator===l&&o(s,u.semver))return!1}return!0};var kr=$y;const Ny=kr,ky=(s,t,e)=>Ny(s,t,">",e);var Fy=ky;const Vy=kr,Uy=(s,t,e)=>Vy(s,t,"<",e);var zy=Uy;const lo=vt(),Gy=(s,t,e)=>(s=new lo(s,e),t=new lo(t,e),s.intersects(t,e));var jy=Gy;const Hy=Ui,Xy=xt;var Wy=(s,t,e)=>{const i=[];let r=null,n=null;const o=s.sort((d,a)=>Xy(d,a,e));for(const d of o)Hy(d,t,e)?(n=d,r||(r=d)):(n&&i.push([r,n]),n=null,r=null);r&&i.push([r,null]);const h=[];for(const[d,a]of i)d===a?h.push(d):!a&&d===o[0]?h.push("*"):a?d===o[0]?h.push(`<=${a}`):h.push(`${d} - ${a}`):h.push(`>=${d}`);const l=h.join(" || "),f=typeof t.raw=="string"?t.raw:String(t);return l.length<f.length?l:t};const uo=vt(),Fr=Vi(),{ANY:ys}=Fr,Ce=Ui,Vr=xt,Yy=(s,t,e={})=>{if(s===t)return!0;s=new uo(s,e),t=new uo(t,e);let i=!1;t:for(const r of s.set){for(const n of t.set){const o=Ky(r,n,e);if(i=i||o!==null,o)continue t}if(i)return!1}return!0},qy=[new Fr(">=0.0.0-0")],fo=[new Fr(">=0.0.0")],Ky=(s,t,e)=>{if(s===t)return!0;if(s.length===1&&s[0].semver===ys){if(t.length===1&&t[0].semver===ys)return!0;e.includePrerelease?s=qy:s=fo}if(t.length===1&&t[0].semver===ys){if(e.includePrerelease)return!0;t=fo}const i=new Set;let r,n;for(const c of s)c.operator===">"||c.operator===">="?r=co(r,c,e):c.operator==="<"||c.operator==="<="?n=po(n,c,e):i.add(c.semver);if(i.size>1)return null;let o;if(r&&n){if(o=Vr(r.semver,n.semver,e),o>0)return null;if(o===0&&(r.operator!==">="||n.operator!=="<="))return null}for(const c of i){if(r&&!Ce(c,String(r),e)||n&&!Ce(c,String(n),e))return null;for(const p of t)if(!Ce(c,String(p),e))return!1;return!0}let h,l,f,d,a=n&&!e.includePrerelease&&n.semver.prerelease.length?n.semver:!1,u=r&&!e.includePrerelease&&r.semver.prerelease.length?r.semver:!1;a&&a.prerelease.length===1&&n.operator==="<"&&a.prerelease[0]===0&&(a=!1);for(const c of t){if(d=d||c.operator===">"||c.operator===">=",f=f||c.operator==="<"||c.operator==="<=",r){if(u&&c.semver.prerelease&&c.semver.prerelease.length&&c.semver.major===u.major&&c.semver.minor===u.minor&&c.semver.patch===u.patch&&(u=!1),c.operator===">"||c.operator===">="){if(h=co(r,c,e),h===c&&h!==r)return!1}else if(r.operator===">="&&!Ce(r.semver,String(c),e))return!1}if(n){if(a&&c.semver.prerelease&&c.semver.prerelease.length&&c.semver.major===a.major&&c.semver.minor===a.minor&&c.semver.patch===a.patch&&(a=!1),c.operator==="<"||c.operator==="<="){if(l=po(n,c,e),l===c&&l!==n)return!1}else if(n.operator==="<="&&!Ce(n.semver,String(c),e))return!1}if(!c.operator&&(n||r)&&o!==0)return!1}return!(r&&f&&!n&&o!==0||n&&d&&!r&&o!==0||u||a)},co=(s,t,e)=>{if(!s)return t;const i=Vr(s.semver,t.semver,e);return i>0?s:i<0||t.operator===">"&&s.operator===">="?t:s},po=(s,t,e)=>{if(!s)return t;const i=Vr(s.semver,t.semver,e);return i<0?s:i>0||t.operator==="<"&&s.operator==="<="?t:s};var Zy=Yy;const ms=Ge,go=Ni,Qy=et,yo=lh,Jy=we,tm=og,em=lg,im=fg,sm=dg,rm=yg,nm=xg,om=bg,am=Ag,hm=xt,lm=Ig,um=Og,fm=Br,cm=$g,dm=Fg,pm=Fi,gm=Dr,ym=uh,mm=fh,_m=$r,xm=Nr,vm=ch,wm=hy,bm=Vi(),Tm=vt(),Em=Ui,Am=gy,Sm=xy,Cm=Ty,Pm=Sy,Im=Iy,Rm=kr,Mm=Fy,Om=zy,Lm=jy,Bm=Wy,Dm=Zy;var $m={parse:Jy,valid:tm,clean:em,inc:im,diff:sm,major:rm,minor:nm,patch:om,prerelease:am,compare:hm,rcompare:lm,compareLoose:um,compareBuild:fm,sort:cm,rsort:dm,gt:pm,lt:gm,eq:ym,neq:mm,gte:_m,lte:xm,cmp:vm,coerce:wm,Comparator:bm,Range:Tm,satisfies:Em,toComparators:Am,maxSatisfying:Sm,minSatisfying:Cm,minVersion:Pm,validRange:Im,outside:Rm,gtr:Mm,ltr:Om,intersects:Lm,simplifyRange:Bm,subset:Dm,SemVer:Qy,re:ms.re,src:ms.src,tokens:ms.t,SEMVER_SPEC_VERSION:go.SEMVER_SPEC_VERSION,RELEASE_TYPES:go.RELEASE_TYPES,compareIdentifiers:yo.compareIdentifiers,rcompareIdentifiers:yo.rcompareIdentifiers};let ph="",Js=0;function Nm(s,t){return/^\d+$/.test(s)?s+=".0.0":/^\d+\.\d+$/.test(s)&&(s+=".0"),/^\d+$/.test(t)?t+=".0.0":/^\d+\.\d+$/.test(t)&&(t+=".0"),$m.compare(s,t)}function gh(s){let t={};if(typeof s>"u")if(typeof globalThis.document<"u"){let e=globalThis.document.location;if(e&&e.hash)s=e.hash;else return t}else return t;else{let e=s.indexOf("#");if(e!==-1)s=s.slice(e,s.length);else return t}return s.slice(1).split("&").filter(e=>e!=="").forEach(e=>{let i=e.split("="),r=i.shift(),n=i.join("=");t[r]=n||!0}),t}function km(s,t=0){ph=Fd(s.toString().toUpperCase()),Js=t}function mo(s=1){return Js+=s,ph+"-"+(s||Js)}class Fm{constructor(t){if(this.TileProperties=[],this.imageCollection=[],this.firstgid=this.lastgid=+t.firstgid,typeof t.source<"u"){let n=t.source,o=me(n);if((o==="tsx"||o==="json")&&(t=Kr(Or(n)),!t))throw new Error(n+" external TSX/JSON tileset not found")}this.name=t.name,this.tilewidth=+t.tilewidth,this.tileheight=+t.tileheight,this.spacing=+t.spacing||0,this.margin=+t.margin||0,this.tileoffset=new M,this.isAnimated=!1,this.isCollection=!1,this.class=t.class,this.animations=new Map,this._lastUpdate=0;let e=t.tiles;for(let n in e)if(e.hasOwnProperty(n)){if("animation"in e[n]&&(this.isAnimated=!0,this.animations.set(e[+n].animation[0].tileid,{dt:0,idx:0,frames:e[+n].animation,cur:e[+n].animation[0]})),"properties"in e[n])if(Array.isArray(e[n].properties)){let o={};for(let h in e[n].properties)o[e[n].properties[h].name]=e[n].properties[h].value;this.setTileProperty(+e[n].id+this.firstgid,o)}else this.setTileProperty(+n+this.firstgid,e[n].properties);if("image"in e[n]){let o=Et(e[n].image);if(!o)throw new Error("melonJS: '"+e[n].image+"' file for tile '"+(+n+this.firstgid)+"' not found!");this.imageCollection[+n+this.firstgid]=o}}this.isCollection=this.imageCollection.length>0;let i=t.tileoffset;i&&(this.tileoffset.x=+i.x,this.tileoffset.y=+i.y);let r=t.tileproperties;if(r)for(let n in r)r.hasOwnProperty(n)&&this.setTileProperty(+n+this.firstgid,r[n]);if(this.isCollection===!1){if(this.image=Et(t.image),!this.image)throw new Error("melonJS: '"+t.image+"' file for tileset '"+this.name+"' not found!");this.texture=U.cache.get(this.image,{framewidth:this.tilewidth,frameheight:this.tileheight,margin:this.margin,spacing:this.spacing}),this.atlas=this.texture.getAtlas();let n=+t.columns||Math.round(this.image.width/(this.tilewidth+this.spacing)),o=Math.round(this.image.height/(this.tileheight+this.spacing));t.tilecount%n>0&&++o,this.lastgid=this.firstgid+(n*o-1||0),t.tilecount&&this.lastgid-this.firstgid+1!==+t.tilecount&&console.warn("Computed tilecount ("+(this.lastgid-this.firstgid+1)+") does not match expected tilecount ("+t.tilecount+")")}}getTileImage(t){return this.imageCollection[t]}setTileProperty(t,e){this.TileProperties[t]=e}contains(t){return t>=this.firstgid&&t<=this.lastgid}getViewTileId(t){let e=t-this.firstgid;return this.animations.has(e)?this.animations.get(e).cur.tileid:e}getTileProperties(t){return this.TileProperties[t]}update(t){let e=0,i=ht.getTime(),r=!1;return this._lastUpdate!==i&&(this._lastUpdate=i,this.animations.forEach(n=>{for(n.dt+=t,e=n.cur.duration;n.dt>=e;)n.dt-=e,n.idx=(n.idx+1)%n.frames.length,n.cur=n.frames[n.idx],e=n.cur.duration,r=!0})),r}drawTile(t,e,i,r){if(r.flipped&&(t.save(),t.translate(e,i),t.transform(r.currentTransform),e=i=0),this.isCollection===!0)t.drawImage(this.imageCollection[r.tileId],0,0,r.width,r.height,e,i,r.width,r.height);else{let n=this.atlas[this.getViewTileId(r.tileId)].offset;t.drawImage(this.image,n.x,n.y,this.tilewidth,this.tileheight,e,i,this.tilewidth+t.uvOffset,this.tileheight+t.uvOffset)}r.flipped&&t.restore()}}const Vm=2147483648,Um=1073741824,zm=536870912,tr=536870911,Gm="collision";class jm{constructor(){this.tilesets=[],this.length=0}add(t){this.tilesets.push(t),this.length++}getTilesetByIndex(t){return this.tilesets[t]}getTilesetByGid(t){let e=-1;t&=tr;for(let i=0,r=this.tilesets.length;i<r;i++){if(this.tilesets[i].contains(t))return this.tilesets[i];this.tilesets[i].firstgid===this.tilesets[i].lastgid&&t>=this.tilesets[i].firstgid&&(e=i)}if(e!==-1)return this.tilesets[e];throw new Error("no matching tileset found for gid "+t)}}function yh(s,t,e){let i;if(typeof e!="string")return e;switch(t){case"int":case"float":e=Number(e);break;case"bool":e=e==="true";break;default:if(!e||kd(e))e=e?e==="true":!0;else if(Wa(e))e=Number(e);else if(e.search(/^json:/i)===0){i=e.split(/^json:/i)[1];try{e=JSON.parse(i)}catch{throw new Error("Unable to parse JSON: "+i)}}else if(e.search(/^eval:/i)===0){i=e.split(/^eval:/i)[1];try{e=Function("'use strict';return ("+i+")")()}catch{throw new Error("Unable to evaluate: "+i)}}else((i=e.match(/^#([\da-fA-F])([\da-fA-F]{3})$/))||(i=e.match(/^#([\da-fA-F]{2})([\da-fA-F]{6})$/)))&&(e="#"+i[2]+i[1]);s.search(/^(ratio|anchorPoint)$/)===0&&typeof e=="number"&&(e={x:e,y:e})}return e}function Hm(s,t){if(t.attributes&&t.attributes.length>0)for(let e=0;e<t.attributes.length;e++){const i=t.attributes.item(e);typeof i.name<"u"?s[i.name]=i.value:s[i.nodeName]=i.nodeValue}}function Xm(s,t){let e=t.nodeName;switch(e){case"data":{let i=ot(t);i.encoding=i.encoding||"xml",typeof i.chunks<"u"&&(s.chunks=s.chunks||[],i.chunks.forEach(r=>{s.chunks.push({x:+r.x,y:+r.y,width:+r.width,height:+r.height,data:vi(r.text,i.encoding,i.compression)})}),s.encoding="none"),typeof i.text<"u"&&typeof s.chunks>"u"&&(s.data=vi(i.text,i.encoding,i.compression),s.encoding="none");break}case"chunk":s.chunks=s.chunks||[],s.chunks.push(ot(t));break;case"imagelayer":case"layer":case"objectgroup":case"group":{let i=ot(t);i.type=e==="layer"?"tilelayer":e,i.image&&(i.image=i.image.source),s.layers=s.layers||[],s.layers.push(i);break}case"animation":s.animation=ot(t).frames;break;case"frame":case"object":{const i=e+"s";s[i]=s[i]||[],s[i].push(ot(t));break}case"tile":{let i=ot(t);i.image&&(i.imagewidth=i.image.width,i.imageheight=i.image.height,i.image=i.image.source),s.tiles=s.tiles||{},s.tiles[i.id]=i;break}case"tileset":{let i=ot(t);i.image&&(i.imagewidth=i.image.width,i.imageheight=i.image.height,i.image=i.image.source),s.tilesets=s.tilesets||[],s.tilesets.push(i);break}case"polygon":case"polyline":{s[e]=[];let i=ot(t).points.split(" ");for(let r=0;r<i.length;r++){const n=i[r].split(",");s[e].push({x:+n[0],y:+n[1]})}break}case"properties":s.properties=ot(t);break;case"property":{const i=ot(t),r=typeof i.value<"u"?i.value:i.text;s[i.name]=yh(i.name,i.type||"string",r);break}default:s[e]=ot(t);break}}function Wm(s,t){throw new Error("GZIP/ZLIB compressed TMX Tile Map not supported!")}function Ym(s){let t=s.replace(`
`,"").trim().split(","),e=[];for(let i=0;i<t.length;i++)e.push(+t[i]);return e}function qm(s,t=1){let e=globalThis.atob(s.replace(/[^A-Za-z0-9\+\/\=]/g,"")),i=new Uint32Array(e.length/t);for(let r=0,n=e.length/t;r<n;r++){i[r]=0;for(let o=t-1;o>=0;--o)i[r]+=e.charCodeAt(r*t+o)<<(o<<3)}return i}function vi(s,t,e){switch(e=e||"none",t=t||"none",t){case"csv":return Ym(s);case"base64":return e!=="none"?s=Wm():s=qm(s,4),s;case"none":return s;case"xml":throw new Error("XML encoding is deprecated, use base64 instead");default:throw new Error("Unknown layer encoding: "+t)}}function ot(s){let t={},e="";if(s.nodeType===1&&Hm(t,s),s.hasChildNodes()){let i=s.childNodes;for(const r of i)switch(r.nodeType){case 1:Xm(t,r);break;case 3:e+=r.nodeValue.trim();break}}return e&&(t.text=e),t}function _e(s,t){let e=t.properties,i=t.propertytypes;if(typeof e<"u"){for(let r in e)if(e.hasOwnProperty(r)){let n="string",o=r,h=e[r];typeof e[r].name<"u"&&(o=e[r].name),typeof i<"u"?n=i[r]:typeof e[r].type<"u"&&(n=e[r].type),typeof e[r].value<"u"&&(h=e[r].value),s[o]=yh(o,n,h)}}}class mh extends ut{constructor(t,e,i,r){let n,o;if(super(),r.isCollection){let h=r.getTileImage(i&tr);n=h.width,o=h.height}else n=r.tilewidth,o=r.tileheight;this.setMinMax(0,0,n,o),this.tileset=r,this.currentTransform=null,this.col=t,this.row=e,this.tileId=i,this.flippedX=(this.tileId&Vm)!==0,this.flippedY=(this.tileId&Um)!==0,this.flippedAD=(this.tileId&zm)!==0,this.flipped=this.flippedX||this.flippedY||this.flippedAD,this.flipped===!0&&(this.currentTransform===null&&(this.currentTransform=new Re),this.setTileTransform(this.currentTransform.identity())),this.tileId&=tr}setTileTransform(t){t.translate(this.width/2,this.height/2),this.flippedAD&&(t.rotate(-90*Math.PI/180),t.scale(-1,1)),this.flippedX&&t.scale(this.flippedAD?1:-1,this.flippedAD?-1:1),this.flippedY&&t.scale(this.flippedAD?-1:1,this.flippedAD?1:-1),t.translate(-this.width/2,-this.height/2)}getRenderable(t){let e,i=this.tileset;if(i.animations.has(this.tileId)){let r=[],n=[];i.animations.get(this.tileId).frames.forEach(o=>{n.push(o.tileid),r.push({name:""+o.tileid,delay:o.duration})}),e=i.texture.createAnimationFromName(n,t),e.addAnimation(this.tileId-i.firstgid,r),e.setCurrentAnimation(this.tileId-i.firstgid)}else if(i.isCollection===!0){let r=i.getTileImage(this.tileId);e=new Ct(0,0,Object.assign({image:r})),e.anchorPoint.set(0,0),e.scale(t.width/this.width,t.height/this.height),typeof t.rotation<"u"&&(e.anchorPoint.set(.5,.5),e.currentTransform.rotate(t.rotation),e.currentTransform.translate(t.width/2,t.height/2),t.rotation=void 0)}else e=i.texture.createSpriteFromName(this.tileId-i.firstgid,t),e.anchorPoint.set(0,0);return this.setTileTransform(e.currentTransform),e}}class Km{constructor(t,e,i){this.points=void 0,this.name=e.name,this.x=+e.x,this.y=+e.y,this.z=+i,this.width=+e.width||0,this.height=+e.height||0,this.gid=+e.gid||null,this.tintcolor=e.tintcolor,this.type=e.type,this.class=typeof e.class<"u"?e.class:e.type,this.text=void 0,this.rotation=br(+e.rotation||0),this.id=+e.id||void 0,this.orientation=t.orientation,this.shapes=void 0,this.isEllipse=!1,this.isPoint=!1,this.isPolygon=!1,this.isPolyLine=!1,typeof this.gid=="number"?this.setTile(t.tilesets):typeof e.ellipse<"u"?this.isEllipse=!0:typeof e.point<"u"?this.isPoint=!0:typeof e.polygon<"u"?(this.points=e.polygon,this.isPolygon=!0):typeof e.polyline<"u"&&(this.points=e.polyline,this.isPolyLine=!0),typeof e.text<"u"?(this.text=e.text,this.text.font=e.text.fontfamily||"sans-serif",this.text.size=e.text.pixelsize||16,this.text.fillStyle=e.text.color||"#000000",this.text.textAlign=e.text.halign||"left",this.text.textBaseline=e.text.valign||"top",this.text.width=this.width,this.text.height=this.height,_e(this.text,e)):(_e(this,e),this.shapes||(this.shapes=this.parseTMXShapes())),t.isEditor||t.getRenderer().adjustPosition(this)}setTile(t){let e=t.getTilesetByGid(this.gid);e.isCollection===!1&&(this.width=this.framewidth=e.tilewidth,this.height=this.frameheight=e.tileheight),this.tile=new mh(this.x,this.y,this.gid,e)}parseTMXShapes(){let t=[];if(this.isEllipse===!0)t.push(g.pull("Ellipse",this.width/2,this.height/2,this.width,this.height).rotate(this.rotation));else if(this.isPoint===!0)t.push(g.pull("Point",this.x,this.y));else if(this.isPolygon===!0){let e=g.pull("Polygon",0,0,this.points),i=e.isConvex();if(i===!1)throw new Error("collision polygones in Tiled should be defined as Convex");if(i===null)throw new Error("invalid polygone");t.push(e.rotate(this.rotation))}else if(this.isPolyLine===!0){let e=this.points,i,r,n=e.length-1;for(let o=0;o<n;o++)i=g.pull("Vector2d",e[o].x,e[o].y),r=g.pull("Vector2d",e[o+1].x,e[o+1].y),this.rotation!==0&&(i=i.rotate(this.rotation),r=r.rotate(this.rotation)),t.push(g.pull("Line",0,0,[i,r]))}else t.push(g.pull("Polygon",0,0,[g.pull("Vector2d"),g.pull("Vector2d",this.width,0),g.pull("Vector2d",this.width,this.height),g.pull("Vector2d",0,this.height)]).rotate(this.rotation));if(this.orientation==="isometric")for(let e=0;e<t.length;e++)typeof t[e].toIso=="function"&&t[e].toIso();return t}getObjectPropertyByName(t){return this[t]}}function Zm(s,t,e,i){const r=Math.abs(s),n=Math.abs(t),o=it(e)/it(r)+it(i)/it(n),h=o>1?Math.sqrt(o)*r:r,l=o>1?Math.sqrt(o)*n:n;return[h,l]}function _o([s,t,e,i],[r,n]){return[s*r+t*n,e*r+i*n]}function Qm([s,t],[e,i]){return[s+e,t+i]}function Jm([s,t],e){return[s*e,t*e]}function t0([s,t],[e,i]){return s*e+t*i}function xo([s,t]){return Math.sqrt(s**2+t**2)}function vo(s,t){const[e,i]=s,[r,n]=t;return(e*n-i*r>=0?1:-1)*Math.acos(t0(s,t)/(xo(s)*xo(t)))}function e0(s,t,e,i,r,n,o,h,l){const f=br(l),d=Math.cos(f),a=Math.sin(f),[u,c]=_o([d,a,-a,d],[(s-e)/2,(t-i)/2]),[p,y]=Zm(o,h,u,c),_=r!==n?1:-1,m=it(p)*it(y)-it(p)*it(c)-it(y)*it(u),x=it(p)*it(c)+it(y)*it(u),[v,w]=Jm([p*c/y,-y*u/p],_*Math.sqrt(Math.abs(m/x))),[E,A]=Qm(_o([d,-a,a,d],[v,w]),[(s+e)/2,(t+i)/2]),I=[(u-v)/p,(c-w)/y],z=[(-u-v)/p,(-c-w)/y],L=vo([1,0],I),G=vo(I,z)%(2*Math.PI),Y=!n&&G>0?G-2*Math.PI:n&&G<0?G+2*Math.PI:G,q=L+Y;return{cx:E,cy:A,rx:p,ry:y,startAngle:L,endAngle:q,xAxisRotation:f,anticlockwise:Y<0}}class i0{constructor(t){this.points=[],this.arcResolution=5,this.vertices=[],this.startPoint=g.pull("Point"),this.isDirty=!1,typeof t=="string"&&this.parseSVGPath(t)}parseSVGPath(t){const e=t.match(/([a-df-z])[^a-df-z]*/gi),i=this.points,r=this.startPoint;let n=r;this.beginPath();for(let o=0;o<e.length;o++){const h=e[o],l=h[0].toUpperCase(),f=h.slice(1).trim().split(/[\s,]+/).map(parseFloat);switch(l){case"A":{const d=e0(...f);this.arc(d.x,d.y,d.radiusX,d.radiusY,d.rotation,d.startAngle,d.endAngle,d.applyanticlockwise)}break;case"H":n=i.length===0?r:i[i.length-1],this.lineTo(n.x+f[0],n.y);break;case"V":n=i.length===0?r:i[i.length-1],this.lineTo(n.x,n.y+f[0]);break;case"M":this.moveTo(...f);break;case"L":this.lineTo(...f);break;case"Q":this.quadraticCurveTo(...f);break;case"C":this.bezierCurveTo(...f);break;case"Z":this.closePath();break;default:console.warn("Unsupported command:",l);break}}}beginPath(){this.points.forEach(t=>{g.push(t)}),this.isDirty=!0,this.points.length=0,this.startPoint.set(0,0)}closePath(){let t=this.points;if(t.length>0){let e=t[0];e.equals(t[t.length-1])||this.lineTo(e.x,e.y),this.isDirty=!0}}triangulatePath(){let t=this.vertices;if(this.isDirty){let e=this.points,i=ka(e.flatMap(n=>[n.x,n.y])),r=i.length;for(;t.length<r;)t.push(g.pull("Point"));for(let n=0;n<r;n++){let o=e[i[n]];t[n].set(o.x,o.y)}for(;t.length>r;)g.push(t[t.length-1]),t.length-=1;this.isDirty=!1}return t}moveTo(t,e){this.startPoint.set(t,e),this.isDirty=!0}lineTo(t,e){let i=this.points,r=this.startPoint,n=i.length===0?r:i[i.length-1];r.equals(n)?i.push(g.pull("Point",n.x,n.y)):i.push(g.pull("Point",r.x,r.y)),i.push(g.pull("Point",t,e)),r.x=t,r.y=e,this.isDirty=!0}arc(t,e,i,r,n,o=!1){if(r===n)return;const h=o?Math.abs(r-n)>=Q:Math.abs(n-r)>=Q;r=r%Q,n=n%Q,r<0&&(r+=Q),n<0&&(n+=Q),r>=n&&(n+=Q);let l=n-r,f=1;o&&(f=-1,l=Q-l),h&&(l=Q);const a=l*i/this.arcResolution,c=l/a*f;this.moveTo(t+i*Math.cos(r),e+i*Math.sin(r));let p=r;for(let y=0;y<a;y++)this.lineTo(t+i*Math.cos(p),e+i*Math.sin(p)),p+=c;this.lineTo(t+i*Math.cos(n),e+i*Math.sin(n)),this.isDirty=!0}arcTo(t,e,i,r,n){let o=this.points,h=this.startPoint,l=o.length===0?h:o[o.length-1],f=l.x,d=l.y,a=f-t,u=d-e,c=i-t,p=r-e,y=Math.sqrt(Math.pow(a,2)+Math.pow(u,2)),_=Math.sqrt(Math.pow(c,2)+Math.pow(p,2));a/=y,u/=y,c/=_,p/=_;let m=Math.atan2(u,a)-Math.atan2(p,c),x=Math.tan(m/2),v=n/x,w=t+a*v,E=e+u*v,A=t+c*v,I=e+p*v;this.moveTo(w,E);let z=(a+c)/2,L=(u+p)/2,G=Math.sqrt(Math.pow(z,2)+Math.pow(L,2));z/=G,L/=G;let Y=Math.sqrt(Math.pow(n,2)+Math.pow(v,2)),q=t+Y*z,T=e+Y*L,b=Math.atan2(E-T,w-q),S=Math.atan2(I-T,A-q);this.arc(q,T,n,b,S)}ellipse(t,e,i,r,n,o,h,l=!1){if(o===h)return;let f=l?Math.abs(o-h)>=Q:Math.abs(h-o)>=Q;o=o%Q,h=h%Q,o<0&&(o+=Q),h<0&&(h+=Q),o>=h&&(h+=Q);let d=h-o,a=1;l&&(a=-1,d=Q-d),f&&(d=Q);const c=(d*i+d*r)/2/this.arcResolution,y=d/c*a;let _=o;const m=Math.cos(n),x=Math.sin(n);this.moveTo(t+i*Math.cos(o),e+r*Math.sin(o));for(let v=0;v<c;v++){const w=i*Math.cos(_),E=r*Math.sin(_),A=t+w*m-E*x,I=e+w*x+E*m;this.lineTo(A,I),_+=y}this.lineTo(t+i*Math.cos(o),e+r*Math.sin(o)),this.isDirty=!0}quadraticCurveTo(t,e,i,r){const n=this.points,o=this.startPoint,h=n.length===0?o:n[n.length-1],l=g.pull("Point").set(i,r),f=g.pull("Point").set(t,e),d=this.arcResolution,a=1/d;for(let u=1;u<=d;u++)this.lineTo(h.x*Math.pow(1-a*u,2)+f.x*2*(1-a*u)*a*u+l.x*Math.pow(a*u,2),h.y*Math.pow(1-a*u,2)+f.y*2*(1-a*u)*a*u+l.y*Math.pow(a*u,2));g.push(l,f),this.isDirty=!0}bezierCurveTo(t,e,i,r,n,o){const h=this.points,l=this.startPoint,f=h.length===0?l:h[h.length-1],d=g.pull("Point").set(n,o),a=g.pull("Point").set(t,e),u=g.pull("Point").set(i,r),c=this.arcResolution,p=1/c;for(let y=1;y<=c;y++)this.lineTo(f.x*Math.pow(1-p*y,3)+a.x*3*Math.pow(1-p*y,2)*p*y+u.x*3*(1-p*y)*Math.pow(p*y,2)+d.x*Math.pow(p*y,3),f.y*Math.pow(1-p*y,3)+a.y*3*Math.pow(1-p*y,2)*p*y+u.y*3*(1-p*y)*Math.pow(p*y,2)+d.y*Math.pow(p*y,3));g.push(d,a,u),this.isDirty=!0}rect(t,e,i,r){this.moveTo(t,e),this.lineTo(t+i,e),this.moveTo(t+i,e),this.lineTo(t+i,e+r),this.moveTo(t+i,e+r),this.lineTo(t,e+r),this.moveTo(t,e+r),this.lineTo(t,e),this.isDirty=!0}roundRect(t,e,i,r,n){this.moveTo(t+n,e),this.lineTo(t+i-n,e),this.arcTo(t+i,e,t+i,e+n,n),this.moveTo(t+i,e+n),this.lineTo(t+i,e+r-n),this.arcTo(t+i,e+r,t+i-n,e+r,n),this.moveTo(t+i-n,e+r),this.lineTo(t+n,e+r),this.arcTo(t,e+r,t,e+r-n,n),this.moveTo(t,e+r-n),this.lineTo(t,e+n),this.arcTo(t,e,t+n,e,n),this.isDirty=!0}}let wo={offscreenCanvas:!1,willReadFrequently:!1,antiAlias:!1,context:"2d",transparent:!1,premultipliedAlpha:!0,stencil:!0,blendMode:"normal",failIfMajorPerformanceCaveat:!0,preferWebGL1:!1,powerPreference:"default"},er;function s0(s,t){let e;if(t.context==="2d")e=s.getContext(t.context,{willReadFrequently:t.willReadFrequently});else if(t.context==="webgl"){let i={alpha:t.transparent,antialias:t.antiAlias,depth:t.depth,stencil:!0,preserveDrawingBuffer:!1,premultipliedAlpha:t.transparent?t.premultipliedAlpha:!1,powerPreference:t.powerPreference,failIfMajorPerformanceCaveat:t.failIfMajorPerformanceCaveat};if(t.preferWebGL1!==!0&&(e=s.getContext("webgl2",i),e&&(er=2)),e||(er=1,e=s.getContext("webgl",i)||s.getContext("experimental-webgl",i)),!e)throw new Error("A WebGL context could not be created.")}else throw new Error("Invalid context type. Must be one of '2d' or 'webgl'");return e}class ir{constructor(t,e,i=wo){this.canvas,this.context,this.attributes=Object.assign({},wo,i),typeof i.context>"u"&&(i.context="2d"),typeof i.canvas<"u"?this.canvas=i.canvas:this.canvas=Ir(t,e,this.attributes.offscreenCanvas),this.context=s0(this.canvas,this.attributes),this.WebGLVersion=er,this.setAntiAlias(this.attributes.antiAlias)}onResetEvent(t,e){this.clear(),this.resize(t,e)}clear(){this.context.setTransform(1,0,0,1,0,0),this.context.clearRect(0,0,this.canvas.width,this.canvas.height)}setAntiAlias(t=!1){let e=this.canvas;Gd("imageSmoothingEnabled",t,this.context),typeof e.style<"u"&&(t!==!0?(e.style["image-rendering"]="optimizeSpeed",e.style["image-rendering"]="-moz-crisp-edges",e.style["image-rendering"]="-o-crisp-edges",e.style["image-rendering"]="-webkit-optimize-contrast",e.style["image-rendering"]="optimize-contrast",e.style["image-rendering"]="crisp-edges",e.style["image-rendering"]="pixelated",e.style.msInterpolationMode="nearest-neighbor"):e.style["image-rendering"]="auto")}resize(t,e){this.canvas.width=Math.round(t),this.canvas.height=Math.round(e)}getImageData(t,e,i,r){return t=C(Math.floor(t),0,this.canvas.width-1),e=C(Math.floor(e),0,this.canvas.height-1),i=C(i,1,this.canvas.width-t),r=C(r,1,this.canvas.height-e),this.context.getImageData(t,e,i,r)}toBlob(t="image/png",e){return typeof this.canvas.convertToBlob=="function"?this.canvas.convertToBlob(t,e):new Promise(function(i){this.canvas.toBlob(r=>{i(r)},t,e)})}toImageBitmap(t="image/png",e){return new Promise(i=>{if(typeof this.canvas.transferToImageBitmap=="function")i(this.canvas.transferToImageBitmap());else{let r=new Image;r.src=this.canvas.toDataURL(t,e),r.onload=()=>{globalThis.createImageBitmap(r).then(n=>i(n))}}})}toDataURL(t="image/png",e){return new Promise(i=>{i(this.canvas.toDataURL(t,e))})}invalidate(t){typeof t.gl<"u"&&(t.setCompositor("quad"),this.glTextureUnit=t.cache.getUnit(t.cache.get(this.canvas)),t.currentCompositor.unbindTexture2D(null,this.glTextureUnit))}destroy(){this.context=void 0,this.canvas=void 0}get width(){return this.canvas.width}set width(t){this.canvas.width=Math.round(t)}get height(){return this.canvas.height}set height(t){this.canvas.height=Math.round(t)}}class ne{constructor(t){this.renderTarget=new ir(t.width,t.height,typeof globalThis.canvas<"u"?Object.assign(t,{canvas:globalThis.canvas}):t),this.settings=t,this.designRatio=this.settings.width/this.settings.height,this.scaleRatio=new M(this.settings.scale,this.settings.scale),this.isContextValid=!0,this.depthTest="sorting",this.path2D=new i0,this.type="Generic",this.currentScissor=new Int32Array([0,0,this.settings.width,this.settings.height]),this.maskLevel=0,this.currentBlendMode="none",this.currentColor=new nt(0,0,0,1),this.currentTint=new nt(255,255,255,1),this.projectionMatrix=new fi,this.uvOffset=0}get height(){return this.getCanvas().height}set height(t){this.resize(this.width,t)}get width(){return this.getCanvas().width}set width(t){this.resize(t,this.height)}clear(){}flush(){}reset(){this.resetTransform(),this.setBlendMode(this.settings.blendMode),this.setColor("#000000"),this.clearTint(),this.cache.clear(),this.currentScissor[0]=0,this.currentScissor[1]=0,this.currentScissor[2]=this.width,this.currentScissor[3]=this.height,this.clearMask()}getCanvas(){return this.renderTarget.canvas}getContext(){return this.renderTarget.context}getBlendMode(){return this.currentBlendMode}getColor(){return this.currentColor}globalAlpha(){return this.currentColor.glArray[3]}overlaps(t){return t.left<=this.width&&t.right>=0&&t.top<=this.height&&t.bottom>=0}resize(t,e){let i=this.getCanvas();(t!==i.width||e!==i.height)&&(i.width=t,i.height=e,this.currentScissor[0]=0,this.currentScissor[1]=0,this.currentScissor[2]=t,this.currentScissor[3]=e,B(Ii,t,e))}setAntiAlias(t=!1){this.renderTarget.setAntiAlias(t)}setProjection(t){this.projectionMatrix.copy(t)}stroke(t,e){switch(t.type){case"RoundRect":this.strokeRoundRect(t.left,t.top,t.width,t.height,t.radius,e);break;case"Rectangle":case"Bounds":this.strokeRect(t.left,t.top,t.width,t.height,e);break;case"Polygon":case"Line":this.strokePolygon(t,e);break;case"Ellipse":this.strokeEllipse(t.pos.x,t.pos.y,t.radiusV.x,t.radiusV.y,e);break;case"Point":this.strokePoint(t.x,t.y);break;default:throw new Error("Invalid geometry for fill/stroke")}}fill(t){this.stroke(t,!0)}tint(t,e,i="multiply"){const r={context:"2d",offscreenCanvas:!0,transparent:!0,antiAlias:this.settings.antiAlias};let n=new ir(t.width,t.height,r),o=n.context;return o.fillStyle=e instanceof nt?e.toRGB():e,o.fillRect(0,0,t.width,t.height),o.globalCompositeOperation=i,o.drawImage(t,0,0),o.globalCompositeOperation="destination-atop",o.drawImage(t,0,0),n.canvas}setMask(t,e=!1){}clearMask(){}setTint(t,e=t.alpha){this.currentTint.copy(t),this.currentTint.alpha*=e}clearTint(){this.currentTint.setFloat(1,1,1,1)}toBlob(t="image/png",e){return this.renderTarget.toBlob(t,e)}toImageBitmap(t="image/png",e){return this.renderTarget.toImageBitmap(t,e)}toDataURL(t="image/png",e){return this.renderTarget.toDataURL(t,e)}}function _s(s,t){let e={};return s.frames.forEach(i=>{if(i.hasOwnProperty("filename")){let r=i.frame,n=!!i.trimmed,o;n&&(o={x:i.spriteSourceSize.x,y:i.spriteSourceSize.y,w:i.spriteSourceSize.w,h:i.spriteSourceSize.h});let h,l,f=i.sourceSize&&i.pivot;f&&(h=i.sourceSize.w*i.pivot.x-(n?o.x:0),l=i.sourceSize.h*i.pivot.y-(n?o.y:0)),e[i.filename]={name:i.filename,texture:s.meta.image||"default",offset:new M(r.x,r.y),anchorPoint:f?new M(h/r.w,l/r.h):null,trimmed:n,trim:o,width:r.w,height:r.h,angle:i.rotated===!0?-Ba:0},t.addUVs(e,i.filename,s.meta.size.w,s.meta.size.h)}}),e}function r0(s,t){let e={},i=s.image,r=s.spacing||0,n=s.margin||0,o=i.width,h=i.height,l=g.pull("Vector2d",~~((o-n+r)/(s.framewidth+r)),~~((h-n+r)/(s.frameheight+r)));if(o%(s.framewidth+r)!==0||h%(s.frameheight+r)!==0){let f=l.x*(s.framewidth+r),d=l.y*(s.frameheight+r);f-o!==r&&d-h!==r&&(o=f,h=d,console.warn("Spritesheet Texture for image: "+i.src+" is not divisible by "+(s.framewidth+r)+"x"+(s.frameheight+r)+", truncating effective size to "+o+"x"+h))}for(let f=0,d=l.x*l.y;f<d;f++){let a=""+f;e[a]={name:a,texture:"default",offset:new M(n+(r+s.framewidth)*(f%l.x),n+(r+s.frameheight)*~~(f/l.x)),anchorPoint:s.anchorPoint||null,trimmed:!1,trim:void 0,width:s.framewidth,height:s.frameheight,angle:0},t.addUVs(e,a,o,h)}return g.push(l),e}function n0(s,t){let e={};const i=s.frames;for(const n in i){let o=i[n].frame,h=!!o.trimmed,l;h&&(l={x:o.spriteSourceSize.x,y:o.spriteSourceSize.y,w:o.spriteSourceSize.w,h:o.spriteSourceSize.h});let f,d,a=o.sourceSize&&o.pivot;a&&(f=o.sourceSize.w*o.pivot.x-(h?l.x:0),d=o.sourceSize.h*o.pivot.y-(h?l.y:0)),e[n]={name:n,texture:s.meta.image||"default",offset:new M(o.x,o.y),anchorPoint:a?new M(f/o.w,d/o.h):null,trimmed:h,trim:l,width:o.w,height:o.h,angle:o.rotated===!0?-Ba:0},t.addUVs(e,n,s.meta.size.w,s.meta.size.h)}const r={};for(const n in s.meta.frameTags){const o=s.meta.frameTags[n],h=Array.from({length:o.to-o.from+1},(l,f)=>o.from+f);r[n]={name:o.name,index:h,speed:10*(h.length-1),direction:o.direction}}return e.anims=r,e}function _h(s,t,e="default",i="no-repeat"){return{meta:{app:"melonJS",size:{w:s,h:t},repeat:i,image:"default"},frames:[{filename:e,frame:{x:0,y:0,w:s,h:t}}]}}function o0(s){if(s.includes("texturepacker")||s.includes("free-tex-packer"))return"texturepacker";if(s.includes("shoebox"))return"shoebox";if(s.includes("aseprite"))return"aseprite";if(s.includes("melonJS"))return"melonJS";throw new Error("Unknown texture atlas format: "+s)}class zi{constructor(t,e,i){if(this.format=null,this.sources=new Map,this.atlases=new Map,this.activeAtlas=void 0,typeof t<"u"){t=Array.isArray(t)?t:[t];for(let r in t){let n=t[r];if(typeof n.meta<"u")switch(this.format=o0(n.meta.app),this.repeat=n.meta.repeat||"no-repeat",this.format){case"texturepacker":case"aseprite":if(typeof e>"u"){let o=Et(n.meta.image);if(!o)throw new Error("Atlas texture '"+o+"' not found");this.sources.set(n.meta.image,o)}else this.sources.set(n.meta.image||"default",typeof e=="string"?Et(e):e);this.format==="texturepacker"?this.atlases.set(n.meta.image||"default",_s(n,this)):this.atlases.set(n.meta.image||"default",n0(n,this));break;case"shoebox":if(!n.meta.exporter||!n.meta.exporter.includes("melonJS"))throw new Error("ShoeBox requires the JSON exporter : https://github.com/melonjs/melonJS/tree/master/media/shoebox_JSON_export.sbx");this.sources.set("default",typeof e=="string"?Et(e):e),this.atlases.set(n.meta.image||"default",_s(n,this));break;case"melonJS":this.sources.set("default",typeof e=="string"?Et(e):e),this.atlases.set(n.meta.image||"default",_s(n,this));break;default:throw new Error("Unknown texture atlas format: "+n.meta.app)}else typeof n.framewidth<"u"&&typeof n.frameheight<"u"&&(this.format="Spritesheet (fixed cell size)",this.repeat="no-repeat",typeof e<"u"&&(n.image=typeof e=="string"?Et(e):e),this.atlases.set("default",r0(n,this)),this.sources.set("default",n.image))}this.activeAtlas=this.atlases.keys().next().value}if(this.atlases.length===0)throw new Error("texture atlas format not supported");i!==!1&&this.sources.forEach(r=>{U.cache.set(r,this)})}getAtlas(t){return typeof t=="string"?this.atlases.get(t):this.atlases.get(this.activeAtlas)}getFormat(){return this.format}getTexture(t){return typeof t=="object"&&typeof t.texture=="string"?this.sources.get(t.texture):this.sources.get(this.activeAtlas)}addRegion(t,e,i,r,n){U.settings.verbose===!0&&console.warn("Adding texture region",t,"for texture",this);let o=this.getTexture(),h=this.getAtlas(),l=o.width,f=o.height;return h[t]={name:t,offset:new M(e,i),width:r,height:n,angle:0},this.addUVs(h,t,l,f),h[t]}getRegion(t,e){let i;if(typeof e=="string")i=this.getAtlas(e)[t];else for(let r of this.atlases.values())if(typeof r[t]<"u"){i=r[t];break}return i}getUVs(t){let e=this.getRegion(t);if(typeof e>"u"){let i=t.split(","),r=+i[0],n=+i[1],o=+i[2],h=+i[3];e=this.addRegion(t,r,n,o,h)}return e.uvs}addUVs(t,e,i,r){if(typeof U.gl<"u"){let n=t[e].offset,o=t[e].width,h=t[e].height;t[e].uvs=new Float32Array([n.x/i,n.y/r,(n.x+o)/i,(n.y+h)/r]);let l=n.x+","+n.y+","+i+","+r;t[l]=t[e]}return t[e].uvs}createSpriteFromName(t,e,i=!1){return g.pull(i===!0?"me.NineSliceSprite":"me.Sprite",0,0,Object.assign({image:this,region:t},e||{}))}createAnimationFromName(t,e){let i=[],r={},n=0,o=0;const h=this.getAtlas();typeof t>"u"&&(t=h);for(const l in t){const f=Array.isArray(t)?t[l]:l,d=this.getRegion(f);if(d==null)throw new Error("Texture - region for "+f+" not found");i.push(d),r[f]=i.length-1,n=Math.max(d.width,n),o=Math.max(d.height,o)}return new Ct(0,0,Object.assign({image:this,framewidth:n,frameheight:o,margin:0,spacing:0,atlas:i,anims:h.anims,atlasIndices:r},e||{}))}}class Ur{constructor(t,e){if(this.size_=0,this.map=new Map,this.operator=t,e)for(const[i,r]of e)this.put(i,r);return this}get size(){return this.size_}get(t){const e=this.map.get(t);return e?this.operator.clone(e):this.operator.create()}put(t,e){let i=this.map.get(t);return i||(i=this.operator.create()),this.operator.add(e,i)?(this.map.set(t,i),this.size_++,!0):!1}putAll(t,e){let i=0;if(e){const r=t,n=e;for(const o of n)this.put(r,o),i++}else if(t instanceof Ur)for(const[r,n]of t.entries())this.put(r,n),i++;else throw new TypeError("unexpected arguments");return i>0}has(t){return this.map.has(t)}hasEntry(t,e){return this.operator.has(e,this.get(t))}delete(t){return this.size_-=this.operator.size(this.get(t)),this.map.delete(t)}deleteEntry(t,e){const i=this.get(t);return this.operator.delete(e,i)?(this.map.set(t,i),this.size_--,!0):!1}clear(){this.map.clear(),this.size_=0}keys(){return this.map.keys()}entries(){const t=this;function*e(){for(const[i,r]of t.map.entries())for(const n of r)yield[i,n]}return e()}values(){const t=this;function*e(){for(const[,i]of t.entries())yield i}return e()}forEach(t,e){for(const[i,r]of this.entries())t.call(e===void 0?this:e,r,i,this)}[Symbol.iterator](){return this.entries()}asMap(){const t=new Map;for(const e of this.keys())t.set(e,this.operator.clone(this.get(e)));return t}}class a0 extends Ur{constructor(t){super(new h0,t)}get[Symbol.toStringTag](){return"ArrayMultimap"}}class h0{create(){return[]}clone(t){return t.slice()}add(t,e){return e.push(t),!0}size(t){return t.length}delete(t,e){const i=e.indexOf(t);return i>-1?(e.splice(i,1),!0):!1}has(t,e){return e.includes(t)}}class xh{constructor(t=1/0){this.cache=new a0,this.tinted=new Map,this.units=new Map,this.usedUnits=new Set,this.max_size=t,this.clear()}clear(){this.cache.clear(),this.tinted.clear(),this.units.clear(),this.usedUnits.clear()}allocateTextureUnit(){for(let t=0;t<this.max_size;t++)if(!this.usedUnits.has(t))return this.usedUnits.add(t),t;throw new Error("Texture cache overflow: "+this.max_size+" texture units available for this GPU.")}freeTextureUnit(t){let e=t.sources.get(t.activeAtlas);typeof this.units.get(e)<"u"&&(this.usedUnits.delete(e),this.units.delete(e))}getUnit(t){let e=t.sources.get(t.activeAtlas);return this.units.has(e)||this.units.set(e,this.allocateTextureUnit()),this.units.get(e)}set(t,e){let i=t.width||t.videoWidth,r=t.height||t.videoHeight;if(U.WebGLVersion===1&&(!ge(i)||!ge(r))){let n=typeof t.src<"u"?t.src:t;console.warn("[Texture] "+n+" is not a POT texture ("+i+"x"+r+")")}return this.cache.put(t,e)}get(t,e){let i=this.cache.get(t)[0];if(typeof i<"u"&&typeof e<"u"&&this.cache.forEach((r,n)=>{let o=r.getAtlas();n===t&&o.width===e.framewidth&&o.height===e.frameheight&&(i=r)}),typeof i>"u"&&(console.log("cache miss"),e||(e=_h(t.width||t.videoWidth,t.height||t.videoHeight,t.src?Or(t.src):void 0)),i=new zi(e,t,!1),this.set(t,i)),typeof i.sources<"u"&&i.sources.size>1){console.log(i);for(const[r,n]of i.sources.entries())n===t&&(console.log("cache hit"),console.log(r),i.activeAtlas=r)}return i}delete(t){if(this.cache.has(t)){let e=this.cache.get(t)[0];typeof e<"u"&&this.freeTextureUnit(e),this.cache.delete(t)}}tint(t,e){let i=this.tinted.get(t);return i===void 0&&(i=this.tinted.set(t,new Map)),i.has(e)||i.set(e,U.tint(t,e,"multiply")),i.get(e)}}class Gi extends ne{constructor(t){super(t),this.setBlendMode(this.settings.blendMode),this.setColor(this.currentColor),this.cache=new xh,this.settings.textureSeamFix!==!1&&!this.settings.antiAlias&&(this.uvOffset=1),this.type="CANVAS",this.getCanvas().addEventListener("contextlost",e=>{e.preventDefault(),this.isContextValid=!1,B(Cr,this)},!1),this.getCanvas().addEventListener("contextrestored",()=>{this.isContextValid=!0,B(yi,this)},!1),F(ze,()=>{this.reset()})}reset(){super.reset(),this.clearColor(this.currentColor,this.settings.transparent!==!0)}resetTransform(){this.getContext().setTransform(1,0,0,1,0,0)}setBlendMode(t="normal",e){switch(e=e||this.getContext(),this.currentBlendMode=t,t){case"screen":e.globalCompositeOperation="screen";break;case"lighter":case"additive":e.globalCompositeOperation="lighter";break;case"multiply":e.globalCompositeOperation="multiply";break;default:e.globalCompositeOperation="source-over",this.currentBlendMode="normal";break}}clear(){if(this.settings.transparent===!1){let t=this.getCanvas();this.getContext().clearRect(0,0,t.width,t.height)}}clearColor(t="#000000",e=!1){let i=this.getCanvas(),r=this.getContext();this.save(),this.resetTransform(),r.globalAlpha=1,r.globalCompositeOperation=e===!0?"copy":"source-over",r.fillStyle=t instanceof nt?t.toRGBA():t,this.fillRect(0,0,i.width,i.height),this.restore()}clearRect(t,e,i,r){this.getContext().clearRect(t,e,i,r)}createPattern(t,e){return this.getContext().createPattern(t,e)}drawImage(t,e,i,r,n,o,h,l,f){if(this.getGlobalAlpha()<1/255)return;let d=this.getContext();typeof r>"u"?(r=l=t.width,n=f=t.height,o=e,h=i,e=0,i=0):typeof o>"u"&&(o=e,h=i,l=r,f=n,r=t.width,n=t.height,e=0,i=0),this.settings.subPixel===!1&&(o=~~o,h=~~h);let a=t,u=this.currentTint.toArray();(u[0]!==1||u[1]!==1||u[2]!==1)&&(a=this.cache.tint(t,this.currentTint.toRGB())),d.drawImage(a,e,i,r,n,o,h,l,f)}drawPattern(t,e,i,r,n){if(this.getGlobalAlpha()<1/255)return;let o=this.getContext(),h=o.fillStyle;o.fillStyle=t,o.fillRect(e,i,r,n),o.fillStyle=h}beginPath(){this.getContext().beginPath()}moveTo(t,e){this.getContext().moveTo(t,e)}lineTo(t,e){this.getContext().lineTo(t,e)}rect(t,e,i,r){this.getContext().rect(t,e,i,r)}roundRect(t,e,i,r,n){this.getContext().roundRect(t,e,i,r,n)}stroke(t,e){typeof t>"u"?e===!0?this.getContext().fill():this.getContext().stroke():super.stroke(t,e)}fill(t){this.stroke(t,!0)}closePath(){this.getContext().closePath()}strokeArc(t,e,i,r,n,o,h=!1){if(this.getGlobalAlpha()<1/255)return;let l=this.getContext();l.translate(t,e),l.beginPath(),l.arc(0,0,i,r,n,o||!1),l[h===!0?"fill":"stroke"](),l.translate(-t,-e)}fillArc(t,e,i,r,n,o){this.strokeArc(t,e,i,r,n,o||!1,!0)}strokeEllipse(t,e,i,r,n=!1){if(this.getGlobalAlpha()<1/255)return;let o=this.getContext(),h=i,l=r,f=t-h,d=t+h,a=e-l,u=e+l,c=h*.551784,p=l*.551784,y=t-c,_=t+c,m=e-p,x=e+p;o.beginPath(),o.moveTo(t,a),o.bezierCurveTo(_,a,d,m,d,e),o.bezierCurveTo(d,x,_,u,t,u),o.bezierCurveTo(y,u,f,x,f,e),o.bezierCurveTo(f,m,y,a,t,a),o[n===!0?"fill":"stroke"](),o.closePath()}fillEllipse(t,e,i,r){this.strokeEllipse(t,e,i,r,!0)}strokeLine(t,e,i,r){if(this.getGlobalAlpha()<1/255)return;let n=this.getContext();n.beginPath(),n.moveTo(t,e),n.lineTo(i,r),n.stroke()}fillLine(t,e,i,r){this.strokeLine(t,e,i,r)}strokePolygon(t,e=!1){if(this.getGlobalAlpha()<1/255)return;let i=this.getContext(),r=t.points,n=r.length,o=r[0];this.translate(t.pos.x,t.pos.y),i.beginPath(),i.moveTo(o.x,o.y);for(let h=1;h<n;h++){const l=r[h];i.lineTo(l.x,l.y)}i.lineTo(o.x,o.y),i[e===!0?"fill":"stroke"](),i.closePath(),this.translate(-t.pos.x,-t.pos.y)}fillPolygon(t){this.strokePolygon(t,!0)}strokeRect(t,e,i,r,n=!1){if(this.getGlobalAlpha()<1/255)return;this.getContext()[n===!0?"fillRect":"strokeRect"](t,e,i,r)}fillRect(t,e,i,r){this.strokeRect(t,e,i,r,!0)}strokeRoundRect(t,e,i,r,n,o=!1){if(this.getGlobalAlpha()<1/255)return;let h=this.getContext();h.beginPath(),h.roundRect(t,e,i,r,n),h[o===!0?"fill":"stroke"]()}fillRoundRect(t,e,i,r,n){this.strokeRoundRect(t,e,i,r,n,!0)}strokePoint(t,e){this.strokeLine(t,e,t+1,e+1)}fillPoint(t,e){this.strokePoint(t,e)}restore(){const t=this.getCanvas();this.getContext().restore(),this.currentColor.glArray[3]=this.getGlobalAlpha(),this.currentScissor[0]=0,this.currentScissor[1]=0,this.currentScissor[2]=t.width,this.currentScissor[3]=t.height}save(){this.getContext().save()}rotate(t){this.getContext().rotate(t)}scale(t,e){this.getContext().scale(t,e)}setColor(t){let e=this.currentColor,i=this.getContext();e.copy(t),i.strokeStyle=i.fillStyle=e.toRGBA()}setGlobalAlpha(t){this.getContext().globalAlpha=t}getGlobalAlpha(){return this.getContext().globalAlpha}get lineWidth(){return this.getContext().lineWidth}set lineWidth(t){return this.getContext().lineWidth=t,t}get lineJoin(){return this.getContext().lineJoin}set lineJoin(t){let e=this.getContext();return e.lineJoin=t,e.lineJoin}setTransform(t,e,i,r,n,o){this.resetTransform(),this.transform(t,e,i,r,n,o)}transform(t,e,i,r,n,o){if(typeof t=="object"){let h=t.toArray();t=h[0],e=h[1],i=h[3],r=h[4],n=h[6],o=h[7]}this.settings.subPixel===!1&&(n|=0,o|=0),this.getContext().transform(t,e,i,r,n,o)}translate(t,e){this.settings.subPixel===!1?this.getContext().translate(~~t,~~e):this.getContext().translate(t,e)}clipRect(t,e,i,r){let n=this.getCanvas();if(t!==0||e!==0||i!==n.width||r!==n.height){let o=this.currentScissor;if(o[0]!==t||o[1]!==e||o[2]!==i||o[3]!==r){let h=this.getContext();h.beginPath(),h.rect(t,e,i,r),h.clip(),o[0]=t,o[1]=e,o[2]=i,o[3]=r}}}setMask(t,e=!1){let i=this.getContext();if(this.maskLevel===0&&(i.save(),typeof t<"u"&&i.beginPath()),typeof t<"u")switch(t.type){case"RoundRect":i.roundRect(t.top,t.left,t.width,t.height,t.radius);break;case"Rectangle":case"Bounds":i.rect(t.top,t.left,t.width,t.height);break;case"Polygon":{const r=t.pos.x,n=t.pos.y;i.moveTo(r+t.points[0].x,n+t.points[0].y);for(let o=1;o<t.points.length;o++){const h=t.points[o];i.lineTo(r+h.x,n+h.y)}}break;case"Ellipse":{const r=t.pos.x,n=t.pos.y,o=t.radiusV.x,h=t.radiusV.y,l=r-o,f=r+o,d=n-h,a=n+h;let u=o*.551784,c=h*.551784,p=r-u,y=r+u,_=n-c,m=n+c;i.moveTo(r,d),i.bezierCurveTo(y,d,f,_,f,n),i.bezierCurveTo(f,m,y,a,r,a),i.bezierCurveTo(p,a,l,m,l,n),i.bezierCurveTo(l,_,p,d,r,d)}break;default:throw new Error("Invalid geometry for setMask")}this.maskLevel++,e===!0?(i.closePath(),i.globalCompositeOperation="destination-atop",i.fill()):i.clip()}clearMask(){this.maskLevel>0&&(this.maskLevel=0,this.getContext().restore())}}function l0(s,t){let e=new Array(t);for(let i=0;i<t;i++){e[i]=new Array(s);for(let r=0;r<s;r++)e[i][r]=null}return e}function bo(s,t,e){let i=0,r,n;typeof t.rows>"u"?(r=t.width,n=t.height):(r=t.cols,n=t.rows);for(let o=0;o<n;o++)for(let h=0;h<r;h++){const l=e[i++];l!==0&&(s.layerData[h+t.x][o+t.y]=s.getTileById(l,h+t.x,o+t.y))}}class be extends W{constructor(t,e,i,r,n,o,h){super(0,0,0,0),this.tilewidth=e.tilewidth||i,this.tileheight=e.tileheight||r,this.orientation=n,this.x=0,this.y=0,this.tilesets=o,this.tileset=this.tilesets?this.tilesets.getTilesetByIndex(0):null,this.maxTileSize={width:0,height:0};for(let f=0;f<this.tilesets.length;f++){const d=this.tilesets.getTilesetByIndex(f);this.maxTileSize.width=Math.max(this.maxTileSize.width,d.tilewidth),this.maxTileSize.height=Math.max(this.maxTileSize.height,d.tileheight)}this.animatedTilesets=[],this.isAnimated=!1,this.renderorder=e.renderorder||"right-down",this.class=e.class,this.pos.z=h,this.anchorPoint.set(0,0),this.name=e.name,this.cols=+e.width,this.rows=+e.height;let l=typeof e.visible<"u"?+e.visible:1;this.setOpacity(l?+e.opacity:0),typeof e.tintcolor=="string"&&this.tint.parseHex(e.tintcolor,!0),this.orientation==="isometric"?(this.width=(this.cols+this.rows)*(this.tilewidth/2),this.height=(this.cols+this.rows)*(this.tileheight/2)):(this.width=this.cols*this.tilewidth,this.height=this.rows*this.tileheight),_e(this,e),this.setRenderer(t.getRenderer()),this.layerData=l0(this.rows,this.cols),t.infinite===0?bo(this,this,vi(e.data,e.encoding,e.compression)):t.infinite===1&&e.chunks.forEach(f=>{bo(this,f,vi(f.data,e.encoding,e.compression))})}onActivateEvent(){if(this.animatedTilesets===void 0&&(this.animatedTilesets=[]),this.tilesets){let t=this.tilesets.tilesets;for(let e=0;e<t.length;e++)t[e].isAnimated&&this.animatedTilesets.push(t[e])}this.isAnimated=this.animatedTilesets.length>0,typeof this.preRender>"u"&&this.isAnimated===!1?this.preRender=this.ancestor.getRootAncestor().preRender:this.preRender=!1,this.preRender===!0&&!this.canvasRenderer&&(this.canvasRenderer=new Gi({canvas:Ir(this.width,this.height),width:this.width,heigth:this.height,transparent:!0}),this.getRenderer().drawTileLayer(this.canvasRenderer,this,this)),this.isDirty=!0}onDeactivateEvent(){this.animatedTilesets=void 0}setRenderer(t){this.renderer=t,this.isDirty=!0}getRenderer(){return this.renderer}getTileId(t,e){let i=this.getTile(t,e);return i?i.tileId:null}getTile(t,e){let i=null;if(this.contains(t,e)){let r=this.getRenderer().pixelToTileCoords(t,e,g.pull("Vector2d"));i=this.cellAt(r.x,r.y),g.push(r)}return i}setTile(t,e,i){return this.layerData[e][i]=t,this.isDirty=!0,t}getTileById(t,e,i){return this.tileset.contains(t)||(this.tileset=this.tilesets.getTilesetByGid(t)),new mh(e,i,t,this.tileset)}cellAt(t,e,i){let r=~~t,n=~~e,o=this.getRenderer();return i===!1||r>=0&&r<o.cols&&n>=0&&n<o.rows?this.layerData[r][n]:null}clearTile(t,e){this.layerData[t][e]=null,this.preRender&&this.canvasRenderer.clearRect(t*this.tilewidth,e*this.tileheight,this.tilewidth,this.tileheight),this.isDirty=!0}update(t){let e=this.isDirty;if(this.isAnimated)for(let i=0;i<this.animatedTilesets.length;i++)e=this.animatedTilesets[i].update(t)||e;return e}draw(t,e){if(this.preRender){const i=Math.min(e.width,this.width),r=Math.min(e.height,this.height);t.drawImage(this.canvasRenderer.getCanvas(),e.pos.x,e.pos.y,i,r,e.pos.x,e.pos.y,i,r)}else this.getRenderer().drawTileLayer(t,this,e)}}class u0{constructor(t,e,i){this.name=e.name,this.width=e.width||0,this.height=e.height||0,this.tintcolor=e.tintcolor,this.class=e.class,this.z=i,this.objects=[];let r=typeof e.visible<"u"?e.visible:!0;this.opacity=r===!0?C(+e.opacity||1,0,1):0,_e(this,e),e.objects&&e.objects.forEach(n=>{n.tintcolor=this.tintcolor,this.objects.push(new Km(t,n,i))}),e.layers&&e.layers.forEach(n=>{let o=new be(t,n,t.tilewidth,t.tileheight,t.orientation,t.tilesets,i++);o.setRenderer(t.getRenderer()),this.width=Math.max(this.width,o.width),this.height=Math.max(this.height,o.height),this.objects.push(o)})}destroy(){this.objects=null}getObjectCount(){return this.objects.length}getObjectByIndex(t){return this.objects[t]}}function f0(s,t){this.removeChildNow(s,t)}let si=0;class dt extends W{constructor(t=0,e=0,i,r,n=!1){super(t,e,typeof i>"u"?typeof N.viewport<"u"?N.viewport.width:1/0:i,typeof r>"u"?typeof N.viewport<"u"?N.viewport.height:1/0:r),this.pendingSort=null,this.root=n,this.children=void 0,this.sortOn="z",this.autoSort=!0,this.autoDepth=!0,this.clipping=!1,this.onChildChange=function(o){},this.enableChildBoundsUpdate=!1,this.backgroundColor=g.pull("Color",0,0,0,0),this.drawCount=0,this.autoTransform=!0,this.isKinematic=!1,this.anchorPoint.set(0,0),this.root===!0&&F(Ii,()=>{this.enableChildBoundsUpdate,this.updateBounds(),this.enableChildBoundsUpdate})}reset(){this.pendingSort&&(clearTimeout(this.pendingSort),this.pendingSort=null);let t=this.getChildren();for(let e=t.length,i;e>=0;i=t[--e])i&&i.isPersistent!==!0&&this.removeChildNow(i);typeof this.currentTransform<"u"&&this.currentTransform.identity(),this.backgroundColor.setColor(0,0,0,0)}addChild(t,e){if(t.ancestor instanceof dt?t.ancestor.removeChildNow(t):t.isRenderable&&(t.GUID=mo(t.id)),t.ancestor=this,this.getChildren().push(t),typeof t.updateBounds=="function"&&(this.isFloating===!0&&(t.floating=!1),t.updateBounds()),typeof t.pos<"u"&&(typeof e=="number"?t.pos.z=e:this.autoDepth===!0&&(t.pos.z=this.getChildren().length)),this.autoSort===!0&&this.sort(),typeof t.onActivateEvent=="function"&&this.isAttachedToRoot()&&t.onActivateEvent(),this.enableChildBoundsUpdate===!0&&this.updateBounds(),this.isAttachedToRoot()){let i=this.getRootAncestor();t.body instanceof yt&&i.addBody(t.body),t instanceof dt&&t.forEach(r=>{r.body instanceof yt&&i.addBody(r.body)})}return this.isDirty=!0,this.onChildChange.call(this,this.getChildren().length-1),t}addChildAt(t,e){if(e>=0&&e<this.getChildren().length){if(t.ancestor instanceof dt?t.ancestor.removeChildNow(t):t.isRenderable&&(t.GUID=mo()),t.ancestor=this,this.getChildren().splice(e,0,t),typeof t.updateBounds=="function"&&(this.isFloating===!0&&(t.floating=!1),t.updateBounds()),typeof t.onActivateEvent=="function"&&this.isAttachedToRoot()&&t.onActivateEvent(),this.enableChildBoundsUpdate===!0&&this.updateBounds(),this.isAttachedToRoot()){let i=this.getRootAncestor();t.body instanceof yt&&i.addBody(t.body),t instanceof dt&&t.forEach(r=>{r.body instanceof yt&&i.addBody(r.body)})}return this.isDirty=!0,this.onChildChange.call(this,e),t}else throw new Error("Index ("+e+") Out Of Bounds for addChildAt()")}forEach(t,e){let i=this,r=0,n=this.getChildren(),o=n.length;if(typeof t!="function")throw new Error(t+" is not a function");for(arguments.length>1&&(i=e);r<o;)t.call(i,n[r],r,n),r++}swapChildren(t,e){let i=this.getChildIndex(t),r=this.getChildIndex(e);if(i!==-1&&r!==-1){let n=t.pos.z;t.pos.z=e.pos.z,e.pos.z=n,this.getChildren()[i]=e,this.getChildren()[r]=t,this.isDirty=!0}else throw new Error(t+" Both the supplied childs must be a child of the caller "+this)}getChildAt(t){if(t>=0&&t<this.getChildren().length)return this.getChildren()[t];throw new Error("Index ("+t+") Out Of Bounds for getChildAt()")}getChildIndex(t){return this.getChildren().indexOf(t)}getNextChild(t){let e=this.getChildren().indexOf(t)-1;if(e>=0&&e<this.getChildren().length)return this.getChildAt(e)}hasChild(t){return this===t.ancestor}getChildByProp(t,e){let i=[];function r(n,o){let h=n[o];e instanceof RegExp&&typeof h=="string"?e.test(h)&&i.push(n):h===e&&i.push(n)}return this.forEach(n=>{r(n,t),n instanceof dt&&(i=i.concat(n.getChildByProp(t,e)))}),i}getChildByType(t){let e=[];return this.forEach(i=>{i instanceof t&&e.push(i),i instanceof dt&&(e=e.concat(i.getChildByType(t)))}),e}getChildByName(t){return this.getChildByProp("name",t)}getChildByGUID(t){let e=this.getChildByProp("GUID",t);return e.length>0?e[0]:null}getChildren(){return typeof this.children>"u"&&(this.children=[]),this.children}updateBounds(t=!0){let e=this.getBounds();return super.updateBounds(t),this.enableChildBoundsUpdate===!0&&this.forEach(i=>{if(i.isRenderable){let r=i.updateBounds(!0);r.isFinite()&&e.addBounds(r)}}),e}isAttachedToRoot(){if(this.root===!0)return!0;{let t=this.ancestor;for(;t;){if(t.root===!0)return!0;t=t.ancestor}return!1}}getRootAncestor(){if(this.root===!0)return this;{let t=this.ancestor;for(;t&&t.root!==!0;)t=t.ancestor;return t}}updateBoundsPos(t=this.pos.x,e=this.pos.y){super.updateBoundsPos(t,e),this.forEach(i=>{i.isRenderable&&i.updateBoundsPos(i.pos.x+t-this.pos.x,i.pos.y+e-this.pos.y)})}onActivateEvent(){this.forEach(t=>{typeof t.onActivateEvent=="function"&&t.onActivateEvent()})}removeChild(t,e){if(this.hasChild(t))Qt(f0,this,t,e);else throw new Error("Child is not mine.")}removeChildNow(t,e){if(this.hasChild(t)&&this.getChildIndex(t)>=0){typeof t.onDeactivateEvent=="function"&&t.onDeactivateEvent(),t.body instanceof yt&&this.getRootAncestor().removeBody(t.body),e||g.push(t,!1)===!1&&typeof t.destroy=="function"&&t.destroy();let i=this.getChildIndex(t);i>=0&&(this.getChildren().splice(i,1),t.ancestor=void 0),this.enableChildBoundsUpdate===!0&&this.updateBounds(),this.isDirty=!0,this.onChildChange.call(this,i)}}setChildsProperty(t,e,i){this.forEach(r=>{i===!0&&r instanceof dt&&r.setChildsProperty(t,e,i),r[t]=e})}moveUp(t){let e=this.getChildIndex(t);e-1>=0&&(this.swapChildren(t,this.getChildAt(e-1)),this.isDirty=!0)}moveDown(t){let e=this.getChildIndex(t);e>=0&&e+1<this.getChildren().length&&(this.swapChildren(t,this.getChildAt(e+1)),this.isDirty=!0)}moveToTop(t){let e=this.getChildIndex(t);if(e>0){let i=this.getChildren();i.splice(0,0,i.splice(e,1)[0]),t.pos.z=i[1].pos.z+1,this.isDirty=!0}}moveToBottom(t){let e=this.getChildIndex(t),i=this.getChildren();e>=0&&e<i.length-1&&(i.splice(i.length-1,0,i.splice(e,1)[0]),t.pos.z=i[i.length-2].pos.z-1,this.isDirty=!0)}sort(t){this.pendingSort||(t===!0&&this.forEach(e=>{e instanceof dt&&e.sort(t)}),this.pendingSort=Qt(function(){this.getChildren().sort(this["_sort"+this.sortOn.toUpperCase()]),this.pendingSort=null,this.isDirty=!0},this))}onDeactivateEvent(){this.forEach(t=>{typeof t.onDeactivateEvent=="function"&&t.onDeactivateEvent()})}_sortZ(t,e){return e.pos&&t.pos?e.pos.z-t.pos.z:t.pos?-1/0:1/0}_sortReverseZ(t,e){return t.pos&&e.pos?t.pos.z-e.pos.z:t.pos?1/0:-1/0}_sortX(t,e){if(!e.pos||!t.pos)return t.pos?-1/0:1/0;let i=e.pos.z-t.pos.z;return i||e.pos.x-t.pos.x}_sortY(t,e){if(!e.pos||!t.pos)return t.pos?-1/0:1/0;let i=e.pos.z-t.pos.z;return i||e.pos.y-t.pos.y}destroy(){this.reset(),super.destroy(arguments)}update(t){let e=!1,i=j.isPaused(),r=this.getChildren();const n=r.length;for(let o=n,h;o--,h=r[o];)i&&!h.updateWhenPaused||(h.isRenderable?(e=si>0||h.floating,e&&si++,h.inViewport=!1,j.current().cameras.forEach(l=>{l.isVisible(h,e)&&(h.inViewport=!0)}),this.isDirty|=(h.inViewport||h.alwaysUpdate)&&h.update(t),si>0&&si--):this.isDirty|=h.update(t));return super.update(t)}draw(t,e){let i=!1,r=this.getBounds();this.drawCount=0,this.root===!1&&this.clipping===!0&&r.isFinite()===!0&&t.clipRect(r.left,r.top,r.width,r.height),t.translate(this.pos.x,this.pos.y),this.backgroundColor.alpha>1/255&&t.clearColor(this.backgroundColor);let n=this.getChildren();for(let o=n.length,h;o--,h=n[o];)h.isRenderable&&(i=h.floating===!0,(h.inViewport||i)&&(i&&(t.save(),t.resetTransform()),h.preDraw(t),h.draw(t,e),h.postDraw(t),i&&t.restore(),this.drawCount++))}}class zr{constructor(t,e,i,r){this.cols=t,this.rows=e,this.tilewidth=i,this.tileheight=r,this.bounds=new ut}canRender(t){return this.tilewidth===t.tilewidth&&this.tileheight===t.tileheight}getBounds(t){let e=t instanceof be?g.pull("Bounds"):this.bounds;return e.setMinMax(0,0,this.cols*this.tilewidth,this.rows*this.tileheight),e}pixelToTileCoords(t,e,i){return i}tileToPixelCoords(t,e,i){return i}drawTile(t,e,i,r){}drawTileLayer(t,e,i){}}class c0 extends zr{constructor(t){super(t.cols,t.rows,t.tilewidth,t.tileheight)}canRender(t){return t.orientation==="orthogonal"&&super.canRender(t)}pixelToTileCoords(t,e,i){return(i||new M).set(t/this.tilewidth,e/this.tileheight)}tileToPixelCoords(t,e,i){return(i||new M).set(t*this.tilewidth,e*this.tileheight)}adjustPosition(t){typeof t.gid=="number"&&(t.y-=t.height)}drawTile(t,e,i,r){let n=r.tileset;n.drawTile(t,n.tileoffset.x+e*this.tilewidth,n.tileoffset.y+(i+1)*this.tileheight-n.tileheight,r)}drawTileLayer(t,e,i){let r=1,n=1,o=this.pixelToTileCoords(Math.max(i.pos.x-(e.maxTileSize.width-e.tilewidth),0),Math.max(i.pos.y-(e.maxTileSize.height-e.tileheight),0),g.pull("Vector2d")).floorSelf(),h=this.pixelToTileCoords(i.pos.x+i.width+this.tilewidth,i.pos.y+i.height+this.tileheight,g.pull("Vector2d")).ceilSelf();switch(h.x=h.x>this.cols?this.cols:h.x,h.y=h.y>this.rows?this.rows:h.y,e.renderorder){case"right-up":h.y=o.y+(o.y=h.y)-h.y,n=-1;break;case"left-down":h.x=o.x+(o.x=h.x)-h.x,r=-1;break;case"left-up":h.x=o.x+(o.x=h.x)-h.x,h.y=o.y+(o.y=h.y)-h.y,r=-1,n=-1;break}for(let l=o.y;l!==h.y;l+=n)for(let f=o.x;f!==h.x;f+=r){let d=e.cellAt(f,l,!1);d&&this.drawTile(t,f,l,d)}g.push(o),g.push(h)}}class d0 extends zr{constructor(t){super(t.cols,t.rows,t.tilewidth,t.tileheight),this.hTilewidth=this.tilewidth/2,this.hTileheight=this.tileheight/2,this.originX=this.rows*this.hTilewidth}canRender(t){return t.orientation==="isometric"&&super.canRender(t)}getBounds(t){let e=t instanceof be?g.pull("Bounds"):this.bounds;return e.setMinMax(0,0,(this.cols+this.rows)*(this.tilewidth/2),(this.cols+this.rows)*(this.tileheight/2)),e}pixelToTileCoords(t,e,i){return(i||new M).set(e/this.tileheight+(t-this.originX)/this.tilewidth,e/this.tileheight-(t-this.originX)/this.tilewidth)}tileToPixelCoords(t,e,i){return(i||new M).set((t-e)*this.hTilewidth+this.originX,(t+e)*this.hTileheight)}adjustPosition(t){let e=t.x/this.hTilewidth,i=t.y/this.tileheight,r=g.pull("Vector2d");this.tileToPixelCoords(e,i,r),t.x=r.x,t.y=r.y,g.push(r)}drawTile(t,e,i,r){let n=r.tileset;n.drawTile(t,(this.cols-1)*n.tilewidth+(e-i)*n.tilewidth>>1,-n.tilewidth+(e+i)*n.tileheight>>2,r)}drawTileLayer(t,e,i){let r=e.tileset,n=this.pixelToTileCoords(i.pos.x-r.tilewidth,i.pos.y-r.tileheight,g.pull("Vector2d")).floorSelf(),o=this.pixelToTileCoords(i.pos.x+i.width+r.tilewidth,i.pos.y+i.height+r.tileheight,g.pull("Vector2d")).ceilSelf(),h=this.tileToPixelCoords(o.x,o.y,g.pull("Vector2d")),l=this.tileToPixelCoords(n.x,n.y,g.pull("Vector2d"));l.x-=this.hTilewidth,l.y+=this.tileheight;let f=l.y-i.pos.y>this.hTileheight,d=i.pos.x-l.x<this.hTilewidth;f&&(d?(n.x--,l.x-=this.hTilewidth):(n.y--,l.x+=this.hTilewidth),l.y-=this.hTileheight);let a=f^d,u=n.clone();for(let c=l.y*2;c-this.tileheight*2<h.y*2;c+=this.tileheight){u.setV(n);for(let p=l.x;p<h.x;p+=this.tilewidth){let y=e.cellAt(u.x,u.y);if(y){r=y.tileset;let _=r.tileoffset;r.drawTile(t,_.x+p,_.y+c/2-r.tileheight,y)}u.x++,u.y--}a?(n.y++,l.x-=this.hTilewidth,a=!1):(n.x++,l.x+=this.hTilewidth,a=!0)}g.push(u),g.push(n),g.push(o),g.push(h),g.push(l)}}const p0=[{x:0,y:0},{x:1,y:-1},{x:1,y:0},{x:2,y:0}],g0=[{x:0,y:0},{x:-1,y:1},{x:0,y:1},{x:0,y:2}];class vh extends zr{constructor(t){super(t.cols,t.rows,t.tilewidth&-2,t.tileheight&-2),this.hexsidelength=t.hexsidelength||0,this.staggerX=t.staggeraxis==="x",this.staggerEven=t.staggerindex==="even",this.sidelengthx=0,this.sidelengthy=0,t.orientation==="hexagonal"&&(this.staggerX?this.sidelengthx=this.hexsidelength:this.sidelengthy=this.hexsidelength),this.sideoffsetx=(this.tilewidth-this.sidelengthx)/2,this.sideoffsety=(this.tileheight-this.sidelengthy)/2,this.columnwidth=this.sideoffsetx+this.sidelengthx,this.rowheight=this.sideoffsety+this.sidelengthy,this.centers=[new M,new M,new M,new M]}canRender(t){return t.orientation==="hexagonal"&&super.canRender(t)}getBounds(t){let e=t instanceof be?g.pull("Bounds"):this.bounds;return this.staggerX?(e.setMinMax(0,0,this.cols*this.columnwidth+this.sideoffsetx,this.rows*(this.tileheight+this.sidelengthy)),e.width>1&&(e.height+=this.rowheight)):(e.setMinMax(0,0,this.cols*(this.tilewidth+this.sidelengthx),this.rows*this.rowheight+this.sideoffsety),e.height>1&&(e.width+=this.columnwidth)),e}doStaggerX(t){return this.staggerX&&t&1^this.staggerEven}doStaggerY(t){return!this.staggerX&&t&1^this.staggerEven}topLeft(t,e,i){let r=i||new M;return this.staggerX?t&1^this.staggerEven?r.set(t-1,e):r.set(t-1,e-1):e&1^this.staggerEven?r.set(t,e-1):r.set(t-1,e-1),r}topRight(t,e,i){let r=i||new M;return this.staggerX?t&1^this.staggerEven?r.set(t+1,e):r.set(t+1,e-1):e&1^this.staggerEven?r.set(t+1,e-1):r.set(t,e-1),r}bottomLeft(t,e,i){let r=i||new M;return this.staggerX?t&1^this.staggerEven?r.set(t-1,e+1):r.set(t-1,e):e&1^this.staggerEven?r.set(t,e+1):r.set(t-1,e+1),r}bottomRight(t,e,i){let r=i||new M;return this.staggerX?t&1^this.staggerEven?r.set(t+1,e+1):r.set(t+1,e):e&1^this.staggerEven?r.set(t+1,e+1):r.set(t,e+1),r}pixelToTileCoords(t,e,i){let r=i||new M;this.staggerX?t-=this.staggerEven?this.tilewidth:this.sideoffsetx:e-=this.staggerEven?this.tileheight:this.sideoffsety;let n=g.pull("Vector2d",Math.floor(t/(this.columnwidth*2)),Math.floor(e/(this.rowheight*2))),o=g.pull("Vector2d",t-n.x*(this.columnwidth*2),e-n.y*(this.rowheight*2));this.staggerX?(n.x=n.x*2,this.staggerEven&&++n.x):(n.y=n.y*2,this.staggerEven&&++n.y);let h,l,f,d;this.staggerX?(h=this.sidelengthx/2,f=h+this.columnwidth,d=this.tileheight/2,this.centers[0].set(h,d),this.centers[1].set(f,d-this.rowheight),this.centers[2].set(f,d+this.rowheight),this.centers[3].set(f+this.columnwidth,d)):(l=this.sidelengthy/2,f=this.tilewidth/2,d=l+this.rowheight,this.centers[0].set(f,l),this.centers[1].set(f-this.columnwidth,d),this.centers[2].set(f+this.columnwidth,d),this.centers[3].set(f,d+this.rowheight));let a=0,u=Number.MAX_VALUE;for(let p=0;p<4;++p){const y=this.centers[p].sub(o).length2();y<u&&(u=y,a=p)}let c=this.staggerX?p0:g0;return r.set(n.x+c[a].x,n.y+c[a].y),g.push(n),g.push(o),r}tileToPixelCoords(t,e,i){let r=Math.floor(t),n=Math.floor(e),o=i||new M;return this.staggerX?(o.y=n*(this.tileheight+this.sidelengthy),this.doStaggerX(r)&&(o.y+=this.rowheight),o.x=r*this.columnwidth):(o.x=r*(this.tilewidth+this.sidelengthx),this.doStaggerY(n)&&(o.x+=this.columnwidth),o.y=n*this.rowheight),o}adjustPosition(t){typeof t.gid=="number"&&(t.y-=t.height)}drawTile(t,e,i,r){let n=r.tileset,o=this.tileToPixelCoords(e,i,g.pull("Vector2d"));n.drawTile(t,n.tileoffset.x+o.x,n.tileoffset.y+o.y+(this.tileheight-n.tileheight),r),g.push(o)}drawTileLayer(t,e,i){let r,n=this.pixelToTileCoords(i.pos.x,i.pos.y,g.pull("Vector2d"));n.sub(e.pos);let o=this.tileToPixelCoords(n.x+e.pos.x,n.y+e.pos.y,g.pull("Vector2d")),h=n.clone(),l=o.clone(),f=i.pos.y-o.y<this.sideoffsety,d=i.pos.x-o.x<this.sideoffsetx;f&&n.y--,d&&n.x--;let a=e.cols,u=e.rows;if(this.staggerX){n.x=Math.max(0,n.x),n.y=Math.max(0,n.y),o=this.tileToPixelCoords(n.x+e.pos.x,n.y+e.pos.y,o);let c=this.doStaggerX(n.x+e.pos.x);for(;o.y<i.bottom&&n.y<u;){for(h.setV(n),l.setV(o);l.x<i.right&&h.x<a;h.x+=2)r=e.cellAt(h.x,h.y,!1),r&&r.tileset.drawTile(t,l.x,l.y,r),l.x+=this.tilewidth+this.sidelengthx;c?(n.x-=1,n.y+=1,o.x-=this.columnwidth,c=!1):(n.x+=1,o.x+=this.columnwidth,c=!0),o.y+=this.rowheight}g.push(h),g.push(l)}else{for(n.x=Math.max(0,n.x),n.y=Math.max(0,n.y),o=this.tileToPixelCoords(n.x+e.pos.x,n.y+e.pos.y,o),this.doStaggerY(n.y)&&(o.x-=this.columnwidth);o.y<i.bottom&&n.y<u;n.y++){for(h.setV(n),l.setV(o),this.doStaggerY(n.y)&&(l.x+=this.columnwidth);l.x<i.right&&h.x<a;h.x++)r=e.cellAt(h.x,h.y,!1),r&&r.tileset.drawTile(t,l.x,l.y,r),l.x+=this.tilewidth+this.sidelengthx;o.y+=this.rowheight}g.push(h),g.push(l)}g.push(n),g.push(o)}}class y0 extends vh{canRender(t){return t.orientation==="staggered"&&super.canRender(t)}pixelToTileCoords(t,e,i){let r=i||new M,n=t,o=e;this.staggerX?n-=this.staggerEven?this.sideoffsetx:0:o-=this.staggerEven?this.sideoffsety:0;let h=g.pull("Vector2d",Math.floor(n/this.tilewidth),Math.floor(o/this.tileheight));this.staggerX?(h.x=h.x*2,this.staggerEven&&++h.x):(h.y=h.y*2,this.staggerEven&&++h.y);let l=g.pull("Vector2d",n-h.x*this.tilewidth,o-h.y*this.tileheight),f=l.x*(this.tileheight/this.tilewidth);return this.sideoffsety-f>l.y&&(h=this.topLeft(h.x,h.y,h)),-this.sideoffsety+f>l.y&&(h=this.topRight(h.x,h.y,h)),this.sideoffsety+f<l.y&&(h=this.bottomLeft(h.x,h.y,h)),this.sideoffsety*3-f<l.y&&(h=this.bottomRight(h.x,h.y,h)),r=this.tileToPixelCoords(h.x,h.y,r),r.set(t-r.x,e-r.y),r.set(r.x-this.tilewidth/2,r.y*(this.tilewidth/this.tileheight)),r.div(this.tilewidth/Math.sqrt(2)).rotate(br(-45)).add(h),g.push(h),g.push(l),r}}function m0(s){switch(s.orientation){case"orthogonal":return new c0(s);case"isometric":return new d0(s);case"hexagonal":return new vh(s);case"staggered":return new y0(s);default:throw new Error(s.orientation+" type TMX Tile Map not supported!")}}function Bt(s,t,e){const i="melonJS: %s is deprecated since version %s, please use %s";let r=new Error().stack;console.groupCollapsed?console.groupCollapsed("%c"+i,"font-weight:normal;color:yellow;",s,e,t):console.warn(i,s,e,t),typeof r<"u"&&console.warn(r),console.groupCollapsed&&console.groupEnd()}function _0(s,t,e){return new be(s,t,s.tilewidth,s.tileheight,s.orientation,s.tilesets,e)}function x0(s,t,e){_e(t.properties,t);let i=g.pull("ImageLayer",+t.offsetx||+t.x||0,+t.offsety||+t.y||0,Object.assign({name:t.name,image:t.image,ratio:g.pull("Vector2d",+t.parallaxx||1,+t.parallaxy||1),tint:typeof t.tintcolor<"u"?g.pull("Color").parseHex(t.tintcolor,!0):void 0,z:e},t.properties)),r=typeof t.visible<"u"?t.visible:!0;return i.setOpacity(r?+t.opacity:0),i}function v0(s){return new Fm(s)}function To(s,t,e){return new u0(s,t,e)}class Eo{constructor(t,e){this.data=e,this.name=t,this.cols=+e.width,this.rows=+e.height,this.tilewidth=+e.tilewidth,this.tileheight=+e.tileheight,this.infinite=+e.infinite||0,this.orientation=e.orientation,this.renderorder=e.renderorder||"right-down",this.version=""+e.version,this.tiledversion=""+e.tiledversion,this.class=e.class,this.tilesets=null,typeof this.layers>"u"&&(this.layers=[]),typeof this.objectGroups>"u"&&(this.objectGroups=[]),this.isEditor=e.editor==="melon-editor",this.nextobjectid=+e.nextobjectid||void 0,this.hexsidelength=+e.hexsidelength,this.staggeraxis=e.staggeraxis,this.staggerindex=e.staggerindex,this.bounds=this.getRenderer().getBounds().clone(),this.width=this.bounds.width,this.height=this.bounds.height,this.backgroundcolor=e.backgroundcolor,this.version!=="undefined"&&this.version!==""&&Nm(this.version,"1.5")<0&&Bt("("+this.name+") Tiled Map format version 1.4 and below","format 1.5 or higher","10.4.4"),_e(this,e),this.initialized=!1}getRenderer(){return(typeof this.renderer>"u"||!this.renderer.canRender(this))&&(this.renderer=m0(this)),this.renderer}getBounds(){return this.bounds}readMapObjects(t){if(this.initialized===!0)return;let e=0;this.tilesets||(this.tilesets=new jm),typeof t.tilesets<"u"&&t.tilesets.forEach(r=>{this.tilesets.add(v0(r))}),this.background_image&&this.layers.push(g.pull("ImageLayer",0,0,{name:"background_image",image:this.background_image,z:e++})),t.layers.forEach(i=>{switch(i.type){case"imagelayer":this.layers.push(x0(this,i,e++));break;case"tilelayer":this.layers.push(_0(this,i,e++));break;case"objectgroup":this.objectGroups.push(To(this,i,e++));break;case"group":this.objectGroups.push(To(this,i,e++));break}}),this.initialized=!0}addTo(t,e,i){let r=t.autoSort,n=t.autoDepth,o=this.getBounds();t.autoSort=!1,t.autoDepth=!1,this.backgroundcolor&&t.backgroundColor.parseCSS(this.backgroundcolor),this.getLayers().forEach(l=>{t.addChild(l)}),this.getObjects(e).forEach(l=>{t.addChild(l)}),t.resize(this.bounds.width,this.bounds.height),t.sort(!0);function h(l,f){N.viewport.setBounds(0,0,Math.max(o.width,l),Math.max(o.height,f)),t.pos.set(Math.max(0,~~((l-o.width)/2)),Math.max(0,~~((f-o.height)/2)),t.pos.z)}i===!0&&(Ot(Jt,h),h(N.viewport.width,N.viewport.height),F(Jt,h,this)),t.autoSort=r,t.autoDepth=n}getObjects(t){let e=[],i=!1,r;this.readMapObjects(this.data);for(let n=0;n<this.objectGroups.length;n++){let o=this.objectGroups[n];i=o.name.toLowerCase().includes(Gm),t===!1&&(r=new dt(0,0,this.width,this.height),r.anchorPoint.set(0,0),r.name=o.name,r.pos.z=o.z,r.setOpacity(o.opacity),r.autoSort=!1,r.autoDepth=!1);for(let h=0;h<o.objects.length;h++){let l=o.objects[h],f,d;typeof l.anchorPoint>"u"&&(l.anchorPoint={x:0,y:0}),typeof l.tintcolor<"u"&&(l.tint=g.pull("Color"),l.tint.parseHex(l.tintcolor,!0)),l instanceof be?f=l:typeof l.text=="object"?(typeof l.text.anchorPoint>"u"&&(l.text.anchorPoint=l.anchorPoint),l.text.bitmap===!0?f=g.pull("BitmapText",l.x,l.y,l.text):f=g.pull("Text",l.x,l.y,l.text),f.pos.z=l.z):typeof l.tile=="object"?(d=l.shapes,typeof d>"u"&&(d=g.pull("Polygon",0,0,[g.pull("Vector2d",0,0),g.pull("Vector2d",this.width,0),g.pull("Vector2d",this.width,this.height)])),f=l.tile.getRenderable(l),f.body=new yt(f,d),f.body.setStatic(!0),f.pos.setMuted(l.x,l.y,l.z)):(typeof l.name<"u"&&l.name!==""?f=g.pull(l.name,l.x,l.y,l):(f=g.pull("Renderable",l.x,l.y,l.width,l.height),d=l.shapes,typeof d>"u"&&(d=g.pull("Polygon",0,0,[g.pull("Vector2d",0,0),g.pull("Vector2d",this.width,0),g.pull("Vector2d",this.width,this.height)])),f.anchorPoint.set(0,0),f.name=l.name,f.type=l.type,f.class=l.class||l.type,f.id=l.id,f.body=new yt(f,d),f.body.setStatic(!0),f.resize(f.body.getBounds().width,f.body.getBounds().height)),f.pos.z=l.z),i&&!l.name&&f.body&&(f.body.collisionType=lt.types.WORLD_SHAPE,f.body.isStatic=!0),t!==!1?(f.isRenderable===!0&&(f.setOpacity(f.getOpacity()*o.opacity),typeof f.renderable<"u"&&f.renderable.isRenderable===!0&&f.renderable.setOpacity(f.renderable.getOpacity()*o.opacity)),e.push(f)):r.addChild(f)}t===!1&&r.children.length>0&&(r.autoSort=!0,r.autoDepth=!0,e.push(r))}return e}getLayers(){return this.readMapObjects(this.data),this.layers}destroy(){this.tilesets=void 0,this.layers.length=0,this.objectGroups.length=0,this.initialized=!1}}let Nt={},Ht=[],ue=0;function Ao(s,t,e){t.container.reset(),N.reset(),Nt[Ne.getCurrentLevelId()]&&Nt[Ne.getCurrentLevelId()].destroy(),ue=Ht.indexOf(s),w0(s,t.container,t.flatten,t.setViewportBounds),B(gi,s),t.onLoaded(s),e&&j.restart()}function w0(s,t,e,i){let r=Nt[s];km(s,r.nextobjectid),t.anchorPoint.set(0,0),r.addTo(t,e,i)}let Ne={add(s,t,e){switch(s){case"tmx":if(Nt[t]==null)Nt[t]=new Eo(t,Kr(t)),Ht.push(t);else return!1;return e&&e(),!0;default:throw new Error("no level loader defined for format "+s)}},load(s,t){if(t=Object.assign({container:N.world,onLoaded:N.onLevelLoaded,flatten:N.mergeGroup,setViewportBounds:!0},t||{}),typeof Nt[s]>"u")throw new Error("level "+s+" not found");if(Nt[s]instanceof Eo)j.isRunning()?(j.stop(),Qt(Ao,this,s,t,!0)):Ao(s,t);else throw new Error("no level loader defined");return!0},getCurrentLevelId(){return Ht[ue]},getCurrentLevel(){return Nt[this.getCurrentLevelId()]},reload(s){return this.load(this.getCurrentLevelId(),s)},next(s){return ue+1<Ht.length?this.load(Ht[ue+1],s):!1},previous(s){return ue-1>=0?this.load(Ht[ue-1],s):!1},levelCount(){return Ht.length}};function So(s,t,e,i){if(typeof Vt[s.name]<"u")return 0;function r(n){Vt[s.name]=n,s.type==="tmx"&&Ne.add(s.type,s.name)}if(s.data){r(s.data),typeof t=="function"&&t();return}return qt(s.src,"text",i).then(n=>{if(typeof n!="string")throw new Error("Invalid response type");let o;switch(me(s.src)){case"xml":case"tmx":case"tsx":{const h=new DOMParser;if(typeof h.parseFromString>"u")throw new Error("XML file format loading supported, use the JSON file format instead");const l=h.parseFromString(n,"text/xml"),f=ot(l);o=f.map||f.tilesets[0]||f;break}case"json":case"tmj":case"tsj":o=JSON.parse(n);break;default:throw new Error(`TMX file format not supported: ${me(s.src)}`)}r(o),typeof t=="function"&&t()}).catch(n=>{typeof e=="function"&&e(n)}),1}function b0(s,t,e,i){return typeof Ut[s.name]<"u"?0:(qt(s.src,"json",i).then(r=>{Ut[s.name]=r,typeof t=="function"&&t()}).catch(r=>{typeof e=="function"&&e(r)}),1)}function T0(s,t,e,i){return qt(s.src,"arrayBuffer",i).then(r=>{const n=new TextDecoder;te[s.name]=n.decode(r),typeof t=="function"&&t()}).catch(r=>{typeof e=="function"&&e(r)}),1}function E0(s,t,e,i){let r=globalThis.document.createElement("script");return r.src=s.src,r.type="text/javascript",typeof crossOrigin=="string"&&(r.crossOrigin=i.crossOrigin),r.defer=!0,typeof t=="function"&&(r.onload=()=>{t()}),typeof e=="function"&&(r.onerror=()=>{e(s.name)}),globalThis.document.getElementsByTagName("body")[0].appendChild(r),1}function A0(s,t,e,i){if(typeof zt[s.name]<"u")return 0;let r=zt[s.name]=globalThis.document.createElement("video");if(mi(s.src)){const n=s.src.match(/[^:]\w+\/[\w-+\d.]+(?=;|,)/)[0];if(!n||r.canPlayType(n)==="")throw new Error(`Invalid dataURL or Video file format not supported: ${n}`)}else if(!cp(me(s.src)))throw new Error(`Video file format not supported: ${me(s.src)}`);return mi(s.src)?qt(s.src,"blob",i).then(n=>{r.src=globalThis.URL.createObjectURL(n)}).catch(n=>{typeof e=="function"&&e(n)}):r.src=s.src,r.setAttribute("preload",s.stream===!0?"metadata":"auto"),r.setAttribute("playsinline","true"),r.setAttribute("disablePictureInPicture","true"),r.setAttribute("controls","false"),r.setAttribute("crossorigin",i.crossOrigin),s.autoplay===!0&&r.setAttribute("autoplay","true"),s.loop===!0&&r.setAttribute("loop","true"),typeof t=="function"&&(s.stream===!0||s.autoplay===!1?r.onloadedmetadata=()=>{typeof t=="function"&&t()}:r.oncanplay=()=>{typeof t=="function"&&t()}),typeof e=="function"&&(r.onerror=()=>{e()}),r.load(),1}let Gr="",at={},jr,Hr=!1;function Xr(s=!1){Gr=s?"?"+~~(Math.random()*1e7):""}function S0(s){s.crossOrigin!==void 0&&(jr=s.crossOrigin),s.nocache!==void 0&&Xr(s.nocache),s.withCredentials!==void 0&&(Hr=s.withCredentials)}function C0(s,t){s!=="*"?at[s]=t:(at.audio=t,at.video=t,at.binary=t,at.image=t,at.json=t,at.js=t,at.tmx=t,at.tsx=t)}let ke,P0,I0,sr=new Map,wh=!1,Fe=0,rr=0,Co=0;const Wr={};function R0(){Tt("binary",T0),Tt("image",Gp),Tt("json",b0),Tt("js",E0),Tt("tmx",So),Tt("tsx",So),Tt("audio",Ud),Tt("fontface",jp),Tt("video",A0),wh=!0}function Yr(s){if(rr===Fe)if(typeof s=="function"||ke){clearTimeout(Co);let t=s||ke;setTimeout(()=>{t(),B(Md)},300)}else throw new Error("no load callback defined");else Co=setTimeout(()=>{Yr(s)},100)}function M0(s){delete Wr[s.src],rr++;let t=rr/Fe;B(Vs,t,s)}function O0(s){throw Wr[s.src]=s,this.onError&&this.onError(s),B(Od,s),new Error("Failed loading resource "+s.src)}function Tt(s,t){if(typeof t!="function")throw new Error("invalid parser function for "+s);typeof sr.get(s)<"u"&&Bt("overriding parser for "+s+" format"),sr.set(s,t)}function L0(s,t,e=!0){for(let i=0;i<s.length;i++)Fe+=qr(s[i],M0.bind(this,s[i]),O0.bind(this,s[i]));typeof t<"u"&&(ke=t),e===!0&&j.change(j.LOADING),Yr(ke)}function B0(s){const t=Wr[s];this.unload(t),Fe-=1,Fe+=this.load(t,this.onResourceLoaded.bind(this,t),this.onLoadingError.bind(this,t)),Yr(this.onload)}function qr(s,t,e){wh===!1&&R0(),typeof at[s.type]<"u"&&(s.src=at[s.type]+s.src);let i=sr.get(s.type);if(typeof i>"u")throw new Error("load : unknown or invalid resource type : "+s.type);return i.call(this,s,t,e,{nocache:Gr,crossOrigin:jr,withCredentials:Hr})}function $t(s){switch(s.type){case"binary":return s.name in te?(delete te[s.name],!0):!1;case"image":return s.name in At?(delete At[s.name],!0):!1;case"json":return s.name in Ut?(delete Ut[s.name],!0):!1;case"js":return!0;case"fontface":return typeof typeof globalThis.document<"u"&&typeof globalThis.document.fonts<"u"?(globalThis.document.fonts.delete(ee[s.name]),delete ee[s.name],!0):!1;case"tmx":case"tsx":return s.name in Vt?(delete Vt[s.name],!0):!1;case"audio":return qa(s.name);case"video":return s.name in zt?(delete zt[s.name],!0):!1;default:throw new Error("unload : unknown or invalid resource type : "+s.type)}}function D0(){let s;for(s in te)te.hasOwnProperty(s)&&$t({name:s,type:"binary"});for(s in At)At.hasOwnProperty(s)&&$t({name:s,type:"image"});for(s in Vt)Vt.hasOwnProperty(s)&&$t({name:s,type:"tmx"});for(s in Ut)Ut.hasOwnProperty(s)&&$t({name:s,type:"json"});for(s in zt)zt.hasOwnProperty(s)&&$t({name:s,type:"json"});for(s in ee)ee.hasOwnProperty(s)&&$t({name:s,type:"font"});zd()}function Kr(s){return s=""+s,s in Vt?Vt[s]:null}function nr(s){return s=""+s,s in te?te[s]:null}function Et(s){return s=Or(""+s),s in At?At[s]:null}function $0(s){return s=""+s,s in Ut?Ut[s]:null}function N0(s){return s=""+s,s in zt?zt[s]:null}function k0(s){return s=""+s,s in ee?ee[s]:null}var F0={__proto__:null,baseURL:at,get crossOrigin(){return jr},getBinary:nr,getFont:k0,getImage:Et,getJSON:$0,getTMX:Kr,getVideo:N0,load:qr,get nocache(){return Gr},onError:I0,onProgress:P0,get onload(){return ke},preload:L0,reload:B0,setBaseURL:C0,setNocache:Xr,setOptions:S0,setParser:Tt,unload:$t,unloadAll:D0,get withCredentials(){return Hr}};class Ct extends W{constructor(t,e,i){if(super(t,e,0,0),this.animationpause=!1,this.animationspeed=100,this.offset=g.pull("Vector2d",0,0),this.isVideo=!1,this.onended,this.source=null,this.anim={},this.resetAnim=void 0,this.current={name:void 0,length:0,offset:g.pull("Vector2d",0,0),width:0,height:0,angle:0,idx:0},this.dt=0,this._flicker={isFlickering:!1,duration:0,callback:null,state:!1},i.image instanceof zi){if(this.source=i.image,this.image=this.source.getTexture(),this.textureAtlas=i.image,typeof i.region<"u"){let r=this.source.getRegion(i.region);if(r)this.setRegion(r);else throw new Error("Texture - region for "+i.region+" not found")}}else{if(this.image=typeof i.image=="object"?i.image:Et(i.image),!this.image)throw new Error("me.Sprite: '"+i.image+"' image/texture not found!");this.isVideo=HTMLVideoElement&&this.image instanceof HTMLVideoElement,this.isVideo?(this.width=this.current.width=i.framewidth=i.framewidth||this.image.videoWidth,this.height=this.current.height=i.frameheight=i.frameheight||this.image.videoHeight,this.animationpause=this.image.autoplay!==!0,this.animationpause&&this.image.pause(),this._onBlurFn=()=>{this.image.pause()},F(Fs,this._onBlurFn),this.image.onended=()=>{typeof this.onended=="function"&&(this.image.loop||(this.animationpause=!0),this.onended())}):(this.width=this.current.width=i.framewidth=i.framewidth||this.image.width,this.height=this.current.height=i.frameheight=i.frameheight||this.image.height,this.source=U.cache.get(this.image,i),this.textureAtlas=this.source.getAtlas())}if(typeof i.atlas<"u"&&(this.textureAtlas=i.atlas,this.atlasIndices=i.atlasIndices),typeof i.flipX<"u"&&this.flipX(!!i.flipX),typeof i.flipY<"u"&&this.flipY(!!i.flipY),typeof i.rotation<"u"&&this.rotate(i.rotation),i.anchorPoint&&this.anchorPoint.set(i.anchorPoint.x,i.anchorPoint.y),typeof i.tint<"u"&&(i.tint instanceof nt?this.tint.copy(i.tint):this.tint.parseCSS(i.tint)),typeof i.name=="string"&&(this.name=i.name),typeof i.z<"u"&&(this.pos.z=i.z),typeof i.anims<"u")for(const r in i.anims)this.addAnimation(i.anims[r].name,i.anims[r].index,i.anims[r].speed);!this.isVideo&&this.addAnimation("default",null)!==0&&this.setCurrentAnimation("default")}isFlickering(){return this._flicker.isFlickering}play(){this.animationpause=!1}pause(){this.animationpause=!0}flicker(t,e){return this._flicker.duration=t,this._flicker.duration<=0?(this._flicker.isFlickering=!1,this._flicker.callback=null):this._flicker.isFlickering||(this._flicker.callback=e,this._flicker.isFlickering=!0),this}addAnimation(t,e,i){this.anim[t]={name:t,frames:[],idx:0,length:0};let r=0;if(typeof this.textureAtlas!="object")return 0;e==null&&(e=[],Object.keys(this.textureAtlas).forEach((n,o)=>{e[o]=o}));for(let n=0,o=e.length;n<o;n++){let h=e[n],l;typeof h=="number"||typeof h=="string"?l={name:h,delay:i||this.animationspeed}:l=h;let f=l.name;if(typeof f=="number")typeof this.textureAtlas[f]<"u"&&(this.anim[t].frames[n]=Object.assign({},this.textureAtlas[f],l),r++);else{if(this.source.getFormat().includes("Spritesheet"))throw new Error("string parameters for addAnimation are not allowed for standard spritesheet based Texture");this.anim[t].frames[n]=Object.assign({},this.textureAtlas[this.atlasIndices[f]],l),r++}}return this.anim[t].length=r,r}setCurrentAnimation(t,e,i=!1){if(typeof this.anim[t]<"u")this.isCurrentAnimation(t)||(this.current.name=t,this.current.length=this.anim[this.current.name].length,typeof e=="string"?this.resetAnim=this.setCurrentAnimation.bind(this,e,null,!0):typeof e=="function"?this.resetAnim=e:this.resetAnim=void 0,this.setAnimationFrame(0),i||(this.dt=0),this.isDirty=!0);else throw new Error("animation id '"+t+"' not defined");return this}reverseAnimation(t){return typeof t<"u"&&typeof this.anim[t]<"u"?this.anim[t].frames.reverse():this.anim[this.current.name].frames.reverse(),this.isDirty=!0,this}isCurrentAnimation(t){return this.current.name===t}setRegion(t){return this.image=this.source.getTexture(t),this.current.offset.setV(t.offset),this.current.angle=typeof t.angle=="number"?t.angle:0,this.width=this.current.width=t.width,this.height=this.current.height=t.height,t.anchorPoint&&this.anchorPoint.setMuted(this._flip.x&&t.trimmed===!0?1-t.anchorPoint.x:t.anchorPoint.x,this._flip.y&&t.trimmed===!0?1-t.anchorPoint.y:t.anchorPoint.y),this.updateBounds(),this.isDirty=!0,this}setAnimationFrame(t=0){return this.current.idx=t%this.current.length,this.setRegion(this.getAnimationFrameObjectByIndex(this.current.idx))}getCurrentAnimationFrame(){return this.current.idx}getAnimationFrameObjectByIndex(t){return this.anim[this.current.name].frames[t]}update(t){if(this.isVideo)this.animationpause?this.image.pause():this.image.paused&&this.image.play(),this.isDirty=!this.image.paused;else if(!this.animationpause&&this.current.length>1){let e=this.getAnimationFrameObjectByIndex(this.current.idx).delay;for(this.dt+=t;this.dt>=e;){this.isDirty=!0,this.dt-=e;let i=this.current.length>1?this.current.idx+1:this.current.idx;if(this.setAnimationFrame(i),this.current.idx===0&&(typeof this.onended=="function"&&this.onended(),typeof this.resetAnim=="function"&&this.resetAnim()===!1)){this.setAnimationFrame(this.current.length-1),this.dt%=e;break}e=this.getAnimationFrameObjectByIndex(this.current.idx).delay}}return this._flicker.isFlickering&&(this._flicker.duration-=t,this._flicker.duration<0&&(typeof this._flicker.callback=="function"&&this._flicker.callback(),this.flicker(-1)),this.isDirty=!0),super.update(t)}draw(t,e){if(this._flicker.isFlickering&&(this._flicker.state=!this._flicker.state,!this._flicker.state))return;let i=this.current,r=this.pos.x,n=this.pos.y,o=i.width,h=i.height,l=i.offset,f=this.offset;i.angle!==0&&(t.translate(-r,-n),t.rotate(i.angle),r-=h,o=i.height,h=i.width),t.drawImage(this.image,f.x+l.x,f.y+l.y,o,h,r,n,o,h)}destroy(){g.push(this.offset),this.offset=void 0,this.isVideo&&(Ot(Fs,this._onBlurFn),this._onBlurFn=void 0,this.image.onended=void 0,this.image.pause(),this.image.currentTime=0),this.image=void 0,super.destroy()}}var V0="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAQAAAAEACAMAAABrrFhUAAAA8FBMVEUgICBrqDHRZVtqpzEhJCAjKCBurTIfHyDQZFptrDEWAB8OAB7VZ1wtIiIAEhYlISDYaF4SAB4pIiEAFhkcFh8eGyBopDAMAB5noS8kKyAAGhtjmy4bEB9lni8ZBR/HYFdPeim/XFQ9XCUaCh9flS1VhCtSfyorOSEVHh4HHB1EZyatVExhmC5ajCxHbSc0SyMuQCInMiFKcSgxRSI6VSRBYiWdTUZdki09JyZ8PzpYiSs3UCRlNjK1WE9ckC1MdShbjywyJCONRkDKYliUSUNeMzBDKShXMC2kUEl1PDeEQj1OLStnNjNxOjZsODQAAAcMh1CFAAAU4UlEQVR42uyaa3fSMBjHk5EQkgClkBZKoXblNhlswIooc2N6pp7jUb//x/FpRbnt4JWwzv7eraQvfs/zby7tUEpKSkpKSkpKSkpKSkpKSkqKTsg30P8E+FIArJllqQaglMXQt6tPuhogGSlaLWFKKU2hEB33eqPRqDemRAlhRhdbVjwIBj8xogajhpBSkNH1dOJ37mYDt1mr2UCt1mwOZned7qQfjhxPVs0WovTpRIFFNkpIU42CSWfm2phnIzjHP+DLS9hutjuL4IqZUigC9yU/CWDBhBROOJkPbBxL4swKjDf/jEvBbXe4CMeiKixKEx0EAq03JbqeDJs4Ul9a7mE5AqqAazM/pJCb5JaAUmWa42nHBflYDf8y8WC4qznv9yRKZAUIRUKO+/Maz/J1+d8ugu0rK3kVoNSTVhDZr8v/WRGyQw8lC0KJMK989+/sVzXILiRNzmrACGXSC4Z2lsf2f08GN2lyHgJCLUn6bRw1/2dim+A9hIKiJMAQ6NOJu7f5a7r8B+u/7N7BAzMZBaBIkkkz0t83sfMsgDHsgN1BOybaFNvww2qblMgEUGKqi2aU/X3u2HZnHf8iuL4aO0S1PKDVQM54dBn0F50718bfq5CwOYBQIaaDVfd37MG91u5MwhER8WHQU8qC2wCEmFJefEYUrBdedGe15b4xQasAtaqXt/wh/W87W1679YNeCxQbjNCItTchBFheRErAmHEYb575ch/Qeuz9ByXpdHH2QX2wx4NuMBbSbJCfn3IJWZ4dndBvZ6Bytt949A8AbZjT6OHftQeDTHtx2VgebhFj6KfAmGisJaS46k+mj/4sELW/N+QP6UOIXf/Sqwq0p/F7okA8KU312BcAqmTf3k1/1Hx7HlgyskfsL96h7b3XMNCRcYQzz+KH9N3FSC57fxiYUTDOWLmAjgcjpBo2d9oPKxdv95Fs0UPGl5XPinWDVYqGwdBxYFQJH/Mdfc5nQUuyw77KYYXKm/ub09PzV/Xn5SNVAOJ/B/Hf0W8HwiQUHRTwf/2slM/nS6WbN/XjZIDK6534w8zv9r1In6GDUq6/y+VzMaVTdGYg7cDj38/wHX17YknQPzSGUb8p5U5icqX7ovaZkBFk+nw7/hx3epIdvPtAufIpf7Ikl39W0B0BRpToQPy32j8IZUPPW+xC8S0E4Afv6noLwGgL3WZ32u8roetbTqF4v1aA/JdKGWmEUc8ZgP/m0j+4riKKNFEoflwrQO6D1gQwKnrulj/mXUto048XgZV+/vQMaYQ5otfc8s/Wpprav5oFz5cRgHXwo85VgFHw55nN+Ld7UvMnPOP5y2elXMRJ6VzDA7DPH2e7XstBemHl+vubfAk4efGc6SsAo9542x9fVJH+D/lQgfrnF+fn9++KWv0bdHP+z3A7rFKC9MMMo1KsVIr1ssYHgFiqvemfdUemg45EuVAuFMpIH4SI4ZZ/2xEOQ8eCAUgjVHa3/G+txuN/Z/+vYE51suU/9NT/5G8GIL3uPxfsCfwf11fyrW1FgRiGTkna0vZpYHQUXRHdVZBhvCMorP7/V+3oyprgPiy2Dxk2HzA06TknpyHz19CjVfcpf9kj+6SBtqgcMPz/q/vPdPgwLP/DsCM1f2vTf7Ifap5/hYXQ/FGnX7S16LdABADc23oqVP91kYfgrU5b1GxKHSCo7tILzR/z9eJ8nliv0zqAMZ8ATEJfaP6+7jlj3CDlXpHVfsfnH+eyn4kMzMdGQRNO7fNkGEXbGTigBkDq1lZzU07BnaXzIab6LCMAuEEmdWcD8+ax9uNTckxFqyWxwKBgKXZrzerHtAbcPhFQ0R8oAExdChXADIt1Tz0KkGi9TjML1CBLqgA0YZGIFZhZqVNUtf9GCdBbF0IF4Be/vvQYz6pyxhRwH+QC4CpXoAgELvE6iKMtfwJLzv+5YU2iDasOR0MJMBdMgFsMK6ICrppGY+rELGAdhFpAYoXYgRdBRzsLUtB3L/z+7zpITFvHYhQAdorGyQudAdCuNe8qoJjVNgYAF0M+9iFbAe9tK2w4BKIIdVJ0CLASv7jeBFo7cBwCrxcgP1IAjEv5ALipwII1gmGGMR4A2uEB+blJK4x4E1kdZhQA5xYowPe58z3lwKfH199WbQRAc/LpuwPWu17k0qaFCnANAgHSvKJcZdMCxJtgOsQuKsexG2uCwMxa8O8aUa/axHZCe/OUZA42ag0Avqi5ll2nYSAaRQEbZI+NrbKwEFFYJURCiEcpqEE0aZOmBfH/f4PLQ+OEttwxLKg3jq5Or3TG9jyOJ/FjgSIGZvBRLhB1oFvi7/3X5CIDhZHodOLtfyyEXUlh0IGzyDoQM+rbGljFRNaE2ZOXj0MT3pALxGQo8v1z1ILRBb6+hTJoZgLvBoMYRjZAeALuv/v/hZCzeTxWRIu/iwEvbqQMmKcxUekwHqF/KQSo74OCVX8rCyQoC9C/QYBZENZTcYMlRkqjWFlVZfn9OWGXwcoDVFKewD+fo33v9AwQD3HGFqH5XsXHACWVA7BObfp+YyoL4BKpLvb+MuvBlVn1q03iwIONVNFy1jPUBvGyPOaGJT4GGOPAHd9v66bIuy7Pi3p5GKoTrYSdeRXaQrk7LD02P2Gbejv2FqrYdugFxgHM5ChBEFNpIn/czxaObdMJrcXP4Z94sdxZUGZmAZmA+7ws0im4a9oenFQsKg58uE8NhBgE43+LlBysa65FmvJweIppMzobsmJKWve+EFrMsUJ3+wEqGaUKPA9XkSYNhj0xUd8xYkbBsU516lnMhv+LFs1nKCX7BZYVjIUQZ8FC830PRjG6LnSqBzCSPcloP0U9IaLZhknntlynSGhOS+yV/bWuEla1EPwSONXdAc0VKYv4ZcyoWQBGEDp/2zdI/zyrYgfyR6CAL7nm18BC18pJFnlLhuUMsScgvs9CwjrXyOgCq/Q9yIQpBa0Q/DqW6+JoJSNX9AGNT4S2uezhx8B9kBvu2AZGjpQubwLRglHKLnX6Z7DodmgBQjDHkji7O3+MoFFZgITx+pLiMdiChL1G7DUL8DWQLBDPw3dGh5Yjn38YT+TuMrhuvy71HbGiGyzRAg8DVYQQzO49evYg7ArLiP7v82/7n3OcZ8u6F36+IzjfVCqivwkTetqNCHpP2nvdfS74PJTr7zH+NM9pTflPwTMbcN1YkgEwFcL7EXIddf85LQ1SrtZ8FsO6uh13w7Abt02nZ7tjbiuR1+2Xn2COYPxaCCM3+KCqQz86fnpDSgOkPQg+i/dtb8E6P/zUt8Vln+/pF4fVD7D103Gbz8B8cIbULeJlHXqLM2ZQZDHEuGMnpsF+m0Alpfk+pKmAtZdCJNf5wUGJYAervRB8eggotSH2SlAy2myBchi14VbCxKlzka+BScWCqofBUASYCbsVKAQzD65g7CbmEl9OCTQtocEm74ysiPsq6imhilLVxANyUfR2o9i0SN7YstH8DP+9db+DYcD/iFsgqnXWd02SXAc9CrLpx124yFd2w35HlQ4tEPCHxPwO9haY7oG1NbQbMnLPYPbw2YNIMYAlxeTIDlP+WP0axAUhTrGzefUXEeK+kXetvU3DUDQtqdxKSQwJG1romIbQSLWhfuChFRioG92rsP//c3AiwbErxfKxBMoFf/am5cyPc+899/hDkTOJHZ4IKMQQrC6irDZTh+YVa9VHlsbuyK6uEe7tINCdK9hVutGkUgL/S0pox5cEchPX2X9qrXVfuIQIoAcsDN2sj+yb5XuVU8JZlgkpZ+PMzMbhvG0AwKqfteh6O3VZbqL8J4tNhggAluxxBgaNEIK7A/BNWvkWC7DCV/X+3qsMU0+LkqiS75NyMUhD+LqqrjdT51TPlQeAVTZ11nXpW1nm1sDOWhA1blBBcGEincwV1crqwV7Vq6r0U8ZxiCEevONwtzaaKnGS6X3lCGRHSwaAuyzU4Uyr5tjaLv4wL6+cm3BbxwFw9pSujJsfowBY2UfAutHeyRftZGwXb4RxY2+XDQHAgQGAlblMHI382xeRABwnSicBpyDYjS/HADYILhiYFAMA6k8DUDgANCQAfue0bPy3AeC3QD48AGK2gHLOgJFwAKhDENfgvwkArkGGCH0SDcAuEeKp8MhQYcEAtFT4EU2Fn9nB0HvJAExQHEMwRIfDogFgw2GI7eGXIhkANyESlxITvQLc/2UwAO+cLILgW4BMikIg46TF01QwAGxaHOwBuoI9uQBwhRGMPbs09nouFwCo3fAlLG6GCooFAMVRrGVaXTUz5XGxAHjK44xAQioArUBiZgskYiUyUrcAKhygdDEiqT2xPACZDS6qSe2+y04hIROAFM5aSO6F2qe5pmxDAMBJivJCydFhqsiOK9SHhQLQNb/ahTHFycsglh7EFogB4IQUSyORsqT841Aay8aBxR7VqYlQHPfK33SysAUVwY/qzF/ZO5kRfKLljAkidJMfZaEPgJXVD+ubNnUZqL0yS0upwKAOWidW7ZY++UhSIRQxp79KmAvth8sIha5Q8VZJ0B6YdquFaZlBTjyl7UMQEQcXyG8fZ93TN+MHCJv75l4bzWQ3+RhlRI8A2UzGozpEdpvjgSDRYALh7TY6qS+PWpHvBcT9nmdizk+nmQHsNq+xAHoRuLkYt21k32qlQ/01D0es0gVUCIcAZUimdbG+u7z/XOP7PQgsiu395WpbNKUKaEKqNmbyeZFoNiEKOscrDHkf1bxpmz91GdZY2HWHhjWHlt3kRc6bS/I2IoijIkyadZ7nJTNZU5PpByHAAmhXvkgfGqXUACY77fOc5h2SeXRciTNQ2Gkef56oOAsNtF1KQwCRIN/9CxqFZII8E5WXFpdFiZeW2oNHyRrIhSAfGrMHUCUfrKN8yAI+oYyUkFK2HaVFW2khtR/rPzDal+UkZGjwzOMAwRSJkReScwyi5QGdEvxI2wqZSEdNeGryRNYl018dT9X/zlIzndt0eHR4MNSnVXyPgoAGR3tKYidJ8dOa4PRCTTD2eRl7CUyEmAqirIHqbuxveuOcAjIuApwAHjNFKqmC5lsZIdH8zGuuzp8mYJQCTgGo/FARix7KMSQzYzn8vAAU8gFGcPQS+DJ8AH4rndH8PqQ3S35yd2U7isNAMFHasWw/WcopQhRBIBICQsggJCIx/P9XrTMcDWbZY5YQs36Yh4EZXNXl7vJB3Hkjd7fCkCfc3/ZGbgh4zp5xwYbuBdBWGr00pF2OrT0E6p/sIH6V1uRHTANeDv1NE/j4rB1mFYMHgTYJsJtnrGORL1W9w107NA4/u+gqjL+cFXprU2+cbSvA828GxFKImwRmLpDiji6WwCdvsuDjOU1MA7iI+WzXBj4MmfFpQKuAeC7wOdss6n8afe8qjaUaqNdRWoeEPt1g4wPGpFkMUJKuIruDAaA/ahsToVmXr4NnYanq4GI4eq4waLKJZxADYF12MvFIEO3EZKPLTMxxhADo1ztK0zgtxIND3JhieKnTeKEEhacT4F9OHOB+qRkMXHZwcCOzgwxFv76IfKszMxgg4bqNDDa26cSs01hsmKMtDlj9X8La4sfAdHkvHn6vHhngtGcGAJT+EX+3RxnwDDV+GPf7rIYUQGQa/tyj3RFA063GwN4f98cAJT6f3HaIDaukO1FS8GCuMTCveGz10yhJvIWGP+rWolKSFkMtEw7LvuaGMa/yW/y208iO8GMxXEXslnRnE8LrUyEFIpqhht8edb5aRWNeawzYLJMvnxhQsMKZw16KHw2RzoC7iF+dCOJ0PGX2a/Hj0sNFA5gIPl4zDFD+KzX8dfzhoyh0zwCzP/nrREA8MQu0HtjOSHTeAcwDxcDVPt/d1iGQVygQiKx2rq1FIPh4BX7MA/G5AOEwCNZKBN3PjuJEbCLX0cZgVL90kY6SxFcW5E4EZegTq9N+ECssdszWyZ8X/DX4UYc+n+oydFx7SgR0Z4sogEzWgc684x6s9PV1GMS6DbsmguGMc9IRBUC4HM3d+w+d9jIlAxKOIi0R2A5z85HkHWRDCiQV5YIxR8PP7KWAfiblsSxyV++P6tDhQz5dBS38emLfhV9ZkKa/Q8xknKAdu04Fiw/OLfKssFCLAJf1xEH4PZpQ3ZBvMCdddcvejxLhE3hO8KnkzQ7hX8t/LfvdnwAiiz327IoCli9jwUFxQP8l9kBgLKzNvhX/Pc/zpo+JqD4M+NpBEVzlAjeaNqkYA4Hv00s8wetswJDj6/BPfQNOKlCAsN7+rIPtSMjXKy4SIH8rBGoBEPCkqGYHx8XMfx3+wUdombE9RzhfBg8ocIPDUnHAfULgr0JP1R8Vs13kovZvEq2TqfCbsC1xMkXFzsY46RxsPxuQioRWCQC/RA5AFPhUCL9cL6JW+j+Dz1rXTfuXPzaSiNEcY3XHgT3YLRvCheSeBQR5oKpdIQfLS6WQUM4mA8e9Qa/7TWPCf/FpfLwcIgU6B0zBGe6zWVklMlQ8jD2/BX0mg3pjLkUo07jcZIsWPEP0OvwgA9l78r9vBAT5jB5QcESjYDlRvpsuN01dES/lnEupfqQeVKtmtMx2+dBhJ/APmHSdaWGW+rERPyymAVKgtRMq5rYIg2g4z/P9YbFY7PN8PoyC4wuI/QH8yUokxDIu/Ofk7YVFFmllSyfhjJCxFvIXaqa99Ah+MKnF2KzBf0dBElbrAdNk8IAKbL9/txJIlK1EajT8Yzb0hTXb2pjC/7k5X55qvqzCxHT458mL4M10iDL4bsMSEuxGifDeAv5RBcBFPDsEWMq/H3vmOttlIbhFzKt8v5SBL/hquW85QBL+Xvmuk3+W/H2CfyuDccvBIrKxsP859jb0LNqvy1RweK/gYwMCiZDVKMsDdlLCr2m4vEWBD+bTTcFFCu8XfI0Dr53XjbL9yeRh/dNgo0+yo+10s1LcJW+O/ryo05IQ8ricZYt5pGg4Wr6bxo6/taP5YTprKh624AmYavn+urVgfC6F9KpSef7JYTtQ7jcInLYFyhcP8sMkW27KwudCcA/I+4f+Tgnn+a5CKCT3SVWs6ros63q1qgg9/do7vY3+L6H/0a4dqgAAg1AULYPBsjax+P//uA3TwuJAxj3RJiYf7xJ5rBVVLNzHcA8T7fkZl6iePpchSDvs8b9XBwAAAAAAqGQCc31B4/xqSwwAAAAASUVORK5CYII=";class U0 extends W{constructor(t,e,i,r){super(t,e,i,r),this.barHeight=r,this.anchorPoint.set(0,0),F(Vs,this.onProgressUpdate,this),F(Jt,this.resize,this),this.anchorPoint.set(0,0),this.progress=0}onProgressUpdate(t){this.progress=~~(t*this.width),this.isDirty=!0}draw(t,e){t.setColor("black"),t.fillRect(this.pos.x,e.centerY,t.width,this.barHeight/2),t.setColor("#55aa00"),t.fillRect(this.pos.x,e.centerY,this.progress,this.barHeight/2)}onDestroyEvent(){Ot(Vs,this.onProgressUpdate),Ot(Jt,this.resize)}}class z0 extends Mr{onResetEvent(){N.world.backgroundColor.parseCSS("#202020"),N.world.addChild(new U0(0,U.height/2,U.width,8),1),qr({name:"melonjs_logo",type:"image",src:V0},()=>{N.world.addChild(new Ct(U.width/2,U.height/2,{image:"melonjs_logo",framewidth:256,frameheight:256}),2)})}onDestroyEvent(){$t({name:"melonjs_logo",type:"image"})}}let gt=-1,ie=-1,wi=!1,rt={},jt={color:"",duration:0},or=null,ar=null,Dt=0;function bh(){ie===-1&&gt!==-1&&(ie=globalThis.requestAnimationFrame(Th))}function G0(){wi&&gt!==-1&&(wi=!1)}function j0(){wi=!0}function Th(s){B(za,s),ie!==-1&&(ie=globalThis.requestAnimationFrame(Th))}function Eh(){globalThis.cancelAnimationFrame(ie),ie=-1}function xs(s){Eh(),rt[gt]&&rt[gt].stage.destroy(),rt[s]&&(gt=s,rt[gt].stage.reset.apply(rt[gt].stage,ar),bh(),B(Ar),or&&or())}ye(Pi,()=>{j.set(j.LOADING,new z0),j.set(j.DEFAULT,new Mr),ye(Sr,()=>{j.change(j.DEFAULT,!0)})});let j={LOADING:0,MENU:1,READY:2,PLAY:3,GAMEOVER:4,GAME_END:5,SCORE:6,CREDITS:7,SETTINGS:8,DEFAULT:9,USER:100,stop(s=!1){gt!==this.LOADING&&this.isRunning()&&(Eh(),s===!0&&s(),Dt=globalThis.performance.now(),B(Ed))},pause(s=!1){gt!==this.LOADING&&!this.isPaused()&&(j0(),Dt=globalThis.performance.now(),B(Fs))},restart(s=!1){this.isRunning()||(bh(),Dt=globalThis.performance.now()-Dt,B(Er,Dt))},resume(s=!1){this.isPaused()&&(G0(),Dt=globalThis.performance.now()-Dt,B($e,Dt))},isRunning(){return ie!==-1},isPaused(){return wi},set(s,t,e=!1){if(!(t instanceof Mr))throw new Error(t+" is not an instance of me.Stage");rt[s]={},rt[s].stage=t,rt[s].transition=!0,e===!0&&this.change(s)},get(s=gt){if(typeof rt[s]<"u")return rt[s].stage},current(){return this.get()},transition(s,t,e){s==="fade"&&(jt.color=t,jt.duration=e)},setTransition(s,t){rt[s].transition=t},change(s,t){if(typeof rt[s]>"u")throw new Error("Undefined Stage for state '"+s+"'");this.isCurrent(s)||(ar=null,arguments.length>1&&(ar=Array.prototype.slice.call(arguments,1)),jt.duration&&rt[s].transition?(or=()=>{N.viewport.fadeOut(jt.color,jt.duration)},N.viewport.fadeIn(jt.color,jt.duration,function(){Qt(xs,this,s)})):t===!0?xs(s):Qt(xs,this,s))},isCurrent(s){return gt===s}};class H0{constructor(){this.tick=1,this.fps=0,this.maxfps=60,this.interpolation=!1,this.framecount=0,this.framedelta=0,this.last=0,this.now=0,this.delta=0,this.step=0,this.minstep=0,this.timers=[],this.timerId=0,ye(Pi,()=>{this.reset(),this.now=this.last=0,F(ja,t=>this.update(t))}),F($e,()=>{this.reset()}),F(Er,()=>{this.reset()}),F(Ar,()=>{this.reset()})}reset(){this.last=this.now=globalThis.performance.now(),this.delta=0,this.framedelta=0,this.framecount=0,this.step=Math.ceil(1e3/this.maxfps),this.minstep=1e3/this.maxfps*1.25}setTimeout(t,e,i,...r){return this.timers.push({fn:t,delay:e,elapsed:0,repeat:!1,timerId:++this.timerId,pauseable:i===!0||!0,args:r}),this.timerId}setInterval(t,e,i,...r){return this.timers.push({fn:t,delay:e,elapsed:0,repeat:!0,timerId:++this.timerId,pauseable:i===!0||!0,args:r}),this.timerId}clearTimeout(t){t>0&&Qt(this.clearTimer.bind(this),this,t)}clearInterval(t){t>0&&Qt(this.clearTimer.bind(this),this,t)}getTime(){return this.now}getDelta(){return this.delta}countFPS(){this.framecount++,this.framedelta+=this.delta,this.framecount%10===0&&(this.fps=C(Math.round(1e3*this.framecount/this.framedelta),0,this.maxfps),this.framedelta=0,this.framecount=0)}update(t){this.last=this.now,this.now=t,this.delta=this.now-this.last,this.delta<0&&(this.delta=0),this.tick=this.delta>this.minstep&&this.interpolation?this.delta/this.step:1,this.updateTimers()}clearTimer(t){for(let e=0,i=this.timers.length;e<i;e++)if(this.timers[e].timerId===t){this.timers.splice(e,1);break}}updateTimers(){for(let t=0,e=this.timers.length;t<e;t++){let i=this.timers[t];i.pauseable&&j.isPaused()||(i.elapsed+=this.delta),i.elapsed>=i.delay&&(i.fn.apply(null,i.args),i.repeat===!0?i.elapsed-=i.delay:this.clearTimeout(i.timerId))}}}const ht=new H0;class yt{constructor(t,e,i){if(this.ancestor=t,typeof this.bounds>"u"&&(this.bounds=g.pull("Bounds")),typeof this.shapes>"u"&&(this.shapes=[]),this.collisionMask=lt.types.ALL_OBJECT,this.collisionType=lt.types.ENEMY_OBJECT,typeof this.vel>"u"&&(this.vel=g.pull("Vector2d")),this.vel.set(0,0),typeof this.force>"u"&&(this.force=g.pull("Vector2d")),this.force.set(0,0),typeof this.friction>"u"&&(this.friction=g.pull("Vector2d")),this.friction.set(0,0),this.bounce=0,this.mass=1,typeof this.maxVel>"u"&&(this.maxVel=g.pull("Vector2d")),this.maxVel.set(490,490),this.isStatic=!1,this.gravityScale=1,this.ignoreGravity=!1,this.falling=!1,this.jumping=!1,typeof i=="function"&&(this.onBodyUpdate=i),this.bounds.clear(),typeof e<"u")if(Array.isArray(e))for(let r=0;r<e.length;r++)this.addShape(e[r]);else this.addShape(e);this.ancestor.isKinematic=!1}setStatic(t=!0){this.isStatic=t===!0}addShape(t){if(t instanceof Ft||t instanceof ut){let e=t.toPolygon();this.shapes.push(e),this.bounds.add(e.points),this.bounds.translate(e.pos)}else t instanceof Be?(this.shapes.includes(t)||this.shapes.push(t),this.bounds.addBounds(t.getBounds()),this.bounds.translate(t.getBounds().x,t.getBounds().y)):t instanceof kt?(this.shapes.includes(t)||this.shapes.push(t),this.bounds.add(t.points),this.bounds.translate(t.pos)):t instanceof De?(this.shapes.includes(t)||this.shapes.push(t),this.bounds.addPoint(t)):this.fromJSON(t);return typeof this.onBodyUpdate=="function"&&this.onBodyUpdate(this),this.shapes.length}setVertices(t,e=0,i=!0){let r=this.getShape(e);r instanceof kt?r.setShape(0,0,t):this.shapes[e]=g.pull("Polygon",0,0,t),this.bounds.add(this.shapes[e].points,i),typeof this.onBodyUpdate=="function"&&this.onBodyUpdate(this)}addVertices(t,e=0){this.setVertices(t,e,!1)}fromJSON(t,e){let i=t;if(typeof e<"u"&&(i=t[e]),typeof i>"u")throw new Error("Identifier ("+e+") undefined for the given JSON object)");if(i.length){for(let r=0;r<i.length;r++)this.addVertices(i[r].shape,r);this.mass=i[0].density||0,this.friction.set(i[0].friction||0,i[0].friction||0),this.bounce=i[0].bounce||0}return i.length}getShape(t){return this.shapes[t||0]}getBounds(){return this.bounds}removeShape(t){this.bounds.clear(),pi(this.shapes,t);for(let e=0;e<this.shapes.length;e++)this.addShape(this.shapes[e]);return this.shapes.length}removeShapeAt(t){return this.removeShape(this.getShape(t))}setCollisionMask(t=lt.types.ALL_OBJECT){this.collisionMask=t}setCollisionType(t){if(typeof t<"u")if(typeof lt.types[t]<"u")this.collisionType=lt.types[t];else throw new Error("Invalid value for the collisionType property")}respondToCollision(t){let e=t.overlapV;if(this.ancestor.pos.sub(e),e.x!==0&&(this.vel.x=~~(.5+this.vel.x-e.x)||0,this.bounce>0&&(this.vel.x*=-this.bounce)),e.y!==0&&(this.vel.y=~~(.5+this.vel.y-e.y)||0,this.bounce>0&&(this.vel.y*=-this.bounce),!this.ignoreGravity)){let i=this.falling===!0?1:this.jumping===!0?-1:0;this.falling=e.y>=i,this.jumping=e.y<=-i}}forEach(t,e){let i=this,r=0,n=this.shapes,o=n.length;if(typeof t!="function")throw new Error(t+" is not a function");for(arguments.length>1&&(i=e);r<o;)t.call(i,n[r],r,n),r++}contains(...t){let e,i;if(t.length===2?[e,i]=t:[e,i]=[t[0].x,t[0].y],this.getBounds().contains(e,i)){for(let r=this.shapes.length,n;r--,n=this.shapes[r];)if(n.contains(e,i))return!0}return!1}rotate(t,e=this.getBounds().center){return t!==0&&(this.bounds.clear(),this.forEach(i=>{i.rotate(t,e),this.bounds.addBounds(i.getBounds())})),this}setMaxVelocity(t,e){this.maxVel.x=t,this.maxVel.y=e}setFriction(t=0,e=0){this.friction.x=t,this.friction.y=e}update(t){let e=ht.tick;if(this.force.x!==0&&(this.vel.x+=this.force.x*e),this.force.y!==0&&(this.vel.y+=this.force.y*e),this.friction.x>0){let i=this.friction.x*e,r=this.vel.x+i,n=this.vel.x-i;this.vel.x=r<0?r:n>0?n:0}if(this.friction.y>0){let i=this.friction.y*e,r=this.vel.y+i,n=this.vel.y-i;this.vel.y=r<0?r:n>0?n:0}return this.vel.y!==0&&(this.vel.y=C(this.vel.y,-this.maxVel.y,this.maxVel.y)),this.vel.x!==0&&(this.vel.x=C(this.vel.x,-this.maxVel.x,this.maxVel.x)),this.falling=this.vel.y*Math.sign(this.force.y)>0,this.jumping=this.falling?!1:this.jumping,this.ancestor.pos.add(this.vel),this.vel.x!==0||this.vel.y!==0}destroy(){g.push(this.bounds),g.push(this.vel),g.push(this.force),g.push(this.friction),g.push(this.maxVel),this.shapes.forEach(t=>{g.push(t,!1)}),this.onBodyUpdate=void 0,this.ancestor=void 0,this.bounds=void 0,this.vel=void 0,this.force=void 0,this.friction=void 0,this.maxVel=void 0,this.shapes.length=0,this.setStatic(!1)}}let Ie={Linear:{None:function(s){return s}},Quadratic:{In:function(s){return s*s},Out:function(s){return s*(2-s)},InOut:function(s){return(s*=2)<1?.5*s*s:-.5*(--s*(s-2)-1)}},Cubic:{In:function(s){return s*s*s},Out:function(s){return--s*s*s+1},InOut:function(s){return(s*=2)<1?.5*s*s*s:.5*((s-=2)*s*s+2)}},Quartic:{In:function(s){return s*s*s*s},Out:function(s){return 1- --s*s*s*s},InOut:function(s){return(s*=2)<1?.5*s*s*s*s:-.5*((s-=2)*s*s*s-2)}},Quintic:{In:function(s){return s*s*s*s*s},Out:function(s){return--s*s*s*s*s+1},InOut:function(s){return(s*=2)<1?.5*s*s*s*s*s:.5*((s-=2)*s*s*s*s+2)}},Sinusoidal:{In:function(s){return 1-Math.cos(s*Math.PI/2)},Out:function(s){return Math.sin(s*Math.PI/2)},InOut:function(s){return .5*(1-Math.cos(Math.PI*s))}},Exponential:{In:function(s){return s===0?0:Math.pow(1024,s-1)},Out:function(s){return s===1?1:1-Math.pow(2,-10*s)},InOut:function(s){return s===0?0:s===1?1:(s*=2)<1?.5*Math.pow(1024,s-1):.5*(-Math.pow(2,-10*(s-1))+2)}},Circular:{In:function(s){return 1-Math.sqrt(1-s*s)},Out:function(s){return Math.sqrt(1- --s*s)},InOut:function(s){return(s*=2)<1?-.5*(Math.sqrt(1-s*s)-1):.5*(Math.sqrt(1-(s-=2)*s)+1)}},Elastic:{In:function(s){return s===0?0:s===1?1:-Math.pow(2,10*(s-1))*Math.sin((s-1.1)*5*Math.PI)},Out:function(s){return s===0?0:s===1?1:Math.pow(2,-10*s)*Math.sin((s-.1)*5*Math.PI)+1},InOut:function(s){return s===0?0:s===1?1:(s*=2,s<1?-.5*Math.pow(2,10*(s-1))*Math.sin((s-1.1)*5*Math.PI):.5*Math.pow(2,-10*(s-1))*Math.sin((s-1.1)*5*Math.PI)+1)}},Back:{In:function(s){return s*s*((1.70158+1)*s-1.70158)},Out:function(s){return--s*s*((1.70158+1)*s+1.70158)+1},InOut:function(s){const t=2.5949095;return(s*=2)<1?.5*(s*s*((t+1)*s-t)):.5*((s-=2)*s*((t+1)*s+t)+2)}},Bounce:{In:function(s){return 1-Ie.Bounce.Out(1-s)},Out:function(s){return s<1/2.75?7.5625*s*s:s<2/2.75?7.5625*(s-=1.5/2.75)*s+.75:s<2.5/2.75?7.5625*(s-=2.25/2.75)*s+.9375:7.5625*(s-=2.625/2.75)*s+.984375},InOut:function(s){return s<.5?Ie.Bounce.In(s*2)*.5:Ie.Bounce.Out(s*2-1)*.5+.5}}},de={Linear:function(s,t){let e=s.length-1,i=e*t,r=Math.floor(i),n=de.Utils.Linear;return t<0?n(s[0],s[1],i):t>1?n(s[e],s[e-1],e-i):n(s[r],s[r+1>e?e:r+1],i-r)},Bezier:function(s,t){let e=0,i=s.length-1,r=Math.pow,n=de.Utils.Bernstein,o;for(o=0;o<=i;o++)e+=r(1-t,i-o)*r(t,o)*s[o]*n(i,o);return e},CatmullRom:function(s,t){let e=s.length-1,i=e*t,r=Math.floor(i),n=de.Utils.CatmullRom;return s[0]===s[e]?(t<0&&(r=Math.floor(i=e*(1+t))),n(s[(r-1+e)%e],s[r],s[(r+1)%e],s[(r+2)%e],i-r)):t<0?s[0]-(n(s[0],s[0],s[1],s[1],-i)-s[0]):t>1?s[e]-(n(s[e],s[e],s[e-1],s[e-1],i-e)-s[e]):n(s[r?r-1:0],s[r],s[e<r+1?e:r+1],s[e<r+2?e:r+2],i-r)},Utils:{Linear:function(s,t,e){return(t-s)*e+s},Bernstein:function(s,t){let e=de.Utils.Factorial;return e(s)/e(t)/e(s-t)},Factorial:(function(){let s=[1];return function(t){let e=1,i;if(s[t])return s[t];for(i=t;i>1;i--)e*=i;return s[t]=e,e}})(),CatmullRom:function(s,t,e,i,r){let n=(e-s)*.5,o=(i-t)*.5,h=r*r,l=r*h;return(2*t-2*e+n+o)*l+(-3*t+3*e-2*n-o)*h+n*r+t}}};class Po{constructor(t){this.setProperties(t)}onResetEvent(t){this.setProperties(t)}setProperties(t){this._object=t,this._valuesStart={},this._valuesEnd={},this._valuesStartRepeat={},this._duration=1e3,this._repeat=0,this._yoyo=!1,this._reversed=!1,this._delayTime=0,this._startTime=null,this._easingFunction=Ie.Linear.None,this._interpolationFunction=de.Linear,this._chainedTweens=[],this._onStartCallback=null,this._onStartCallbackFired=!1,this._onUpdateCallback=null,this._onCompleteCallback=null,this._tweenTimeTracker=N.lastUpdate,this.isPersistent=!1,this.updateWhenPaused=!1,this.isRenderable=!1;for(let e in t)typeof t!="object"&&(this._valuesStart[e]=parseFloat(t[e]))}_resumeCallback(t){this._startTime&&(this._startTime+=t)}onActivateEvent(){F($e,this._resumeCallback,this)}onDeactivateEvent(){Ot($e,this._resumeCallback)}to(t,e){return this._valuesEnd=t,typeof e<"u"&&(typeof e=="number"?this._duration=e:typeof e=="object"&&(e.duration&&(this._duration=e.duration),e.yoyo&&this.yoyo(e.yoyo),e.easing&&this.easing(e.easing),e.repeat&&this.repeat(e.repeat),e.delay&&this.delay(e.delay),e.interpolation&&this.interpolation(e.interpolation),e.autoStart&&this.start())),this}start(t=ht.getTime()){this._onStartCallbackFired=!1,N.world.addChild(this),this._startTime=t+this._delayTime;for(let e in this._valuesEnd){if(this._valuesEnd[e]instanceof Array){if(this._valuesEnd[e].length===0)continue;this._valuesEnd[e]=[this._object[e]].concat(this._valuesEnd[e])}this._valuesStart[e]=this._object[e],this._valuesStart[e]instanceof Array||(this._valuesStart[e]*=1),this._valuesStartRepeat[e]=this._valuesStart[e]||0}return this}stop(){return N.world.removeChildNow(this),this}delay(t){return this._delayTime=t,this}repeat(t){return this._repeat=t,this}yoyo(t){return this._yoyo=t,this}easing(t){if(typeof t!="function")throw new Error("invalid easing function for me.Tween.easing()");return this._easingFunction=t,this}interpolation(t){return this._interpolationFunction=t,this}chain(){return this._chainedTweens=arguments,this}onStart(t){return this._onStartCallback=t,this}onUpdate(t){return this._onUpdateCallback=t,this}onComplete(t){return this._onCompleteCallback=t,this}update(t){this._tweenTimeTracker=N.lastUpdate>this._tweenTimeTracker?N.lastUpdate:this._tweenTimeTracker+t;let e=this._tweenTimeTracker,i;if(e<this._startTime)return!0;this._onStartCallbackFired===!1&&(this._onStartCallback!==null&&this._onStartCallback.call(this._object),this._onStartCallbackFired=!0);let r=(e-this._startTime)/this._duration;r=r>1?1:r;let n=this._easingFunction(r);for(i in this._valuesEnd){let o=this._valuesStart[i]||0,h=this._valuesEnd[i];h instanceof Array?this._object[i]=this._interpolationFunction(h,n):(typeof h=="string"&&(h=o+parseFloat(h)),typeof h=="number"&&(this._object[i]=o+(h-o)*n))}if(this._onUpdateCallback!==null&&this._onUpdateCallback.call(this._object,n),r===1)if(this._repeat>0){isFinite(this._repeat)&&this._repeat--;for(i in this._valuesStartRepeat){if(typeof this._valuesEnd[i]=="string"&&(this._valuesStartRepeat[i]=this._valuesStartRepeat[i]+parseFloat(this._valuesEnd[i])),this._yoyo){let o=this._valuesStartRepeat[i];this._valuesStartRepeat[i]=this._valuesEnd[i],this._valuesEnd[i]=o}this._valuesStart[i]=this._valuesStartRepeat[i]}return this._yoyo&&(this._reversed=!this._reversed),this._startTime=e+this._delayTime,!0}else{N.world.removeChildNow(this),this._onCompleteCallback!==null&&this._onCompleteCallback.call(this._object);for(let o=0,h=this._chainedTweens.length;o<h;o++)this._chainedTweens[o].start(e);return!1}return!0}static get Easing(){return Ie}static get Interpolation(){return de}}class X0{constructor(t,e){this.vertexSize=t,this.objSize=e,this.maxVertex=256,this.vertexCount=0,this.buffer=new ArrayBuffer(this.maxVertex*this.vertexSize*this.objSize),this.bufferF32=new Float32Array(this.buffer),this.bufferU32=new Uint32Array(this.buffer)}clear(){this.vertexCount=0}isFull(t=this.objSize){return this.vertexCount+t>=this.maxVertex}resize(t){for(;t>this.maxVertex;)this.maxVertex<<=1;let e=this.bufferF32;return this.buffer=new ArrayBuffer(this.maxVertex*this.vertexSize*this.objSize),this.bufferF32=new Float32Array(this.buffer),this.bufferU32=new Uint32Array(this.buffer),this.bufferF32.set(e),this}push(t,e,i,r,n){let o=this.vertexCount*this.vertexSize;return this.vertexCount>=this.maxVertex&&this.resize(this.vertexCount),this.bufferF32[o]=t,this.bufferF32[++o]=e,typeof i<"u"&&(this.bufferF32[++o]=i,this.bufferF32[++o]=r),typeof n<"u"&&(this.bufferU32[++o]=n),this.vertexCount++,this}toFloat32(t,e){return typeof e<"u"?this.bufferF32.subarray(t,e):this.bufferF32}toUint32(t,e){return typeof e<"u"?this.bufferU32.subarray(t,e):this.bufferU32}length(){return this.vertexCount}isEmpty(){return this.vertexCount===0}}class Ah{constructor(t,e){this.init(t,e)}init(t,e){if(this.renderer=t,this.gl=t.gl,this.color=t.currentColor,this.viewMatrix=t.currentTransform,this.defaultShader=void 0,this.currentShader=void 0,this.mode=this.gl.TRIANGLES,this.attributes=[],this.vertexByteSize=0,this.vertexSize=0,this.vertexData=null,typeof e<"u"&&Array.isArray(e.attributes))e.attributes.forEach(i=>{this.addAttribute(i.name,i.size,i.type,i.normalized,i.offset),this.vertexData=new X0(this.vertexSize,6)});else throw new Error("attributes definition missing");if(typeof e<"u"&&typeof e.shader<"u")this.defaultShader=new oh(this.gl,e.shader.vertex,e.shader.fragment);else throw new Error("shader definition missing")}reset(){this.gl=this.renderer.gl,this.vertexData.clear()}bind(){this.renderer.currentProgram!==this.defaultShader.program&&this.useShader(this.defaultShader)}useShader(t){this.renderer.currentProgram!==t.program&&(this.flush(),t.bind(),t.setUniform("uProjectionMatrix",this.renderer.projectionMatrix),t.setVertexAttributes(this.gl,this.attributes,this.vertexByteSize),this.currentShader=t,this.renderer.currentProgram=this.currentShader.program)}addAttribute(t,e,i,r,n){switch(this.attributes.push({name:t,size:e,type:i,normalized:r,offset:n}),i){case this.gl.BYTE:this.vertexByteSize+=e*Int8Array.BYTES_PER_ELEMENT;break;case this.gl.UNSIGNED_BYTE:this.vertexByteSize+=e*Uint8Array.BYTES_PER_ELEMENT;break;case this.gl.SHORT:this.vertexByteSize+=e*Int16Array.BYTES_PER_ELEMENT;break;case this.gl.UNSIGNED_SHORT:this.vertexByteSize+=e*Uint16Array.BYTES_PER_ELEMENT;break;case this.gl.INT:this.vertexByteSize+=e*Int32Array.BYTES_PER_ELEMENT;break;case this.gl.UNSIGNED_INT:this.vertexByteSize+=e*Uint32Array.BYTES_PER_ELEMENT;break;case this.gl.FLOAT:this.vertexByteSize+=e*Float32Array.BYTES_PER_ELEMENT;break;default:throw new Error("Invalid GL Attribute type")}this.vertexSize=this.vertexByteSize/Float32Array.BYTES_PER_ELEMENT}setProjection(t){this.currentShader.setUniform("uProjectionMatrix",t)}flush(t=this.mode){let e=this.vertexData,i=e.vertexCount;if(i>0){let r=this.gl,n=e.vertexSize;this.renderer.WebGLVersion>1?r.bufferData(r.ARRAY_BUFFER,e.toFloat32(),r.STREAM_DRAW,0,i*n):r.bufferData(r.ARRAY_BUFFER,e.toFloat32(0,i*n),r.STREAM_DRAW),r.drawArrays(t,0,i),e.clear()}}}var W0=`// Current vertex point
attribute vec2 aVertex;
attribute vec4 aColor;

// Projection matrix
uniform mat4 uProjectionMatrix;

varying vec4 vColor;

void main(void) {
    // Transform the vertex position by the projection matrix
    gl_Position = uProjectionMatrix * vec4(aVertex, 0.0, 1.0);
    // Pass the remaining attributes to the fragment shader
    vColor = vec4(aColor.bgr * aColor.a, aColor.a);
}
`,Y0=`varying vec4 vColor;

void main(void) {
    gl_FragColor = vColor;
}
`;class q0 extends Ah{init(t){super.init(t,{attributes:[{name:"aVertex",size:2,type:t.gl.FLOAT,normalized:!1,offset:0*Float32Array.BYTES_PER_ELEMENT},{name:"aColor",size:4,type:t.gl.UNSIGNED_BYTE,normalized:!0,offset:2*Float32Array.BYTES_PER_ELEMENT}],shader:{vertex:W0,fragment:Y0}})}drawVertices(t,e,i=e.length){let r=this.viewMatrix,n=this.vertexData,o=this.renderer.getGlobalAlpha(),h=this.renderer.currentColor.toUint32(o);n.isFull(i)&&this.flush(),t!==this.mode&&(this.flush(this.mode),this.mode=t),r.isIdentity()?e.forEach(l=>{n.push(l.x,l.y,void 0,void 0,h)}):e.forEach(l=>{r.apply(l),n.push(l.x,l.y,void 0,void 0,h)}),(this.mode===this.gl.LINE_STRIP||this.mode===this.gl.LINE_LOOP)&&this.flush(this.mode)}}var K0=`// Current vertex point
attribute vec2 aVertex;
attribute vec2 aRegion;
attribute vec4 aColor;

// Projection matrix
uniform mat4 uProjectionMatrix;

varying vec2 vRegion;
varying vec4 vColor;

void main(void) {
    // Transform the vertex position by the projection matrix
    gl_Position = uProjectionMatrix * vec4(aVertex, 0.0, 1.0);
    // Pass the remaining attributes to the fragment shader
    vColor = vec4(aColor.bgr * aColor.a, aColor.a);
    vRegion = aRegion;
}
`,Z0=`uniform sampler2D uSampler;
varying vec4 vColor;
varying vec2 vRegion;

void main(void) {
    gl_FragColor = texture2D(uSampler, vRegion) * vColor;
}
`;let ri=[new M,new M,new M,new M];class Q0 extends Ah{init(t){super.init(t,{attributes:[{name:"aVertex",size:2,type:t.gl.FLOAT,normalized:!1,offset:0*Float32Array.BYTES_PER_ELEMENT},{name:"aRegion",size:2,type:t.gl.FLOAT,normalized:!1,offset:2*Float32Array.BYTES_PER_ELEMENT},{name:"aColor",size:4,type:t.gl.UNSIGNED_BYTE,normalized:!0,offset:4*Float32Array.BYTES_PER_ELEMENT}],shader:{vertex:K0,fragment:Z0}}),this.currentTextureUnit=-1,this.boundTextures=[]}reset(){super.reset();for(let t=0;t<this.renderer.maxTextures;t++){let e=this.getTexture2D(t);typeof e<"u"&&this.deleteTexture2D(e)}this.currentTextureUnit=-1}createTexture2D(t,e=null,i,r="no-repeat",n=e.width,o=e.height,h=!0,l=!0){let f=this.gl,d=ge(n)&&ge(o),a=r.search(/^repeat(-x)?$/)===0&&(d||this.renderer.WebGLVersion>1)?f.REPEAT:f.CLAMP_TO_EDGE,u=r.search(/^repeat(-y)?$/)===0&&(d||this.renderer.WebGLVersion>1)?f.REPEAT:f.CLAMP_TO_EDGE,c=f.createTexture();if(this.bindTexture2D(c,t),f.texParameteri(f.TEXTURE_2D,f.TEXTURE_WRAP_S,a),f.texParameteri(f.TEXTURE_2D,f.TEXTURE_WRAP_T,u),f.texParameteri(f.TEXTURE_2D,f.TEXTURE_MAG_FILTER,i),f.texParameteri(f.TEXTURE_2D,f.TEXTURE_MIN_FILTER,i),f.pixelStorei(f.UNPACK_PREMULTIPLY_ALPHA_WEBGL,h),e===null||typeof e.byteLength<"u")f.texImage2D(f.TEXTURE_2D,0,f.RGBA,n,o,0,f.RGBA,f.UNSIGNED_BYTE,e,0);else if(typeof globalThis.OffscreenCanvas<"u"&&e instanceof globalThis.OffscreenCanvas){const p=e.transferToImageBitmap();f.texImage2D(f.TEXTURE_2D,0,f.RGBA,f.RGBA,f.UNSIGNED_BYTE,p),p.close()}else f.texImage2D(f.TEXTURE_2D,0,f.RGBA,f.RGBA,f.UNSIGNED_BYTE,e);return d&&l===!0&&f.generateMipmap(f.TEXTURE_2D),c}deleteTexture2D(t){this.gl.deleteTexture(t),this.unbindTexture2D(t)}getTexture2D(t){return this.boundTextures[t]}bindTexture2D(t,e){let i=this.gl;t!==this.boundTextures[e]?(this.flush(),this.currentTextureUnit!==e&&(this.currentTextureUnit=e,i.activeTexture(i.TEXTURE0+e)),i.bindTexture(i.TEXTURE_2D,t),this.boundTextures[e]=t):this.currentTextureUnit!==e&&(this.flush(),this.currentTextureUnit=e,i.activeTexture(i.TEXTURE0+e))}unbindTexture2D(t,e){return typeof e>"u"&&(e=this.boundTextures.indexOf(t)),e!==-1&&(delete this.boundTextures[e],e===this.currentTextureUnit&&(this.currentTextureUnit=-1)),e}uploadTexture(t,e,i,r=!1){let n=this.renderer.cache.getUnit(t),o=this.boundTextures[n];return typeof o>"u"||r?this.createTexture2D(n,t.getTexture(),this.renderer.settings.antiAlias?this.gl.LINEAR:this.gl.NEAREST,t.repeat,e,i,t.premultipliedAlpha):this.bindTexture2D(o,n),this.currentTextureUnit}addQuad(t,e,i,r,n,o,h,l,f,d,a=!1){let u=this.vertexData;u.isFull(6)&&this.flush();let c=this.uploadTexture(t,r,n,a);this.currentShader.setUniform("uSampler",c);let p=this.viewMatrix,y=ri[0].set(e,i),_=ri[1].set(e+r,i),m=ri[2].set(e,i+n),x=ri[3].set(e+r,i+n);p.isIdentity()||(p.apply(y),p.apply(_),p.apply(m),p.apply(x)),u.push(y.x,y.y,o,h,d),u.push(_.x,_.y,l,h,d),u.push(m.x,m.y,o,f,d),u.push(m.x,m.y,o,f,d),u.push(_.x,_.y,l,h,d),u.push(x.x,x.y,l,f,d)}}let vs;class Sh extends ne{constructor(t){super(Object.assign(t,{context:"webgl"})),this.GPUVendor=void 0,this.GPURenderer=void 0,this.gl=this.renderTarget.context,this.lineWidth=1,this.lineJoin="round",this.vertexBuffer=this.gl.createBuffer(),this.maxTextures=this.gl.getParameter(this.gl.MAX_TEXTURE_IMAGE_UNITS),this._colorStack=[],this._matrixStack=[],this._scissorStack=[],this._blendStack=[],this.currentTransform=new Re,this.currentCompositor=void 0,this.currentProgram=void 0,this.compositors=new Map,this.gl.bindBuffer(this.gl.ARRAY_BUFFER,this.vertexBuffer),this.addCompositor(new(this.settings.compositor||Q0)(this),"quad",!0),this.addCompositor(new(this.settings.compositor||q0)(this),"primitive"),this.depthTest=t.depthTest,this.depthTest==="z-buffer"?(this.gl.enable(this.gl.DEPTH_TEST),this.gl.depthFunc(this.gl.LEQUAL),this.gl.depthMask(!0)):(this.gl.disable(this.gl.DEPTH_TEST),this.gl.depthMask(!1)),this.gl.disable(this.gl.SCISSOR_TEST),this.gl.enable(this.gl.BLEND),this.setBlendMode(this.settings.blendMode);let e=this.gl.getExtension("WEBGL_debug_renderer_info");e!==null&&(this.GPUVendor=this.gl.getParameter(e.UNMASKED_VENDOR_WEBGL),this.GPURenderer=this.gl.getParameter(e.UNMASKED_RENDERER_WEBGL)),this.customShader=void 0,this.cache=new xh(this.maxTextures),this.type="WebGL"+this.WebGLVersion,this.getCanvas().addEventListener("webglcontextlost",i=>{i.preventDefault(),this.isContextValid=!1,B(Cr,this)},!1),this.getCanvas().addEventListener("webglcontextrestored",()=>{this.reset(),this.isContextValid=!0,B(yi,this)},!1),F(ze,()=>{this.reset()}),F(Ii,(i,r)=>{this.flush(),this.setViewport(0,0,i,r)})}get WebGLVersion(){return this.renderTarget.WebGLVersion}getSupportedCompressedTextureFormats(){if(typeof vs>"u"){const t=this.gl;vs={astc:t.getExtension("WEBGL_compressed_texture_astc")||this._gl.getExtension("WEBKIT_WEBGL_compressed_texture_astc"),bptc:t.getExtension("EXT_texture_compression_bptc")||this._gl.getExtension("WEBKIT_EXT_texture_compression_bptc"),s3tc:t.getExtension("WEBGL_compressed_texture_s3tc")||this._gl.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc"),s3tc_srgb:t.getExtension("WEBGL_compressed_texture_s3tc_srgb")||this._gl.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc_srgb"),pvrtc:t.getExtension("WEBGL_compressed_texture_pvrtc")||this._gl.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc"),etc1:t.getExtension("WEBGL_compressed_texture_etc1")||this._gl.getExtension("WEBKIT_WEBGL_compressed_texture_etc1"),etc2:t.getExtension("WEBGL_compressed_texture_etc")||t.getExtension("WEBKIT_WEBGL_compressed_texture_etc")||t.getExtension("WEBGL_compressed_texture_es3_0")}}return vs}hasSupportedCompressedFormats(t){const e=this.getSupportedCompressedTextureFormats();for(var i in e)for(var r in e[i])if(t===e[i][r])return!0;return!1}reset(){super.reset(),this._colorStack.forEach(t=>{g.push(t)}),this._matrixStack.forEach(t=>{g.push(t)}),this._colorStack.length=0,this._matrixStack.length=0,this._blendStack.length=0,this.clear(),this.setViewport(),this.gl.getParameter(this.gl.ARRAY_BUFFER_BINDING)!==this.vertexBuffer&&this.gl.bindBuffer(this.gl.ARRAY_BUFFER,this.vertexBuffer),this.currentCompositor=void 0,this.currentProgram=void 0,this.customShader=void 0,this.compositors.forEach(t=>{this.isContextValid===!1?t.init(this):t.reset()}),this.setCompositor("quad"),this.gl.disable(this.gl.SCISSOR_TEST)}addCompositor(t,e="default",i=!1){if(typeof this.compositors.get(e)<"u")throw new Error("Invalid Compositor name");this.compositors.set(e,t),i===!0&&this.setCompositor(e)}setCompositor(t="default",e=this.customShader){let i=this.compositors.get(t);if(typeof i>"u")throw new Error("Invalid Compositor");return this.currentCompositor!==i&&(this.currentCompositor!==void 0&&this.currentCompositor.flush(),this.currentCompositor=i),t==="quad"&&typeof e=="object"?this.currentCompositor.useShader(e):this.currentCompositor.bind(),this.currentCompositor}resetTransform(){this.currentTransform.identity()}createPattern(t,e){if(this.setCompositor("quad"),U.WebGLVersion===1&&(!ge(t.width)||!ge(t.height))){let r=typeof t.src<"u"?t.src:t;throw new Error("[WebGL Renderer] "+r+" is not a POT texture ("+t.width+"x"+t.height+")")}let i=new zi(_h(t.width,t.height,"pattern",e),t);return this.currentCompositor.uploadTexture(i),i}flush(){this.currentCompositor.flush()}setProjection(t){super.setProjection(t),this.currentCompositor.setProjection(t)}setViewport(t=0,e=0,i=this.getCanvas().width,r=this.getCanvas().height){this.gl.viewport(t,e,i,r)}clear(){let t=this.gl;t.clearColor(0,0,0,this.settings.transparent?0:1),this.lineWidth=1,this.depthTest==="z-buffer"?t.clear(t.DEPTH_BUFFER_BIT|t.COLOR_BUFFER_BIT|t.STENCIL_BUFFER_BIT):t.clear(t.COLOR_BUFFER_BIT|t.STENCIL_BUFFER_BIT)}clearColor(t="#000000",e=!1){let i,r=this.gl;if(t instanceof nt)i=t.toArray();else{let n=g.pull("me.Color");i=n.parseCSS(t).toArray(),g.push(n)}r.clearColor(i[0],i[1],i[2],e===!0?1:i[3]),r.clear(r.COLOR_BUFFER_BIT)}clearRect(t,e,i,r){this.save(),this.clipRect(t,e,i,r),this.clearColor(),this.restore()}drawImage(t,e,i,r,n,o,h,l,f){typeof r>"u"?(r=l=t.width,n=f=t.height,o=e,h=i,e=0,i=0):typeof o>"u"&&(o=e,h=i,l=r,f=n,r=t.width,n=t.height,e=0,i=0),this.settings.subPixel===!1&&(o|=0,h|=0),this.setCompositor("quad");let d=typeof t.videoWidth<"u",a=this.cache.get(t),u=a.getUVs(e+","+i+","+r+","+n);this.currentCompositor.addQuad(a,o,h,l,f,u[0],u[1],u[2],u[3],this.currentTint.toUint32(this.getGlobalAlpha()),d)}drawPattern(t,e,i,r,n){let o=t.getUVs("0,0,"+r+","+n);this.setCompositor("quad"),this.currentCompositor.addQuad(t,e,i,r,n,o[0],o[1],o[2],o[3],this.currentTint.toUint32(this.getGlobalAlpha()))}beginPath(){this.path2D.beginPath()}moveTo(t,e){this.path2D.moveTo(t,e)}lineTo(t,e){this.path2D.lineTo(t,e)}rect(t,e,i,r){this.path2D.rect(t,e,i,r)}roundRect(t,e,i,r,n){this.path2D.roundRect(t,e,i,r,n)}stroke(t,e){this.setCompositor("primitive"),typeof t>"u"?e===!0?this.currentCompositor.drawVertices(this.gl.TRIANGLES,this.path2D.triangulatePath()):this.currentCompositor.drawVertices(this.gl.LINES,this.path2D.points):super.stroke(t,e)}fill(t){this.stroke(t,!0)}closePath(){this.path2D.closePath()}getContext(){return this.gl}setBlendMode(t="normal",e=this.gl){if(this.currentBlendMode!==t)switch(this.flush(),e.enable(e.BLEND),this.currentBlendMode=t,t){case"screen":e.blendFunc(e.ONE,e.ONE_MINUS_SRC_COLOR);break;case"lighter":case"additive":e.blendFunc(e.ONE,e.ONE);break;case"multiply":e.blendFunc(e.DST_COLOR,e.ONE_MINUS_SRC_ALPHA);break;default:e.blendFunc(e.ONE,e.ONE_MINUS_SRC_ALPHA),this.currentBlendMode="normal";break}}restore(){if(this._matrixStack.length!==0){let t=this._colorStack.pop(),e=this._matrixStack.pop();this.currentColor.copy(t),this.currentTransform.copy(e),this.setBlendMode(this._blendStack.pop()),g.push(t),g.push(e)}if(this._scissorStack.length!==0)this.currentScissor.set(this._scissorStack.pop());else{const t=this.getCanvas();this.gl.disable(this.gl.SCISSOR_TEST),this.currentScissor[0]=0,this.currentScissor[1]=0,this.currentScissor[2]=t.width,this.currentScissor[3]=t.height}}save(){this._colorStack.push(this.currentColor.clone()),this._matrixStack.push(this.currentTransform.clone()),this.gl.isEnabled(this.gl.SCISSOR_TEST)&&this._scissorStack.push(this.currentScissor.slice()),this._blendStack.push(this.getBlendMode())}rotate(t){this.currentTransform.rotate(t)}scale(t,e){this.currentTransform.scale(t,e)}setAntiAlias(t=!1){super.setAntiAlias(t)}setGlobalAlpha(t){this.currentColor.alpha=t}getGlobalAlpha(){return this.currentColor.alpha}setColor(t){let e=this.currentColor.alpha;this.currentColor.copy(t),this.currentColor.alpha*=e}strokeArc(t,e,i,r,n,o=!1,h=!1){this.setCompositor("primitive"),this.path2D.beginPath(),this.path2D.arc(t,e,i,r,n,o),h===!1?this.currentCompositor.drawVertices(this.gl.LINES,this.path2D.points):this.currentCompositor.drawVertices(this.gl.TRIANGLES,this.path2D.triangulatePath())}fillArc(t,e,i,r,n,o=!1){this.strokeArc(t,e,i,r,n,o,!0)}strokeEllipse(t,e,i,r,n=!1){this.setCompositor("primitive"),this.path2D.beginPath(),this.path2D.ellipse(t,e,i,r,0,0,360),n===!1?this.currentCompositor.drawVertices(this.gl.LINES,this.path2D.points):this.currentCompositor.drawVertices(this.gl.TRIANGLES,this.path2D.triangulatePath())}fillEllipse(t,e,i,r){this.strokeEllipse(t,e,i,r,!0)}strokeLine(t,e,i,r){if(this.setCompositor("primitive"),this.lineWidth===1)this.path2D.beginPath(),this.path2D.moveTo(t,e),this.path2D.lineTo(i,r),this.currentCompositor.drawVertices(this.gl.LINES,this.path2D.points);else if(this.lineWidth>1){const n=this.lineWidth/2,o=Math.atan2(r-e,i-t),h=Math.sin(o)*n,l=Math.cos(o)*n,f=t-h,d=e+l,a=t+h,u=e-l,c=i+h,p=r-l,y=i-h,_=r+l;this.path2D.beginPath(),this.path2D.moveTo(f,d),this.path2D.lineTo(a,u),this.path2D.lineTo(c,p),this.path2D.lineTo(y,_),this.path2D.closePath(),this.currentCompositor.drawVertices(this.gl.TRIANGLES,this.path2D.triangulatePath())}}fillLine(t,e,i,r){this.strokeLine(t,e,i,r)}strokePolygon(t,e=!1){const i=t.points,r=i.length;if(this.translate(t.pos.x,t.pos.y),e===!1&&this.lineWidth>1){const n=this.lineWidth/2;for(let l=0;l<r-1;l++){const f=i[l],d=i[l+1];this.fillEllipse(d.x,d.y,n,n),this.strokeLine(f.x,f.y,d.x,d.y)}const o=i[r-1],h=i[0];o.equals(h)||(this.fillEllipse(h.x,h.y,n,n),this.strokeLine(o.x,o.y,h.x,h.y))}else{this.setCompositor("primitive"),this.path2D.beginPath();for(let n=0;n<r-1;n++){const o=i[n],h=i[n+1];this.path2D.moveTo(o.x,o.y),this.path2D.lineTo(h.x,h.y)}this.path2D.closePath(),e===!1?this.currentCompositor.drawVertices(this.gl.LINES,this.path2D.points):this.currentCompositor.drawVertices(this.gl.TRIANGLES,this.path2D.triangulatePath())}this.translate(-t.pos.x,-t.pos.y)}fillPolygon(t){this.strokePolygon(t,!0)}strokeRect(t,e,i,r,n=!1){if(n===!1&&this.lineWidth>1){const o=this.lineWidth/2;this.strokeLine(t,e,t+i,e),this.strokeLine(t+i,e,t+i,e+r),this.strokeLine(t+i,e+r,t,e+r),this.strokeLine(t,e+r,t,e),this.fillEllipse(t,e,o,o),this.fillEllipse(t+i,e,o,o),this.fillEllipse(t+i,e+r,o,o),this.fillEllipse(t,e+r,o,o)}else this.setCompositor("primitive"),this.path2D.beginPath(),this.path2D.rect(t,e,i,r),n===!1?this.currentCompositor.drawVertices(this.gl.LINES,this.path2D.points):this.currentCompositor.drawVertices(this.gl.TRIANGLES,this.path2D.triangulatePath())}fillRect(t,e,i,r){this.strokeRect(t,e,i,r,!0)}strokeRoundRect(t,e,i,r,n,o=!1){this.setCompositor("primitive"),this.path2D.beginPath(),this.path2D.roundRect(t,e,i,r,n),o===!1?this.currentCompositor.drawVertices(this.gl.LINES,this.path2D.points):this.currentCompositor.drawVertices(this.gl.TRIANGLES,this.path2D.triangulatePath())}fillRoundRect(t,e,i,r,n){this.strokeRoundRect(t,e,i,r,n,!0)}strokePoint(t,e){this.strokeLine(t,e,t+1,e+1)}fillPoint(t,e){this.strokePoint(t,e)}setTransform(t,e,i,r,n,o){this.resetTransform(),this.transform(t,e,i,r,n,o)}transform(t,e,i,r,n,o){if(typeof t=="object"?this.currentTransform.multiply(t):this.currentTransform.transform(t,e,i,r,n,o),this.settings.subPixel===!1){let h=this.currentTransform.toArray();h[6]|=0,h[7]|=0}}translate(t,e){let i=this.currentTransform;if(i.translate(t,e),this.settings.subPixel===!1){let r=i.toArray();r[6]|=0,r[7]|=0}}clipRect(t,e,i,r){let n=this.getCanvas(),o=this.gl;if(t!==0||e!==0||i!==n.width||r!==n.height){let h=this.currentScissor;if(o.isEnabled(o.SCISSOR_TEST)&&h[0]===t&&h[1]===e&&h[2]===i&&h[3]===r)return;this.flush(),o.enable(this.gl.SCISSOR_TEST),o.scissor(t+this.currentTransform.tx,n.height-r-e-this.currentTransform.ty,i,r),h[0]=t,h[1]=e,h[2]=i,h[3]=r}else o.disable(o.SCISSOR_TEST)}setMask(t,e=!1){let i=this.gl;this.flush(),this.maskLevel===0&&(i.enable(i.STENCIL_TEST),i.clear(i.STENCIL_BUFFER_BIT)),this.maskLevel++,i.colorMask(!1,!1,!1,!1),i.stencilFunc(i.EQUAL,this.maskLevel,1),i.stencilOp(i.REPLACE,i.REPLACE,i.REPLACE),this.fill(t),this.flush(),i.colorMask(!0,!0,!0,!0),e===!0?i.stencilFunc(i.EQUAL,this.maskLevel+1,1):i.stencilFunc(i.NOTEQUAL,this.maskLevel+1,1),i.stencilOp(i.KEEP,i.KEEP,i.KEEP)}clearMask(){this.maskLevel>0&&(this.flush(),this.maskLevel=0,this.gl.disable(this.gl.STENCIL_TEST))}}class Io extends W{constructor(t,e,i){super(0,0,1/0,1/0),this.color=g.pull("Color").parseCSS(e),this.onResetEvent(t,e,i)}onResetEvent(t,e,i=0){this.name=t,this.pos.z=i,this.floating=!0,this.color.parseCSS(e)}draw(t,e){t.save(),t.clipRect(0,0,e.width,e.height),t.clearColor(this.color),t.restore()}destroy(){g.push(this.color),this.color=void 0,super.destroy()}}class Ro extends Ct{constructor(t,e,i){super(t,e,i),this.floating=!0,this.offset.set(t,e),this.ratio=g.pull("Vector2d",1,1),typeof i.ratio<"u"&&(Wa(i.ratio)?this.ratio.set(i.ratio,+i.ratio):this.ratio.setV(i.ratio)),typeof i.anchorPoint>"u"?this.anchorPoint.set(0,0):typeof i.anchorPoint=="number"?this.anchorPoint.set(i.anchorPoint,i.anchorPoint):this.anchorPoint.setV(i.anchorPoint),this.repeat=i.repeat||"repeat",F(yi,this.createPattern,this)}get repeat(){return this._repeat}set repeat(t){switch(this._repeat=t,this._repeat){case"no-repeat":this.repeatX=!1,this.repeatY=!1;break;case"repeat-x":this.repeatX=!0,this.repeatY=!1;break;case"repeat-y":this.repeatX=!1,this.repeatY=!0;break;default:this.repeatX=!0,this.repeatY=!0;break}this.resize(N.viewport.width,N.viewport.height),this.createPattern()}onActivateEvent(){F(Us,this.updateLayer,this),F(Jt,this.resize,this),F(gi,this.updateLayer,this),this.ancestor.root!==!0&&this.updateLayer()}resize(t,e){return super.resize(this.repeatX?1/0:t,this.repeatY?1/0:e)}createPattern(){this._pattern=U.createPattern(this.image,this._repeat)}updateLayer(){const t=this.ratio.x,e=this.ratio.y,i=N.viewport;if(t===0&&e===0)return;const r=this.width,n=this.height,o=i.bounds.width,h=i.bounds.height,l=this.anchorPoint.x,f=this.anchorPoint.y,d=l*(t-1)*(o-i.width)+this.offset.x-t*i.pos.x,a=f*(e-1)*(h-i.height)+this.offset.y-e*i.pos.y;this.repeatX?this.pos.x=d%r:this.pos.x=d,this.repeatY?this.pos.y=a%n:this.pos.y=a,this.isDirty=!0}preDraw(t){t.save(),t.setGlobalAlpha(t.globalAlpha()*this.getOpacity()),t.setTint(this.tint),this.blendMode!==t.getBlendMode()&&t.setBlendMode(this.blendMode)}draw(t,e){const i=this.width,r=this.height,n=e.bounds.width,o=e.bounds.height,h=this.anchorPoint.x,l=this.anchorPoint.y;let f=this.pos.x,d=this.pos.y;this.ratio.x===0&&this.ratio.y===0&&(f=f+h*(n-i),d=d+l*(o-r)),t.translate(f,d),t.drawPattern(this._pattern,0,0,e.width*2,e.height*2)}onDeactivateEvent(){Ot(Us,this.updateLayer),Ot(Jt,this.resize),Ot(gi,this.updateLayer)}destroy(){g.push(this.ratio),this.ratio=void 0,Ot(yi,this.createPattern),super.destroy()}}class Mo extends Ct{constructor(t,e,i){if(super(t,e,i),typeof i.width!="number"||typeof i.height!="number")throw new Error("height and width properties are mandatory");this.width=Math.floor(i.width),this.height=Math.floor(i.height),this.nss_width=this.width,this.nss_height=this.height,this.insetx=i.insetx,this.insety=i.insety}get width(){return super.width}set width(t){super.width=this.nss_width=t}get height(){return super.height}set height(t){super.height=this.nss_height=t}draw(t){let e=this.current,i=this.pos.x,r=this.pos.y,n=e.width,o=e.height,h=e.offset,l=this.offset;e.angle!==0&&(t.translate(-i,-r),t.rotate(e.angle),i-=o,n=e.height,o=e.width);let f=l.x+h.x,d=l.y+h.y,a=this.insetx||n/4,u=this.insety||o/4;t.drawImage(this.image,f,d,a,u,i,r,a,u),t.drawImage(this.image,f+n-a,d,a,u,i+this.nss_width-a,r,a,u),t.drawImage(this.image,f,d+o-u,a,u,i,r+this.nss_height-u,a,u),t.drawImage(this.image,f+n-a,d+o-u,a,u,i+this.nss_width-a,r+this.nss_height-u,a,u);let c=n-(a<<1),p=o-(u<<1),y=this.nss_width-(a<<1),_=this.nss_height-(u<<1);t.drawImage(this.image,f+a,d,c,u,i+a,r,y,u),t.drawImage(this.image,f+a,d+o-u,c,u,i+a,r+this.nss_height-u,y,u),t.drawImage(this.image,f,d+u,a,p,i,r+u,a,_),t.drawImage(this.image,f+n-a,d+u,a,p,i+this.nss_width-a,r+u,a,_),t.drawImage(this.image,f+a,d+u,c,p,i+a,r+u,y,_)}}function hr(s,t){s.font=t.font,s.fillStyle=t.fillStyle.toRGBA(),s.strokeStyle=t.strokeStyle.toRGBA(),s.lineWidth=t.lineWidth,s.textAlign=t.textAlign,s.textBaseline=t.textBaseline}const J0=["ex","em","pt","px"],t_=[12,24,.75,1];class bi extends W{constructor(t,e,i){super(t,e,i.width||0,i.height||0),this.fillStyle=g.pull("Color",0,0,0),this.strokeStyle=g.pull("Color",0,0,0),this.lineWidth=0,this.textAlign="left",this.textBaseline="top",this.lineHeight=1,this.wordWrapWidth=-1,this.fontSize=10,this._text=[],this.onResetEvent(t,e,i)}onResetEvent(t,e,i){typeof this.fillStyle>"u"&&(this.fillStyle=g.pull("Color",0,0,0)),typeof this.strokeStyle>"u"&&(this.strokeStyle=g.pull("Color",0,0,0)),typeof i.fillStyle<"u"&&(i.fillStyle instanceof nt?this.fillStyle.copy(i.fillStyle):this.fillStyle.parseCSS(i.fillStyle)),typeof i.strokeStyle<"u"&&(i.strokeStyle instanceof nt?this.strokeStyle.copy(i.strokeStyle):this.strokeStyle.parseCSS(i.strokeStyle)),this.lineWidth=i.lineWidth||0,this.textAlign=i.textAlign||"left",this.textBaseline=i.textBaseline||"top",this.lineHeight=i.lineHeight||1,this.wordWrapWidth=i.wordWrapWidth||-1,this.fontSize=10,typeof i.anchorPoint<"u"?this.anchorPoint.setV(i.anchorPoint):this.anchorPoint.set(0,0),typeof i.floating<"u"&&(this.floating=!!i.floating),this.setFont(i.font,i.size),i.bold===!0&&this.bold(),i.italic===!0&&this.italic(),this.canvasTexture=g.pull("CanvasRenderTarget",2,2,{offscreenCanvas:!1}),this.metrics=new Ch(this),this.setText(i.text)}bold(){return this.font="bold "+this.font,this.isDirty=!0,this}italic(){return this.font="italic "+this.font,this.isDirty=!0,this}setFont(t,e=10){let i=t.split(",").map(r=>(r=r.trim(),/(^".*"$)|(^'.*'$)/.test(r)?r:'"'+r+'"'));if(typeof e=="number")this.fontSize=e,e+="px";else{let r=e.match(/([-+]?[\d.]*)(.*)/);this.fontSize=parseFloat(r[1]),r[2]?this.fontSize*=t_[J0.indexOf(r[2])]:e+="px"}return this.height=this.fontSize,this.font=e+" "+i.join(","),this.isDirty=!0,this}setText(t=""){let e=this.getBounds();this._text.toString()!==t.toString()&&(Array.isArray(t)?this._text=t:this._text=(""+t).split(`
`)),this._text.length>0&&this.wordWrapWidth>0&&(this._text=this.metrics.wordWrap(this._text,this.wordWrapWidth,this.canvasTexture.context)),e.addBounds(this.metrics.measureText(this._text,this.canvasTexture.context),!0);let i=Math.ceil(this.metrics.width),r=Math.ceil(this.metrics.height);return U.WebGLVersion===1&&(i=In(this.metrics.width),r=In(this.metrics.height)),this.canvasTexture.invalidate(U),(this.canvasTexture.width<i||this.canvasTexture.height<r)&&this.canvasTexture.resize(i,r),this.canvasTexture.clear(),this._drawFont(this.canvasTexture.context,this._text,this.pos.x-this.metrics.x,this.pos.y-this.metrics.y),this.isDirty=!0,this}measureText(t,e=this._text){return this.metrics.measureText(e,this.canvasTexture.context)}draw(t,e,i=this.pos.x,r=this.pos.y){typeof this.ancestor>"u"&&((this.pos.x!==i||this.pos.y!==r)&&(this.pos.x=i,this.pos.y=r,this.isDirty=!0),this.setText(e),t.save(),t.setGlobalAlpha(t.globalAlpha()*this.getOpacity())),i=this.metrics.x,r=this.metrics.y,t.settings.subPixel===!1&&(i=~~i,r=~~r),t.drawImage(this.canvasTexture.canvas,i,r),typeof this.ancestor>"u"&&t.restore()}drawStroke(t,e,i,r){this.draw(t,e,i,r)}_drawFont(t,e,i,r){hr(t,this);for(let n=0;n<e.length;n++){const o=e[n].trimEnd();this.fillStyle.alpha>0&&t.fillText(o,i,r),this.lineWidth>0&&this.strokeStyle.alpha>0&&t.strokeText(o,i,r),r+=this.metrics.lineHeight()}return this.metrics}destroy(){typeof U.gl<"u"&&(U.setCompositor("quad"),U.currentCompositor.deleteTexture2D(U.currentCompositor.getTexture2D(this.glTextureUnit)),this.glTextureUnit=void 0),U.cache.delete(this.canvasTexture.canvas),g.push(this.canvasTexture),this.canvasTexture=void 0,g.push(this.fillStyle),g.push(this.strokeStyle),this.fillStyle=this.strokeStyle=void 0,this.metrics=void 0,this._text.length=0,super.destroy()}}class Ch extends ut{constructor(t){super(),this.ancestor=t,this.setMinMax(0,0,0,0)}lineHeight(){return this.ancestor instanceof bi?this.ancestor.fontSize*this.ancestor.lineHeight:this.ancestor.fontData.capHeight*this.ancestor.lineHeight*this.ancestor.fontScale.y}lineWidth(t,e){if(this.ancestor instanceof bi)return e.measureText(t).width;{let i=t.split("");const r=i.length;let n=0,o=null;for(let h=0;h<r;h++){let l=i[h].charCodeAt(0),f=this.ancestor.fontData.glyphs[l];if(typeof f<"u"){let d=o&&o.kerning?o.getKerning(l):0;n+=(f.xadvance+d)*this.ancestor.fontScale.x,o=f}}return n}}measureText(t,e){let i;Array.isArray(t)?i=t:i=(""+t).split(`
`),typeof e<"u"&&(e.save(),hr(e,this.ancestor)),this.width=this.height=0;for(let r=0;r<i.length;r++)this.width=Math.max(this.lineWidth(i[r].trimEnd(),e),this.width),this.height+=this.lineHeight();return this.width=Math.ceil(this.width),this.height=Math.ceil(this.height),this.x=Math.floor(this.ancestor.textAlign==="right"?this.ancestor.pos.x-this.width:this.ancestor.textAlign==="center"?this.ancestor.pos.x-this.width/2:this.ancestor.pos.x),this.y=Math.floor(this.ancestor.textBaseline.search(/^(top|hanging)$/)===0?this.ancestor.pos.y:this.ancestor.textBaseline==="middle"?this.ancestor.pos.y-this.lineHeight()/2:this.ancestor.pos.y-this.lineHeight()),typeof e<"u"&&e.restore(),this}wordWrap(t,e,i){let r,n="",o=[];Array.isArray(t)&&(t=t.join(" ")),r=t.replace(/[\r\n]+/g," ").split(" "),typeof i<"u"&&(i.save(),hr(i,this.ancestor));for(let h=0;h<r.length;h++){let l=r[h];this.lineWidth(n+l+" ",i)<e?n+=l+" ":(o.push(n+`
`),n=l+" ")}return o.push(n),typeof i<"u"&&i.restore(),o}}class Oo extends W{constructor(t,e,i){super(t,e,i.width||0,i.height||0),this.textAlign=i.textAlign||"left",this.textBaseline=i.textBaseline||"top",this.lineHeight=i.lineHeight||1,this.wordWrapWidth=i.wordWrapWidth||-1,this._text=[],this.fontScale=g.pull("Vector2d",1,1),this.fontImage=typeof i.font=="object"?i.font:Et(i.font),typeof i.fontData!="string"?this.fontData=g.pull("BitmapTextData",nr(i.font)):this.fontData=g.pull("BitmapTextData",i.fontData.includes("info face")?i.fontData:nr(i.fontData)),typeof i.floating<"u"&&(this.floating=!!i.floating),typeof i.fillStyle<"u"&&(this.fillStyle=i.fillStyle),typeof i.anchorPoint<"u"?this.anchorPoint.set(i.anchorPoint.x,i.anchorPoint.y):this.anchorPoint.set(0,0),this.metrics=new Ch(this),typeof i.size=="number"&&i.size!==1&&this.resize(i.size),this.setText(i.text)}set(t,e){return this.textAlign=t,e&&this.resize(e),this.isDirty=!0,this}setText(t=""){return this._text.toString()!==t.toString()&&(Array.isArray(t)?this._text=t:this._text=(""+t).split(`
`),this.isDirty=!0),this._text.length>0&&this.wordWrapWidth>0&&(this._text=this.metrics.wordWrap(this._text,this.wordWrapWidth)),this.updateBounds(),this}updateBounds(t=!0){let e=this.getBounds();if(e.clear(),typeof this.metrics<"u"){let i,r;switch(e.addBounds(this.metrics.measureText(this._text)),this.textAlign){case"right":i=this.metrics.width*1;break;case"center":i=this.metrics.width*.5;break;default:i=0;break}switch(this.textBaseline){case"middle":r=this.metrics.height*.5;break;case"ideographic":case"alphabetic":case"bottom":r=this.metrics.height*1;break;default:r=0;break}e.translate(i,r)}return t===!0&&typeof this.ancestor<"u"&&typeof this.ancestor.getAbsolutePosition=="function"&&this.floating!==!0&&e.translate(this.ancestor.getAbsolutePosition()),e}get fillStyle(){return this.tint}set fillStyle(t){t instanceof nt?this.tint.copy(t):this.tint.parseCSS(t)}resize(t){return this.fontScale.set(t,t),this.updateBounds(),this.isDirty=!0,this}measureText(t=this._text){return this.metrics.measureText(t)}draw(t,e,i,r){let n=t.globalAlpha();typeof this.ancestor>"u"?(this.setText(e),t.setGlobalAlpha(n*this.getOpacity())):(i=this.pos.x,r=this.pos.y);let o=i,h=this.metrics.lineHeight(),l=0;for(let f=0;f<this._text.length;f++){i=o;const d=this._text[f].trimEnd();let a=this.metrics.lineWidth(d);switch(this.textAlign){case"right":i-=a;break;case"center":i-=a*.5;break}switch(this.textBaseline){case"middle":r-=h*.5;break;case"ideographic":case"alphabetic":case"bottom":r-=h;break}this.isDirty===!0&&typeof this.ancestor>"u"&&(f===0&&(this.pos.y=r),l<a&&(l=a,this.pos.x=i));let u=null;for(let c=0,p=d.length;c<p;c++){let y=d.charCodeAt(c),_=this.fontData.glyphs[y];if(typeof _<"u"){let m=_.width,x=_.height,v=u&&u.kerning?u.getKerning(y):0,w=this.fontScale.x,E=this.fontScale.y;m!==0&&x!==0&&t.drawImage(this.fontImage,_.x,_.y,m,x,i+_.xoffset*w,r+_.yoffset*E,m*w,x*E),i+=(_.xadvance+v)*w,u=_}else console.warn("BitmapText: no defined Glyph in for "+String.fromCharCode(y))}r+=h}typeof this.ancestor>"u"&&t.setGlobalAlpha(n),this.isDirty=!1}destroy(){g.push(this.fontScale),this.fontScale=void 0,g.push(this.fontData),this.fontData=void 0,this._text.length=0,this.metrics=void 0,super.destroy()}}class Lo extends Ct{constructor(t,e,i){super(t,e,i),this.name=i.name,this.type=i.type,this.id=i.id;let r=i.shapes;typeof r>"u"&&(r=g.pull("Polygon",0,0,[g.pull("Vector2d",0,0),g.pull("Vector2d",this.width,0),g.pull("Vector2d",this.width,this.height)])),this.body=new yt(this,r),this.body.collisionType=lt.types.COLLECTABLE_OBJECT,this.body.setCollisionMask(lt.types.PLAYER_OBJECT),this.body.setStatic(!0),i.anchorPoint?this.anchorPoint.set(i.anchorPoint.x,i.anchorPoint.y):this.anchorPoint.set(0,0)}}class Bo extends W{constructor(t,e,i){super(t,e,i.width||0,i.height||0),this.anchorPoint.set(0,0),this.fade=i.fade,this.duration=i.duration,this.fading=!1,this.name="Trigger",this.type=i.type,this.id=i.id,this.gotolevel=i.to,this.triggerSettings={event:"level"},["type","container","onLoaded","flatten","setViewportBounds","to"].forEach(n=>{typeof i[n]<"u"&&(this.triggerSettings[n]=i[n])});let r=i.shapes;typeof r>"u"&&(r=g.pull("Polygon",0,0,[g.pull("Vector2d",0,0),g.pull("Vector2d",this.width,0),g.pull("Vector2d",this.width,this.height)])),this.body=new yt(this,r),this.body.collisionType=lt.types.ACTION_OBJECT,this.body.setCollisionMask(lt.types.PLAYER_OBJECT),this.body.setStatic(!0),this.resize(this.body.getBounds().width,this.body.getBounds().height)}getTriggerSettings(){let t=this.ancestor.getRootAncestor();return typeof this.triggerSettings.container=="string"&&(this.triggerSettings.container=t.getChildByName(this.triggerSettings.container)[0]),this.triggerSettings}onFadeComplete(){let t=this.ancestor.getRootAncestor();Ne.load(this.gotolevel,this.getTriggerSettings()),t.app.viewport.fadeOut(this.fade,this.duration)}triggerEvent(){let t=this.getTriggerSettings(),e=this.ancestor.getRootAncestor();if(t.event==="level")this.gotolevel=t.to,this.fade&&this.duration?this.fading||(this.fading=!0,e.app.viewport.fadeIn(this.fade,this.duration,()=>this.onFadeComplete())):Ne.load(this.gotolevel,t);else throw new Error("Trigger invalid type")}onCollision(t,e){return this.name==="Trigger"&&this.triggerEvent.apply(this),!1}}function e_(s){let t=s.texture.context,e=s.texture.width/2,i=s.texture.height/2,r=s.radiusX,n=s.radiusY,o,h,l,f,d;s.texture.clear(),r>=n?(o=1,l=1,h=n/r,f=r/n,d=t.createRadialGradient(e,i*f,0,e,n*f,r)):(h=1,f=1,o=r/n,l=n/r,d=t.createRadialGradient(e*l,i,0,e*l,i,n)),d.addColorStop(0,s.color.toRGBA(s.intensity)),d.addColorStop(1,s.color.toRGBA(0)),t.fillStyle=d,t.setTransform(o,0,0,h,0,0),t.fillRect(0,0,s.texture.width*l,s.texture.height*f)}class Do extends W{constructor(t,e,i,r=i,n="#FFF",o=.7){super(t,e,i*2,r*2),this.color=g.pull("Color").parseCSS(n),this.radiusX=i,this.radiusY=r,this.intensity=o,this.blendMode="lighter",this.visibleArea=g.pull("Ellipse",this.centerX,this.centerY,this.width,this.height),this.texture=g.pull("CanvasRenderTarget",this.width,this.height,{offscreenCanvas:!1}),this.anchorPoint.set(0,0),e_(this)}getVisibleArea(){return this.visibleArea.setShape(this.getBounds().centerX,this.getBounds().centerY,this.width,this.height)}update(t){return!0}draw(t,e){t.drawImage(this.texture.canvas,this.getBounds().x,this.getBounds().y)}destroy(){g.push(this.color),this.color=void 0,g.push(this.texture),this.texture=void 0,g.push(this.visibleArea),this.visibleArea=void 0,super.destroy()}}const Pe=9,$o=1<<Pe;class Ph{constructor(){this.id=0,this.x=0,this.y=0,this.width=0,this.height=0,this.u=0,this.v=0,this.u2=0,this.v2=0,this.xoffset=0,this.yoffset=0,this.xadvance=0,this.fixedWidth=!1}getKerning(t){if(this.kerning){let e=this.kerning[t>>>Pe];if(e)return e[t&$o-1]||0}return 0}setKerning(t,e){this.kerning||(this.kerning={});let i=this.kerning[t>>>Pe];typeof i>"u"&&(this.kerning[t>>>Pe]={},i=this.kerning[t>>>Pe]),i[t&$o-1]=e}}const No=["M","N","B","D","C","E","F","K","A","G","H","I","J","L","O","P","Q","R","S","T","U","V","W","X","Y","Z"];function ko(s,t){let e=s.match(t);if(!e)throw new Error("Could not find pattern "+t+" in string: "+s);return e[0].split("=")[1]}function i_(s){let t=Object.keys(s);for(let e=0;e<t.length;e++)if(t[e]>32)return s[t[e]];return null}function s_(s){let t=32,e=s[t];e||(e=new Ph,e.id=t,e.xadvance=i_(s).xadvance,s[t]=e)}class Fo{constructor(t){this.onResetEvent(t)}onResetEvent(t){this.padTop=0,this.padRight=0,this.padBottom=0,this.padLeft=0,this.lineHeight=0,this.capHeight=1,this.descent=0,this.glyphs={},this.parse(t)}parse(t){if(!t)throw new Error("File containing font data was empty, cannot load the bitmap font.");let e=t.split(/\r\n|\n/),i=t.match(/padding\=\d+,\d+,\d+,\d+/g);if(!i)throw new Error("Padding not found in first line");let r=i[0].split("=")[1].split(",");this.padTop=parseFloat(r[0]),this.padLeft=parseFloat(r[1]),this.padBottom=parseFloat(r[2]),this.padRight=parseFloat(r[3]),this.lineHeight=parseFloat(ko(e[1],/lineHeight\=\d+/g));let n=parseFloat(ko(e[1],/base\=\d+/g)),o=this.padTop+this.padBottom,h=null;for(let f=4;f<e.length;f++){let d=e[f],a=d.split(/=|\s+/);if(!(!d||/^kernings/.test(d)))if(/^kerning\s/.test(d)){let u=parseFloat(a[2]),c=parseFloat(a[4]),p=parseFloat(a[6]);h=this.glyphs[u],h!==null&&typeof h<"u"&&h.setKerning(c,p)}else{h=new Ph;let u=parseFloat(a[2]);h.id=u,h.x=parseFloat(a[4]),h.y=parseFloat(a[6]),h.width=parseFloat(a[8]),h.height=parseFloat(a[10]),h.xoffset=parseFloat(a[12]),h.yoffset=parseFloat(a[14]),h.xadvance=parseFloat(a[16]),h.width>0&&h.height>0&&(this.descent=Math.min(n+h.yoffset,this.descent)),this.glyphs[u]=h}}this.descent+=this.padBottom,s_(this.glyphs);let l=null;for(let f=0;f<No.length;f++){let d=No[f];if(l=this.glyphs[d.charCodeAt(0)],l)break}if(l)this.capHeight=l.height;else for(let f in this.glyphs)if(this.glyphs.hasOwnProperty(f)){if(h=this.glyphs[f],h.height===0||h.width===0)continue;this.capHeight=Math.max(this.capHeight,h.height)}this.capHeight-=o}}const lr=-1,r_=0,ur=1;let $=[];for(let s=0;s<10;s++)$.push(new M);let Xt=[];for(let s=0;s<5;s++)Xt.push([]);function Vo(s,t,e){let i=Number.MAX_VALUE,r=-Number.MAX_VALUE,n=s.length;for(let o=0;o<n;o++){const h=s[o].dot(t);h<i&&(i=h),h>r&&(r=h)}e[0]=i,e[1]=r}function Uo(s,t,e,i,r,n){let o=Xt.pop(),h=Xt.pop(),l=$.pop().copy(t).sub(s),f=l.dot(r);if(Vo(e,r,o),Vo(i,r,h),h[0]+=f,h[1]+=f,o[0]>h[1]||h[0]>o[1])return $.push(l),Xt.push(o),Xt.push(h),!0;if(n){let d=0;if(o[0]<h[0])if(n.aInB=!1,o[1]<h[1])d=o[1]-h[0],n.bInA=!1;else{let u=o[1]-h[0],c=h[1]-o[0];d=u<c?u:-c}else if(n.bInA=!1,o[1]>h[1])d=o[0]-h[1],n.aInB=!1;else{let u=o[1]-h[0],c=h[1]-o[0];d=u<c?u:-c}let a=Math.abs(d);a<n.overlap&&(n.overlap=a,n.overlapN.copy(r),d<0&&n.overlapN.negateSelf())}return $.push(l),Xt.push(o),Xt.push(h),!1}function ws(s,t){let e=s.length2(),i=t.dot(s);return i<0?lr:i>e?ur:r_}function n_(s,t,e,i,r){let n=t.points,o=t.normals,h=o.length,l=i.points,f=i.normals,d=f.length,a=$.pop().copy(s.pos).add(s.ancestor.getAbsolutePosition()).add(t.pos),u=$.pop().copy(e.pos).add(e.ancestor.getAbsolutePosition()).add(i.pos);for(let c=0;c<h;c++)if(Uo(a,u,n,l,o[c],r))return $.push(a),$.push(u),!1;for(let c=0;c<d;c++)if(Uo(a,u,n,l,f[c],r))return $.push(a),$.push(u),!1;return r&&(r.a=s,r.b=e,r.overlapV.copy(r.overlapN).scale(r.overlap)),$.push(a),$.push(u),!0}function o_(s,t,e,i,r){let n=$.pop().copy(e.pos).add(e.ancestor.getAbsolutePosition()).add(i.pos).sub(s.pos).add(s.ancestor.getAbsolutePosition()).sub(t.pos),o=t.radius,h=i.radius,l=o+h,f=l*l,d=n.length2();if(d>f)return $.push(n),!1;if(r){let a=Math.sqrt(d);r.a=s,r.b=e,r.overlap=l-a,r.overlapN.copy(n.normalize()),r.overlapV.copy(n).scale(r.overlap),r.aInB=o<=h&&a<=h-o,r.bInA=h<=o&&a<=o-h}return $.push(n),!0}function Ih(s,t,e,i,r){let n=$.pop().copy(e.pos).add(e.ancestor.getAbsolutePosition()).add(i.pos).sub(s.pos).add(s.ancestor.getAbsolutePosition()).sub(t.pos),o=i.radius,h=o*o,l=t.points,f=t.edges,d=f.length,a=$.pop(),u=$.pop(),c=$.pop(),p=0;for(let y=0;y<d;y++){const _=y===d-1?0:y+1,m=y===0?d-1:y-1;let x=0,v=null;a.copy(f[y]),c.copy(n).sub(l[y]),r&&c.length2()>h&&(r.aInB=!1);let w=ws(a,c),E=!0;if(w===lr){let A=null;if(d>1&&(a.copy(f[m]),A=$.pop().copy(n).sub(l[m]),w=ws(a,A),w!==ur&&(E=!1)),E){if(p=c.length(),p>o)return $.push(n),$.push(a),$.push(u),$.push(c),A&&$.push(A),!1;r&&(r.bInA=!1,v=c.normalize(),x=o-p)}A&&$.push(A)}else if(w===ur){if(d>1&&(a.copy(f[_]),c.copy(n).sub(l[_]),w=ws(a,c),w!==lr&&(E=!1)),E){if(p=c.length(),p>o)return $.push(n),$.push(a),$.push(u),$.push(c),!1;r&&(r.bInA=!1,v=c.normalize(),x=o-p)}}else{u.copy(t.normals[y]),p=c.dot(u);let A=Math.abs(p);if((d===1||p>0)&&A>o)return $.push(n),$.push(a),$.push(u),$.push(c),!1;r&&(v=u,x=o-p,(p>=0||x<2*o)&&(r.bInA=!1))}v&&r&&Math.abs(x)<Math.abs(r.overlap)&&(r.overlap=x,r.overlapN.copy(v))}return r&&(r.a=s,r.b=e,r.overlapV.copy(r.overlapN).scale(r.overlap)),$.push(n),$.push(a),$.push(u),$.push(c),!0}function a_(s,t,e,i,r){let n=Ih(e,i,s,t,r);if(n&&r){let o=r.a,h=r.aInB;r.overlapN.negateSelf(),r.overlapV.negateSelf(),r.a=r.b,r.b=o,r.aInB=r.bInA,r.bInA=h}return n}var zo={__proto__:null,testEllipseEllipse:o_,testEllipsePolygon:a_,testPolygonEllipse:Ih,testPolygonPolygon:n_};class h_{constructor(){this.a=null,this.b=null,this.overlapN=new M,this.overlapV=new M,this.aInB=!0,this.bInA=!0,this.indexShapeA=-1,this.indexShapeB=-1,this.overlap=Number.MAX_VALUE}clear(){return this.aInB=!0,this.bInA=!0,this.overlap=Number.MAX_VALUE,this.indexShapeA=-1,this.indexShapeB=-1,this}}let l_={pos:new M(0,0),ancestor:{_absPos:new M(0,0),getAbsolutePosition:function(){return this._absPos}}},bs=new ut,Ts=new ut;class u_{constructor(t){this.world=t,this.response=new h_}shouldCollide(t,e){let i=t.body,r=e.body;return typeof i=="object"&&typeof r=="object"&&t!==e&&t.isKinematic!==!0&&e.isKinematic!==!0&&i.shapes.length>0&&r.shapes.length>0&&!(i.isStatic===!0&&r.isStatic===!0)&&(i.collisionMask&r.collisionType)!==0&&(i.collisionType&r.collisionMask)!==0}collides(t,e,i=this.response){for(let r=t.shapes.length,n;r--,n=t.shapes[r];)for(let o=e.shapes.length,h;o--,h=e.shapes[o];)if(zo["test"+n.type+h.type].call(this,t.ancestor,n,e.ancestor,h,i.clear())===!0)return i.indexShapeA=r,i.indexShapeB=o,!0;return!1}collisions(t){let e=0,i=this.world.broadphase.retrieve(t);return bs.addBounds(t.getBounds(),!0),bs.addBounds(t.body.getBounds()),i.forEach(r=>{this.shouldCollide(t,r)&&(Ts.addBounds(r.getBounds(),!0),Ts.addBounds(r.body.getBounds()),bs.overlaps(Ts)&&this.collides(t.body,r.body)&&(e++,t.onCollision&&t.onCollision(this.response,r)!==!1&&t.body.isStatic===!1&&t.body.respondToCollision.call(t.body,this.response),r.onCollision&&r.onCollision(this.response,t)!==!1&&r.body.isStatic===!1&&r.body.respondToCollision.call(r.body,this.response)))}),e>0}rayCast(t,e=[]){let i=0,r=this.world.broadphase.retrieve(t);for(let n=r.length,o;n--,o=r[n];)if(o.body&&t.getBounds().overlaps(o.getBounds())){const h=o.body.shapes.length;if(o.body.shapes.length===0)continue;let l=t,f=0;do{let d=o.body.getShape(f);zo["test"+l.type+d.type].call(this,l_,l,o,d)&&(e[i]=o,i++),f++}while(f<h)}return e.length=i,e}}class f_ extends dt{constructor(t=0,e=0,i=1/0,r=1/0){super(t,e,i,r,!0),this.name="rootContainer",this.anchorPoint.set(0,0),this.app=void 0,this.physic="builtin",this.fps=60,this.gravity=new M(0,.98),this.preRender=!1,this.bodies=new Set,this.broadphase=new Fa(this,this.getBounds().clone(),lt.maxChildren,lt.maxDepth),this.detector=new u_(this),F(ze,this.reset,this),F(gi,()=>{this.broadphase.clear(this.getBounds())})}reset(){this.broadphase.clear(),this.anchorPoint.set(0,0),super.reset(),this.bodies.clear()}addBody(t){return this.physic==="builtin"&&this.bodies.add(t),this}removeBody(t){return this.physic==="builtin"&&this.bodies.delete(t),this}bodyApplyGravity(t){if(!t.ignoreGravity&&t.gravityScale!==0){let e=this.gravity;t.force.x+=t.mass*e.x*t.gravityScale,t.force.y+=t.mass*e.y*t.gravityScale}}update(t){return(this.physic==="builtin"||Tp()===!0)&&(this.broadphase.clear(),this.broadphase.insertContainer(this)),this.step(t),super.update(t)}step(t){if(this.physic==="builtin"){let e=j.isPaused();this.bodies.forEach(i=>{if(!i.isStatic){let r=i.ancestor;!(e&&!r.updateWhenPaused)&&(r.inViewport||r.alwaysUpdate)&&(this.bodyApplyGravity(i),i.update(t)===!0&&(r.isDirty=!0),this.detector.collisions(r),i.force.set(0,0))}})}B(Rd,t)}}class Go extends W{constructor(t){super(t.getRandomPointX(),t.getRandomPointY(),t.settings.image.width,t.settings.image.height),this.onResetEvent(t,!0)}onResetEvent(t,e=!1){e===!1?(this.pos.set(t.getRandomPointX(),t.getRandomPointY()),this.resize(t.settings.image.width,t.settings.image.height),this.currentTransform.identity()):this.vel=g.pull("Vector2d"),this.image=t.settings.image,this.alwaysUpdate=!0,typeof t.settings.tint=="string"&&this.tint.parseCSS(t.settings.tint),t.settings.textureAdditive===!0&&(this.blendMode="additive"),t.settings.blendMode!=="normal"&&(this.blendMode=t.settings.blendMode);let i=t.settings.angle+(t.settings.angleVariation>0?(ae(0,2)-1)*t.settings.angleVariation:0),r=t.settings.speed+(t.settings.speedVariation>0?(ae(0,2)-1)*t.settings.speedVariation:0);this.vel.set(r*Math.cos(i),-r*Math.sin(i)),this.life=ae(t.settings.minLife,t.settings.maxLife),this.startLife=this.life,this.startScale=C(ae(t.settings.minStartScale,t.settings.maxStartScale),t.settings.minStartScale,t.settings.maxStartScale),this.endScale=C(ae(t.settings.minEndScale,t.settings.maxEndScale),t.settings.minEndScale,t.settings.maxEndScale),this.gravity=t.settings.gravity,this.wind=t.settings.wind,this.followTrajectory=t.settings.followTrajectory,this.onlyInViewport=t.settings.onlyInViewport,this._deltaInv=ht.maxfps/1e3,t.settings.followTrajectory||(this.angle=ae(t.settings.minRotation,t.settings.maxRotation))}update(t){let e=t*this._deltaInv;if(this.life=this.life>t?this.life-t:0,this.life<=0)return this.ancestor.removeChild(this),!1;let i=this.life/this.startLife,r=this.startScale;this.startScale>this.endScale?(r*=i,r=r<this.endScale?this.endScale:r):this.startScale<this.endScale&&(r/=i,r=r>this.endScale?this.endScale:r),this.alpha=i,this.vel.x+=this.wind*e,this.vel.y+=this.gravity*e;let n=this.followTrajectory?Math.atan2(this.vel.y,this.vel.x):this.angle;return this.pos.x+=this.vel.x*e,this.pos.y+=this.vel.y*e,this.currentTransform.setTransform(r,0,0,0,r,0,this.pos.x,this.pos.y,1).rotate(n),this.isDirty=this.inViewport||!this.onlyInViewport,super.update(t)}draw(t){let e=this.width,i=this.height;t.drawImage(this.image,0,0,e,i,-e/2,-i/2,e,i)}}class jo extends W{constructor(t,e,i){if(typeof i.width!="number"||typeof i.height!="number")throw new Error("height and width properties are mandatory when passing settings parameters to an object entity");super(t,e,i.width,i.height),this.children=[],i.image&&(i.framewidth=i.framewidth||i.width,i.frameheight=i.frameheight||i.height,this.renderable=new Ct(0,0,i)),i.anchorPoint?this.anchorPoint.setMuted(i.anchorPoint.x,i.anchorPoint.y):this.anchorPoint.setMuted(0,0),typeof i.name=="string"&&(this.name=i.name),this.type=i.type||"",this.id=i.id||"",this.alive=!0,typeof i.shapes>"u"&&(i.shapes=g.pull("Polygon",0,0,[g.pull("Vector2d",0,0),g.pull("Vector2d",this.width,0),g.pull("Vector2d",this.width,this.height),g.pull("Vector2d",0,this.height)])),this.body=new yt(this,i.shapes,()=>this.onBodyUpdate()),this.width===0&&this.height===0&&this.resize(this.body.getBounds().width,this.body.getBounds().height),this.body.setCollisionMask(i.collisionMask),this.body.setCollisionType(i.collisionType),this.autoTransform=!1}get renderable(){return this.children[0]}set renderable(t){if(t instanceof W)this.children[0]=t,this.children[0].ancestor=this,this.updateBounds();else throw new Error(t+"should extend me.Renderable")}update(t){return this.renderable&&(this.isDirty|=this.renderable.update(t)),super.update(t)}updateBounds(t=!0){let e=this.getBounds();if(e.clear(),e.addFrame(0,0,this.width,this.height),this.children&&this.children.length>0&&e.addBounds(this.children[0].getBounds()),this.body&&e.addBounds(this.body.getBounds()),t===!0){let i=this.getAbsolutePosition();e.centerOn(i.x+e.x+e.width/2,i.y+e.y+e.height/2)}return e}onBodyUpdate(){this.updateBounds()}preDraw(t){t.save(),t.translate(this.pos.x+this.body.getBounds().x,this.pos.y+this.body.getBounds().y),this.renderable instanceof W&&t.translate(this.anchorPoint.x*this.body.getBounds().width,this.anchorPoint.y*this.body.getBounds().height)}draw(t,e){let i=this.renderable;i instanceof W&&(i.preDraw(t),i.draw(t,e),i.postDraw(t))}destroy(){this.renderable&&(this.renderable.destroy.apply(this.renderable,arguments),this.children.splice(0,1)),super.destroy(arguments)}onDeactivateEvent(){this.renderable&&this.renderable.onDeactivateEvent&&this.renderable.onDeactivateEvent()}}function c_(s){try{if(fp(s))return new Sh(s)}catch(t){console.log("Error creating WebGL renderer :"+t.message)}return new Gi(s)}function d_(s,t,e){let i=s.renderer,r=i.getCanvas(),n=i.getContext(),o=i.settings,h=th,l=o.zoomX=r.width*t*h,f=o.zoomY=r.height*e*h;i.scaleRatio.set(t*h,e*h),r.style.width=l/h+"px",r.style.height=f/h+"px",i.setAntiAlias(n,o.antiAlias),i.setBlendMode(o.blendMode,n),s.repaint()}function ni(s){let t=s.renderer,e=t.settings,i=e.scale,r=e.scale,n;if(e.autoScale){let o=1/0,h=1/0;if(globalThis.getComputedStyle){let a=globalThis.getComputedStyle(t.getCanvas(),null);o=parseInt(a.maxWidth,10)||1/0,h=parseInt(a.maxHeight,10)||1/0}typeof s.settings.scaleTarget<"u"?n=Pr(s.settings.scaleTarget):n=up(s.getParentElement());let l=Math.min(o,n.width),f=Math.min(h,n.height),d=l/f;if(e.scaleMethod==="fill-min"&&d>t.designRatio||e.scaleMethod==="fill-max"&&d<t.designRatio||e.scaleMethod==="flex-width"){let a=Math.min(o,e.height*d);i=r=l/a,t.resize(Math.floor(a),e.height)}else if(e.scaleMethod==="fill-min"&&d<t.designRatio||e.scaleMethod==="fill-max"&&d>t.designRatio||e.scaleMethod==="flex-height"){let a=Math.min(h,e.width*(f/l));i=r=f/a,t.resize(e.width,Math.floor(a))}else e.scaleMethod==="flex"?t.resize(Math.floor(l),Math.floor(f)):e.scaleMethod==="stretch"?(i=l/e.width,r=f/e.height):d<t.designRatio?i=r=l/e.width:i=r=f/e.height}d_(s,i,r)}function p_(s){let t=s.renderer.type,e=typeof s.renderer.GPURenderer=="string"?" ("+s.renderer.GPURenderer+")":"",i=t.includes("WebGL")&&s.renderer.depthTest==="z-buffer"?"Depth Test | ":"",r=ip?"Web Audio":"HTML5 Audio";console.log(t+" renderer"+e+" | "+i+r+" | pixel ratio "+th+" | "+(Hs.nodeJS?"node.js":Hs.isMobile?"mobile":"desktop")+" | "+hp()+" | "+np),console.log("resolution: requested "+s.settings.width+"x"+s.settings.height+", got "+s.renderer.width+"x"+s.renderer.height)}class g_{constructor(t,e,i){this.parentElement=void 0,this.renderer=void 0,this.viewport=void 0,this.world=void 0,this.mergeGroup=!0,this.lastUpdate=0,this.isInitialized=!1,this.settings=void 0,this.pauseOnBlur=!0,this.resumeOnFocus=!0,this.stopOnBlur=!1,this.isDirty=!0,this.isAlwaysDirty=!1,this.frameCounter=0,this.frameRate=1,this.accumulator=0,this.accumulatorMax=0,this.accumulatorUpdateDelta=0,this.stepSize=1e3/60,this.updateDelta=0,this.lastUpdateStart=null,this.updateAverageDelta=0,i.legacy!==!0&&this.init(t,e,i)}init(t,e,i){this.settings=Object.assign(eh,i||{}),this.settings.width=t,this.settings.height=e,this.settings.transparent=!!this.settings.transparent,this.settings.antiAlias=!!this.settings.antiAlias,this.settings.failIfMajorPerformanceCaveat=!!this.settings.failIfMajorPerformanceCaveat,this.settings.depthTest=this.settings.depthTest==="z-buffer"?"z-buffer":"sorting",this.settings.subPixel=!!this.settings.subPixel,this.settings.verbose=!!this.settings.verbose,this.settings.scaleMethod.search(/^(fill-(min|max)|fit|flex(-(width|height))?|stretch)$/)!==-1?this.settings.autoScale=this.settings.scale==="auto"||!0:(this.settings.scaleMethod="fit",this.settings.autoScale=this.settings.scale==="auto"||!1);let r=gh();if(r.webgl===!0||r.webgl1===!0||r.webgl2===!0?(this.settings.renderer=Ws,r.webgl1===!0&&(this.settings.preferWebGL1=!0)):r.canvas===!0&&(this.settings.renderer=ih),this.settings.scale=this.settings.autoScale?1:+this.settings.scale||1,this.settings.zoomX=t*this.settings.scale,this.settings.zoomY=e*this.settings.scale,this.parentElement=Xs(this.settings.parent),typeof this.settings.scaleTarget<"u"&&(this.settings.scaleTarget=Xs(this.settings.scaleTarget)),typeof this.settings.renderer=="number")switch(this.settings.renderer){case sh:case Ws:this.renderer=c_(this.settings);break;default:this.renderer=new Gi(this.settings);break}else{let n=this.settings.renderer;this.renderer=new n(this.settings)}F(Ha,()=>ni(this),this),F(hi,()=>ni(this),this),this.parentElement.appendChild(this.renderer.getCanvas()),Hs.isMobile&&ap(!1),ni(this),"MutationObserver"in globalThis&&new MutationObserver(()=>ni(this)).observe(this.parentElement,{attributes:!1,childList:!0,subtree:!0}),this.settings.consoleHeader!==!1&&p_(this),this.world=new f_(0,0,this.settings.width,this.settings.height),this.world.app=this,this.world.physic=this.settings.physic,this.lastUpdate=globalThis.performance.now(),this.world.autoSort=!(this.renderer.type==="WEBGL"&&this.settings.depthTest==="z-buffer"),this.isInitialized=!0,B(Ad,this),F(Ar,this.repaint,this),F(Er,this.repaint,this),F($e,this.repaint,this),F(Ga,this.reset,this),F(za,n=>{this.update(n),this.draw()},this),F(Ns,()=>{this.stopOnBlur===!0&&j.stop(!0),this.pauseOnBlur===!0&&j.pause(!0)}),F(ks,()=>{this.stopOnBlur===!0&&j.restart(!0),this.resumeOnFocus===!0&&j.resume(!0)})}reset(){let t=j.get();typeof t<"u"&&(this.viewport=t.cameras.get("default")),B(ze),this.updateFrameRate()}get sortOn(){return this.world.sortOn}set sortOn(t){this.world.sortOn=t}onLevelLoaded(){}updateFrameRate(){this.frameCounter=0,this.frameRate=~~(.5+60/ht.maxfps),this.stepSize=1e3/this.world.fps,this.accumulator=0,this.accumulatorMax=this.stepSize*10,this.isAlwaysDirty=ht.maxfps>this.world.fps}getParentElement(){return this.parentElement}repaint(){this.isDirty=!0}update(t){if(++this.frameCounter%this.frameRate===0){for(this.frameCounter=0,B(ja,t),this.accumulator+=ht.getDelta(),this.accumulator=Math.min(this.accumulator,this.accumulatorMax),this.updateDelta=ht.interpolation?ht.getDelta():this.stepSize,this.accumulatorUpdateDelta=ht.interpolation?this.updateDelta:Math.max(this.updateDelta,this.updateAverageDelta);this.accumulator>=this.accumulatorUpdateDelta||ht.interpolation;)if(this.lastUpdateStart=globalThis.performance.now(),j.isPaused()!==!0&&B(Cd,t),this.isDirty=this.world.update(this.updateDelta),this.isDirty=j.current().update(this.updateDelta)||this.isDirty,this.lastUpdate=globalThis.performance.now(),this.updateAverageDelta=this.lastUpdate-this.lastUpdateStart,this.accumulator-=this.accumulatorUpdateDelta,ht.interpolation){this.accumulator=0;break}B(Sd,this.lastUpdate)}}draw(){this.renderer.isContextValid===!0&&(this.isDirty||this.isAlwaysDirty)&&(B(Pd,globalThis.performance.now()),this.renderer.clear(),j.current().draw(this.renderer,this.world),this.isDirty=!1,this.renderer.flush(),B(Id,globalThis.performance.now()))}}Object.defineProperty(ne.prototype,"Texture",{get:function(){return Bt("me.video.renderer.Texture","me.TextureAtlas","10.4.0"),zi}});ne.prototype.getScreenCanvas=function(){return Bt("getScreenCanvas","getCanvas","13.1.0"),this.getCanvas()};ne.prototype.getScreenContext=function(){return Bt("getScreenContext","getContext","13.1.0"),this.getContext()};ne.prototype.getWidth=function(){return Bt("getWidth","width","15.12.0"),this.width};ne.prototype.getHeight=function(){return Bt("getHeight","height","15.12.0"),this.height};Gi.prototype.setLineWidth=function(s){Bt("setLineWidth","lineWidth","17.3.0"),this.lineWidth=s};Sh.prototype.setLineWidth=function(s){Bt("setLineWidth","lineWidth","17.3.0"),this.lineWidth=s};const y_="17.4.0";let fr=!1;const N=new g_(0,0,{legacy:!0});function m_(){fr!==!0&&(console.log("melonJS 2 (v"+y_+") | http://melonjs.org"),g.register("me.Entity",jo),g.register("me.Collectable",Lo),g.register("me.Trigger",Bo),g.register("me.Light2d",Do),g.register("me.Tween",Po,!0),g.register("me.Color",nt,!0),g.register("me.Particle",Go,!0),g.register("me.Sprite",Ct),g.register("me.NineSliceSprite",Mo),g.register("me.Renderable",W),g.register("me.Text",bi,!0),g.register("me.BitmapText",Oo),g.register("me.BitmapTextData",Fo,!0),g.register("me.ImageLayer",Ro),g.register("me.ColorLayer",Io,!0),g.register("me.Vector2d",M,!0),g.register("me.Vector3d",It,!0),g.register("me.ObservableVector2d",Rt,!0),g.register("me.ObservableVector3d",Mt,!0),g.register("me.Matrix2d",Re,!0),g.register("me.Matrix3d",fi,!0),g.register("me.Rect",Ft,!0),g.register("me.RoundRect",di,!0),g.register("me.Polygon",kt,!0),g.register("me.Line",ci,!0),g.register("me.Point",De,!0),g.register("me.Ellipse",Be,!0),g.register("me.Bounds",ut,!0),g.register("Entity",jo),g.register("Collectable",Lo),g.register("Trigger",Bo),g.register("Light2d",Do),g.register("Tween",Po,!0),g.register("Color",nt,!0),g.register("Particle",Go,!0),g.register("Sprite",Ct),g.register("NineSliceSprite",Mo),g.register("Renderable",W),g.register("Text",bi,!0),g.register("BitmapText",Oo),g.register("BitmapTextData",Fo,!0),g.register("ImageLayer",Ro),g.register("ColorLayer",Io,!0),g.register("Vector2d",M,!0),g.register("Vector3d",It,!0),g.register("ObservableVector2d",Rt,!0),g.register("ObservableVector3d",Mt,!0),g.register("Matrix2d",Re,!0),g.register("Matrix3d",fi,!0),g.register("Rect",Ft,!0),g.register("RoundRect",di,!0),g.register("Polygon",kt,!0),g.register("Line",ci,!0),g.register("Point",De,!0),g.register("Ellipse",Be,!0),g.register("Bounds",ut,!0),g.register("CanvasRenderTarget",ir,!0),B(Pi),Xr(gh().nocache||!1),mp(),fr=!0)}op(()=>{m_()});class __ extends W{constructor(t){super(0,0,t.width,t.heigth),this.engine=t,this.anchorPoint.set(0,0),j.change(j.DEFAULT,!0);const e=new Array(t.count),i=[1,-1];for(let r=0;r<t.count;r++){const n=10+Math.random()*80,o=Math.random()*t.width,h=Math.random()*(t.height-n),[l,f]=[3*Math.random()*i[Math.floor(Math.random()*2)],3*Math.random()*i[Math.floor(Math.random()*2)]];let d;t.type==="sprite"&&(d=new Ct(o,h,{image:"/sprite.png",framewidth:64,frameheight:64,anchorPoint:new M(.5,.5)}),N.world.addChild(d)),e[r]={x:o,y:h,size:n,dx:l,dy:f,el:d}}t.particles=e}update(){return!0}draw(t){const e=this.engine.particles;for(let i=0;i<this.engine.count;i++){const r=e[i];r.x-=r.dx,r.y-=r.dy,r.x+r.size<0?r.dx*=-1:r.y+r.size<0&&(r.dy*=-1),r.x>this.engine.width?r.dx*=-1:r.y>this.engine.height&&(r.dy*=-1),this.engine.type==="stroke"?(t.setColor("#ffffff"),t.strokeArc(r.x,r.y,r.size,0,Math.PI*2)):this.engine.type==="fill"?(t.setColor("#ffffff"),t.fillArc(r.x,r.y,r.size,0,Math.PI*2,!1),t.setColor("#000000"),t.strokeArc(r.x,r.y,r.size,0,Math.PI*2,!1)):this.engine.type==="sprite"&&r.el&&r.el.pos.set(r.x,r.y)}this.engine.fpsmeter.tick()}}class x_ extends Rh{init(){if(super.init(),this.canvas.innerHTML="",window.cancelAnimationFrame(this.request),this.textureLoaded=!1,N.world)N.world.reset();else{const t=document.querySelector("main");t.removeChild(t.lastElementChild),kn.init(this.width,this.height,{parent:"main",renderer:kn.AUTO,preferWebGL1:!1,subPixel:!1}),N.world.backgroundColor.setColor("#1a1a1a")}F0.preload([{name:"sprite",type:"image",src:"sprite.png"}],()=>{this.textureLoaded=!0,this.render()})}render(){this.textureLoaded&&N.world.addChild(new __(this))}}document.addEventListener("DOMContentLoaded",()=>{new x_().render()});
