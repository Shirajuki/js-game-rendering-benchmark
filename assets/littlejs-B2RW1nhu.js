import{E as It}from"./engine-4ZHbU-ty.js";let z=0;const Rt=0;function q(i){return Math.abs(i)}function j(i,t){return Math.min(i,t)}function Dt(i){return Math.sign(i)}function Z(i,t=1){return(i%t+t)%t}function f(i,t=0,e=1){return i<t?t:i>e?e:i}function k(i,t,e){return(e-=t)?f((i-t)/e):0}function Nt(i,t,e){return t+f(i)*(e-t)}function _(i=1,t=0){return t+Math.random()*(i-t)}function u(i=0,t){return typeof i=="number"?new x(i,t??i):new x(i.x,i.y)}class x{constructor(t=0,e=0){this.x=t,this.y=e,this.isValid()}set(t=0,e=0){return this.x=t,this.y=e,this.isValid(),this}copy(){return new x(this.x,this.y)}add(t){return new x(this.x+t.x,this.y+t.y)}subtract(t){return new x(this.x-t.x,this.y-t.y)}multiply(t){return new x(this.x*t.x,this.y*t.y)}divide(t){return new x(this.x/t.x,this.y/t.y)}scale(t){return new x(this.x*t,this.y*t)}length(){return this.lengthSquared()**.5}lengthSquared(){return this.x**2+this.y**2}distance(t){return this.distanceSquared(t)**.5}distanceSquared(t){return(this.x-t.x)**2+(this.y-t.y)**2}normalize(t=1){const e=this.length();return e?this.scale(t/e):new x(0,t)}clampLength(t=1){const e=this.length();return e>t?this.scale(t/e):this}dot(t){return this.x*t.x+this.y*t.y}cross(t){return this.x*t.y-this.y*t.x}angle(){return Math.atan2(this.x,this.y)}setAngle(t=0,e=1){return this.x=e*Math.sin(t),this.y=e*Math.cos(t),this}rotate(t){const e=Math.cos(-t);return t=Math.sin(-t),new x(this.x*e-this.y*t,this.x*t+this.y*e)}setDirection(t,e=1){return t=Z(t,4),u(t%2?t-1?-e:e:0,t%2?0:t?-e:e)}direction(){return q(this.x)>q(this.y)?0>this.x?3:1:0>this.y?2:0}invert(){return new x(this.y,-this.x)}floor(){return new x(Math.floor(this.x),Math.floor(this.y))}area(){return q(this.x*this.y)}lerp(t,e){return this.add(t.subtract(this).scale(f(e)))}arrayCheck(t){return 0<=this.x&&0<=this.y&&this.x<t.x&&this.y<t.y}toString(t=3){}isValid(){return typeof this.x=="number"&&!isNaN(this.x)&&typeof this.y=="number"&&!isNaN(this.y)}}function v(i,t,e,n){return new m(i,t,e,n)}class m{constructor(t=1,e=1,n=1,r=1){this.r=t,this.g=e,this.b=n,this.a=r,this.isValid()}set(t=1,e=1,n=1,r=1){return this.r=t,this.g=e,this.b=n,this.a=r,this.isValid(),this}copy(){return new m(this.r,this.g,this.b,this.a)}add(t){return new m(this.r+t.r,this.g+t.g,this.b+t.b,this.a+t.a)}subtract(t){return new m(this.r-t.r,this.g-t.g,this.b-t.b,this.a-t.a)}multiply(t){return new m(this.r*t.r,this.g*t.g,this.b*t.b,this.a*t.a)}divide(t){return new m(this.r/t.r,this.g/t.g,this.b/t.b,this.a/t.a)}scale(t,e=t){return new m(this.r*t,this.g*t,this.b*t,this.a*e)}clamp(){return new m(f(this.r),f(this.g),f(this.b),f(this.a))}lerp(t,e){return this.add(t.subtract(this).scale(f(e)))}setHSLA(t=0,e=0,n=1,r=1){t=Z(t,1),e=f(e),n=f(n),e=.5>n?n*(1+e):n+e-n*e,n=2*n-e;const o=(h,d,a)=>1>6*(a=Z(a,1))?h+6*(d-h)*a:1>2*a?d:2>3*a?h+(d-h)*(4-6*a):h;return this.r=o(n,e,t+1/3),this.g=o(n,e,t),this.b=o(n,e,t-1/3),this.a=r,this.isValid(),this}HSLA(){const t=f(this.r),e=f(this.g),n=f(this.b),r=f(this.a),o=Math.max(t,e,n),h=Math.min(t,e,n),d=(o+h)/2;let a=0,w=0;if(o!=h){let g=o-h;w=.5<d?g/(2-o-h):g/(o+h),t==o?a=(e-n)/g+(e<n?6:0):e==o?a=(n-t)/g+2:n==o&&(a=(t-e)/g+4)}return[a/6,w,d,r]}mutate(t=.05,e=0){return new m(this.r+_(t,-t),this.g+_(t,-t),this.b+_(t,-t),this.a+_(e,-e)).clamp()}toString(t=!0){const e=n=>(16>(n=255*f(n)|0)?"0":"")+n.toString(16);return"#"+e(this.r)+e(this.g)+e(this.b)+(t?e(this.a):"")}setHex(t){return typeof t=="string"&&t[0]=="#",[4,5,7,9].includes(t.length),6>t.length?(this.r=f(parseInt(t[1],16)/15),this.g=f(parseInt(t[2],16)/15),this.b=f(parseInt(t[3],16)/15),this.a=t.length==5?f(parseInt(t[4],16)/15):1):(this.r=f(parseInt(t.slice(1,3),16)/255),this.g=f(parseInt(t.slice(3,5),16)/255),this.b=f(parseInt(t.slice(5,7),16)/255),this.a=t.length==9?f(parseInt(t.slice(7,9),16)/255):1),this.isValid(),this}rgbaInt(){const t=255*f(this.r)|0,e=255*f(this.g)<<8,n=255*f(this.b)<<16,r=255*f(this.a)<<24;return t+e+n+r}isValid(){return typeof this.r=="number"&&!isNaN(this.r)&&typeof this.g=="number"&&!isNaN(this.g)&&typeof this.b=="number"&&!isNaN(this.b)&&typeof this.a=="number"&&!isNaN(this.a)}}const rt=v(),bt=v(0,0,0);v(.5,.5,.5);v(1,0,0);v(1,.5,0);v(1,1,0);v(0,1,0);v(0,1,1);v(0,0,1);v(.5,0,1);v(1,0,1);let B=u(),S=32,ot=u(1920,1080),G=u(),Ct=!0,gt=u(16),L=0,Ut=!0,Ft=!1,Bt=.3;u(640,80);function Mt(i){B=i}function Lt(i){S=i}function Pt(i){G=i}function zt(i){z=i}let c,F,b,R,U=u(),M=[],Y;function _t(i=u(),t=gt,e=0,n=0){typeof t=="number"&&(t=u(t));var r=M[e];const o=t.add(u(2*n));return typeof i=="number"&&(r=r.size.x/o.x|0,i=0<r?u(i%r,i/r|0):u()),i=u(i.x*o.x+n,i.y*o.y+n),new it(i,t,e,n)}class it{constructor(t=u(),e=gt,n=0,r=0){this.pos=t.copy(),this.size=e.copy(),this.textureIndex=n,this.padding=r}offset(t){return new it(this.pos.add(t),this.size,this.textureIndex)}frame(t){return this.offset(u(t*(this.size.x+2*this.padding),0))}getTextureInfo(){return M[this.textureIndex]}}class ht{constructor(t){this.image=t,this.size=u(t.width,t.height),this.glTexture=ee(t)}}function ft(i){return new x((i.x-U.x/2+.5)/S+B.x,(i.y-U.y/2+.5)/-S+B.y)}function mt(i){return new x((i.x-B.x)*S+U.x/2-.5,(i.y-B.y)*-S+U.y/2-.5)}function Gt(i,t=u(1),e,n=new m,r=0,o,h=new m(0,0,0,0),d=Ct,a,w){const g=e&&e.getTextureInfo();if(d)if(a&&(i=ft(i),t=t.scale(1/S)),g){var l=u(1).divide(g.size);d=e.pos.x*l.x,a=e.pos.y*l.y,w=e.size.x*l.x;const y=e.size.y*l.y;l=l.scale(L),$t(g.glTexture),ct(i.x,i.y,t.x,t.y,r,d+l.x,a+l.y,d-l.x+w,a-l.y+y,n.rgbaInt(),h.rgbaInt())}else ct(i.x,i.y,t.x,t.y,r,0,0,0,0,0,n.rgbaInt());else z&&++Y,t=u(t.x,-t.y),kt(i,t,r,o,y=>{if(g){const E=e.pos.x+L,K=e.pos.y+L,St=e.size.x-2*L,At=e.size.y-2*L;y.globalAlpha=n.a,y.drawImage(g.image,E,K,St,At,-.5,-.5,1,1),y.globalAlpha=1}else y.fillStyle=n.toString(),y.fillRect(-.5,-.5,1,1)},a,w)}function Ot(i,t=1,e=1,n=0,r=new m,o=0,h=new m(0,0,0),d,a=F){i=mt(i),t*=S,e*=S,o*=S,a.fillStyle=r.toString(),a.beginPath(),a.ellipse(i.x,i.y,t,e,n,0,9),a.fill(),o&&(a.strokeStyle=h.toString(),a.lineWidth=o,a.stroke())}function at(i,t=1,e=new m,n=0,r=new m(0,0,0),o,h=F){Ot(i,t,t,0,e,n,r,o,h)}function kt(i,t,e,n,r,o,h=F){o||(i=mt(i),t=t.scale(S)),h.save(),h.translate(i.x+.5,i.y+.5),h.rotate(e),h.scale(t.x,-t.y),r(h),h.restore()}function Yt(i,t=0){return p[t]&&!!(p[t][i]&1)}function pt(){p=[[]]}u();let X=u(),H=!1;function P(i,t=0){return Yt(i,t+1)}let p=[[]];function Xt(){yt||document.hasFocus()||pt(),ft(X),Kt()}function Ht(){for(const i of p)for(const t in i)i[t]&=1}function Wt(){function i(t){return t=="KeyW"?"ArrowUp":t=="KeyS"?"ArrowDown":t=="KeyA"?"ArrowLeft":t=="KeyD"?"ArrowRight":t}onkeydown=t=>{t.repeat||(H=!1,p[0][t.code]=3,p[0][i(t.code)]=3)},onkeyup=t=>{p[0][t.code]=4,p[0][i(t.code)]=4},onmousedown=t=>{N&&N.state!="running"&&N.resume(),H=!1,p[0][t.button]=3,X=Q(t),t.button&&t.preventDefault()},onmouseup=t=>p[0][t.button]=p[0][t.button]&2|4,onmousemove=t=>X=Q(t),onwheel=t=>t.ctrlKey?0:Dt(t.deltaY),oncontextmenu=t=>!1,onblur=t=>pt(),yt&&Ut&&qt()}function Q(i){const t=c.getBoundingClientRect(),e=k(i.x,t.left,t.right);return i=k(i.y,t.top,t.bottom),u(e*c.width,i*c.height)}const ut=[];function Kt(){const i=h=>{const d=a=>.3<a?k(a,.3,.8):-.3>a?-k(-a,.3,.8):0;return u(d(h.x),d(-h.y)).clampLength()};var t,e,n,r;if(navigator&&navigator.getGamepads&&document.hasFocus())for(t=navigator.getGamepads(),e=t.length;e--;){r=t[e];const h=p[e+1]||(p[e+1]=[]);if(n=ut[e]||(ut[e]=[]),r){for(var o=0;o<r.axes.length-1;o+=2)n[o>>1]=i(u(r.axes[o],r.axes[o+1]));for(o=r.buttons.length;o--;){const d=r.buttons[o],a=P(o,e);h[o]=d.pressed?a?1:3:a?4:0,H||=!e&&d.pressed}r=u((P(15,e)&&1)-(P(14,e)&&1),(P(12,e)&&1)-(P(13,e)&&1)),r.lengthSquared()&&(n[0]=r.clampLength())}}}const yt=window.ontouchstart!==void 0;function qt(){function i(n){N&&N.state!="running"&&N.resume();const r=n.touches.length;if(r){const o=u(n.touches[0].clientX,n.touches[0].clientY);X=Q(o),e?H=Ft:p[0][0]=3}else e&&(p[0][0]=p[0][0]&2|4);return e=r,document.hasFocus()&&n.preventDefault(),!0}let t=i;document.addEventListener("touchstart",n=>t(n),{passive:!1}),document.addEventListener("touchmove",n=>t(n),{passive:!1}),document.addEventListener("touchend",n=>t(n),{passive:!1}),onmousedown=onmouseup=()=>0;let e}let N=new AudioContext,V;function jt(){V=N.createGain(),V.connect(N.destination),V.gain.value=Bt}u();let I,s,Vt=!0,O,$,xt,tt,T,et,D,nt,W;const wt=1e4,Et=11,vt=4*Et,Tt=wt*vt;function Jt(){{I=document.createElement("canvas"),s=I.getContext("webgl2",{antialias:Vt});var i=c.parentElement;i.appendChild(I),O=te(`#version 300 es
precision highp float;uniform mat4 m;in vec2 g;in vec4 p,u,c,a;in float r;out vec2 v;out vec4 d,e;void main(){vec2 s=(g-.5)*p.zw;gl_Position=m*vec4(p.xy+s*cos(r)-vec2(-s.y,s)*sin(r),1,1);v=mix(u.xw,u.zy,g);d=c;e=a;}`,`#version 300 es
precision highp float;uniform sampler2D s;in vec2 v;in vec4 d,e;out vec4 c;void main(){c=texture(s,v)*d+e;}`),i=new ArrayBuffer(Tt),T=new Float32Array(i),et=new Uint32Array(i),xt=s.createBuffer(),tt=s.createBuffer(),i=new Float32Array([D=0,0,1,0,0,1,1,1]),s.bindBuffer(s.ARRAY_BUFFER,tt),s.bufferData(s.ARRAY_BUFFER,i,s.STATIC_DRAW)}}function Zt(){{Qt(),s.useProgram(O),s.activeTexture(s.TEXTURE0),M[0]&&s.bindTexture(s.TEXTURE_2D,$=M[0].glTexture);var i=nt=W=0,t=(n,r,o,h)=>{n=s.getAttribLocation(O,n);const d=o&&vt,a=o&&1,w=o==1;s.enableVertexAttribArray(n),s.vertexAttribPointer(n,h,r,w,d,i),s.vertexAttribDivisor(n,a),i+=h*o};s.bindBuffer(s.ARRAY_BUFFER,tt),t("g",s.FLOAT,0,2),s.bindBuffer(s.ARRAY_BUFFER,xt),s.bufferData(s.ARRAY_BUFFER,Tt,s.DYNAMIC_DRAW),t("p",s.FLOAT,4,4),t("u",s.FLOAT,4,4),t("c",s.UNSIGNED_BYTE,1,4),t("a",s.UNSIGNED_BYTE,1,4),t("r",s.FLOAT,4,1),t=u(2*S).divide(U);var e=u(-1).subtract(B.multiply(t));s.uniformMatrix4fv(s.getUniformLocation(O,"m"),!1,[t.x,0,0,0,0,t.y,0,0,1,1,1,1,e.x,e.y,0,0])}}function Qt(){s.viewport(0,0,I.width=c.width,I.height=c.height),s.clear(s.COLOR_BUFFER_BIT)}function $t(i){i==$||(st(),s.bindTexture(s.TEXTURE_2D,$=i))}function lt(i,t){return t=s.createShader(t),s.shaderSource(t,i),s.compileShader(t),t}function te(i,t){const e=s.createProgram();return s.attachShader(e,lt(i,s.VERTEX_SHADER)),s.attachShader(e,lt(t,s.FRAGMENT_SHADER)),s.linkProgram(e),e}function ee(i){const t=s.createTexture();return s.bindTexture(s.TEXTURE_2D,t),i&&i.width?s.texImage2D(s.TEXTURE_2D,0,s.RGBA,s.RGBA,s.UNSIGNED_BYTE,i):(i=new Uint8Array([255,255,255,255]),s.texImage2D(s.TEXTURE_2D,0,s.RGBA,1,1,0,s.RGBA,s.UNSIGNED_BYTE,i)),i=s.NEAREST,s.texParameteri(s.TEXTURE_2D,s.TEXTURE_MIN_FILTER,i),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_MAG_FILTER,i),t}function st(){if(D){var i=W?s.ONE:s.ONE_MINUS_SRC_ALPHA;s.blendFuncSeparate(s.SRC_ALPHA,i,s.ONE,i),s.enable(s.BLEND),s.bufferSubData(s.ARRAY_BUFFER,0,T),s.drawArraysInstanced(s.TRIANGLE_STRIP,0,4,D),z&&(Y+=D),D=0,W=nt}}function ie(i,t=!1){(D||t)&&(st(),!t||i.drawImage(I,0,0))}function ct(i,t,e,n,r,o,h,d,a,w,g=0){(D>=wt||W!=nt)&&st();let l=D++*Et;T[l++]=i,T[l++]=t,T[l++]=e,T[l++]=n,T[l++]=o,T[l++]=h,T[l++]=d,T[l++]=a,et[l++]=w,et[l++]=g,T[l++]=r}const ne="LittleJS",se="1.11.10",re=60;let C=[],dt=0,A=0,J=0;const oe=[],he=[];function ae(i,t,e,n,r,o=[],h=document.body){function d(g=0){var l=g-dt;dt=g,z&&(J=Nt(.05,J,1e3/(l||1))),g=Rt,A+=l,g||(A=j(A,50)),a();{for(l=0,0>A&&-9<A&&(l=A,A=0);0<=A;A-=1e3/re)Xt(),t(),oe.forEach(E=>E()),ue(),e(),Ht();A+=l}{U=u(c.width,c.height),R.imageSmoothingEnabled=F.imageSmoothingEnabled=!1,Zt(),n(),C.sort((E,K)=>E.renderOrder-K.renderOrder);for(var y of C)y.destroyed||y.render();r(),he.forEach(E=>E()),ie(F),z&&(R.textAlign="right",R.textBaseline="top",R.font="1em monospace",R.fillStyle="#000",y=ne+" v"+se+" / "+Y+" / "+C.length+" / "+J.toFixed(1)+" GL",R.fillText(y,c.width-3,3),R.fillStyle="#fff",R.fillText(y,c.width-2,2),Y=0)}requestAnimationFrame(d)}function a(){{if(G.x){c.width=G.x,c.height=G.y;const g=innerWidth/innerHeight,l=c.width/c.height;(I||c).style.width=c.style.width=b.style.width=g<l?"100%":"",(I||c).style.height=c.style.height=b.style.height=g<l?"":"100%"}else c.width=j(innerWidth,ot.x),c.height=j(innerHeight,ot.y);b.width=c.width,b.height=c.height,U=u(c.width,c.height)}}function w(){new Promise(g=>g(i())).then(d)}i||=()=>{},t||=()=>{},e||=()=>{},n||=()=>{},r||=()=>{},h.style.cssText="margin:0;overflow:hidden;width:100vw;height:100vh;display:flex;align-items:center;justify-content:center;background:#000;image-rendering:pixelated;user-select:none;-webkit-user-select:none;touch-action:none;-webkit-touch-callout:none",h.appendChild(c=document.createElement("canvas")),F=c.getContext("2d"),Wt(),jt(),Jt(),h.appendChild(b=document.createElement("canvas")),R=b.getContext("2d"),c.style.cssText=b.style.cssText="position:absolute",I&&(I.style.cssText="position:absolute"),a(),h=o.map((g,l)=>new Promise(y=>{const E=new Image;E.crossOrigin="anonymous",E.onerror=E.onload=()=>{M[l]=new ht(E),y()},E.src=g})),o.length||h.push(new Promise(g=>{M[0]=new ht(new Image),g()})),Promise.all(h).then(w)}function ue(){function i(t){if(!t.destroyed){t.update();for(const e of t.children)i(e)}}C.filter(t=>t.collideSolidObjects);for(const t of C)t.parent||(i(t),t.updateTransforms());C=C.filter(t=>!t.destroyed)}class le extends It{init(){super.init(),this.rootElement=document.getElementById("root"),this.initialized||(ae(this.gameInit.bind(this),this.gameUpdate.bind(this),this.gameUpdatePost.bind(this),this.gameRender.bind(this),this.gameRenderPost.bind(this),this.type==="sprite"?["sprite.png"]:[],this.rootElement),this.initialized=!0,this.rootElement.style.width=this.width+"px",this.rootElement.style.height=this.height+"px")}gameInit(){zt(!1),Pt(u(this.width,this.height)),Lt(1),Mt(u(this.width/2,this.height/2)),c.style.background="#1a1a1a",document.querySelectorAll("canvas:not(:first-of-type)").forEach(n=>{n.style.background="transparent"});const t=new Array(this.count),e=[1,-1];for(let n=0;n<this.count;n++){const r=10+Math.random()*80,o=Math.random()*this.width,h=Math.random()*(this.height-r),d=u(o,h),[a,w]=[3*Math.random()*e[Math.floor(Math.random()*2)],3*Math.random()*e[Math.floor(Math.random()*2)]];t[n]={pos:d,size:r,dx:a,dy:w,tile:this.type==="sprite"?_t(0,64,0):null}}this.particles=t}gameUpdate(){const t=this.particles;for(let e=0;e<this.count;e++){const n=t[e];n.pos.x-=n.dx,n.pos.y-=n.dy,n.pos.x+n.size<0?n.dx*=-1:n.pos.y+n.size<0&&(n.dy*=-1),n.pos.x>this.width?n.dx*=-1:n.pos.y>this.height&&(n.dy*=-1)}}gameUpdatePost(){}gameRender(){this.fpsmeter.tick();for(let t=0;t<this.particles.length;t++){const e=this.particles[t];this.type==="sprite"?Gt(e.pos,e.tile.size,e.tile):(this.type==="fill"&&at(e.pos,e.size,rt,1,bt),this.type!="sprite"&&at(e.pos,e.size,v(0,0,0,0),1,rt))}}gameRenderPost(){}render(){super.render()}}document.addEventListener("DOMContentLoaded",()=>{new le().render()});
